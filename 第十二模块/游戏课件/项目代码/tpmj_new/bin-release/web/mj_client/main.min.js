var __reflect=this&&this.__reflect||function(t,e,o){t.__class__=e,o?o.push(e):o=[e],t.__types__=t.__types__?o.concat(t.__types__):o},__extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onEnable,o),o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onRemove,o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){e.target instanceof eui.Button&&t.App.SoundManager.playEffect(t.SoundManager.button)},o),o}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){},o.prototype.onRemove=function(){},o.prototype.onDestroy=function(){},o.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},o}(eui.Component);t.BaseUI=e,__reflect(e.prototype,"Tpm.BaseUI")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return e.call(this)||this}return __extends(o,e),Object.defineProperty(o.prototype,"gameScene",{get:function(){return this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ctrl",{get:function(){return t.App.getController(t.GameController.NAME)},enumerable:!0,configurable:!0}),o}(t.BaseUI);t.BaseGameMod=e,__reflect(e.prototype,"Tpm.BaseGameMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.getInstance=function(){var t=this;return null==t.instance&&(t.instance=new t),t.instance},t}();t.SingleClass=e,__reflect(e.prototype,"Tpm.SingleClass")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.moduleList={},t}return __extends(o,e),o.prototype.registerController=function(t,e){this.moduleList[t]=e},o.prototype.unRegisterController=function(t){this.moduleList[t].onRemove(),delete this.moduleList[t]},o.prototype.unRegisterControllerAll=function(){for(var t in this.moduleList)this.moduleList[t].onRemove()},o.prototype.getController=function(t){return this.moduleList[t]},o.prototype.sendEvent=function(e){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];(r=t.App.EventManager).sendEvent.apply(r,[e].concat(o));var r},o.prototype.addEvent=function(e,o,n){t.App.EventManager.addEvent(e,o,n)},o.prototype.removeEvent=function(e,o,n){t.App.EventManager.removeEvent(e,o,n)},o}(t.SingleClass);t.BaseApp=e,__reflect(e.prototype,"Tpm.BaseApp")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.prototype.onRegister=function(){},e.prototype.onRemove=function(){},e.prototype.sendEvent=function(e){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];t.App.EventManager.sendEvent(e,o)},e.prototype.addEvent=function(e,o,n){t.App.EventManager.addEvent(e,o,n)},e.prototype.removeEvent=function(e,o,n){t.App.EventManager.removeEvent(e,o,n)},e}();t.BaseController=e,__reflect(e.prototype,"Tpm.BaseController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.listenerVisible(),t}return __extends(o,e),o.prototype.listenerVisible=function(){var t=this;eui.Binding.bindHandler(this,["visible"],function(e){e||t.hide()},this)},o.prototype.show=function(e,o){void 0===e&&(e=!0),void 0===o&&(o=!0),t.App.PopUpManager.addPopUp(this,e,o)},o.prototype.hide=function(){t.App.PopUpManager.removePopUp(this)},o.prototype.recDataFun=function(t){this.recData=t},o}(t.BaseUI);t.BasePanel=e,__reflect(e.prototype,"Tpm.BasePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setController=function(t){this.ctrl=t},e}(t.BaseUI);t.BaseScene=e,__reflect(e.prototype,"Tpm.BaseScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return e.call(this)||this}return __extends(o,e),Object.defineProperty(o.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),o.prototype.initList=function(){this.outCardList=[[],[]],this.handCardList=[[],[]],this.chiCardList=[[],[]],this.pengCardList=[[],[]],this.gangCardList=[[],[]],this.angCardList=[[],[]],this.moCardList=[[],[]],this.huCardList=[[],[]]},o.prototype.drownAllHandCard=function(){for(var e=0;e<this.handCardList[t.UserPosition.Down].length;e++)this.handCardList[t.UserPosition.Down][e].toDown();this.moCardList[t.UserPosition.Down][0]&&this.moCardList[t.UserPosition.Down][0].toDown()},o.prototype.getEatAllLen=function(t){var e=Math.floor(this.chiCardList[t].length/3),o=Math.floor(this.pengCardList[t].length/3),n=Math.floor(this.gangCardList[t].length/4),r=Math.floor(this.angCardList[t].length/4),i=e+o+n+r;return i},o.prototype.addCardToOut=function(e,o){var n=0,r=t.CardPos.outCardPosYList[o];o==t.UserPosition.Down?n=t.CardPos.outCardPosXList[o]+t.CardPos.outCardGapList[o]*this.outCardList[o].length:o==t.UserPosition.Up&&(n=t.CardPos.outCardPosXList[o]-t.CardPos.outCardGapList[o]*this.outCardList[o].length),e.x=n,e.y=r,this.outCardList[o].push(e),this.outGro.addChild(e)},o.prototype.addCardToHand=function(e,o){var n=0,r=t.CardPos.handCardPosYlist[o],i=3,a=this.getEatAllLen(o);o==t.UserPosition.Down?n=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*(a*i+this.handCardList[o].length):o==t.UserPosition.Up&&(n=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*this.handCardList[o].length),e.x=n,e.y=r,this.handCardList[o].push(e),this.cardGro.addChild(e)},o.prototype.addCardToEat=function(e,o,n){if(void 0===n&&(n=!1),3!=e.length)return void console.error("添加吃、碰牌异常");for(var r=3,i=13,a=this.getEatAllLen(o),s=t.CardPos.eatCardPosYList[o],c=0,h=0;h<e.length;h++){var d=this.cardFactory.getEatCard(e[h],o);o==t.UserPosition.Down?c=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*r*a+t.CardPos.eatCardGapList[o]*h:o==t.UserPosition.Up&&(c=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*(i-(a+1)*r)+t.CardPos.eatCardOffset[o]+t.CardPos.eatCardGapList[o]*h),d.x=c,d.y=s,n?this.pengCardList[o].push(d):this.chiCardList[o].push(d),this.cardGro.addChild(d)}},o.prototype.addCardToGang=function(e,o,n){if(void 0===n&&(n=!1),4!=e.length)return void console.error("添加杠牌异常");for(var r=3,i=13,a=this.getEatAllLen(o),s=0,c=t.CardPos.eatCardPosYList[o],h=0;h<e.length;h++){var d;if(h==r){var p=1;n&&o==t.UserPosition.Up?(d=this.cardFactory.getAnGangCard(e[h],o),this.angCardList[o].push(d)):n?(d=this.cardFactory.getEatCard(e[h],o),this.angCardList[o].push(d)):(d=this.cardFactory.getEatCard(e[h],o),this.gangCardList[o].push(d)),o==t.UserPosition.Down?(s=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*r*a+t.CardPos.eatCardGapList[o]*p,n&&(s+=1)):o==t.UserPosition.Up&&(s=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*(i-(a+1)*r)+t.CardPos.eatCardOffset[o]+t.CardPos.eatCardGapList[o]*p),c+=n?t.CardPos.angFourOffsetY[o]:t.CardPos.gangFourOffsetY[o]}else n?(d=this.cardFactory.getAnGangCard(e[h],o),this.angCardList[o].push(d)):(d=this.cardFactory.getEatCard(e[h],o),this.gangCardList[o].push(d)),o==t.UserPosition.Down?s=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*r*a+t.CardPos.eatCardGapList[o]*h:o==t.UserPosition.Up&&(s=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*(i-(a+1)*r)+t.CardPos.eatCardOffset[o]+t.CardPos.eatCardGapList[o]*h);d.x=s,d.y=c,this.cardGro.addChild(d)}},o.prototype.addCardToBu=function(e,o){var n=0;console.log("bgbg===",e),console.log("pengList===",this.pengCardList[o]);for(var r=0;r<this.pengCardList[o].length;r++)if(this.pengCardList[o][r].cardValue==e&&(n++,2==n)){var i=this.cardFactory.getEatCard(e,o);return i.x=this.pengCardList[o][r].x,i.y=this.pengCardList[o][r].y+t.CardPos.gangFourOffsetY[o],this.cardGro.addChild(i),this.gangCardList[o].push(this.pengCardList[o][r-1]),this.gangCardList[o].push(this.pengCardList[o][r]),this.gangCardList[o].push(this.pengCardList[o][r+1]),this.gangCardList[o].push(i),this.pengCardList[o].splice(r+1,1),this.pengCardList[o].splice(r,1),void this.pengCardList[o].splice(r-1,1)}console.error("bu gang error")},o.prototype.addCardToMo=function(e,o){var n=t.CardPos.moCardPosXList[o],r=t.CardPos.handCardPosYlist[o];e.x=n,e.y=r,this.moCardList[o][0]=e,this.cardGro.addChild(e)},o.prototype.addCardToHu=function(e,o,n){void 0===n&&(n=!1);var r=3,i=this.getEatAllLen(o),a=t.CardPos.eatCardPosYList[o],s=0,c=0;n&&(c=t.CardPos.huCardOffsetX[o]);var h=this.cardFactory.getEatCard(e,o);o==t.UserPosition.Down?s=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*r*i+t.CardPos.eatCardGapList[o]*this.huCardList[o].length+c:o==t.UserPosition.Up&&(s=n?t.CardPos.handCardPosXList[o]+this.handCardList[o].length*t.CardPos.eatCardOffset[o]/r+t.CardPos.huCardOffsetX[o]-t.CardPos.eatCardGapList[o]:t.CardPos.handCardPosXList[o]+this.handCardList[o].length*t.CardPos.eatCardOffset[o]/r+t.CardPos.eatCardGapList[o]*this.huCardList[o].length),h.x=s,h.y=a,this.huCardList[o].push(h),this.cardGro.addChild(h)},o.prototype.reHandCardPos=function(e){t.CardLogic.getInstance().sortHandCardAB(this.handCardList[e]);for(var o=0;o<this.handCardList[e].length;o++){var n=this.handCardList[e][o],r=0,i=3,a=this.getEatAllLen(e);e==t.UserPosition.Down?r=t.CardPos.handCardPosXList[e]+t.CardPos.handCardGapList[e]*(a*i+o):e==t.UserPosition.Up&&(r=t.CardPos.handCardPosXList[e]+t.CardPos.handCardGapList[e]*o),n.x=r}},o.prototype.removeLastOutCard=function(t){this.outCardList[t][this.outCardList[t].length-1].recycle(),this.outCardList[t].pop()},o.prototype.deletHandCard=function(e,o,n){if(void 0===n&&(n=!1),o!=t.UserPosition.Up||t.App.DataCenter.runingData.ownTingState||(e=0),console.log("dddddddddddddd===vv=======",e),n)return void(this.moCardList[o][0]?(this.moCardList[o][0].recycle(),this.moCardList[o]=[]):console.error("delete mocard error"));for(var r=!1,i=0;i<this.handCardList[o].length;i++)if(this.handCardList[o][i].cardValue==e||0==e&&o==t.UserPosition.Up){this.handCardList[o][i].recycle(),this.handCardList[o].splice(i,1),r=!0;break}r||(this.moCardList[o][0]&&this.moCardList[o][0].cardValue==e?(this.moCardList[o][0].recycle(),this.moCardList[o]=[]):console.error("delete handcard error"))},o.prototype.reCardValue=function(e,o){if(0!=e&&0!=o){for(var n=t.UserPosition.Down,r=!0,i=0;i<this.handCardList[n].length;i++)if(this.handCardList[n][i].cardValue==e)return this.handCardList[n][i].setCardValueAndSHow(o),this.reHandCardPos(n),void(r=!1);r&&e==this.moCardList[n][0].cardValue&&this.moCardList[n][0].setCardValueAndSHow(o)}},o.prototype.initDb=function(){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes("tpm_fanpai_ske_json")),t.parseTextureAtlasData(RES.getRes("tpm_fanpai_tex_json"),RES.getRes("tpm_fanpai_tex_png")),this.cardDbMovieList=[];for(var e=0;13>e;e++){var o=t.buildArmatureDisplay("Armature");this.cardDbMovieList.push(o)}},o.prototype.showFanDb=function(e){if(!this.cardDbMovieList[e].parent){var o=t.UserPosition.Down;this.cardDbMovieList[e].y=t.CardPos.handCardPosYlist[o]+61,this.cardDbMovieList[e].x=t.CardPos.handCardPosXList[o]+t.CardPos.handCardGapList[o]*e+42.5,this.dbGro.addChild(this.cardDbMovieList[e])}this.cardDbMovieList[e].animation.play("fanpai_erren",1)},o.prototype.getCardResidue=function(e){if(e>83||17>e)return console.error("get residue cardvalue error"),0;for(var o=4,n=0;n<this.chiCardList.length;n++)o-=this.getCardNumFromList(e,this.chiCardList[n]);for(var n=0;n<this.pengCardList.length;n++)o-=this.getCardNumFromList(e,this.pengCardList[n]);for(var n=0;n<this.gangCardList.length;n++)o-=this.getCardNumFromList(e,this.gangCardList[n]);for(var n=0;n<this.outCardList.length;n++)o-=this.getCardNumFromList(e,this.outCardList[n]);for(var n=0;n<this.moCardList.length;n++)o-=this.getCardNumFromList(e,this.moCardList[n]);return o-=this.getCardNumFromList(e,this.angCardList[t.UserPosition.Down]),o-=this.getCardNumFromList(e,this.handCardList[t.UserPosition.Down]),0>o&&(console.error("residue error",o),o=0),o},o.prototype.getCardNumFromList=function(t,e){for(var o=0,n=0;n<e.length;n++)t==e[n].cardValue&&o++;return o},o.prototype.clearAllCard=function(){this.movieGro.removeChildren(),this.clearCardList(this.outCardList),this.clearCardList(this.handCardList),this.clearCardList(this.chiCardList),this.clearCardList(this.pengCardList),this.clearCardList(this.gangCardList),this.clearCardList(this.angCardList),this.clearCardList(this.huCardList),this.clearCardList(this.moCardList),this.outCardList=[[],[]],this.handCardList=[[],[]],this.chiCardList=[[],[]],this.pengCardList=[[],[]],this.gangCardList=[[],[]],this.angCardList=[[],[]],this.huCardList=[[],[]],this.moCardList=[[],[]],this.cardGro.removeChildren(),this.cardGro.addChild(this.outGro)},o.prototype.clearCardList=function(t){for(var e=0;e<t.length;e++){t[e]||console.error("list eeee");for(var o=0;o<t[e].length;o++)t[e][o].recycle()}},o}(t.BaseGameMod);t.CardModBase=e,__reflect(e.prototype,"Tpm.CardModBase")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.R_Fail={code:110,desc:"fail desc"},e.R_100002={code:200,info:{room:null,old_session:null,reconnect:!1}},e.R_100010={code:200,info:{game_data:{desk_info:{bank_seat_id:0,desk_id:0,remain_count:0,room_type:0,status:0},player_info:[{seat_id:0,bu_hua_num:0,guo_hu_num:0,is_ting:0,last_card:0,hand_card_by_order:[[],[],[]],out_card:[]}],wait_task:{command_id:0,end_time:1,params:{seat_id:0,end_time:0,act_info:{}}}},user_info:[]}},e.R_100100={code:200,info:{ready:0}},e.R_100104={code:200,info:{desk_id:1e5,room_type:1,seat_info:{0:{status:1,nick:"11",seat_id:0,user_id:1,point:4e3}}}},e.R_100105={code:200,info:{desk_id:0,seat_info:{0:{status:1,nick:"11",seat_id:0,user_id:1,point:4e3}}}},e.R_101001={code:200,info:{seat_id:0,act_info:{}}},e.R_101002={code:200,info:{seat_id:0,remain_count:0,card_list:[]}},e.R_101003={code:200,info:{player_info:{0:{hand_card:[[],[]]},1:{hand_card:[[],[]]}}}},e.R_101004={code:200,info:{bank_seat_id:0,dice:[]}},e.R_101005={code:200,info:{card_list:[{seat_id:0,card_list:[]},{seat_id:0,card_list:[]}]}},e.R_101006={code:200,info:{total_points:[],detail:[{params:{guo_hu_count:0,hand_card_for_settle_show:[],hu_fan_count:0,hu_seat_id:0,source_seat_id:0,type_list:[]},points:[],type:1}]}},e.R_101008={code:200,info:{seat_id:0,hua_card:[],bu_cards:[]}},e.R_101100={code:200,info:{user_id:0,seat_id:0,point:0}},e.R_101101={code:200,info:{code:0,desc:[]}},e.R_101105={code:200,info:{user_id:0,nick:""}},e.R_101106={code:200,info:{user_id:0,nick:"",ready:0}},e.R_101107={code:200,info:{status:0,nick:"",seat_id:0,user_id:0,point:0}},e.R_101109={code:200,info:{user_id:0,nick:""}},e.R_101110={code:200,info:{user_id:0,nick:"",status:0}},e.R_101112={code:200,info:{card_list:[97],seat_id:0,all_hand_cards:{0:{an_gang_cards:[],hand_card:[]},1:{an_gang_cards:[],hand_card:[]}},act_type:10}},e.R_101007={code:200,info:{hua_card_list:[],seat_id:0}},e.R_100999={code:200,info:{test_type:0,hand_card:[],cards:[]}},t.ProtocolDataRev=e,__reflect(e.prototype,"Tpm.ProtocolDataRev")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eventList={},e}return __extends(e,t),e.prototype.sendEvent=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this.eventList[t];if(null!=n)for(var r,i,a=n.length,s=0;a>s;s++){var c=n[s];r=c[0],i=c[1],r.apply(i,e)}},e.prototype.addEvent=function(t,e,o){var n=this.eventList[t];if(null==n)n=[],this.eventList[t]=n;else for(var r=n.length,i=0;r>i;i++)if(n[i][0]==e&&n[i][1]==o)return;n.push([e,o])},e.prototype.removeEvent=function(t,e,o){var n=this.eventList[t];if(null!=n)for(var r=n.length,i=r-1;i>=0;i--)n[i][0]==e&&n[i][1]==o&&n.splice(i,1);n&&0==n.length&&(this.eventList[t]=null,delete this.eventList[t])},e}(t.SingleClass);t.EventMananger=e,__reflect(e.prototype,"Tpm.EventMananger")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.sceneLayer=0]="sceneLayer",t[t.popLayer=1]="popLayer",t[t.msgLayer=2]="msgLayer",t[t.lockLayer=3]="lockLayer",t[t.tipLayer=4]="tipLayer"}(e=t.LayerConst||(t.LayerConst={}));var o=function(e){function o(){var o=e.call(this)||this;return o.rootLayer=new eui.UILayer,o.rootLayer.percentWidth=100,o.rootLayer.percentHeight=100,o.rootLayer.touchEnabled=!1,t.App.StageUtils.stage.addChild(o.rootLayer),o.sceneLayer=new eui.UILayer,o.sceneLayer.touchEnabled=!1,o.rootLayer.addChild(o.sceneLayer),o.popLayer=new eui.UILayer,o.popLayer.touchEnabled=!1,o.rootLayer.addChild(o.popLayer),o.lockLayer=new eui.UILayer,o.lockLayer.touchEnabled=!1,o.rootLayer.addChild(o.lockLayer),o.msgLayer=new eui.UILayer,o.msgLayer.touchEnabled=!1,o.rootLayer.addChild(o.msgLayer),o.tipLayer=new eui.UILayer,o.tipLayer.touchEnabled=!1,o.rootLayer.addChild(o.tipLayer),o.layerList=[o.sceneLayer,o.popLayer,o.lockLayer,o.msgLayer,o.tipLayer],o}return __extends(o,e),o.prototype.addChildToLayer=function(t,e){return this.layerList[e]&&t?void this.layerList[e].addChild(t):void console.log("add to layer fault")},o.prototype.removeChildFromLayer=function(t,e){return this.layerList[e]&&t?void this.layerList[e].removeChild(t):void console.log("remove from layer fault")},o.prototype.adjustIndex=function(t){this.popLayer.setChildIndex(t,this.popLayer.numChildren-2)},o.prototype.removeLayerChirdren=function(t){this.layerList[t].removeChildren()},o.prototype.getLayerChildrenNum=function(t){return this.layerList[t].numChildren},Object.defineProperty(o.prototype,"RootLayer",{get:function(){return this.rootLayer},enumerable:!0,configurable:!0}),o}(t.SingleClass);t.LayerManager=o,__reflect(o.prototype,"Tpm.LayerManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.panelList={},t.panelClassList={},t.assetList={},t}return __extends(o,e),o.prototype.register=function(t,e,o){void 0===o&&(o=null),this.panelClassList[t]=e,this.assetList[t]=o},o.prototype.registerAll=function(){for(var e in t.PanelConst){var o=Number(e),n=egret.getDefinitionByName("Tpm."+t.PanelConst[e]);this.register(o,n)}},o.prototype.open=function(e,o,n,r,i,a,s,c){var h=this;void 0===o&&(o=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===a&&(a=!0),void 0===s&&(s=null),void 0===c&&(c=null),console.log("open Panel=="+e);var d=this.panelList[e];if(null==d){var p=this.panelClassList[e];if(null==p)return null;d=new p,this.panelList[e]=d}o?t.App.PopUpManager.changeTransparency(.5):t.App.PopUpManager.changeTransparency(.8),null!=s&&d.recDataFun(s);var l=this.assetList[e];return null!=l?(t.App.LoadingLock.addLock(),t.App.ResUtils.loadGroup(l,this,function(){t.App.LoadingLock.minusLock(),null!=n&&null!=r&&d.once(egret.Event.ADDED_TO_STAGE,function(){n.call(r,!0)},h),d.show(a,i)},null,10)):(null!=n&&null!=r&&d.once(egret.Event.ADDED_TO_STAGE,function(){n.call(r)},this),d.show(a,i)),d},o.prototype.close=function(t){var e=this.panelList[t];return null!=e&&e.hide(),e},o.prototype.getPanel=function(t){return this.panelList[t]},o.prototype.closeAllPanel=function(){t.App.ResUtils.deleteAllCallBack(),t.App.PopUpManager.removeAllPopUp(),t.App.LoadingLock.minusLock()},o}(t.SingleClass);t.PanelManager=e,__reflect(e.prototype,"Tpm.PanelManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.lockCount=0,t.clickClose=[],t.panelList=[],t.createLockBg(),t}return __extends(o,e),o.prototype.addPopUp=function(e,o,n){void 0===o&&(o=!0),void 0===n&&(n=!0),this.curPanel==e&&(console.log("panel repitition!!!!!!!!!!!!!"),this.curPanel.hide()),o&&(this.lockCount++,t.App.LayerManager.addChildToLayer(this.lockBg,t.LayerConst.popLayer)),this.clickClose[this.lockCount]=n,t.App.LayerManager.addChildToLayer(e,t.LayerConst.popLayer),this.curPanel=e,this.panelList.push(e)},o.prototype.removePopUp=function(e){e.parent&&e.parent.removeChild(e),this.lockCount--,this.lockCount>0?t.App.LayerManager.adjustIndex(this.lockBg):(this.lockCount=0,this.clickClose[this.lockCount]=!1,this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg),this.curPanel=null),this.panelList.pop(),this.panelList.length>0&&(this.curPanel=this.panelList[this.panelList.length-1]),this.panelList.length<1&&(this.curPanel=null,this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg))},o.prototype.removeAllPopUp=function(){t.App.LayerManager.removeLayerChirdren(t.LayerConst.popLayer),this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg),this.lockCount=0,this.clickClose.length=0,this.curPanel=null},o.prototype.changeTransparency=function(t){this.lockBg.alpha=t},o.prototype.createLockBg=function(){this.lockBg=new egret.Sprite,this.lockBg.graphics.beginFill(0,1);var e=t.App.StageUtils.stage;this.lockBg.graphics.drawRect(0,0,e.stageWidth,e.stageHeight),this.lockBg.graphics.endFill(),this.lockBg.touchEnabled=!0,this.lockBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},o.prototype.onTouchTap=function(){this.clickClose[this.lockCount]&&this.curPanel.hide()},o}(t.SingleClass);t.PopUpManager=e,__reflect(e.prototype,"Tpm.PopUpManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.sceneClassList={},t.sceneList={},t}return __extends(o,e),o.prototype.register=function(t,e){this.sceneClassList[t]=e},o.prototype.runScene=function(e,o){this.curScene&&t.App.LayerManager.removeChildFromLayer(this.curScene,t.LayerConst.sceneLayer);var n=this.sceneList[e];if(null==n){var r=this.sceneClassList[e];if(null==r)return console.error("当前场景不存在:",e),null;n=new r,this.sceneList[e]=n}return this.curScene=n,o&&this.curScene.setController(o),t.App.LayerManager.addChildToLayer(this.curScene,t.LayerConst.sceneLayer),this.curScene},o.prototype.getScene=function(t){return this.sceneList[t]},o.prototype.setScene=function(t,e){this.sceneList[t]=e},o.prototype.getCurScene=function(){return this.curScene},o}(t.SingleClass);t.SceneManager=e,__reflect(e.prototype,"Tpm.SceneManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;o.soundList={},o._allowPlayEffect=!0,o._allowPlayBGM=!0,o._effectVolume=1,o._bgmVolume=1,o.girlCard=[],o.girlAct=[],o.boyCard=[],o.boyAct=[],o.gd_girlCard=[],o.gd_girlAct=[],o.gd_boyCard=[],o.gd_boyAct=[],o.boyChat=[],o.girlChat=[],o.gd_boyChat=[],o.gd_girlChat=[],o.isGuangDongSpeak=!1;for(var n=0;3>n;n++)o.boyCard[49+n]="man"+(n+51)+"_mp3",o.girlCard[49+n]="woman"+(n+51)+"_mp3",o.gd_boyCard[49+n]="gd_man"+(n+51)+"_mp3",o.gd_girlCard[49+n]="gd_woman"+(n+51)+"_mp3";for(var n=0;9>n;n++)o.boyCard[17+n]="man"+(n+31)+"_mp3",o.boyCard[33+n]="man"+(n+21)+"_mp3",o.girlCard[17+n]="woman"+(n+31)+"_mp3",o.girlCard[33+n]="woman"+(n+21)+"_mp3",o.gd_boyCard[17+n]="gd_man"+(n+31)+"_mp3",o.gd_boyCard[33+n]="gd_man"+(n+21)+"_mp3",o.gd_girlCard[17+n]="gd_woman"+(n+31)+"_mp3",o.gd_girlCard[33+n]="gd_woman"+(n+21)+"_mp3";o.boyAct[t.ACT_act.Act_Chi]=[],o.boyAct[t.ACT_act.Act_AnGang]=[],o.boyAct[t.ACT_act.Act_Gang]=[],o.boyAct[t.ACT_act.Act_Hu]=[],o.boyAct[t.ACT_act.Act_Peng]=[],o.boyAct[t.ACT_act.Act_zimo]=[],o.girlAct[t.ACT_act.Act_Chi]=[],o.girlAct[t.ACT_act.Act_AnGang]=[],o.girlAct[t.ACT_act.Act_Gang]=[],o.girlAct[t.ACT_act.Act_Hu]=[],o.girlAct[t.ACT_act.Act_Peng]=[],o.girlAct[t.ACT_act.Act_zimo]=[],o.gd_boyAct[t.ACT_act.Act_Chi]=[],o.gd_boyAct[t.ACT_act.Act_AnGang]=[],o.gd_boyAct[t.ACT_act.Act_Gang]=[],o.gd_boyAct[t.ACT_act.Act_Hu]=[],o.gd_boyAct[t.ACT_act.Act_Peng]=[],o.gd_boyAct[t.ACT_act.Act_zimo]=[],o.gd_girlAct[t.ACT_act.Act_Chi]=[],o.gd_girlAct[t.ACT_act.Act_AnGang]=[],o.gd_girlAct[t.ACT_act.Act_Gang]=[],o.gd_girlAct[t.ACT_act.Act_Hu]=[],o.gd_girlAct[t.ACT_act.Act_Peng]=[],o.gd_girlAct[t.ACT_act.Act_zimo]=[];for(var n=0;3>n;n++)o.boyAct[t.ACT_act.Act_Chi][n]="man_chi"+n+"_mp3",o.boyAct[t.ACT_act.Act_AnGang][n]="man_gang"+n+"_mp3",o.boyAct[t.ACT_act.Act_Gang][n]="man_gang"+n+"_mp3",o.boyAct[t.ACT_act.Act_Hu][n]="man_hu"+n+"_mp3",o.boyAct[t.ACT_act.Act_Peng][n]="man_peng"+n+"_mp3",o.boyAct[t.ACT_act.Act_zimo][n]="man_zimo"+n+"_mp3",o.girlAct[t.ACT_act.Act_Chi][n]="woman_chi"+n+"_mp3",o.girlAct[t.ACT_act.Act_AnGang][n]="woman_gang"+n+"_mp3",o.girlAct[t.ACT_act.Act_Gang][n]="woman_gang"+n+"_mp3",o.girlAct[t.ACT_act.Act_Hu][n]="woman_hu"+n+"_mp3",o.girlAct[t.ACT_act.Act_Peng][n]="woman_peng"+n+"_mp3",o.girlAct[t.ACT_act.Act_zimo][n]="woman_zimo"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_Chi][n]="gd_man_chi"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_AnGang][n]="gd_man_gang"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_Gang][n]="gd_man_gang"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_Hu][n]="gd_man_hu"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_Peng][n]="gd_man_peng"+n+"_mp3",o.gd_boyAct[t.ACT_act.Act_zimo][n]="gd_man_zimo"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_Chi][n]="gd_woman_chi"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_AnGang][n]="gd_woman_gang"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_Gang][n]="gd_woman_gang"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_Hu][n]="gd_woman_hu"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_Peng][n]="gd_woman_peng"+n+"_mp3",o.gd_girlAct[t.ACT_act.Act_zimo][n]="gd_woman_zimo"+n+"_mp3";for(var n=0;7>=n;n++)o.boyChat.push("man_chat"+n+"_mp3"),o.gd_boyChat.push("gd_man_chat"+n+"_mp3"),o.girlChat.push("woman_chat"+n+"_mp3"),o.gd_girlChat.push("gd_woman_chat"+n+"_mp3");return o}return __extends(o,e),o.prototype.playOutCard=function(e,o){void 0===o&&(o=t.SEX_TYPE.boy),o==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.playEffect(this.gd_boyCard[e]):this.playEffect(this.boyCard[e]):this.isGuangDongSpeak?this.playEffect(this.gd_girlCard[e]):this.playEffect(this.girlCard[e])},o.prototype.playAct=function(e,o){void 0===o&&(o=t.SEX_TYPE.boy);var n=t.NumberTool.getRandInt(0,2);o==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.gd_boyAct[e]&&this.playEffect(this.gd_boyAct[e][n]):this.boyAct[e]&&this.playEffect(this.boyAct[e][n]):this.isGuangDongSpeak?this.gd_girlAct[e]&&this.playEffect(this.gd_girlAct[e][n]):this.girlAct[e]&&this.playEffect(this.girlAct[e][n])},o.prototype.playChat=function(e,o){void 0===o&&(o=t.SEX_TYPE.boy),o==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.gd_boyChat[e]&&this.playEffect(this.gd_boyChat[e]):this.boyChat[e]&&this.playEffect(this.boyChat[e]):this.isGuangDongSpeak?this.gd_girlChat[e]&&this.playEffect(this.gd_girlChat[e]):this.girlChat[e]&&this.playEffect(this.girlChat[e])},o.prototype.playEffect=function(t,e,o){if(void 0===e&&(e=0),void 0===o&&(o=1),0!=this.allowPlayEffect){var n=this.soundList[t];if(null==n&&(n=RES.getRes(t),null!=n&&(this.soundList[t]=n)),n){n.type=egret.Sound.EFFECT;var r=n.play(e,o);r.volume=this._effectVolume}}},o.prototype.playBGM=function(e,o,n){if(void 0===o&&(o=0),void 0===n&&(n=Number.MAX_VALUE),0!=this.allowPlayBGM&&null==this.bgmChannel&&t.App.SceneManager.getCurScene()!=t.App.SceneManager.getScene(t.SceneConst.HallScene)&&t.App.SceneManager.getCurScene()!=t.App.SceneManager.getScene(t.SceneConst.LoginScene)){this.stopBGM();var r=this.soundList[e];null==r&&(r=RES.getRes(e),r&&(this.soundList[e]=r)),r&&(r.type=egret.Sound.MUSIC,this.bgmChannel=r.play(o,n),this.bgmChannel.volume=this._bgmVolume)}},o.prototype.stopBGM=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},Object.defineProperty(o.prototype,"allowPlayEffect",{get:function(){return this._allowPlayEffect},set:function(t){this._allowPlayEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"allowPlayBGM",{get:function(){return this._allowPlayBGM},set:function(t){this._allowPlayBGM=t,0==this._allowPlayBGM?this.stopBGM():this.playBGM(o.bgm)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"effectVolume",{get:function(){return this._effectVolume},set:function(t){this._effectVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bgmVolume",{get:function(){return this._bgmVolume},set:function(t){this._bgmVolume=t,this.bgmChannel&&(this.bgmChannel.volume=this._bgmVolume)},enumerable:!0,configurable:!0}),o.prototype.stopAllSound=function(){this.stopBGM()},o}(t.SingleClass);e.win="audio_win_mp3",e.lose="audio_lose_mp3",e.warn="audio_warn_mp3",e.hall_click="tpm_audio_button_click_mp3",e.clickCard="audio_card_click_mp3",e.enter="audio_enter_mp3",e.bgm="Audio_Game_Back_mp3",e.user_left="audio_left_mp3",e.liuju="audio_liuju_mp3",e.ready="audio_ready_mp3",e.shazi="audio_shaizi_mp3",e.tuoGuan="audio_tuo_guan_mp3",e.button="tpm_audio_button_click_mp3",t.SoundManager=e,__reflect(e.prototype,"Tpm.SoundManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.name="",this.callBackList={},this.objList={},this.reconnecting=!1,this.reconInvalTime=3e3,this.curReconnectCount=0,this.reconnenctLimit=5,this.bAllowReconnnect=!1,this.protoBuffer="",this.dataBuffer=null,this.url="",this.headSize=12,this.getMessage=0,this.timer=new egret.Timer(5e3,0)}return e.prototype.register=function(t,e,o){this.callBackList[t]=e,this.objList[t]=o},e.prototype.unRegister=function(t){delete this.callBackList[t],delete this.objList[t]},e.prototype.startConnect=function(e,o){void 0===o&&(o=!1),console.log("开始连接:"+e),t.App.LoadingLock.addLock("网络连接中..."),this.url=e,this.bAllowReconnnect=o,this.createSocket(),this.socket.connectByUrl(e),this.getMessage=0,this.timeId=egret.setTimeout(this.netError,this,4500)},e.prototype.netError=function(){this.isConnected()||t.App.EventManager.sendEvent(t.EventConst.SocketClose,this)},e.prototype.createSocket=function(){this.socket&&(this.socket.removeEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this),this.socket.connected&&this.socket.close()),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this)},e.prototype.onConnect=function(e){egret.log(" connect success"),t.App.LoadingLock.minusLock(),this.resetReconnenct(),t.App.EventManager.sendEvent(t.EventConst.SocketConnect,this),this.sendHeart()},e.prototype.onClose=function(e){egret.log("socket close"),t.App.LoadingLock.minusLock(),t.App.EventManager.sendEvent(t.EventConst.SocketClose,this),this.timer.stop()},e.prototype.onError=function(e){egret.log("socket error"),this.timer.stop(),0==this.tryReconnect()&&t.App.EventManager.sendEvent(t.EventConst.SocketIOError,this)},e.prototype.tryReconnect=function(){return 0==this.bAllowReconnnect?!1:(this.curReconnectCount++,this.curReconnectCount<=this.reconnenctLimit?(1==this.curReconnectCount&&t.App.EventManager.sendEvent(t.EventConst.StartReconnect,this),egret.setTimeout(this.startConnect,this,this.reconInvalTime,this.url,!0),!0):!1)},e.prototype.close=function(){this.timer.stop(),egret.clearTimeout(this.timeId),this.socket&&(this.socket.removeEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this),this.socket.connected&&this.socket.close()),this.resetReconnenct(),this.dataBuffer=null,this.protoBuffer=null},e.prototype.resetReconnenct=function(){this.reconnecting=!1,this.curReconnectCount=0},e.prototype.isConnected=function(){return this.socket&&this.socket.connected?!0:!1},e.prototype.send=function(e,o){if(void 0===o&&(o={}),this.socket&&this.socket.connected){var n=new egret.ByteArray,r=JSON.stringify(o);n.writeUTFBytes(r);var i=this.headSize+n.length,a=e.split("_"),s=this.getHead(i,a[0]);s.writeBytes(n),this.socket.writeBytes(s),this.socket.flush(),console.log("send:",e,JSON.stringify(o))}else egret.log("socket is not connected"),this.dataBuffer=o,this.protoBuffer=e,t.App.EventManager.sendEvent(t.EventConst.SocketNotConnect,this),t.App.EventManager.sendEvent(t.EventConst.SocketClose,this)
},e.prototype.onRecieve=function(t){this.getMessage=0;var e=new egret.ByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,this.socket.readBytes(e),this.process(e)},e.prototype.process=function(t){var e=t.readInt();if(e!=t.length)return void console.error("data error!!");var o,n=t.readInt(),r=(t.readInt(),t.readUTFBytes(t.length-this.headSize));""!=r&&(o=JSON.parse(r));var i=n+"",a=this.callBackList[i],s=this.objList[i];console.log("rev:",i,o),a&&s?a.call(s,o):console.log("no receive callback:",i)},e.prototype.getHead=function(t,e){var o=new egret.ByteArray;return o.endian=egret.Endian.LITTLE_ENDIAN,o.writeInt(t),o.writeInt(e),o.writeInt(0),o},e.prototype.sendHeart=function(){},e.prototype.timerLisener=function(){0==this.getMessage?(this.send("",""),this.getMessage++):this.socket.close()},e}();t.ClientSocket=e,__reflect(e.prototype,"Tpm.ClientSocket")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.send=function(e,o,n,r){void 0===r&&(r=!0);var i=this.extendObj(t.ProtocolHttp.httpHead,e),a=JSON.stringify(i),s=t.App.DataCenter.ServerInfo.WEB_URL+e.action.toLowerCase()+"?base="+a;console.log("send url:"+s);var c=new egret.HttpRequest;c.open(s,egret.HttpMethod.GET),c.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}505==i.code&&t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1),o.call(n,i)},this),c.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("error : event="+e),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),c.send()},o.prototype.sendTest=function(e,o,n,r){void 0===r&&(r=!0);var i=this.extendObj(t.ProtocolHttp.httpHead,e),a=JSON.stringify(i),s="http://oldboy.iespoir.com:8889/mj/"+e.action.toLowerCase()+"?base="+a;console.log("send url:"+s);var c=new egret.HttpRequest;c.open(s,egret.HttpMethod.GET),c.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}505==i.code&&t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1),o.call(n,i)},this),c.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("error : event="+e),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),c.send()},o.prototype.post=function(e,o,n){var r=(this.extendObj(t.ProtocolHttp.httpHead,e),JSON.stringify(e.param)),i=t.App.DataCenter.ServerInfo.WEB_URL+e.action.toLowerCase();console.log("post url:"+i);var a=new egret.HttpRequest;a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.open(i,egret.HttpMethod.POST),a.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}o.call(n,i)},this),a.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("post error"),t.App.LoadingLock.minusLock(),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),console.log("loginsend:",r),a.send(r)},o.prototype.extendObj=function(e,o){var n=new Object;for(var r in o)if(!n.hasOwnProperty(r)&&"action"!=r&&(n[r]=o[r],"skey"==r&&t.App.DataCenter.UserInfo.myUserUid&&(n[r]=t.App.DataCenter.UserInfo.myUserInfo.skey),"uid"==r&&t.App.DataCenter.UserInfo.myUserUid&&(n[r]=t.App.DataCenter.UserInfo.myUserInfo.userID),t.App.DataCenter.UserInfo.myUserUid&&console.log("skey:::",t.App.DataCenter.UserInfo.myUserInfo.skey),"param"==r))for(var i in n[r])"playerID"==i&&t.App.DataCenter.UserInfo.myUserUid&&(n[r][i]=t.App.DataCenter.UserInfo.myUserInfo.userID);return n},o}(t.SingleClass);t.HttpSender=e,__reflect(e.prototype,"Tpm.HttpSender")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.dataList={},this.callBackList={},this.objList={}}return e.prototype.addMsg=function(t,e,o,n){this.dataList[t]=e,this.callBackList[t]=o,this.objList[t]=n},e.prototype.minusMsg=function(t){delete this.dataList[t],delete this.callBackList[t],delete this.objList[t]},e.prototype.exeMsg=function(t,e){void 0===e&&(e=!0);var o=this.callBackList[t],n=this.objList[t],r=this.dataList[t];o&&n&&o.call(n,r),e&&this.minusMsg(t)},e.prototype.addMsgData=function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=!1),o?(this.dataList[t]||(this.dataList[t]=[]),this.dataList[t].push(e)):this.dataList[t]=e},e.prototype.getMsgData=function(e,o){void 0===o&&(o=!0);var n=t.ArrayTool.deepCopy(this.dataList[e]);return o&&this.minusMsg(e),n},e}();t.MsgCache=e,__reflect(e.prototype,"Tpm.MsgCache")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.gameSocket=new t.ClientSocket,o.gameSocket.name="gameSocket",o}return __extends(o,e),o}(t.SingleClass);t.GameSocket=e,__reflect(e.prototype,"Tpm.GameSocket")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.swap=function(t,e,o){var n=t[e];t[e]=t[o],t[o]=n},e.randSort=function(e){for(var o=e.length,n=0;o>n;n++)this.swap(e,n,t.NumberTool.getRandInt(0,o-1))},e.formatDate=function(t){var e=new Date(1e3*parseInt(t));return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},e.formatDate1=function(t){var o=new Date(1e3*parseInt(t));return e.aze(o.getFullYear())+"-"+e.aze(o.getMonth()+1)+"-"+e.aze(o.getDate())},e.formatDate2=function(t){var o=new Date(1e3*parseInt(t));return e.aze(o.getHours())+":"+e.aze(o.getMinutes())+":"+e.aze(o.getSeconds())},e.aze=function(t){return t>9?""+t:"0"+t},e.getObjectLength=function(t){var e=0;for(var o in t)e++;return e},e.deepCopy=function(t){var o;if("object"==typeof t)if(null===t)o=null;else if(void 0==t)o=void 0;else if(t instanceof Array){o=[];for(var n=0,r=t.length;r>n;n++)o.push(e.deepCopy(t[n]))}else{o={};for(var i in t)o[i]=e.deepCopy(t[i])}else o=t;return o},e}();t.ArrayTool=e,__reflect(e.prototype,"Tpm.ArrayTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(e,o){void 0===o&&(o=0);var n=t.call(this)||this;return n.delay=e,n.repeatCount=o,n}return __extends(e,t),e.prototype.start=function(){this.previous=egret.getTimer(),this.accTime=0,egret.startTick(this.update,this)},e.prototype.reset=function(){this.previous=egret.getTimer(),this.accTime=0,this.currentCount=0},e.prototype.stop=function(){egret.stopTick(this.update,this)},e.prototype.update=function(){for(this.curTime=egret.getTimer(),this.passTime=this.curTime-this.previous,this.previous=this.curTime,this.accTime+=this.passTime;this.accTime>=this.delay;)this.accTime-=this.delay,this.currentCount++,this.repeatCount>0&&this.currentCount==this.repeatCount&&(this.dispatchEvent(new egret.TimerEvent(egret.TimerEvent.TIMER_COMPLETE)),this.stop()),this.dispatchEvent(new egret.TimerEvent(egret.TimerEvent.TIMER));return!1},e}(egret.EventDispatcher);t.DateTimer=e,__reflect(e.prototype,"Tpm.DateTimer")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.lockNum=0,o.lockBg=new eui.Rect,o.lockBg.width=1334,o.lockBg.height=750,o.lockBg.fillAlpha=.5,o.circle=new eui.Image,o.circle.source=t.ResPathConfig.lockRotat,o.circle.anchorOffsetX=o.circle.width/2,o.circle.anchorOffsetY=o.circle.height/2,o.circle.verticalCenter=0,o.circle.horizontalCenter=0,o.descLab=new eui.Label,o.descLab.verticalCenter=50,o.descLab.horizontalCenter=0,o.descLab.textColor=t.App.ArtConfig.getColor(t.ColorConst.white),o.descLab.text="",o.descLab.fontFamily=t.App.ArtConfig.getFont(t.FontConst.Microsoft),o}return __extends(o,e),o.prototype.addLock=function(e){void 0===e&&(e=""),this.lockNum<0&&(this.lockNum=0),this.lockNum++,egret.Tween.removeTweens(this.circle),this.descLab.text=e,egret.Tween.get(this.circle,{loop:!0}).to({rotation:360},1e3),t.App.LayerManager.addChildToLayer(this.lockBg,t.LayerConst.lockLayer),t.App.LayerManager.addChildToLayer(this.circle,t.LayerConst.lockLayer),t.App.LayerManager.addChildToLayer(this.descLab,t.LayerConst.lockLayer)},o.prototype.minusLock=function(){this.lockNum--,this.lockNum<=0&&this.circle&&this.circle.parent&&(egret.Tween.removeTweens(this.circle),t.App.LayerManager.removeChildFromLayer(this.lockBg,t.LayerConst.lockLayer),t.App.LayerManager.removeChildFromLayer(this.circle,t.LayerConst.lockLayer),t.App.LayerManager.removeChildFromLayer(this.descLab,t.LayerConst.lockLayer))},o}(t.SingleClass);t.LoadingLock=e,__reflect(e.prototype,"Tpm.LoadingLock")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.formatTime=function(t){return t>=0&&10>t?"0"+t:t+""},t.getRandInt=function(t,e){return Math.round(Math.random()*(e-t))+t},t.formatCapital=function(t){return 0>=t||t>=10?"":["一","二","三","四","五","六","七","八","九"][t-1]},t.formatMoney=function(t,e){void 0===e&&(e=1);var o="";return t>=1e3&&9999>t&&(o=2==e?(t/1e3).toFixed(0)+"千":t+""),t>=1e4&&99999>t&&(o=t%1e4==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(3)+"万"),t>=1e5&&999999>t&&(o=t%1e5==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(2)+"万"),t>=1e6&&9999999>t&&(o=t%1e6==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(1)+"万"),t>=1e7&&99999999>t&&(o=t%1e7==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(0)+"万"),t>=1e8&&999999999>t&&(o=t%1e8==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(3)+"亿"),t>=1e9&&9999999999>t&&(o=t%1e9==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(2)+"亿"),t>=1e10&&99999999999>t&&(o=t%1e10==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(1)+"亿"),o},t.sperateMoney=function(t){for(var e=t.toString(),o=e.length,n=0,r="",i=o-1;i>=0;i--)r=r.concat(e[i]),n++,n%3==0&&(r=r.concat(","));for(var a=r.length,s="",i=a-1;i>=0;i--)s=s.concat(r[i]);return","==s[0]&&(s=s.substr(1,a-1)),s},t.formatGoldHead=function(t){if(0==t)return"0";var e="",o="";if(t>=1e8)o="亿",e=(t/1e8).toFixed(4)+"";else{if(!(t>=1e4))return e=t+"";o="万",e=(t/1e4).toFixed(4)+""}e=e.substr(0,5),"."==e.substr(4,1)&&(e=e.substr(0,4));for(var n=0;n<e.length&&"0"==e.substr(e.length-1,1);n++)e=e.substr(0,e.length-2);return e+=o},t}();t.NumberTool=e,__reflect(e.prototype,"Tpm.NumberTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(t){this.className="Tpm."+t,this.list=[]}return t.prototype.getObject=function(){if(this.list.length>0)return this.list.shift();var t=egret.getDefinitionByName(this.className);return new t},t.prototype.returnObject=function(t){this.list.push(t)},t.getPool=function(e,o){if(void 0===o&&(o=0),!t.pool[e]&&(t.pool[e]=new t(e),0!=o))for(var n=egret.getDefinitionByName(e),r=t.pool[e],i=0;o>i;i++)r.returnObject(new n);return t.pool[e]},t}();e.pool={},t.ObjectPool=e,__reflect(e.prototype,"Tpm.ObjectPool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},t.formatNickName=function(t,e){if(void 0===e&&(e=10),t){var o=this.getStrLength(t,e),n=o[0];return n>e?t.substr(0,o[1])+"...":t}},t.getStrLength=function(t,e){void 0===e&&(e=10);for(var o=0,n=0,r=0,i=0;i<t.length;i++)n=t.charCodeAt(i),n>127||n>=65&&90>=n?(o+=2,e>=o&&r++):(o++,e>=o&&r++);return[o,r]},t}();t.StringTool=e,__reflect(e.prototype,"Tpm.StringTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(e){function o(t){i(t)}function n(t){r(t)}function r(e){var o=new eui.Group;o.width=t.App.StageUtils.stageWidth,o.height=100,o.touchEnabled=!1;var n=new eui.Image;n.texture=RES.getRes(t.ResPathConfig.tipsTopBg),n.horizontalCenter=0,o.y=-n.height;var r=new eui.Label;r.size=30,r.textColor=t.App.ArtConfig.getColor(t.ColorConst.topTips),r.text=e,r.horizontalCenter=0,r.y=(n.height-r.size)/2-3,o.addChild(n),o.addChild(r),t.App.LayerManager.getLayerChildrenNum(t.LayerConst.tipLayer)>0&&(egret.Tween.removeTweens(o),t.App.LayerManager.removeLayerChirdren(t.LayerConst.tipLayer)),t.App.LayerManager.addChildToLayer(o,t.LayerConst.tipLayer);var i=egret.setTimeout(function(){o&&o.parent&&t.App.LayerManager.removeChildFromLayer(o,t.LayerConst.tipLayer)},this,4e3);egret.Tween.get(o).to({y:0},200).wait(2e3).to({y:-n.height,alpha:0},300).call(function(){egret.clearTimeout(i),egret.Tween.removeTweens(o),o&&o.parent&&t.App.LayerManager.removeChildFromLayer(o,t.LayerConst.tipLayer)})}function i(e){var o=new eui.Group;o.width=1334,o.height=50,o.y=335,o.alpha=0;var n=new eui.Image;n.texture=RES.getRes(t.ResPathConfig.tipsBg),n.horizontalCenter=0;var r=new eui.Label;r.size=30,r.textColor=t.App.ArtConfig.getColor(t.ColorConst.middleTips),r.text=e,r.horizontalCenter=0,r.y=14,o.addChild(n),o.addChild(r),t.App.LayerManager.getLayerChildrenNum(t.LayerConst.tipLayer)>0&&(egret.Tween.removeTweens(o),t.App.LayerManager.removeLayerChirdren(t.LayerConst.tipLayer)),t.App.LayerManager.addChildToLayer(o,t.LayerConst.tipLayer);var i=egret.setTimeout(function(){o&&o.parent&&t.App.LayerManager.removeChildFromLayer(o,t.LayerConst.tipLayer)},this,4e3);egret.Tween.get(o).to({alpha:1},200).wait(1300).to({y:o.y-187.5,alpha:0},500).call(function(){egret.clearTimeout(i),egret.Tween.removeTweens(o),o&&o.parent&&t.App.LayerManager.removeChildFromLayer(o,t.LayerConst.tipLayer)})}e.showMiddle=o,e.showTop=n}(e=t.Tips||(t.Tips={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"IsWeb",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsIos",{get:function(){return"iOS"==egret.Capabilities.os},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsAndroid",{get:function(){return"Android"==egret.Capabilities.os},enumerable:!0,configurable:!0}),e}(t.SingleClass);t.DeviceUtils=e,__reflect(e.prototype,"Tpm.DeviceUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){function e(t,e){void 0===e&&(e=1e3),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.scaleX=4,t.scaleY=4,t.alpha=0,egret.Tween.get(t).to({scaleX:1,scaleY:1,alpha:1},200).wait(e).call(function(){t.parent&&t.parent.removeChild(t)})}function o(t,e){void 0===e&&(e=1e3);var o=t.y,n=new Date,r=n.getSeconds();egret.Tween.get(t).wait(e).to({y:o-100,alpha:.5},250).call(function(){var e=new Date,o=e.getSeconds(),n=o-r;console.log("tips显示时间="+n),t.parent&&t.parent.removeChild(t)})}function n(t,e,o,n){void 0===e&&(e=200),void 0===o&&(o=0),void 0===n&&(n=0);var r=t.y;egret.Tween.get(t,{loop:!0}).wait(o).to({y:r-t.height/3},e/2).to({y:r},e/2).wait(n)}function r(e){for(var o=e.length,n=400,r=0,i=0,a=.5,s=0;o>s;s++)r=s*(n*(1-a)),i=(o-s)*(n*(1-a)),t.bounce(e[s],n,r,i)}function i(t){egret.Tween.removeTweens(t)}function a(e){for(var o=e.length,n=0;o>n;n++)t.removeTween(e[n])}t.showMax2Min=e,t.showFload=o,t.bounce=n,t.bounceOneByOne=r,t.removeTween=i,t.removeObjsTween=a}(e=t.EffectUtils||(t.EffectUtils={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=RES.getRes("kwx_keywordConfig_json");this.keyWordList=t.keyword.split("|")},e.prototype.filteString=function(t){if(this.isInit()){for(var e,o=this.keyWordList.length,n=0;o>n;n++)if(e=new RegExp(this.keyWordList[n],"i"),-1!=t.search(e)){console.log("包含敏感关键词:",this.keyWordList[n]);for(var r=this.keyWordList[n].length,i="",a=0;r>a;a++)i+="*";t=t.replace(e,i)}return t}return"***"},e.prototype.checkStringOK=function(t){if(this.isInit()){for(var e,o=this.keyWordList.length,n=0;o>n;n++)if(e=new RegExp(this.keyWordList[n],"i"),null!=t.match(e))return!1;return!0}return!1},e.prototype.isInit=function(){return null!=this.keyWordList},e}(t.SingleClass);t.KeyWord=e,__reflect(e.prototype,"Tpm.KeyWord")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"allowMusic",{get:function(){var t=this.loadItem("tpm_allowMusic");return null==t&&(this.allowMusic=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_allowMusic",t?"1":"0")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowEffect",{get:function(){var t=this.loadItem("tpm_allowEffect");return null==t&&(this.allowEffect=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_allowEffect",t?"1":"0")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoVoice",{get:function(){var t=this.loadItem("tpm_autoVoice");return null==t&&(this.autoVoice=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_autoVoice",t?"1":"0")},enumerable:!0,configurable:!0}),e.prototype.saveItem=function(t,e){t&&egret.localStorage.setItem(t,e)},e.prototype.loadItem=function(t){return t?egret.localStorage.getItem(t):void 0},e}(t.SingleClass);t.LocalStorageUtil=e,__reflect(e.prototype,"Tpm.LocalStorageUtil")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initResVersion(),e.groupList=new Array,e.configList=new Array,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,e.onResourceLoadComplete,e),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,e.onResourceLoadProgress,e),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,e.onResourceLoadError,e),e}return __extends(e,t),e.prototype.initResVersion=function(){window&&window.version&&(RES.web.Html5VersionController.prototype.getVirtualUrl=function(t){var e=window.version;return t+=-1==t.indexOf("?")?"?ver="+e:"&ver="+e})},e.prototype.addConfig=function(t,e){this.configList.push([t,e])},e.prototype.loadConfig=function(t,e){this.onConfigComplete=t,this.onConfigCompleteTarget=e,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this.configList.length)return this.onConfigComplete.call(this.onConfigCompleteTarget),this.onConfigComplete=null,void(this.onConfigCompleteTarget=null);var t=this.configList.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},e.prototype.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroupQuiet=function(t,e){void 0===e&&(e=1);var o=this.combGroupName(t);RES.loadGroup(o,e)},e.prototype.loadGroup=function(t,e,o,n,r){void 0===e&&(e=null),void 0===o&&(o=null),void 0===n&&(n=null),void 0===r&&(r=1);var i=this.combGroupName(t);this.groupList[i]=[o,n,e],this.loadGroupQuiet(t,r)},e.prototype.onResourceLoadComplete=function(t){var e=t.groupName;if(console.log("加载资源组完成:",e),this.groupList[e]){var o=this.groupList[e][0],n=this.groupList[e][2];null!=o&&o.call(n),this.deleteCallBack(e)}},e.prototype.onResourceLoadProgress=function(t){var e=t.groupName;if(this.groupList[e]){var o=this.groupList[e][1],n=this.groupList[e][2];null!=o&&o.call(n,t)}},e.prototype.onResourceLoadError=function(t){console.error(t.groupName+"资源组加载失败"),this.onResourceLoadComplete(t)},e.prototype.deleteCallBack=function(t){console.log("取消加载资源组回调:"+t),this.groupList[t]=null,delete this.groupList[t]},e.prototype.deleteAllCallBack=function(){for(var t in this.groupList)this.deleteCallBack(t)},e.prototype.combGroupName=function(t){var e="";if("string"==typeof t)e=t;else{for(var o=t.length,n=0;o>n;n++)e+=t[n];RES.createGroup(e,t)}return e},e}(t.SingleClass);t.ResUtils=e,__reflect(e.prototype,"Tpm.ResUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfStageWidth",{get:function(){return this.stage.stageWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfStageHeight",{get:function(){return this.stage.stageHeight/2},enumerable:!0,configurable:!0}),e.prototype.runBrowserAdapt=function(){this.stage.addEventListener(egret.StageOrientationEvent.ORIENTATION_CHANGE,this.changeScaleMode,this)},e.prototype.changeScaleMode=function(){console.log("当前适配模式:",this.stage.scaleMode)},e}(t.SingleClass);t.StageUtils=e,__reflect(e.prototype,"Tpm.StageUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(e){function o(e,o,n,r){void 0===n&&(n=null),void 0===r&&(r=100);var i=Math.round(o/r);if(0>=i)return void(e&&e.call(n));var a=new t.DateTimer(r,i),s=0;a.addEventListener(egret.TimerEvent.TIMER,function(){s++,s==i&&(a.stop(),e&&e.call(n))},this),a.start()}e.setTimeOut=o}(e=t.Utils||(t.Utils={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.startUp=function(){this.registerController(t.LoginController.NAME,new t.LoginController),this.registerController(t.HallController.NAME,new t.HallController),this.registerController(t.GameController.NAME,new t.GameController);var e=o.getController(t.LoginController.NAME);e.onRegister();var n=o.SceneManager;n.register(t.SceneConst.HallScene,t.HallScene),n.register(t.SceneConst.GameScene,t.GameScene);var r=o.PanelManager;if(r.registerAll(),this.addEvent(t.EventConst.SocketClose,this.onSocketClose,this),o.GameConfig.init(),o.DataCenter.debugInfo.skipNet)o.DataCenter.debugInfo.skipHall?o.SceneManager.runScene(t.SceneConst.GameScene,this.getController(t.GameController.NAME)):o.SceneManager.runScene(t.SceneConst.HallScene,this.getController(t.HallController.NAME));else{var i=this.getController(t.LoginController.NAME);i.loginGate()}},o.prototype.onSocketClose=function(){o.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},o.getController=function(t){return o.getInstance().getController(t)},Object.defineProperty(o,"DataCenter",{get:function(){return t.DataCenter.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"DeviceUtils",{get:function(){return t.DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"StageUtils",{get:function(){return t.StageUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ResUtils",{get:function(){return t.ResUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"LayerManager",{get:function(){return t.LayerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"SoundManager",{get:function(){return t.SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PopUpManager",{get:function(){return t.PopUpManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"MessageBoxManager",{get:function(){return t.MessageBoxManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"EventManager",{get:function(){return t.EventMananger.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"LoadingLock",{get:function(){return t.LoadingLock.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PanelManager",{get:function(){return t.PanelManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"SceneManager",{get:function(){return t.SceneManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"PlatformBridge",{get:function(){return t.PlatformBridge.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"gameSocket",{get:function(){return t.GameSocket.getInstance().gameSocket},enumerable:!0,configurable:!0}),Object.defineProperty(o,"httpSender",{get:function(){return t.HttpSender.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"LocalStorageUtil",{get:function(){return t.LocalStorageUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"GameConfig",{get:function(){return t.StorageConfig.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ArtConfig",{get:function(){return t.ArtConfig.getInstance()},enumerable:!0,configurable:!0}),o}(t.BaseApp);t.App=e,__reflect(e.prototype,"Tpm.App")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.Preload="preload",t.AssetConst=e,__reflect(e.prototype,"Tpm.AssetConst")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.SocketConnect="SocketConnect",e.StartReconnect="StartReconnect",e.SocketNotConnect="SocketNotConnect",e.SocketIOError="SocketIOError",e.SocketClose="SocketClose",t.EventConst=e,__reflect(e.prototype,"Tpm.EventConst")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.SocketClosePanel=0]="SocketClosePanel",t[t.SetPanel=1]="SetPanel",t[t.SharePanel=2]="SharePanel",t[t.ShopMallPanel=3]="ShopMallPanel",t[t.EmailPanel=4]="EmailPanel",t[t.PlayMethodPanel=5]="PlayMethodPanel",t[t.GiveMoneyPanel=6]="GiveMoneyPanel",t[t.MoneyNotEnoughPanel=7]="MoneyNotEnoughPanel",t[t.EmailDetailPanel=8]="EmailDetailPanel",t[t.PersonalInfoPanel=9]="PersonalInfoPanel",t[t.CommonMessageBoxPanel=10]="CommonMessageBoxPanel",t[t.ResultPanel=11]="ResultPanel"}(e=t.PanelConst||(t.PanelConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.PreloadScene=0]="PreloadScene",t[t.LoginScene=1]="LoginScene",t[t.HallScene=2]="HallScene",t[t.GameScene=3]="GameScene"}(e=t.SceneConst||(t.SceneConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initList(),e}return __extends(e,t),e.prototype.initList=function(){this.colorList=[0,16777215,16381141,7143430],this.fontList=["Microsoft YaHei"],this.sizeList=[]},e.prototype.getColor=function(t){return this.colorList[t]||0==this.colorList[t]||console.error("color null"),this.colorList[t]},e.prototype.getFont=function(t){return this.fontList[t]||console.error("font null"),this.fontList[t]},e.prototype.getSize=function(t){return this.sizeList[t]||console.error("size null"),this.sizeList[t]},e}(t.SingleClass);t.ArtConfig=e,__reflect(e.prototype,"Tpm.ArtConfig");var o;!function(t){t[t.black=0]="black",t[t.white=1]="white",t[t.middleTips=2]="middleTips",t[t.topTips=3]="topTips"}(o=t.ColorConst||(t.ColorConst={}));var n;!function(t){t[t.Microsoft=0]="Microsoft"}(n=t.FontConst||(t.FontConst={}));var r;!function(t){}(r=t.SizeConst||(t.SizeConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.UserInfo=new t.UserInfo,o.ServerInfo=new t.ServerInfo,o.deskInfo=new t.DeskInfo,o.runingData=new t.RuningData,o.debugInfo=new t.DebugInfo,o.MsgCache=new t.MsgCache,o.roomInfo=new t.RoomInfo,o}return __extends(o,e),o}(t.SingleClass);t.DataCenter=e,__reflect(e.prototype,"Tpm.DataCenter")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){this.password="123456"}return Object.defineProperty(t.prototype,"isDebug",{get:function(){return null!=egret.getOption("debug")&&""!=egret.getOption("debug")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocalPhp",{get:function(){return parseInt(egret.getOption("local"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Sever",{get:function(){return Number(egret.getOption("server"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"account",{get:function(){egret.getOption("debug");return"oldboy"+egret.getOption("debug")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipHall",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipNet",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipGameServer",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"testState",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoReady",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.DebugInfo=e,__reflect(e.prototype,"Tpm.DebugInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){this.deskID=0,this.ownerID=0,this.deskCode=0,this.gameID=0,this.basePoint=0,this.deskLevel=0,this.maxPlayCount=0,this.ownerName="",this.chip=0,this.deskNo=0,this.isGameRunning=!1,this.isPlaying=!1,this.peoplecount=0,this.playCount=0}return t.prototype.readData=function(t){this.deskID=t.deskID,this.ownerID=t.ownerID,this.deskCode=t.deskCode,this.gameID=t.gameid,this.deskLevel=t.deskLevel,this.chip=t,this.curPlayCount=t,this.curSitPeopleCoiunt=t,this.deposit=t.deposit,this.deskDesc=t.deskDesc,this.deskName=t.deskName,this.deskNo=t.deskNo,this.isGameRunning=t.isGameRunning,this.isPlaying=t.isPlaying,this.ownerName=t.ownerName,this.peoplecount=t.peoplecount,this.playCount=t.playCount,this.gameConfig=t.gameConfig,t.basepoint?this.basePoint=t.basepoint:t.basePoint&&(this.basePoint=t.basePoint)},t}();t.DeskInfo=e,__reflect(e.prototype,"Tpm.DeskInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();t.GameInfo=e,__reflect(e.prototype,"Tpm.GameInfo");var o;!function(t){t[t.Act_Cancle=-1]="Act_Cancle",t[t.Act_Pass=0]="Act_Pass",t[t.Act_Out=10]="Act_Out",t[t.Act_Chi=20]="Act_Chi",t[t.Act_Peng=30]="Act_Peng",t[t.Act_Gang=40]="Act_Gang",t[t.Act_BuGang=50]="Act_BuGang",t[t.Act_AnGang=60]="Act_AnGang",t[t.Act_Ting=70]="Act_Ting",t[t.Act_DianHu=80]="Act_DianHu",t[t.Act_Zimo=90]="Act_Zimo",t[t.Act_Fa=100]="Act_Fa",t[t.Act_Guohu=104]="Act_Guohu",t[t.Act_ZuheGang=101]="Act_ZuheGang",t[t.Act_Buhua=103]="Act_Buhua"}(o=t.ACT_state||(t.ACT_state={}));var n;!function(t){t[t.Act_cancle=-3]="Act_cancle",t[t.Act_ChangeCard=-2]="Act_ChangeCard",t[t.Act_GetCard=-1]="Act_GetCard",t[t.Act_Pass=0]="Act_Pass",t[t.Act_NormalDo=1]="Act_NormalDo",t[t.Act_Ting=2]="Act_Ting",t[t.Act_Chi=3]="Act_Chi",t[t.Act_Peng=4]="Act_Peng",t[t.Act_Gang=5]="Act_Gang",t[t.Act_AnGang=6]="Act_AnGang",t[t.Act_Hu=7]="Act_Hu",t[t.Act_Buhua=8]="Act_Buhua",t[t.Act_zimo=9]="Act_zimo",t[t.Act_Guohu=10]="Act_Guohu"}(n=t.ACT_act||(t.ACT_act={}));var r;!function(t){t[t.GS_WAIT_SETGAME=0]="GS_WAIT_SETGAME",t[t.GS_WAIT_ARGEE=1]="GS_WAIT_ARGEE",t[t.GS_GAME_PLAYING=2]="GS_GAME_PLAYING",t[t.GS_GAME_FINSHED=3]="GS_GAME_FINSHED"}(r=t.GS_GAME_STATION||(t.GS_GAME_STATION={}));var i;!function(t){t[t.TRSHIP=1]="TRSHIP",t[t.ESC=2]="ESC",t[t.READY=4]="READY",t[t.SETTLE=8]="SETTLE"}(i=t.PLAYER_STATE||(t.PLAYER_STATE={}));var a;!function(t){t[t.NULL=-1]="NULL",t[t.Down=0]="Down",t[t.Up=1]="Up",t[t.R=2]="R",t[t.L=3]="L"}(a=t.UserPosition||(t.UserPosition={}));var s;!function(t){t[t.boy=1]="boy",t[t.girl=2]="girl",t[t.unknow=3]="unknow"}(s=t.SEX_TYPE||(t.SEX_TYPE={}));var c;!function(t){t[t.Free=0]="Free",t[t.Ready=1]="Ready",t[t.DealCard=2]="DealCard",t[t.Playing=3]="Playing",t[t.Over=4]="Over"}(c=t.GameState||(t.GameState={}));var h;!function(t){t[t.UNREADY=1]="UNREADY",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.ESCAPE=4]="ESCAPE",t[t.OFFLINE=5]="OFFLINE"}(h=t.UserState||(t.UserState={}));var d=function(){function t(){}return t}();d.Name={17:"一万",18:"二万",19:"三万",20:"四万",21:"五万",22:"六万",23:"七万",24:"八万",25:"九万",65:"东",66:"南",67:"西",68:"北",81:"中",82:"发",83:"白"},t.CardName=d,__reflect(d.prototype,"Tpm.CardName");var p=function(){function t(){}return t.getHuTypeFan=function(t){return Math.floor(t%1e3/10)||1},t}();p.HuTypeName={1000:"屁胡",1001:"一般高",1002:"连六",1003:"老少妇",1004:"幺九刻",1005:"明杠",1006:"边张",1007:"坎张",1008:"单钓将",1009:"自摸",1021:"箭刻",1022:"门前清",1023:"平胡",1024:"四归一",1025:"双暗刻",1026:"暗杠",1027:"断幺",1028:"报听",1041:"全带幺",1042:"不求人",1043:"双明杠",1044:"胡绝张",1061:"碰碰胡",1062:"混一色",1063:"全球人",1064:"双箭刻",1081:"妙手回春",1082:"海底捞月",1083:"杠上开花",1084:"抢杠胡",1085:"双暗杠",1121:"三风刻",1161:"清龙",1162:"一色三步高",1163:"三暗刻",1242:"清一色",1243:"一色三同顺",1244:"一色三节高",1321:"一色四步高",1322:"三杠",1323:"混幺九",1324:"天听",1481:"一色四同顺",1482:"一色四节高",1641:"小四喜",1642:"小三元",1643:"四暗刻",1644:"字一色",1645:"一色双龙会",1646:"人胡",1881:"大四喜",1882:"大三元",1883:"九莲宝灯",1884:"四杠",1886:"天胡",1887:"地胡",2000:"七对",2885:"七连对",3000:"十三幺"},t.HuType=p,__reflect(p.prototype,"Tpm.HuType")
}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.emailItemData={icon:"",title:"",content:"",time:"",id:0},e.emailDetailData={icon:"",title:"",content:"",time:"",id:0},t.EmailData=e,__reflect(e.prototype,"Tpm.EmailData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.mallItemData={icon:"",money:"",price:""},t.MallData=e,__reflect(e.prototype,"Tpm.MallData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.infoData={action:"PersonalInfoHandler",data:{point:-77,accid:1,uid:9123,ratewinning:"5%",avater_url:"",totalgames:165,sex:1,highest_winning_streak:2,name:"abc"},ret:0,desc:"success"},t.PersonalInfoData=e,__reflect(e.prototype,"Tpm.PersonalInfoData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.wxShareData={shareType:"wxShare",type:0,title:"",content:"",picUrlstr:""},e.qqShareData={shareType:"qqShare",title:"",url:"",description:"",picUrlstr:""},t.ShareData=e,__reflect(e.prototype,"Tpm.ShareData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.loadBg="tpm_hall_bg_png",e.tipsBg="tpm_tips_bg_png",e.tipsTopBg="tpm_tips_top_bg_png",e.lockRotat="",t.ResPathConfig=e,__reflect(e.prototype,"Tpm.ResPathConfig")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.prototype.initData=function(t){this.roomType=t.room_type,this.roomName=t.name,this.minEnterGold=t.min_enter_gold,this.maxEnterGold=t.max_enter_gold,this.minPlayGold=t.min_play_gold,this.recommendPayNum=t.recommend_pay_num,this.outCardTime=t.draw_card_time,this.serviceCharge=t.service_charge,this.baseBet=t.base_bet,this.minHuFan=t.min_hu_fan,this.maxHuFan=t.max_hu_fan,this.specialRule=t.special_rule,this.curPlayerCount=t.cur_player_count},t}();t.RoomData=e,__reflect(e.prototype,"Tpm.RoomData");var o;!function(t){t[t.noob=0]="noob",t[t.middle=1]="middle",t[t.high=2]="high"}(o=t.RoomType||(t.RoomType={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.prototype.initList=function(e){this.roomList=[];for(var o=0;o<e.length;o++){var n=new t.RoomData;n.initData(e[o]),this.roomList.push(n)}this.roomList.sort(function(t,e){return t.roomType-e.roomType}),console.log("房间配置表：",this.roomList)},e.prototype.getConfigForType=function(t){return this.roomList?this.roomList[t]:void console.error("roominfo not init")},e.prototype.reRoomNum=function(t){if(!t||t.length<3)return void console.log("roomnum error");for(var e=0;e<t.length;e++)this.roomList[e].curPlayerCount=t[e]},e}();t.RoomInfo=e,__reflect(e.prototype,"Tpm.RoomInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.gameState=t.GameState.Free,this.socketClose=!1,this.bAllowOutCard=!1,this.ownTingState=!1,this.curentRoomType=t.RoomType.noob,this.selectBtnState=!1,this.ownGuoTimes=0}return Object.defineProperty(e.prototype,"guoHuFlag",{get:function(){return this.curentRoomType!=t.RoomType.noob?!0:!1},enumerable:!0,configurable:!0}),e.prototype.clearData=function(e){void 0===e&&(e=!0),this.gameState=t.GameState.Free,this.socketClose=!1,this.bAllowOutCard=!1,this.ownTingState=!1,this.selectBtnState=!1,e&&(this.curentRoomType=t.RoomType.noob),this.ownGuoTimes=0},e}();t.RuningData=e,__reflect(e.prototype,"Tpm.RuningData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.HTTP_FLAG_TEST=!0}return Object.defineProperty(e.prototype,"WEB_URL",{get:function(){var e="";switch(t.App.DataCenter.debugInfo.isLocalPhp){case 1:e="http://39.108.10.161:50006/majapi/";break;case 2:e="http://"+t.App.DataCenter.ServerInfo.HTTP_LOGIN_IP+"/majapi/";break;default:e="http://"+t.App.DataCenter.ServerInfo.HTTP_LOGIN_IP+"/majapi/"}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HTTP_LOGIN_IP",{get:function(){var t="oldboy.iespoir.com:8889";return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SERVER_URL",{get:function(){if(this._SERVER_URL&&!t.App.DataCenter.debugInfo.Sever)return this._SERVER_URL;var e=t.App.DataCenter.debugInfo.Sever;switch(e){case 1:return"ws://oldboy.iespoir.com:10000";default:return"ws://oldboy.iespoir.com:10000"}},set:function(t){this._SERVER_URL=t},enumerable:!0,configurable:!0}),e}();t.ServerInfo=e,__reflect(e.prototype,"Tpm.ServerInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return e.call(this)||this}return __extends(o,e),o.prototype.init=function(){t.App.SoundManager.allowPlayBGM=t.App.LocalStorageUtil.allowMusic,t.App.SoundManager.allowPlayEffect=t.App.LocalStorageUtil.allowEffect},o}(t.SingleClass);t.StorageConfig=e,__reflect(e.prototype,"Tpm.StorageConfig")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.userList={}}return Object.defineProperty(e.prototype,"myUserInfo",{get:function(){if(!this.myUserUid)return void console.error("uid null");var t=this.getUser(this.myUserUid);return t?t:void console.error("userinfo null")},enumerable:!0,configurable:!0}),e.prototype.addUser=function(t){this.userList[t.userID]?console.log("用户重复添加:",t.userID):this.userList[t.userID]=t;var e=this.getUserNum();e>2&&console.error("user > 2"),console.log("自己ID==",this.myUserUid),console.log("玩家列表==",this.userList)},e.prototype.getUser=function(t){return this.userList[t]},e.prototype.isExist=function(t){return this.getUser(t)?!0:!1},e.prototype.getUserBySeatID=function(t){for(var e in this.userList)if(this.userList[e].seatID==t)return this.userList[e]},e.prototype.getUserByPos=function(t){for(var e in this.userList)if(this.userList[e].userPos==t)return this.userList[e];return null},e.prototype.getUserByUserID=function(t){for(var e in this.userList)if(this.userList[e].userID==t)return this.userList[e]},e.prototype.deleteUser=function(t){delete this.userList[t]},e.prototype.deleteAllUserExcptMe=function(){for(var t in this.userList)parseInt(t)!=this.myUserInfo.userID&&delete this.userList[t]},e.prototype.deleteAllUser=function(){for(var t in this.userList)delete this.userList[t]},e.prototype.getUserNum=function(){return t.ArrayTool.getObjectLength(this.userList)},e.prototype.getPosFromSeat=function(e){return console.log("isMine--------",this.myUserInfo.seatID==e),this.myUserInfo.seatID==e?t.UserPosition.Down:t.UserPosition.Up},e.prototype.getSeatFromPos=function(t){var e=this.getUserByPos(t);return e.seatID},e.prototype.isZhuang=function(t){var e=this.getUserByUserID(t);return e.zhuangFlag?!0:!1},e.prototype.clearZhuang=function(){for(var t in this.userList)this.userList[t].zhuangFlag=!1},e}();t.UserInfo=e,__reflect(e.prototype,"Tpm.UserInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this._userID=0,this.nickName="",this.sex=t.SEX_TYPE.girl,this._headUrl="",this.skey="",this.deviceID="111",this.diamond=0,this.seatID=0,this.gold=0,this.zhuangFlag=!1}return e.prototype.initUserFromHttp=function(e){this._userID=e.uid,this.nickName=e.nick_name,this.headUrl="1"==e.avater_url?"":e.avater_url,this.skey=e.skey,this.sex=e.sex,this.diamond=e.diamond,this.gold=e.money,this.userPos=t.UserPosition.Down},e.prototype.initUserFromSocket=function(e){this._userID=e.user_id,this.nickName=e.nick,this.seatID=e.seat_id,this.gold=e.point,this.state=e.status,this._userID==t.App.DataCenter.UserInfo.myUserUid?this.userPos=t.UserPosition.Down:this.userPos=t.UserPosition.Up},Object.defineProperty(e.prototype,"headUrl",{get:function(){return this._headUrl},set:function(t){1==t?this._headUrl="":this._headUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userID",{get:function(){return this._userID},enumerable:!0,configurable:!0}),e}();t.UserVO=e,__reflect(e.prototype,"Tpm.UserVO")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.revGoodsList=function(e){var o=t.ProtocolHttpData.GoodsListData;o=e,o.ret?t.Tips.showTop(o.desc):t.App.PanelManager.open(t.PanelConst.ShopMallPanel,!1,null,null,!0,!0,o.data)},o.revBuyProp=function(e){var o=t.ProtocolHttpData.GoodsListData;o=e,o.ret&&(303==o.ret?t.App.PlatformBridge.sendPlatformEvent(t.PlatFormEventConst.payStart):t.Tips.showTop(o.desc))},o.revEmailList=function(e){var o=t.ProtocolHttpData.EmailListData;o=e,o.ret&&400!=o.ret?t.Tips.showTop(o.desc):t.App.PanelManager.open(t.PanelConst.EmailPanel,!1,null,null,!0,!0,o.data)},o.revEmailDetail=function(e){var o=t.ProtocolHttpData.emailDeatilData;o=e,o.ret?t.Tips.showTop(o.desc):t.App.PanelManager.open(t.PanelConst.EmailDetailPanel,!1,null,null,!0,!0,o.data)},o.revUserInfo=function(e){var o=t.ProtocolHttpData.PersonalInfoData;o=e,o.ret?t.Tips.showTop(o.desc):t.App.PanelManager.open(t.PanelConst.PersonalInfoPanel,!1,null,null,!0,!0,o.data)},o.revMoneyMsg=function(e){var o=t.ProtocolHttpData.PersonalInfoData;if(o=e,o.ret)t.Tips.showTop(o.desc);else{var n=t.App.SceneManager.getScene(t.SceneConst.HallScene);n&&n.headMod.updateDiamondAndGold(o.data.diamond,o.data.money)}},o.revIncomeSupportMsg=function(e){var o=t.ProtocolHttpData.GiveMoneyData;o=e,o.ret?t.Tips.showTop(o.desc):t.App.PanelManager.open(t.PanelConst.GiveMoneyPanel,!1,null,this,!1,!0,o.data)},o.revIncomeSupport=function(e){var o=t.ProtocolHttpData.GiveMoneyData;if(o=e,o.ret)t.Tips.showTop(o.desc);else{t.App.SceneManager.getScene(t.SceneConst.HallScene)}},o}(t.SingleClass);t.HallHttpDataReceive=e,__reflect(e.prototype,"Tpm.HallHttpDataReceive")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.sendGetGoodsList=function(e){void 0===e&&(e=1);var o=t.ProtocolHttp.GetGoodsList;o.param.type=e,t.App.httpSender.send(o,t.HallHttpDataReceive.revGoodsList,this)},o.sendBuyProp=function(e){void 0===e&&(e=1);var o=t.ProtocolHttp.BuyProp;o.param.goodid=e,t.App.httpSender.send(o,t.HallHttpDataReceive.revBuyProp,this)},o.sendGetEmailList=function(){var e=t.ProtocolHttp.GetEmailList;t.App.httpSender.send(e,t.HallHttpDataReceive.revEmailList,this)},o.sendReadEmail=function(e){var o=t.ProtocolHttp.ReadEmail;o.param.id=e,t.App.httpSender.send(o,t.HallHttpDataReceive.revEmailDetail,this)},o.sendGetUserInfo=function(){var e=t.ProtocolHttp.getUserInfo;t.App.httpSender.send(e,t.HallHttpDataReceive.revUserInfo,this)},o.sendGetDiamondAndGold=function(){var e=t.ProtocolHttp.getMoneyMsg;t.App.httpSender.send(e,t.HallHttpDataReceive.revMoneyMsg,this)},o.sendGetIncomeSupportMsg=function(){var e=t.ProtocolHttp.GetIncomeSupportMsg;t.App.httpSender.send(e,t.HallHttpDataReceive.revIncomeSupportMsg,this)},o.sendGetIncomeSupport=function(){var e=t.ProtocolHttp.GetIncomeSupport;t.App.httpSender.send(e,t.HallHttpDataReceive.revIncomeSupport,this)},o}(t.SingleClass);t.HallHttpDataSend=e,__reflect(e.prototype,"Tpm.HallHttpDataSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t._gameVersion="1.0.0",t._ContentSize={contentWidth:750,contentHeight:1334},t}return __extends(o,e),o.prototype.setUserInfo=function(t){this.userInfo=t},Object.defineProperty(o.prototype,"gameVersion",{get:function(){return this._gameVersion},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"ContentSize",{get:function(){return this._ContentSize},enumerable:!0,configurable:!0}),o.prototype.linstenPlatformEvent=function(e,o){switch(void 0===o&&(o=null),e){case t.PlatFormEventConst.gameStart:break;case t.PlatFormEventConst.payEnd:break;case t.PlatFormEventConst.shareEnd:}},o.prototype.sendPlatformEvent=function(t,e){return void 0===e&&(e=null),this.platformCallback?this.platformCallback(t,e):void console.error("platformCallback is null")},o}(t.SingleClass);t.PlatformBridge=e,__reflect(e.prototype,"Tpm.PlatformBridge")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.setUseInfo="setUseInfo",e.gameStart="gameStart",e.gameEnd="gameEnd",e.payStart="payStart",e.payEnd="payEnd",e.shareStart="shareStart",e.shareEnd="shareEnd",t.PlatFormEventConst=e,__reflect(e.prototype,"Tpm.PlatFormEventConst")}(Tpm||(Tpm={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,o,n){function r(t){e.call(n,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),o.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Tpm;!function(t){var e=function(){function t(){}return t}();e.S_common={},e.S_100002={user_id:0,passwd:""},e.S_100010={user_id:0},e.S_100100={user_id:0,ready:0},e.S_100103={user_id:0},e.S_100104={user_id:0},e.S_100105={user_id:0,room_type:0},e.S_100130={user_id:0},e.S_100140={user_id:0,act:0,act_params:null},e.S_100112={user_id:0},e.S_100999={user_id:0,test_type:0,test_params:"{}"},t.ProtocolDataSend=e,__reflect(e.prototype,"Tpm.ProtocolDataSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.R_100002="100002",e.R_100010="100010",e.R_100100="100100",e.R_100103="100103",e.R_100104="100104",e.R_100105="100105",e.R_101001="101001",e.R_101002="101002",e.R_101003="101003",e.R_101004="101004",e.R_101005="101005",e.R_101006="101006",e.R_101007="101007",e.R_101008="101008",e.R_101100="101100",e.R_101101="101101",e.R_101105="101105",e.R_101106="101106",e.R_101107="101107",e.R_101109="101109",e.R_101110="101110",e.R_101112="101112",e.R_100999="100999",t.ProtocolHeadRev=e,__reflect(e.prototype,"Tpm.ProtocolHeadRev")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.S_100002="100002",e.S_100010="100010",e.S_100100="100100",e.S_100103="100103",e.S_100104="100104",e.S_100105="100105",e.S_100130="100130",e.S_100140="100140",e.S_100112="100112",e.S_100999="100999",t.ProtocolHeadSend=e,__reflect(e.prototype,"Tpm.ProtocolHeadSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.httpHead={ver:"1.6.1",AssetID:1,mainID:100},e.rev_z_login={ret:0,desc:"",action:"",mainID:0,AssetID:0,data:{hadinvited:1,deskTime:"",user:"",name:"",sex:-1,skey:"",avater_url:"",password:"",is_overtime:0,last_ip:"",uid:0,ip:"",port:"",prushport:"",excluroom_name:"",excluroom_code:"",round_card_num:0,login_days:0,payment:"",point:0,is_visitor:0}},e.GetGoodsList={action:"getgood",skey:"",uid:0,param:{type:0}},e.BuyProp={action:"BuyProp",skey:"",uid:0,param:{goodid:0}},e.send_z_buySure={action:"PlaceOrder",skey:"",uid:0,param:{goodsid:1,pay_type:1,independent:0,platform:1}},e.GetEmailList={action:"GetEmail",skey:"",uid:0,param:[]},e.ReadEmail={action:"ReadEmail",skey:"",uid:0,param:{id:0}},e.GetReward={action:"confirmemail",skey:"",uid:0,param:{id:0}},e.GetIncomeSupportMsg={action:"getincomesupport",skey:"",uid:0,param:[]},e.GetIncomeSupport={action:"receiveincomesupport",skey:"",uid:0,param:[]},e.getUserInfo={action:"getpersonal",skey:"",uid:0,param:{}},e.getMoneyMsg={action:"getcurrency",skey:"",uid:0,param:{}},e.getShareRecord={action:"CombatGainsShare",skey:"",uid:0,param:{deskBuildDate:"0",deskCode:"0"}},e.getQrCodeImg={action:"ShareByQrcode",skey:"",uid:0,param:{}},e.getRoomInfo={action:"get_hall_room_info",skey:"",uid:0,param:{}},e.getRoomNum={action:"get_hall_room_people_count",skey:"",uid:0,param:{}},e.getHeadInfo={action:"get_userinfo",skey:"",uid:0,param:{base:{uid:0}}},t.ProtocolHttp=e,__reflect(e.prototype,"Tpm.ProtocolHttp")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.LoginData={ret:0,action:"handler.login_handler",data:{diamond:0,uid:0,avater_url:"",ip:"",sex:0,user:"",password:"",port:0,accid:0,skey:"",name:"",point:0,payment:0,is_visitor:0,money:0},desc:"success"},e.GoodsListData={ret:-1,action:"",data:[],desc:""},e.GoodsListItemData={icon:"",title:"",rmb_price:0,selling_price:0,id:0},e.EmailListData={ret:-1,action:"",data:[],desc:""},e.EmailListItemData={icon:"",time_desc:"",id:0,title:"",content:""},e.emailDeatilData={data:{content:"",reward:[],is_receive:"0",eid:0,title:""},ret:-1,desc:"success"},e.RewardItem={reward_name:"局数卡",reward_quantity:"0",reward_icon:0},e.PersonalInfoData={data:{point:0,accid:-1,uid:0,winning_rate:"0",avater_url:"",total:0,sex:0,highest_winning_streak:0,nick_name:"",diamond:0,money:0},ret:0,desc:""},e.MoneyNotEnoughData={lowestmoney:8e3,type:"高",selling_price:10,quantity:5e3},e.GiveMoneyData={ret:0,desc:"success",data:{income_support_times:0,allcount:"三",money:8e4}},e.RoomInfoData={ret:0,desc:"success",data:{room_cfg_info:[{max_enter_gold:0,recommend_pay_num:0,draw_card_time:0,id:1,service_charge:0,base_bet:0,max_hu_fan:0,min_hu_fan:6,name:"初级场",cur_player_count:0,min_play_gold:0,special_rule:"{}",min_enter_gold:0,room_type:0}]}},t.ProtocolHttpData=e,__reflect(e.prototype,"Tpm.ProtocolHttpData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.touchEnabled=!0,t}return __extends(o,e),o.prototype.showMsg=function(e,o,n,r,i){void 0===o&&(o=!1),void 0===n&&(n=null),void 0===r&&(r=null),void 0===i&&(i=null),this.ok=n,this.thisObject=r,this.cancel=i,this.blackBg.visible=o,null==this.parent&&(t.App.LayerManager.msgLayer.addChild(this),this.x=(t.App.StageUtils.stageWidth-this.width)/2,this.y=(t.App.StageUtils.stageHeight-this.height)/2),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBt,this),this.msgLabel.text=e},o.prototype.onTouch=function(t){switch(t.target){case this.sureBtn:this.ok&&this.ok.call(this.thisObject),this.hideAndRecycle();break;case this.cancelBtn||this.close:this.cancel&&this.cancel.call(this.thisObject),this.hideAndRecycle()}},o.prototype.closeBt=function(){this.hideAndRecycle()},o.prototype.leftTitle=function(t){this.cancelBtn.label=t},o.prototype.centerTitle=function(t){this.sureBtn.label=t},o.prototype.rightTitle=function(t){this.sureBtn.label=t},o.prototype.hideAndRecycle=function(){egret.Tween.removeTweens(this),this.ok=null,this.cancel=null,this.thisObject=null,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.cancelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBt,this),this.hide()},o.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},o}(eui.Component);e.NAME="MessageBox",t.MessageBox=e,__reflect(e.prototype,"Tpm.MessageBox")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.boxPool=t.ObjectPool.getPool(t.MessageBox.NAME),o}return __extends(o,e),o.prototype.getBox=function(){var t=this.boxPool.getObject();return t.skinName="TpmSkin.MessageBoxSkin",t},o.prototype.recycle=function(t){this.boxPool.returnObject(t)},o.prototype.recycleAllBox=function(){for(var e=t.App.LayerManager.msgLayer,o=e.numChildren,n=o-1;n>=0;n--){var r=e.getChildAt(n);r&&r instanceof t.MessageBox&&r.hideAndRecycle()}},o}(t.SingleClass);t.MessageBoxManager=e,__reflect(e.prototype,"Tpm.MessageBoxManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TpmSkin.CommonMessageBoxPanelSkin",e}return __extends(e,t),e.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},e.prototype.recDataFun=function(t){t.content&&""!=t.content&&(this.tipsMessage.text=t.content)},e.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},e}(t.BasePanel);t.CommonMessageBoxPanel=e,__reflect(e.prototype,"Tpm.CommonMessageBoxPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailDetailPanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.NcloseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.HcloseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.getGiftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){var o=t.ProtocolHttpData.emailDeatilData.data;o=e;var n=o.reward.length;if(0==n)this.hasGiftGroup.visible=!1,this.noGiftGroup.visible=!0,this.NemailDetailtitle.text=o.title,this.NemailDetailcontent.text=o.content;else{this.hasGiftGroup.visible=!0,this.noGiftGroup.visible=!1;var r=t.ProtocolHttpData.RewardItem;r=o.reward[0],this.giftNum.text="×"+r.reward_quantity,this.HemailDetailtitle.text=o.title,this.HemailDetailcontent.text=o.content}},o.prototype.getReward=function(){},o.prototype.onRemove=function(){this.HcloseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.NcloseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.getGiftBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getReward,this),this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o}(t.BasePanel);t.EmailDetailPanel=e,__reflect(e.prototype,"Tpm.EmailDetailPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailItemSkin",t}return __extends(o,e),o.prototype.dataChanged=function(){var e=t.ProtocolHttpData.EmailListItemData;e=this.data,""!=e.icon&&(this.emailIcon.source=e.icon),this.emailTitle.text=e.title,this.emailContent.text=e.content,this.sendTime.text=e.time_desc.substr(5),this.id=e.id},o.prototype.childrenCreated=function(){this.readEmailBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readEmail,this)},o.prototype.readEmail=function(e){t.HallHttpDataSend.sendReadEmail(this.id)},o}(eui.ItemRenderer);t.EmailItem=e,__reflect(e.prototype,"Tpm.EmailItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailPanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){var o=new eui.ArrayCollection,n=[],r=e.length;if(r>0){this.emailEmptyGroup.visible=!1;for(var i=0;r>i;i++){var a=t.ArrayTool.deepCopy(t.ProtocolHttpData.EmailListItemData);a.id=e[i].id,a.content=t.StringTool.formatNickName(e[i].content,26),a.title=t.StringTool.formatNickName(e[i].title,20),a.time_desc=e[i].time_desc,n.push(a)}o.source=n,this.emailList.itemRenderer=t.EmailItem,this.emailList.dataProvider=o}else this.emailEmptyGroup.visible=!0},o.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o}(t.BasePanel);t.EmailPanel=e,__reflect(e.prototype,"Tpm.EmailPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.GiveMoneyPanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.getMoneyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.onRemove=function(){this.getMoneyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){this.recData=e;var o=t.ProtocolHttpData.GiveMoneyData.data;o=e;var n=t.NumberTool.sperateMoney(o.money);this.contentText.text="您的金币不足！系统赠送您"+n+"金币，今天第"+t.NumberTool.formatCapital(o.income_support_times)+"次领取，一共可领取三次",this.moneyText.text=n},o.prototype.onSure=function(e){t.HallHttpDataSend.sendGetIncomeSupport()},o}(t.BasePanel);t.GiveMoneyPanel=e,__reflect(e.prototype,"Tpm.GiveMoneyPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.MoneyNotEnoughPanelSkin,t}return __extends(o,e),o.prototype.onEnable=function(){this.buyMoneyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.onRemove=function(){this.buyMoneyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){this.recData=e;var o=t.ProtocolHttpData.MoneyNotEnoughData,n=t.NumberTool.sperateMoney(o.lowestmoney),r=t.NumberTool.sperateMoney(o.quantity),i=o.type,a={size:28,textColor:16576476,fontFamily:"Microsoft YaHei"},s={size:28,textColor:16771840,fontFamily:"SimHei",bold:"true"};this.tipsText.textFlow=[{text:"您需要拥有  ",style:a},{text:n+"金币",style:s},{text:"才能进入"+i+"级场",style:a}],this.moneyText.text=r,this.priceText.text="价值"+o.selling_price+"元"},o.prototype.updateRecommendGood=function(e){var o=t.ProtocolHttpData.MoneyNotEnoughData;o=e,this.moneyText.text=o.quantity+"",this.priceText.text="价值"+o.selling_price+"元"},o.prototype.onSure=function(t){},o}(t.BasePanel);t.MoneyNotEnoughPanel=e,__reflect(e.prototype,"Tpm.MoneyNotEnoughPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.ShopMallItemSkin,t}return __extends(o,e),o.prototype.dataChanged=function(){var e=t.ProtocolHttpData.GoodsListItemData;e=this.data,this.moneyIcon.source="tpm_moneyIcon"+e.icon+"_png",this.moneyText.text=e.title,this.priceText.text="价值"+e.rmb_price+"元",this.buyBtn.getChildAt(2).text=e.selling_price+"",this.id=e.id},o.prototype.childrenCreated=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this)},o.prototype.onBuy=function(e){t.HallHttpDataSend.sendBuyProp(this.id)},o}(eui.ItemRenderer);t.ShopMallItem=e,__reflect(e.prototype,"Tpm.ShopMallItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.ShopMallPanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){var o=new eui.ArrayCollection,n=[],r=t.ProtocolHttpData.GoodsListData.data;r=e;for(var i=r.length,a=0;i>a;a++){var s=t.ArrayTool.deepCopy(t.ProtocolHttpData.GoodsListItemData);s.icon=r[a].icon,s.id=r[a].id,s.selling_price=r[a].selling_price,s.rmb_price=r[a].rmb_price,s.title=r[a].title,n.push(s)}o.source=n,this.mallList.itemRenderer=t.ShopMallItem,this.mallList.dataProvider=o},o.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o}(t.BasePanel);t.ShopMallPanel=e,__reflect(e.prototype,"Tpm.ShopMallPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.SocketClosePanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this)},o.prototype.onRemove=function(){this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this)},o.prototype.onSure=function(e){t.App.DataCenter.runingData.clearData(),t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),t.App.getController(t.LoginController.NAME).connectGameServer(),t.App.PanelManager.closeAllPanel(),this.hide()},o}(t.BasePanel);t.SocketClosePanel=e,__reflect(e.prototype,"Tpm.SocketClosePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.PersonalInfoPanelSkin,t}return __extends(o,e),o.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.recDataFun=function(e){var o=t.ProtocolHttpData.PersonalInfoData.data;o=e,this.headImg.source=o.avater_url,this.nick.text=t.StringTool.formatNickName(o.nick_name,12),this.id.text=o.uid+"",this.golds.text=t.NumberTool.sperateMoney(o.money),this.diamonds.text=o.diamond+"",this.totalCount.text=o.total+"",this.highestWinCount.text=o.highest_winning_streak+"场",this.winRate.text=o.winning_rate},o.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o}(t.BasePanel);t.PersonalInfoPanel=e,__reflect(e.prototype,"Tpm.PersonalInfoPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.FanTypeItemSkin",t}return __extends(o,e),o.prototype.setName=function(t){this.nameLabel.text=t},o.prototype.setDescripe=function(t){if(this.descripeLabel.text=t,this.descripeLabel.numLines>=2){var e=this.descripeLabel.size*(this.descripeLabel.numLines-1);this.cardGroup.y+=e,this.height+=e}},o.prototype.setCardList=function(e){for(var o,n=e.length,r=t.CardFactory.getInstance(),i=0;n>i;i++)o=r.getOutCard(e[i],t.UserPosition.Down),o.scaleX=.9,o.scaleY=.9,o.x=.8*58*i,o.y=0,this.cardGroup.addChild(o);0==n&&(this.height=this.height-this.cardGroup.height)},o}(eui.Component);t.FanTypeItem=e,__reflect(e.prototype,"Tpm.FanTypeItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.contentList=[],t.styleList=[],t.skinName=TpmSkin.PlayMethodPanelSkin,t}return __extends(o,e),o.prototype.onEnable=function(){this.showTargetScroller(0,!0),this.setContenTex(),this.setFanType(),this.playMethodtabBar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPlayMethod,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.onRemove=function(){this.playMethodtabBar.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showPlayMethod,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.onDestory=function(){this.removeChildren()},o.prototype.showPlayMethod=function(t){this.showTargetScroller(this.playMethodtabBar.selectedIndex)},o.prototype.setContenTex=function(){if(!this.textIsInt){var t={size:27.2,textColor:3607296,fontFamily:"SimHei",bold:"true"},e={size:26.2,textColor:3607296,fontFamily:"SimHei"};this.contentList=[this.baseRuleText,this.tsRuleText,this.resultRuleText],this.styleList=[t,e],this.setAllTextContent(),this.textIsInt=!0}},o.prototype.addLine=function(t,e){var o=new eui.Image;o.source=RES.getRes("tpm_line_png"),o.x=t,o.y=e,o.width=this.baseRuleText.width,o.height=1,this.baseRuleScroller.viewport.addChild(o)},o.prototype.setAllTextContent=function(){for(var t=RES.getRes("tpm_baseRuleConf_json"),e=t.content.length,o=(this.contentGroup.numChildren,0);e>o;o++)this.setTextContent(this.contentList[o],t.content[o]);this.addLine(40,90),this.addLine(40,310)},o.prototype.setTextContent=function(t,e){for(var o=e.length,n=[],r=0;o>r;r++){var i={};i.text=e[r].text,i.style=this.styleList[Number(e[r].style)],n.push(i)}t.textFlow=n},o.prototype.setFanType=function(){if(!this.fanTypeIsInt){for(var e=RES.getRes("tpm_fanTypeConf_json"),o=e.content.length,n=this.baseTypeScroller.viewport,r=this.baseTypeScroller.width,i=o-1;i>0;i--)for(var a=e.content[i].length,s=0;a>s;s++){var c=e.content[i][s];if(0==s){var h=new eui.Label(c.fanNum);h.size=27.2,h.width=r,h.textColor=3607296,h.fontFamily="SimHei",h.textAlign="left",n.addChild(h),s=1,c=e.content[i][s]}var d=new t.FanTypeItem;d.setDescripe(c.name+"："+c.descripe),d.setCardList(c.cardList),n.addChild(d)}this.fanTypeIsInt=!0}},o.prototype.showTargetScroller=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),this.playMethodtabBar.selectedIndex=t;for(var o=this.contentGroup.numChildren,n=0;o>n;n++){var r=this.contentGroup.getChildAt(n);n==t?r.visible=!0:r.visible=!1,e&&(r.viewport.scrollV=0)}},o}(t.BasePanel);t.PlayMethodPanel=e,__reflect(e.prototype,"Tpm.PlayMethodPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TpmSkin.ResultFanItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.nameLab.text=this.data.name,this.fanLab.text=this.data.fan+""},e}(eui.ItemRenderer);t.ResultFanItem=e,__reflect(e.prototype,"Tpm.ResultFanItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;
return t.skinName="TpmSkin.ResultPanelSkin",t}return __extends(n,e),Object.defineProperty(n.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.showResult(),this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.changeBtnT.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.continueBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.continueBtnT.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this)},n.prototype.onRemove=function(){this.cardGro.removeChildren(),this.changeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.changeBtnT.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.continueBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.continueBtnT.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this)},n.prototype.onChange=function(){t.App.SceneManager.getScene(t.SceneConst.GameScene).clearDesk(!1),t.App.getController(t.GameController.NAME).sendMod.sendReady(),this.hide()},n.prototype.onContinue=function(){t.App.SceneManager.getScene(t.SceneConst.GameScene).clearDesk(!1),t.App.getController(t.GameController.NAME).sendMod.sendReady(),this.hide()},n.prototype.onBack=function(){var e=t.App.SceneManager.getScene(t.SceneConst.GameScene).readyMod;e.visible=!0,e.setState(t.ReadyState.ready_00),this.hide()},n.prototype.showResult=function(){var e=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101006);if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101006.info;n=e.info;var r;if(n.detail[0].params.hu_seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID)r=o.win;else{if(-1==n.detail[0].params.hu_seat_id)return r=o.liu,void this.showResultType(r);r=o.lose}this.showResultType(r);var i=t.ArrayTool.deepCopy(n.detail[0].params.hand_card_for_settle_show);this.showCardList(i),this.fanNumLab.text=n.detail[0].params.hu_fan_count+"",t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob?(this.guoGro.visible=!0,this.guoTimesLab.text=n.detail[0].params.guo_hu_count+""):this.guoGro.visible=!1;var a="+";this.goldLab.font="tpm_result_win_fnt",n.detail[0].points[t.App.DataCenter.UserInfo.myUserInfo.seatID]<0&&(a="",this.goldLab.font="tpm_result_lose_fnt"),this.goldLab.text=a+n.detail[0].points[t.App.DataCenter.UserInfo.myUserInfo.seatID]+"",this.showFanType(n.detail[0].params.type_list)},n.prototype.showResultType=function(t){switch(t){case o.liu:this.liuGro.visible=!0,this.huGro.visible=!1;break;case o.lose:this.liuGro.visible=!1,this.huGro.visible=!0,this.loseBgGro.visible=!0,this.winBgGro.visible=!1;break;case o.win:this.liuGro.visible=!1,this.huGro.visible=!0,this.loseBgGro.visible=!1,this.winBgGro.visible=!0;break;default:console.error("result type error")}},n.prototype.showFanType=function(e){for(var o=[],n=0;n<e.length;n++){var r={name:"",fan:0};r.name=t.HuType.HuTypeName[e[n]],r.fan=t.HuType.getHuTypeFan(e[n]),o.push(r)}var i=new eui.ArrayCollection;i.source=o,this.fanList.itemRenderer=t.ResultFanItem,this.fanList.dataProvider=i},n.prototype.showCardList=function(e){for(var o=0,n=70,r=t.UserPosition.Down,i=0;i<e.length;i++){var a=e[i];if(i==e.length-1){var s=this.cardFactory.getHandCard(a[0],r);s.x=t.CardPos.moCardPosXList[r],s.y=14,this.cardGro.addChild(s)}else if(i==e.length-2)for(var c=0,h=0;h<a.length;h++){var s=this.cardFactory.getHandCard(a[h],r);s.x=n+t.CardPos.handCardGapList[r]*(3*o+c),s.y=14,this.cardGro.addChild(s),c++}else if(3==a.length){for(var h=0;3>h;h++){var s=this.cardFactory.getEatCard(a[h],r);s.x=n+3*t.CardPos.handCardGapList[r]*o+t.CardPos.eatCardGapList[r]*h,s.y=37,this.cardGro.addChild(s)}o++}else if(4==a.length&&0!=a[1]){for(var h=0;4>h;h++){var s=this.cardFactory.getEatCard(a[h],r);3>h?(s.x=n+3*t.CardPos.handCardGapList[r]*o+t.CardPos.eatCardGapList[r]*h,s.y=37):(s.x=n+3*t.CardPos.handCardGapList[r]*o+1*t.CardPos.eatCardGapList[r],s.y=15),this.cardGro.addChild(s)}o++}else if(4==a.length&&0==a[1]){a[3]=a[0],a[0]=0;for(var h=0;4>h;h++)if(3>h){var s=this.cardFactory.getAnGangCard(a[h],r);s.x=n+3*t.CardPos.handCardGapList[r]*o+t.CardPos.eatCardGapList[r]*h,s.y=37,this.cardGro.addChild(s)}else{var s=this.cardFactory.getEatCard(a[h],r);s.x=n+3*t.CardPos.handCardGapList[r]*o+1*t.CardPos.eatCardGapList[r],s.y=15,this.cardGro.addChild(s)}o++}}},n}(t.BasePanel);t.ResultPanel=e,__reflect(e.prototype,"Tpm.ResultPanel");var o;!function(t){t[t.win=0]="win",t[t.lose=1]="lose",t[t.liu=2]="liu"}(o||(o={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.SetPanelSkin",t}return __extends(o,e),o.prototype.childrenCreated=function(){this.hallSetGroup.visible=!1,this.bgMusic_hallBtn.selected=!t.App.LocalStorageUtil.allowMusic,this.effectMusic_hallBtn.selected=!t.App.LocalStorageUtil.allowEffect},o.prototype.onEnable=function(){this.hallSetGroup.visible=!1,this.gameBool?this.hallSetGroup.visible=!1:(this.hallSetGroup.visible=!0,this.bgMusic_Btn=this.bgMusic_hallBtn,this.effectMusic_Btn=this.effectMusic_hallBtn,this.closeBtn=this.closeBtnHall),this.bgMusic_Btn.selected=!t.App.LocalStorageUtil.allowMusic,this.effectMusic_Btn.selected=!t.App.LocalStorageUtil.allowEffect,this.hallSetGroup.visible=!0,this.bgMusic_Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.effectMusic_Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},o.prototype.onRemove=function(){this.bgMusic_Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.effectMusic_Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.gameBool=!1},o.prototype.onClose=function(){this.hide()},o.prototype.setToggleSwitchTouch=function(e){var o=!e.target.selected;switch(e.target){case this.bgMusic_Btn:t.App.LocalStorageUtil.allowMusic=t.App.SoundManager.allowPlayBGM=o,t.App.SoundManager.allowPlayBGM&&t.App.SceneManager.getCurScene()instanceof t.GameScene||t.App.SoundManager.stopBGM();break;case this.effectMusic_Btn:t.App.LocalStorageUtil.allowEffect=t.App.SoundManager.allowPlayEffect=o}},o}(t.BasePanel);t.SetPanel=e,__reflect(e.prototype,"Tpm.SetPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.SharePanelSkin",t}return __extends(o,e),o.prototype.onEnable=function(){this.wxShareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.wxShareFriendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.qqShareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.onRemove=function(){this.wxShareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.wxShareFriendBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.qqShareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},o.prototype.setShareType=function(t){var e=0;switch(t.target){case this.wxShareBtn:e=0;break;case this.wxShareFriendBtn:e=1;break;case this.qqShareBtn:e=2}this.onShare(e)},o.prototype.onShare=function(e){var o;switch(e){case 0:o=t.ShareData.wxShareData,o.type=0;break;case 1:o=t.ShareData.wxShareData,o.type=1;break;case 2:o=t.ShareData.qqShareData}t.App.PlatformBridge.sendPlatformEvent(t.PlatFormEventConst.shareStart,o),t.Tips.showTop("分享请求已发送！")},o}(t.BasePanel);t.SharePanel=e,__reflect(e.prototype,"Tpm.SharePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.bmdList=[],e.curFrame=0,e.totalFrame=0,e.delay=33,e.loop=1,e}return __extends(e,t),e.prototype.setImgBuffer=function(t,e,o){for(var n=o-e,r=0;n>=r;r++)this.bmdList.push(RES.getRes(t+r+"_png"));this.curFrame=0,this.bitmapData=this.bmdList[0],this.totalFrame=this.bmdList.length},e.prototype.play=function(t){void 0===t&&(t=1),this.loop=t,this.startTimer()},e.prototype.gotoAndPlay=function(t,e){void 0===e&&(e=1),this.curFrame=t,this.bitmapData=this.bmdList[this.curFrame],this.play(e)},e.prototype.stop=function(){this.stopTimer()},e.prototype.startTimer=function(){this.animTimer||(this.animTimer=new egret.Timer(this.delay)),this.animTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.animTimer.delay=this.delay,this.animTimer.reset(),this.animTimer.start()},e.prototype.onTimer=function(){if(this.curFrame==this.totalFrame){if(this.loop--,!(this.loop>0))return this.stopTimer(),void this.dispatchEvent(new egret.Event(egret.Event.COMPLETE));this.gotoAndPlay(0,this.loop)}this.bitmapData=this.bmdList[this.curFrame],this.curFrame++},e.prototype.stopTimer=function(){this.animTimer&&(this.animTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.animTimer.stop())},e}(egret.Bitmap);t.BitmapMovie=e,__reflect(e.prototype,"Tpm.BitmapMovie")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.upDist=20,t.initPosY=0,t.cardBg=new eui.Image,t.cardImg=new eui.Image,t.addChild(t.cardBg),t.addChild(t.cardImg),t.touchChildren=!1,t.touchEnabled=!1,t._bUp=!1,t}return __extends(o,e),Object.defineProperty(o.prototype,"cardValue",{get:function(){return this._cardValue},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"userPos",{get:function(){return this._userPos},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bUp",{get:function(){return this._bUp},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"initY",{get:function(){return this.initPosY},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"arrowState",{get:function(){return this._arrowState},enumerable:!0,configurable:!0}),o.prototype.setArrow=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):(this._arrowState=e,this.cardArrow&&this.cardArrow.parent&&this.cardArrow.parent.removeChild(this.cardArrow),void(e&&(this.cardArrow=new eui.Image,this.cardArrow.source=RES.getRes("tpm_card_arrow_png"),this.cardArrow.x=24,this.cardArrow.y=-41,this.addChild(this.cardArrow))))},o.prototype.setGray=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):void(e?(this.cardMask.visible=!0,this.touchEnabled=!1):(this.cardMask.visible=!1,this.touchEnabled=!0))},o.prototype.setBack=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):void(e?(this.cardBack.visible=!0,this.touchEnabled=!1):(this.cardBack.visible=!1,this.touchEnabled=!0))},o.prototype.setCardValueAndSHow=function(t){this._cardValue=t,this.cardImg.source=RES.getRes("tpm_card_big_"+t+"_png")},o.prototype.setCardValueAndShowOut=function(t){this._cardValue=t,this.cardImg.source=RES.getRes("tpm_card_small_"+t+"_png")},o.prototype.setHandSkin=function(e,o,n){void 0===n&&(n=!1),this._cardValue=e,this._userPos=o,o==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_5_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardImg.x=5,this.initPosY=624,this.cardBack=new eui.Image,this.cardBack.source=RES.getRes("tpm_cardbg_6_png"),this.cardBack.width=86,this.cardBack.height=120,this.addChild(this.cardBack),this.cardBack.visible=!1,this.cardMask=new eui.Rect,this.cardMask.width=83,this.cardMask.height=118,this.cardMask.alpha=.5,this.cardMask.x=1,this.addChild(this.cardMask),this.cardMask.visible=!1):o==t.UserPosition.Up&&(n?(this.cardBg.source=RES.getRes("tpm_cardbg_5_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardImg.x=3,this.cardImg.y=2,this.cardBg.scaleX=.8,this.cardBg.scaleY=.75,this.cardImg.scaleX=.8,this.cardImg.scaleY=.75):(this.cardBg.source=RES.getRes("tpm_cardbg_1_png"),this.cardImg.source=null),this.initPosY=19)},o.prototype.setOutSkin=function(e,o){this._cardValue=e,this._userPos=o,o==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_7_png"),this.cardImg.source=RES.getRes("tpm_card_small_"+e+"_png"),this.cardImg.x=12,this.cardImg.y=8):o==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_7_png"),this.cardImg.source=RES.getRes("tpm_card_small_"+e+"_png"),this.cardImg.x=11,this.cardImg.y=8,this.cardBg.scaleX=.94,this.cardBg.scaleY=.94)},o.prototype.setEatSkin=function(e,o){this._cardValue=e,this._userPos=o,o==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_4_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardBg.scaleX=1.1,this.cardImg.x=7,this.cardImg.y=-10,this.cardImg.scaleX=.8,this.cardImg.scaleY=.8):o==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_8_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardBg.scaleX=.98,this.cardBg.scaleY=.98,this.cardImg.x=3,this.cardImg.y=-14,this.cardImg.scaleX=.79,this.cardImg.scaleY=.79)},o.prototype.setAnGangSkin=function(e,o){this._cardValue=e,this._userPos=o,o==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_6_png"),this.cardImg.source=null,this.cardBg.scaleX=1.08):o==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_6_png"),this.cardImg.source=null,this.cardBg.scaleX=.9,this.cardBg.scaleY=.9)},o.prototype.toUp=function(){0==this.bUp&&(this.y=this.initPosY-this.upDist,this._bUp=!0)},o.prototype.toDown=function(){1==this.bUp&&(this.y=this.initPosY,this._bUp=!1)},o.prototype.recycle=function(){this._bUp=!1,this._userPos=0,this._cardValue=0,this.touchEnabled=!1,this.touchChildren=!1,this.cardBg.source=null,this.cardImg.source=null,this.x=0,this.y=0,this.cardBg.x=0,this.cardBg.y=0,this.cardImg.x=0,this.cardImg.y=0,this.scaleX=1,this.scaleY=1,this.cardImg.scaleX=1,this.cardImg.scaleY=1,this.cardBg.scaleX=1,this.cardBg.scaleY=1,this.parent&&this.parent.removeChild(this),this.alpha=1,this.cardArrow&&this.cardArrow.parent&&this.cardArrow.parent.removeChild(this.cardArrow),this.cardMask&&this.cardMask.parent&&this.cardMask.parent.removeChild(this.cardMask),this.cardBack&&this.cardBack.parent&&this.cardBack.parent.removeChild(this.cardBack),t.ObjectPool.getPool(o.NAME).returnObject(this)},o}(egret.DisplayObjectContainer);e.NAME="Card",t.Card=e,__reflect(e.prototype,"Tpm.Card")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.cardPool=t.ObjectPool.getPool(t.Card.NAME)}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.getHandCard=function(e,o,n){void 0===n&&(n=!1);var r=this.cardPool.getObject();return t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob?r.setHandSkin(e,o,n):r.setHandSkin(e,o),r.touchEnabled=o==t.UserPosition.Down?!0:!1,r},e.prototype.getOutCard=function(t,e){var o=this.cardPool.getObject();return o.setOutSkin(t,e),o},e.prototype.getEatCard=function(t,e){var o=this.cardPool.getObject();return o.setEatSkin(t,e),o},e.prototype.getAnGangCard=function(t,e){var o=this.cardPool.getObject();return o.setAnGangSkin(t,e),o},e}();t.CardFactory=e,__reflect(e.prototype,"Tpm.CardFactory")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.sortHandCard=function(t){for(var e,o,n,r=t.length,i=0;r>i;i++)for(var a=i+1;r>a;a++)e=t[i],o=t[a],e.cardValue<o.cardValue&&(n=t[i],t[i]=t[a],t[a]=n)},e.prototype.sortHandCardAB=function(t){for(var e,o,n,r=t.length,i=0;r>i;i++)for(var a=i+1;r>a;a++)e=t[i],o=t[a],e.cardValue>o.cardValue&&(n=t[i],t[i]=t[a],t[a]=n)},e.prototype.changeSeat=function(e){var o,n=t.App.DataCenter.UserInfo.myUserInfo.seatID;return o=e==n?0:e>n?e-n:4-n+e},e.prototype.changeStateToAct=function(t){for(var e=1,o=0;8>o;o++){var n=e<<o;if(n==t)break}return o},e.prototype.checkActState=function(t,e){return 0==(t&e)?!1:!0},e.prototype.getSameList=function(t,e){for(var o=t.length,n=[],r=0;o>r;r++){for(var i=1,a=t[r].cardValue,s=r+1;o>s;s++)a==t[s].cardValue&&i++;i>=e&&n.push(a)}return n},e.prototype.checkSameByValue=function(t,e,o){for(var n=t.length,r=0,i=0;n>i;i++)t[i].cardValue==e&&r++;return r>=o?!0:!1},e.prototype.getBuGang=function(t,e){for(var o=[],n=[],r=e.length,i=0;r>i;i++)o=o.concat(e[i]);r=o.length;for(var a=t.length,i=0;a>i;i++){for(var s=0,c=t[i].cardValue,h=0;r>h;h++)o[h].cardValue==c&&s++;s>=3&&n.push(c)}return n},e.prototype.getJoinCardPos=function(t,e){for(var o,n=e.length-1,r=t.cardValue,i=0;n>i&&(o=e[i],!(r>=o.cardValue));i++);return i},e.prototype.getActListFromKey=function(e){if("object"!=typeof e)return void console.error("actinfo error");var o=[];for(var n in e)if(Number(n)!=t.ACT_state.Act_Out){o.push(Number(n));var r=t.App.SceneManager.getScene(t.SceneConst.GameScene).cardMod.getOwnMoFlag();r&&(Number(n)==t.ACT_state.Act_Ting||Number(n)==t.ACT_state.Act_BuGang||Number(n)==t.ACT_state.Act_AnGang)&&(t.App.DataCenter.runingData.bAllowOutCard=!0)}else t.App.DataCenter.runingData.bAllowOutCard=!0;for(var n in e)if(Number(n)==t.ACT_state.Act_DianHu||Number(n)==t.ACT_state.Act_Zimo){t.App.DataCenter.runingData.bAllowOutCard=!1;break}return o},e}();t.CardLogic=e,__reflect(e.prototype,"Tpm.CardLogic")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.dragCardValue=0,t.skinName=TpmSkin.GameCardModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.initDb()},o.prototype.onEnable=function(){this.cardTestGro&&(this.cardTestGro.visible=!1),this.initList(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},o.prototype.onRemove=function(){},o.prototype.getOwnMoFlag=function(){return this.moCardList[t.UserPosition.Down][0]?!0:!1},o.prototype.onTouchTap=function(e){var o=e.target;if(console.log("ontouch--------"),o instanceof t.Card){if(o.userPos==t.UserPosition.Up||o.parent!=this.cardGro)return void console.log("target error==",o);if(t.App.DataCenter.runingData.bAllowOutCard?o.bUp?o.arrowState?this.ctrl.sendMod.sendAct(t.ACT_state.Act_Ting,[o.cardValue]):this.ctrl.sendMod.sendAct(t.ACT_state.Act_Out,[o.cardValue]):(this.drownAllHandCard(),o.toUp()):o.bUp?o.toDown():(this.drownAllHandCard(),o.toUp()),o.arrowState&&o.bUp){var n=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);console.log("听牌数据：",n);var r=[];for(var i in n.act_info[t.ACT_state.Act_Ting][o.cardValue]){var a={outCardValue:Number(i),fanNum:n.act_info[t.ACT_state.Act_Ting][o.cardValue][i].fan,residueNum:this.gameScene.cardMod.getCardResidue(Number(i))};r.push(a);for(var s=n.act_info[t.ACT_state.Act_Ting][o.cardValue][i].type_list,c="",h=0;h<s.length;h++)c+=t.HuType.HuTypeName[s[h]],c+=";";console.log(t.CardName.Name[i]+":"+c)}this.gameScene.huTipsMod.showHuTips(r,o.cardValue)}}},o.prototype.onTouchBegin=function(e){if(e.target instanceof t.Card){var o=e.target;o.parent!=this.cardGro||o.arrowState||(this.curTouchCard=o,this.dragCardValue=o.cardValue,t.App.LayerManager.RootLayer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragMove,this),t.App.LayerManager.RootLayer.addEventListener(egret.TouchEvent.TOUCH_END,this.onDragEnd,this))}},o.prototype.onDragMove=function(e){0!=this.dragCardValue&&(null==this.dragMoveCard&&e.stageY<t.CardPos.handCardPosYlist[t.UserPosition.Down]&&(this.dragMoveCard=this.cardFactory.getHandCard(this.dragCardValue,t.UserPosition.Down),this.movieGro.addChild(this.dragMoveCard)),this.dragMoveCard&&(this.dragMoveCard.x=e.stageX-this.dragMoveCard.width/2,this.dragMoveCard.y=e.stageY-this.dragMoveCard.height/2))},o.prototype.onDragEnd=function(e){if(this.dragCardValue=0,this.dragMoveCard){this.dragMoveCard.cardValue;this.clearDragCard(),t.App.DataCenter.runingData.bAllowOutCard&&e.stageY<t.CardPos.handCardPosYlist[t.UserPosition.Down]&&(this.curTouchOutCard=this.curTouchCard,this.ctrl.sendMod.sendAct(t.ACT_state.Act_Out,[this.curTouchOutCard.cardValue]))}},o.prototype.clearDragCard=function(){t.App.LayerManager.RootLayer.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragMove,this),t.App.LayerManager.RootLayer.removeEventListener(egret.TouchEvent.TOUCH_END,this.onDragEnd,this),this.dragCardValue=0,this.dragMoveCard&&(this.dragMoveCard.recycle(),this.dragMoveCard=null)},o.prototype.testOut=function(t){for(var e=[17,18,19,20,22,23,24,53,54,55],o=0;o<e.length;o++){var n=this.cardFactory.getOutCard(e[o],t);this.addCardToOut(n,t)}},o.prototype.testHand=function(e){for(var o=[66,67,81,82,97,102,104],n=0;n<o.length;n++){var r=this.cardFactory.getHandCard(o[n],e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(r,e)}},o.prototype.testChi=function(t){var e=[23,23,23];this.addCardToEat(e,t)},o.prototype.testGang=function(t,e){void 0===e&&(e=!1);var o=[23,23,23,24];this.addCardToGang(o,t,e)},o.prototype.testMo=function(e){var o=0;o=e?0:53;var n=this.cardFactory.getHandCard(o,e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(n,e)},o.prototype.dealCardShow=function(e){for(var o=13,n=[0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;o>r;r++){var i=this.cardFactory.getHandCard(e[r],t.UserPosition.Down);this.addCardToHand(i,t.UserPosition.Down),i.visible=!1;var a=this.cardFactory.getHandCard(n[r],t.UserPosition.Up);this.addCardToHand(a,t.UserPosition.Up),a.visible=!1}for(var r=0;4>r;r++)this.delayShowAGroup(r,t.UserPosition.Down),this.delayShowAGroup(r,t.UserPosition.Up)},o.prototype.delayShowAGroup=function(e,o){var n=this,r=900,i=13;o==t.UserPosition.Down?setTimeout(function(){for(var t=4*e;4*e+4>t&&!(t>=i);t++){var r=n.handCardList[o][t];r.setBack(!0),n.showFanDb(t);var a=t;egret.setTimeout(function(){a==i-1&&egret.setTimeout(function(){n.downCardBackSHow()},n,200);for(var e=t-1;e>t-4-1&&n.handCardList[o][e];e--)n.handCardList[o][e].setBack(!1),n.handCardList[o][e].visible=!0},n,730)}},r*e,this):setTimeout(function(){for(var r=i-1-4*e;r>i-1-4*e-4&&!(0>r);r--){var a=n.handCardList[o][r];a.y=a.initY+t.CardPos.moCardOffsetY[o],a.visible=!0,egret.Tween.get(a).wait(200).to({y:a.initY},50)}},r*e,this)},o.prototype.downCardBackSHow=function(){for(var e=this,o=0;o<this.handCardList[t.UserPosition.Down].length;o++){var n=this.handCardList[t.UserPosition.Down][o];n.setBack(!0),n.visible=!1}this.dealCardBuHua(),t.CardLogic.getInstance().sortHandCardAB(this.handCardList[t.UserPosition.Down]);for(var o=0;o<this.handCardList[t.UserPosition.Down].length;o++)this.handCardList[t.UserPosition.Down][o].x=t.CardPos.handCardPosXList[t.UserPosition.Down]+o*t.CardPos.handCardGapList[t.UserPosition.Down];for(var o=0;13>o;o++)this.showFanDb(o);setTimeout(function(){for(var o=0;o<e.handCardList[t.UserPosition.Down].length;o++){var n=e.handCardList[t.UserPosition.Down][o];n.setBack(!1),n.visible=!0}e.ctrl.sendMod.sendAct(t.ACT_state.Act_Fa,[]),t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101001,!1),t.App.DataCenter.runingData.gameState=t.GameState.Playing},740,this)},o.prototype.dealCardBuHua=function(){var e=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101008);if(e)for(var o=0;o<e.length;o++)if(e[o].seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,t.UserPosition.Down),this.gameScene.flowerMod.setFlowerState(t.UserPosition.Down,e[o].hua_card.length);for(var n=0;n<e[o].hua_card.length;n++)for(var r=0;r<this.handCardList[t.UserPosition.Down].length;r++)this.handCardList[t.UserPosition.Down][r].cardValue==e[o].hua_card[n]&&this.handCardList[t.UserPosition.Down][r].setCardValueAndSHow(e[o].bu_cards[n])}else this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,t.UserPosition.Up),this.gameScene.flowerMod.setFlowerState(t.UserPosition.Up,e[o].hua_card.length)},o.prototype.moCardBuHua=function(e){var o=this;return this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,e),this.moCardList[e][0]?void(this.moCardList[e][0].cardValue>96&&egret.Tween.get(this.moCardList[e][0]).to({alpha:.8},500).to({alpha:0},200).call(function(){egret.Tween.removeTweens(o.moCardList[e][0])})):void console.error("mo card error")},o.prototype.moCardShow=function(e,o){this.moCardList[o][0]&&(this.moCardList[o][0].recycle(),this.moCardList[o].pop());var n=this.cardFactory.getHandCard(e,o,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(n,o),n.visible=!1;var r=this.cardFactory.getHandCard(e,o,t.App.DataCenter.runingData.ownTingState);r.x=n.x,r.y=n.y+t.CardPos.moCardOffsetY[o],this.movieGro.addChild(r),o==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&(n.setGray(!0),r.setGray(!0)),egret.Tween.get(r).wait(200).to({y:this.moCardList[o][0].initY},50).call(function(){n.visible=!0,r&&r.parent&&r.parent.removeChild(r),egret.Tween.removeTweens(r)})},o.prototype.outCardShow=function(e,o){var n=this;void 0===e&&(e=t.UserPosition.Down),void 0===o&&(o=0);var r;if(this.moCardList[e][0].cardValue==o)r=this.moCardList[e][0];else if(e!=t.UserPosition.Up||t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob&&t.App.DataCenter.runingData.ownTingState){for(var i=0;i<this.handCardList[e].length;i++)if(this.handCardList[e][i].cardValue==o){r=this.handCardList[e][i];break}}else r=this.moCardList[e][0];if(!r)return void console.error("out card null");var a=r.cardValue||o;e==t.UserPosition.Up&&(a=o);var s=this.cardFactory.getOutCard(a,e);this.addCardToOut(s,e),s.visible=!1;var c=this.cardFactory.getOutCard(a,e);c.x=r.x,c.y=r.y+t.CardPos.moCardOffsetY[e],this.movieGro.addChild(c);var h=!1;if(r==this.moCardList[e][0])r.recycle(),this.moCardList[e].pop(),h=!0;else{for(var i=0;i<this.handCardList[e].length;i++)if(this.handCardList[e][i]==r){r.recycle(),this.handCardList[e].splice(i,1);break}h=!1}this.drownAllHandCard(),egret.Tween.get(c).to({x:s.x,y:s.y},200).call(function(){c&&c.parent&&c.parent.removeChild(c),s.visible=!0,h||n.moveMoCardToHand(e)},this)},o.prototype.moveMoCardToHand=function(e){var o=this;void 0===e&&(e=t.UserPosition.Down);var n=[-130,-10],r=this.moCardList[e][0];if(!r)return void console.error("have not mocard");var i=this.cardFactory.getHandCard(r.cardValue,e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(i,e),i.visible=!1,t.App.DataCenter.runingData.ownTingState&&e==t.UserPosition.Down&&i.setGray(!0);var a=this.cardFactory.getHandCard(r.cardValue,e,t.App.DataCenter.runingData.ownTingState);a.x=r.x,a.y=r.y,this.movieGro.addChild(a),t.App.DataCenter.runingData.ownTingState&&e==t.UserPosition.Down&&a.setGray(!0),r.recycle(),this.moCardList[e].pop(),egret.Tween.get(a).to({y:i.initY+n[e]},100).call(function(){o.reHandCardPos(e),egret.Tween.get(a).to({x:i.x},200).to({y:i.initY},100).call(function(){i.visible=!0,a&&a.parent&&a.parent.removeChild(a)},o)},this)},o.prototype.eatCardShow=function(e,o,n){void 0===n&&(n=!1);var r=3,i=0;if(0==o&&(i=1),this.removeLastOutCard(i),this.addCardToEat(e,o,n),o==t.UserPosition.Down||t.App.DataCenter.runingData.ownTingState&&t.App.DataCenter.runingData.guoHuFlag){for(var a=0;a<e.length;a++)if(e[a]==t.App.DataCenter.runingData.latelyCardValue){e.splice(a,1);break}for(var a=0;a<e.length;a++)this.deletHandCard(e[a],o)}else for(var a=r;a>1;a--)this.handCardList[o][this.handCardList[o].length-1].recycle(),this.handCardList[o].pop();var s=this.cardFactory.getHandCard(this.handCardList[o][this.handCardList[o].length-1].cardValue,o,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(s,o),this.handCardList[o][this.handCardList[o].length-1].recycle(),this.handCardList[o].pop(),this.reHandCardPos(o)},o.prototype.gangCardShow=function(e,o,n){var r=4,i=!1;if(e==t.ACT_state.Act_AnGang&&(i=!0),e==t.ACT_state.Act_BuGang)this.addCardToBu(o,n);else{for(var a=[],s=0;r>s;s++)a.push(o);this.addCardToGang(a,n,i)}if(e==t.ACT_state.Act_Gang){var c=0;0==n&&(c=1),this.removeLastOutCard(c),this.deletHandCard(o,n),this.deletHandCard(o,n),this.deletHandCard(o,n)}else e==t.ACT_state.Act_BuGang?(this.deletHandCard(o,n),this.moCardList[n].length>0&&(this.handCardList[n].push(this.moCardList[n][0]),this.moCardList[n]=[])):(this.deletHandCard(o,n),this.deletHandCard(o,n),this.deletHandCard(o,n),this.deletHandCard(o,n),this.moCardList[n].length>0&&(this.handCardList[n].push(this.moCardList[n][0]),this.moCardList[n]=[]));this.reHandCardPos(n)},o.prototype.dianHuCardShow=function(e,o){var n=this.cardFactory.getHandCard(e,o,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(n,o);var r=0;0==o&&(r=1),this.removeLastOutCard(r),e!=this.moCardList[o][0].cardValue&&console.error("dianHu card error")},o.prototype.testHu=function(t,e){void 0===e&&(e=null);for(var o=[66,67,81,82,97,102,104],e=e||o,n=0;n<e.length;n++)this.addCardToHu(e[n],t)},o.prototype.clearCardMovieGro=function(){this.movieGro.removeChildren()},o.prototype.tingCardShow=function(){this.drownAllHandCard();var e=t.UserPosition.Down,o=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1),n=[];for(var r in o.act_info[t.ACT_state.Act_Ting])n.push(Number(r));for(var i=0;i<this.handCardList[e].length;i++){for(var a=!0,s=0;s<n.length;s++)if(this.handCardList[e][i].cardValue==n[s]){this.handCardList[e][i].setArrow(!0),a=!1;break}this.handCardList[e][i].setGray(a)}for(var c=!1,i=0;i<n.length;i++)n[i]==this.moCardList[e][0].cardValue&&(c=!0);this.moCardList[e][0].setGray(!0),c&&(this.moCardList[e][0].setGray(!1),this.moCardList[e][0].setArrow(!0))},o.prototype.tingDidShow=function(e){for(var o=t.UserPosition.Down,n=0;n<this.handCardList[o].length;n++)this.handCardList[o][n].setArrow(!1),this.handCardList[o][n].setGray(!0);this.moCardList[o][0].setArrow(!1),this.moCardList[o][0].setGray(!0),this.tingDidCardShow(e)},o.prototype.tingDidCardShow=function(e){if(t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob&&t.App.DataCenter.runingData.ownTingState)for(var o=t.UserPosition.Up,n=e[t.App.DataCenter.UserInfo.getUserByPos(o).seatID].hand_card,r=0;r<n.length;r++){var i=n[r];i&&this.handCardList[o][r].setHandSkin(i,o,t.App.DataCenter.runingData.ownTingState)}},o.prototype.tingCancleShow=function(){var e=t.UserPosition.Down;this.drownAllHandCard();for(var o=0;o<this.handCardList[e].length;o++)this.handCardList[e][o].setArrow(!1),this.handCardList[e][o].setGray(!1);this.moCardList[e][0].setArrow(!1),this.moCardList[e][0].setGray(!1)},o.prototype.huCardShow=function(e,o){var n=o.length;if(!n)return void console.error("game over handcard error");for(var r=0;r<o[n-2].length;r++)this.addCardToHu(o[n-2][r],e);o[n-1].length>0&&this.addCardToHu(o[n-1][0],e,!0);for(var r=0;r<this.handCardList[e].length;r++)this.handCardList[e][r].recycle();if(this.handCardList[e]=[],this.moCardList[e][0]&&(this.moCardList[e][0].recycle(),this.moCardList[e]=[]),e==t.UserPosition.Up){for(var i=[],r=0;r<o.length;r++)4==o[r].length&&0==o[r][1]&&i.push(o[r][0]);if(i.length<1)return;console.log("this.angCardList[pos]======",this.angCardList[e]);for(var r=0;r<this.angCardList[e].length/4;r++){var a=this.angCardList[e][4*r+3],s=this.cardFactory.getEatCard(i[r],e);s.x=a.x,s.y=a.y,this.cardGro.addChild(s),a.recycle(),this.angCardList[e][4*r+3]=s}}},o.prototype.reConnectCardShow=function(e,o,n,r){for(var i,a=0;a<o.length;a++){var s=t.ArrayTool.deepCopy(o[a]),c=s.length;if(a==o.length-1){if(c>0){var h=this.cardFactory.getHandCard(s[0],e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(h,e)}}else a==o.length-2?i=s:3==c?s[0]==s[1]?this.addCardToEat(s,e,!0):this.addCardToEat(s,e,!1):4==c&&(0==s[1]?(s[3]=s[0],s[0]=0,this.addCardToGang(s,e,!0)):this.addCardToGang(s,e,!1))}if(i.length%3==2){for(var d=!0,a=0;a<i.length;a++)if(i[a]==n){d=!1;var h=this.cardFactory.getHandCard(n,e,t.App.DataCenter.runingData.ownTingState);
this.addCardToMo(h,e),i.splice(a,1),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0);break}if(d){var p=i[i.length-1],h=this.cardFactory.getHandCard(p,e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(h,e),i.splice(i.length-1,1),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0)}}for(var a=0;a<i.length;a++){var h=this.cardFactory.getHandCard(i[a],e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(h,e),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0)}for(var a=0;a<r.length;a++){var h=this.cardFactory.getOutCard(r[a],e);this.addCardToOut(h,e)}},o}(t.CardModBase);t.GameCardMod=e,__reflect(e.prototype,"Tpm.GameCardMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameCheatModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.selectGroup=new eui.Group},o.prototype.onEnable=function(){var e=this;this.state=!1,this.reShowState(this.state),this.setFanGro(!1),this.setFanData(),t.App.DataCenter.debugInfo.testState?this.init():this.visible=!1,this.fanGro.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.setFanGro(!1)},this)},o.prototype.onRemove=function(){},o.prototype.init=function(){var e=this;this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=0,e.showSwapCard()},this),this.changeToBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=1,e.showSwapCard()},this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=2,e.showSwapCard()},this),this.lastBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.ProtocolDataSend.S_100999;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.test_type=3;var o={source_card:[],target_card:[]};e.test_params=JSON.stringify(o),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,e)},this),this.huBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),e.setFanGro(!0)},this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),t.App.gameSocket.close(),t.App.EventManager.sendEvent(t.EventConst.SocketClose,t.App.gameSocket)},this),this.jiesanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),e.ctrl.sendMod.sendJieSanTest()},this),this.card_s0=this.cardFactory.getOutCard(0,0),this.card_s0.x=145,this.card_s0.y=10,this.card_s0.scaleX=this.card_s0.scaleY=.6,this.btnBro.addChild(this.card_s0),this.card_s1=this.cardFactory.getOutCard(0,0),this.card_s1.x=145,this.card_s1.y=70,this.card_s1.scaleX=this.card_s1.scaleY=.6,this.btnBro.addChild(this.card_s1),this.card_s2=this.cardFactory.getOutCard(0,0),this.card_s2.x=145,this.card_s2.y=130,this.card_s2.scaleX=this.card_s2.scaleY=.6,this.btnBro.addChild(this.card_s2),this.card_s3=this.cardFactory.getOutCard(0,0),this.card_s3.x=145,this.card_s3.y=190,this.card_s3.scaleX=this.card_s3.scaleY=.6,this.btnBro.addChild(this.card_s3)},Object.defineProperty(o.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),o.prototype.onRule=function(){this.state=!this.state,this.reShowState(this.state)},o.prototype.reShowState=function(t){t?this.allGro.x=0:this.allGro.x=-200},o.prototype.showSwapCard=function(){var e=this;if(this.selectGroup.parent&&this.removeChild(this.selectGroup),this.selectGroup.numChildren>15){this.addChild(this.selectGroup);var o="";return 0==this.curSelcet?o="换牌前":1==this.curSelcet?o="换牌后":2==this.curSelcet&&(o="下一张"),void(this.tipsLabel.text=o)}this.selectGroup.removeChildren();var n=58,r=81,i=9*n,a=3*r;this.selectGroup.width=i,this.selectGroup.height=a,this.selectGroup.x=200,this.selectGroup.y=130;var s=new egret.Sprite;s.graphics.beginFill(0,.5),s.graphics.drawRect(0,0,i,a),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup)},this),this.selectGroup.addChild(s),this.addChild(this.selectGroup);for(var c,h=0;9>h;h++)c=this.cardFactory.getOutCard(17+h,0),c.x=n*h,c.y=10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);for(var h=0;4>h;h++)c=this.cardFactory.getOutCard(65+h,0),c.x=n*h,c.y=r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);for(var h=4;7>h;h++)c=this.cardFactory.getOutCard(77+h,0),c.x=n*h,c.y=r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);this.tipsLabel=new eui.Label,this.tipsLabel.x=7*n+10,this.tipsLabel.y=r+10+10,this.tipsLabel.textColor=t.App.ArtConfig.getColor(t.ColorConst.white),this.tipsLabel.touchEnabled=!1,this.selectGroup.addChild(this.tipsLabel);var o="";0==this.curSelcet?o="换牌前":1==this.curSelcet?o="换牌后":2==this.curSelcet&&(o="下一张"),this.tipsLabel.text=o;for(var h=0;8>h;h++)c=this.cardFactory.getOutCard(97+h,0),c.x=n*h,c.y=2*r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);this.selectGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this)},o.prototype.onSelect=function(e){if(e.target instanceof t.Card){var o=e.target;if(0==this.curSelcet)this.selectValue0=o.cardValue,this.card_s0.setCardValueAndShowOut(this.selectValue0),this.selectGroup.parent&&this.removeChild(this.selectGroup);else if(1==this.curSelcet){this.selectValue1=o.cardValue;var n=t.ProtocolDataSend.S_100999;n.user_id=t.App.DataCenter.UserInfo.myUserUid,n.test_type=1;var r={source_card:[],target_card:[]};r.source_card.push(this.selectValue0),r.target_card.push(this.selectValue1),n.test_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,n),console.log("发送换牌:",this.selectValue0,this.selectValue1),this.card_s1.setCardValueAndShowOut(this.selectValue1),this.selectGroup.parent&&this.removeChild(this.selectGroup)}else if(2==this.curSelcet){var i=t.ProtocolDataSend.S_100999;i.user_id=t.App.DataCenter.UserInfo.myUserUid,i.test_type=2;var r={source_card:[],target_card:[]};r.target_card.push(o.cardValue),i.test_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,i),console.log("发送确认下一张牌，牌值",o.cardValue),this.card_s2.setCardValueAndShowOut(o.cardValue),this.selectGroup.parent&&this.removeChild(this.selectGroup)}}},o.prototype.clearSelect=function(){this.selectValue0=0,this.selectValue1=0,this.card_s0.setCardValueAndShowOut(0),this.card_s1.setCardValueAndShowOut(0)},o.prototype.setFanGro=function(t){this.fanGro.visible=t},o.prototype.setFanData=function(){var e=new eui.ArrayCollection,o=[];o.push({cardList:[17,17,18,18,19,19,20,20,21,21,22,22,22,98],hulabel:"补一花"}),o.push({cardList:[17,17,17,18,18,18,18,20,21,21,22,22,97,98],hulabel:"起手杠"}),o.push({cardList:[17,17,17,18,18,18,18,20,20,20,20,22,97,98],hulabel:"起手杠2"}),o.push({cardList:[18,18,18,19,19,19,20,20,20,23,24,25,82,82],hulabel:"三暗刻"}),o.push({cardList:[17,17,17,17,18,19,20,21,22,23,24,25,25,25],hulabel:"九莲宝灯"}),o.push({cardList:[17,18,19,21,21,21,23,23,23,81,81,81,65,65],hulabel:"混一色"}),o.push({cardList:[17,18,19,20,21,22,23,24,25,17,18,19,82,82],hulabel:"清龙"}),o.push({cardList:[19,20,21,20,21,22,21,22,23,20,21,22,82,82],hulabel:"一色三步高"}),o.push({cardList:[17,18,19,17,18,19,17,18,19,20,21,22,82,82],hulabel:"一色三同顺"}),o.push({cardList:[21,21,21,22,22,22,23,23,23,23,24,25,81,81],hulabel:"一色三节高"}),o.push({cardList:[18,19,20,19,20,21,20,21,22,21,22,23,68,68],hulabel:"一色四步高"}),o.push({cardList:[17,17,22,22,23,23,24,24,25,25,66,66,82,82],hulabel:"七对"}),o.push({cardList:[17,18,19,17,18,19,20,21,22,23,24,25,17,17],hulabel:"清一色"}),o.push({cardList:[17,17,17,18,18,18,19,19,19,20,20,20,25,25],hulabel:"一色四同顺"}),o.push({cardList:[17,17,17,25,25,25,67,67,67,83,83,83,65,65],hulabel:"混幺九"}),o.push({cardList:[65,65,65,66,66,66,67,67,67,68,68,23,23,23],hulabel:"小四喜"}),o.push({cardList:[81,81,81,82,82,82,83,83,17,17,17,18,19,20],hulabel:"小三元"}),o.push({cardList:[65,65,65,66,66,66,67,67,67,82,82,82,83,83],hulabel:"字一色"}),o.push({cardList:[17,18,19,17,18,19,21,21,23,24,25,23,24,25],hulabel:"一色双龙会"}),o.push({cardList:[65,65,65,66,66,66,67,67,67,68,68,68,23,23],hulabel:"大四喜"}),o.push({cardList:[81,81,81,82,82,82,83,83,83,17,17,18,19,20],hulabel:"大三元"}),o.push({cardList:[17,17,18,18,19,19,20,20,21,21,22,22,23,23],hulabel:"七连对"}),e.source=o,this.cardList.dataProvider=e,this.cardList.itemRenderer=t.HuTypeItem},o}(t.BaseGameMod);t.GameCheatMod=e,__reflect(e.prototype,"Tpm.GameCheatMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var o=e.call(this)||this;return o.sendMod=new t.GameCtrlSend(o),o.receiveMod=new t.GameCtrlReceive(o),o}return __extends(o,e),Object.defineProperty(o.prototype,"gameScene",{get:function(){return t.App.SceneManager.getScene(t.SceneConst.GameScene)},enumerable:!0,configurable:!0}),o.prototype.onRegister=function(){this.receiveMod.onRegister()},o.prototype.onRemove=function(){this.receiveMod.onRemove()},o.prototype.sendHeadInfo=function(e){var o=new t.HttpSender,n=t.ProtocolHttp.getHeadInfo;n.uid=t.App.DataCenter.UserInfo.myUserUid,n.param.base.uid=e,o.send(n,this.revHeadInfo,this)},o.prototype.revHeadInfo=function(e){return e.ret?void(e.desc?t.Tips.showTop(e.desc):t.Tips.showTop("获取个人信息失败")):void t.App.PanelManager.open(t.PanelConst.PersonalInfoPanel,!0,null,null,!0,!0,e.data)},o}(t.BaseController);e.NAME="GameController",t.GameController=e,__reflect(e.prototype,"Tpm.GameController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(t){this.gameCtrl=t}return Object.defineProperty(e.prototype,"gameScene",{get:function(){return this.gameCtrl.gameScene},enumerable:!0,configurable:!0}),e.prototype.onRegister=function(){var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100100,this.revReady,this),e.register(t.ProtocolHeadRev.R_100103,this.revExit,this),e.register(t.ProtocolHeadRev.R_101001,this.revAct,this),e.register(t.ProtocolHeadRev.R_101004,this.revDingZhuang,this),e.register(t.ProtocolHeadRev.R_101105,this.revElseExit,this),e.register(t.ProtocolHeadRev.R_101107,this.revUserInto,this),e.register(t.ProtocolHeadRev.R_101109,this.revUserReconnect,this),e.register(t.ProtocolHeadRev.R_101110,this.revUserConnectState,this),e.register(t.ProtocolHeadRev.R_101005,this.revDealCard,this),e.register(t.ProtocolHeadRev.R_101008,this.revDealHua,this),e.register(t.ProtocolHeadRev.R_101002,this.revMoCard,this),e.register(t.ProtocolHeadRev.R_101112,this.revActDo,this),e.register(t.ProtocolHeadRev.R_101007,this.revMoHua,this),e.register(t.ProtocolHeadRev.R_100999,this.revCheat,this),e.register(t.ProtocolHeadRev.R_101003,this.revOver,this),e.register(t.ProtocolHeadRev.R_101006,this.revResult,this)},e.prototype.onRemove=function(){},e.prototype.revReady=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_100100.info;o=e.info,t.App.DataCenter.runingData.gameState=t.GameState.Ready,this.gameScene.readyMod.hideBeginBtn()},e.prototype.revExit=function(e){return 200!=e.code?void t.Tips.showTop("游戏已经开始，无法退出。"):(t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),t.App.DataCenter.UserInfo.clearZhuang(),void t.App.SceneManager.runScene(t.SceneConst.HallScene,t.App.getController(t.HallController.NAME)))},e.prototype.revElseExit=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):(t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),void this.gameScene.headUp.reHeadState(t.UserPosition.Up))},e.prototype.revUserReconnect=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void 0},e.prototype.revUserConnectState=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void e.info.is_offline},e.prototype.revDingZhuang=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101004.info;o=e.info,t.App.DataCenter.UserInfo.clearZhuang(),t.App.DataCenter.UserInfo.getUserBySeatID(o.bank_seat_id).zhuangFlag=!0,o.dice.length>1?this.gameScene.diskMod.setState(t.DiskState.dice,0,o.dice):(this.gameScene.headDown.reZhuangFlag(t.UserPosition.Down),this.gameScene.headUp.reZhuangFlag(t.UserPosition.Up),setTimeout(function(){console.log("deal card"),t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101005)},1100)),t.App.DataCenter.runingData.gameState=t.GameState.DealCard},e.prototype.revUserInto=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101107.info;o=e.info;var n=new t.UserVO;n.initUserFromSocket(o),t.App.DataCenter.UserInfo.addUser(n),this.gameScene.headUp.reHeadState(t.UserPosition.Up),this.gameScene.matchMod.setType(t.MatchType.common)},e.prototype.revDealCard=function(e){t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101005,e,this.exeDealCard,this)},e.prototype.exeDealCard=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101005.info;o=e.info;for(var n=0;n<o.card_list.length;n++)o.card_list[n].seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID&&this.gameScene.cardMod.dealCardShow(o.card_list[n].card_list)},e.prototype.revDealHua=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101008,e.info,!0)},e.prototype.revAct=function(e){console.log("gameState==",t.App.DataCenter.runingData.gameState),t.App.DataCenter.runingData.gameState==t.GameState.Playing?this.exeAct(e):t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101001,e,this.exeAct,this)},e.prototype.exeAct=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101001.info;o=e.info;var n=t.App.DataCenter.UserInfo.getPosFromSeat(o.seat_id),r=n?t.DiskState.up:t.DiskState.down;if(this.gameScene.diskMod.setState(r,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),console.log("接收动作,seat_id=="+o.seat_id+"----mySeatId=="+t.App.DataCenter.UserInfo.myUserInfo.seatID),o.seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){console.log("动作操作数据：",o),t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101001,o);var i=t.CardLogic.getInstance().getActListFromKey(o.act_info);this.gameScene.selectBtnMod.showActBtn(i)}},e.prototype.revMoCard=function(t){this.exeMoCard(t)},e.prototype.exeMoCard=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101002.info;o=e.info;var n=t.App.DataCenter.UserInfo.getPosFromSeat(o.seat_id);this.gameScene.cardMod.moCardShow(o.card_list[0],n);var r=n?t.DiskState.up:t.DiskState.down;this.gameScene.diskMod.setState(r,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),n==t.UserPosition.Down&&(t.App.DataCenter.runingData.bAllowOutCard=!0),this.gameScene.reResidue(!0,o.remain_count)},e.prototype.revMoHua=function(t){this.exeMoHua(t)},e.prototype.exeMoHua=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101007.info;o=e.info;var n=t.App.DataCenter.UserInfo.getPosFromSeat(o.seat_id);this.gameScene.cardMod.moCardBuHua(n),this.gameScene.flowerMod.setFlowerState(n,1)},e.prototype.revActDo=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101112.info;o=e.info;var n=o.act_type;110==n&&(n=t.ACT_state.Act_Guohu);var r=t.App.DataCenter.UserInfo.getPosFromSeat(o.seat_id),i=o.card_list;this.gameScene.onActDo(n,r,i,o.all_hand_cards)},e.prototype.revCheat=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_100999.info;o=e.info,1==o.test_type?(this.gameScene.cardMod.reCardValue(this.gameScene.cheatMod.selectValue0,this.gameScene.cheatMod.selectValue1),this.gameScene.cheatMod.clearSelect()):3==o.test_type&&this.gameScene.cheatMod.card_s3.setCardValueAndShowOut(o.cards[0])},e.prototype.revOver=function(e){var o=t.ArrayTool.deepCopy(e);t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101003,o,this.exeOver,this),this.exeOver(o)},e.prototype.exeOver=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101003.info;o=t.ArrayTool.deepCopy(e.info);for(var n in o.player_info){var r=t.App.DataCenter.UserInfo.getPosFromSeat(Number(n));this.gameScene.cardMod.huCardShow(r,o.player_info[n].hand_card)}t.App.DataCenter.runingData.gameState=t.GameState.Over,this.gameScene.diskMod.setState(t.DiskState.normal)},e.prototype.revResult=function(e){var o=this;t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101006,e,this.exeResult,this),setTimeout(function(){o.exeResult(e)},2e3)},e.prototype.exeResult=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101006.info;o=e.info,t.App.PanelManager.open(t.PanelConst.ResultPanel)},e}();t.GameCtrlReceive=e,__reflect(e.prototype,"Tpm.GameCtrlReceive")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(t){this.gameCtrl=t}return e.prototype.sendExitRoom=function(){var e=t.ProtocolDataSend.S_100103;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100103,e)},e.prototype.sendReady=function(){var e=t.ProtocolDataSend.S_100100;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.ready=1,t.App.gameSocket.send(t.ProtocolHeadSend.S_100100,e)},e.prototype.sendAct=function(e,o){void 0===o&&(o=null),e==t.ACT_state.Act_Guohu&&(e=t.ACT_state.Act_Pass),console.log("发送操作："+e+"  参数："+o);var n=t.ProtocolDataSend.S_100140;n.user_id=t.App.DataCenter.UserInfo.myUserUid,n.act=e;var r={card:0,used_card:[],chu_card:0};switch(e){case t.ACT_state.Act_Out:if(r.card=o[0],console.log("out--selectBtnState-----",t.App.DataCenter.runingData.selectBtnState),t.App.DataCenter.runingData.selectBtnState){var i=t.ArrayTool.deepCopy(t.ProtocolDataSend.S_100140);i.user_id=t.App.DataCenter.UserInfo.myUserUid,i.act=t.ACT_state.Act_Pass,t.App.gameSocket.send(t.ProtocolHeadSend.S_100140,i)}break;case t.ACT_state.Act_Chi:r.used_card=o;break;case t.ACT_state.Act_AnGang:r.used_card.push(o);break;case t.ACT_state.Act_BuGang:r.used_card.push(o);break;case t.ACT_state.Act_Ting:r.chu_card=o[0]}n.act_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100140,n)},e.prototype.sendJieSanTest=function(){var e=t.ProtocolDataSend.S_100112;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100112,e)},e.prototype.sendReconnect=function(){var e=t.ProtocolDataSend.S_100010;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100010,e)},e}();t.GameCtrlSend=e,__reflect(e.prototype,"Tpm.GameCtrlSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameDbModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.dbAmaureList=this.createDBArmatureList("tpm_NewProject_ske_json","tpm_NewProject_tex_json","tpm_NewProject_tex_png")},o.prototype.onEnable=function(){},o.prototype.onRemove=function(){},o.prototype.showActDb=function(e,o){switch(e){case t.ACT_state.Act_Chi:this.showDB("chi_erren",o);break;case t.ACT_state.Act_Peng:this.showDB("peng_erren",o);break;case t.ACT_state.Act_Gang:this.showDB("gang_erren",o);break;case t.ACT_state.Act_AnGang:this.showDB("gang_erren",o);break;case t.ACT_state.Act_BuGang:this.showDB("gang_erren",o);break;case t.ACT_state.Act_DianHu:this.showDB("hu__erren",o);break;case t.ACT_state.Act_Zimo:this.showDB("hu__erren",o);break;case t.ACT_state.Act_Buhua:this.showDB("BuHua",o);break;case t.ACT_state.Act_Guohu:this.showDB("guohu_erren",o);break;case t.ACT_state.Act_Ting:this.showDB("ting_erren",o);break;default:console.error("act error db")}},o.prototype.showDB=function(t,e){var o=[0,0],n=[170,-250];this.dbAmaureList[e].y=375+n[e],"BuHua"==t?this.dbAmaureList[e].x=667+o[e]+30:this.dbAmaureList[e].x=667+o[e],this.dbAmaureList[e].parent||this.addChild(this.dbAmaureList[e]),this.dbAmaureList[e].animation.play(t,1)},o.prototype.createDBArmatureList=function(t,e,o){var n=new dragonBones.EgretFactory;n.parseDragonBonesData(RES.getRes(t)),n.parseTextureAtlasData(RES.getRes(e),RES.getRes(o));for(var r=[],i=0;2>i;i++){var a=n.buildArmatureDisplay("Armature");r.push(a)}return r},o}(t.BaseUI);t.GameDbMod=e,__reflect(e.prototype,"Tpm.GameDbMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameDiskModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){},n.prototype.onRemove=function(){this.stopTimer()},n.prototype.setState=function(t,e,n){switch(void 0===e&&(e=15),void 0===n&&(n=[]),this.diskState=t,this.diskState){case o.normal:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1;break;case o.down:this.arrowDown.visible=!0,this.arrowUp.visible=!1,this.timeGro.visible=!0,this.diceGro.visible=!1,this.startTimer(e);break;case o.up:this.arrowDown.visible=!1,this.arrowUp.visible=!0,this.timeGro.visible=!0,this.diceGro.visible=!1,this.startTimer(e);break;case o.dice:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1,this.playAnimation(n);default:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1}},n.prototype.startTimer=function(e){void 0===e&&(e=15),this.curTime=e,this.timeLab.text=t.NumberTool.formatTime(this.curTime),this.outTimer&&this.outTimer.stop()&&this.outTimer.removeEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.outTimer=new t.DateTimer(1e3,this.curTime),this.outTimer.addEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.outTimer.reset(),this.outTimer.start()},n.prototype.onOutTime=function(){return Number(this.curTime)<1?(this.timeLab.text="00",void this.stopTimer()):(this.curTime--,void(this.timeLab.text=t.NumberTool.formatTime(this.curTime)))},n.prototype.stopTimer=function(){this.outTimer&&this.outTimer.stop()},n.prototype.initMovieClip=function(){this.mc&&this.mc.parent&&this.mc.parent.removeChild(this.mc);var t="tpm_shaizi",e=RES.getRes(t+"_mc_json"),o=RES.getRes(t+"_tex_png"),n=new egret.MovieClipDataFactory(e,o);this.mc=new egret.MovieClip(n.generateMovieClipData("shaizi")),this.mc.x=99,this.mc.y=94,this.addChild(this.mc)},n.prototype.playAnimation=function(e){var o=this;if(e.length<2)return void console.error("dice number error");var n=4;this.initMovieClip(),this.mc.gotoAndPlay(0,n),this.diceGro.visible=!1,setTimeout(function(){o.mc.stop(),o.mc.parent&&o.mc.parent.removeChild(o.mc),o.diceGro.alpha=1,o.diceGro.scaleX=.6,o.diceGro.scaleY=.6,o.diceGro.visible=!0,o.diceGro.getChildAt(0).texture=RES.getRes("tpm_s"+e[0]+"_png"),o.diceGro.getChildAt(1).texture=RES.getRes("tpm_s"+e[1]+"_png"),o.diceGro.visible=!0,egret.Tween.get(o.diceGro).wait(300).to({scaleX:1,scaleY:1},200).wait(700).to({alpha:0},200).set({visible:!1}).call(function(){o.gameScene.headDown.reZhuangFlag(t.UserPosition.Down),o.gameScene.headUp.reZhuangFlag(t.UserPosition.Up)},o),setTimeout(function(){t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101005)},1400)},330*n)},n}(t.BaseGameMod);t.GameDiskMod=e,__reflect(e.prototype,"Tpm.GameDiskMod");var o;!function(t){t[t.normal=0]="normal",t[t.down=1]="down",t[t.up=2]="up",t[t.dice=3]="dice"}(o=t.DiskState||(t.DiskState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameEatChooseModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.initRectList(),this.twoCardList=[[],[]],this.threeCardList=[[],[],[]]},o.prototype.onEnable=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},o.prototype.onRemove=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},o.prototype.initRectList=function(){this.rectList=[];for(var t=0;2>t;t++)this.rectList.push(this.twoGro.getChildAt(t+2));for(var t=0;3>t;t++)this.rectList.push(this.threeGro.getChildAt(t+3))},o.prototype.onChoose=function(t){var e,o=t.target;switch(o){case this.rectList[0]:e=this.tValueList[0];break;case this.rectList[1]:e=this.tValueList[1];break;case this.rectList[2]:e=this.tValueList[0];break;case this.rectList[3]:e=this.tValueList[1];break;case this.rectList[4]:e=this.tValueList[2];break;default:console.error("eat choose error")}return!e||e.length<3?void console.error("eat choose list error"):(console.log("chooseList===",e),this.hideCombo(),void this.dispatchEventWith("selectComboEvent",!1,e))},o.prototype.onCancle=function(){this.hideCombo(),this.gameScene.selectBtnMod.reShow()},o.prototype.showCombo=function(t){if(!t||t.length<2||t[0].length<3)return void console.error("param error");this.tValueList=t,this.twoCardList[0].length<1&&this.initCard();var e,o=3;2==t.length?(this.twoGro.visible=!0,this.threeGro.visible=!1,e=this.twoCardList):3==t.length&&(this.twoGro.visible=!1,this.threeGro.visible=!0,e=this.threeCardList),t.sort(function(t,e){return t[0]-e[0]});for(var n=0;n<t.length;n++)for(var r=0;o>r;r++)t[n].sort(function(t,e){return t-e}),e[n][r].setCardValueAndSHow(t[n][r]);this.visible=!0},o.prototype.hideCombo=function(){this.visible=!1},o.prototype.initCard=function(){for(var e=3,o=60,n=10,r=10,i=.65,a=t.CardFactory.getInstance(),s=0;s<this.twoCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.twoGro.getChildAt(s).addChild(h),h.x=n+o*c,h.y=r,h.scaleX=h.scaleY=i,this.twoCardList[s].push(h)}for(var s=0;s<this.threeCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.threeGro.getChildAt(s).addChild(h),h.x=n+o*c,h.y=r,h.scaleX=h.scaleY=i,this.threeCardList[s].push(h)}},o}(t.BaseGameMod);t.GameEatChooseMod=e,__reflect(e.prototype,"Tpm.GameEatChooseMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameFlowerModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){},o.prototype.onRemove=function(){},o.prototype.initUI=function(){this.downGro.visible=!1,this.upGro.visible=!1,this.upNum=0,this.downNum=0},o.prototype.setFlowerState=function(e,o){1>o||(e==t.UserPosition.Down?(this.downGro.visible=!0,this.downNum+=o,this.flowerLabDown.text="x"+this.downNum):(this.upGro.visible=!0,this.upNum+=o,this.flowerLabUp.text="x"+this.upNum))},o}(t.BaseUI);t.GameFlowerMod=e,__reflect(e.prototype,"Tpm.GameFlowerMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameGangChooseModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.initRectList(),this.twoCardList=[[],[]],this.threeCardList=[[],[],[]]},o.prototype.onEnable=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},o.prototype.onRemove=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},o.prototype.initRectList=function(){this.rectList=[];for(var t=0;2>t;t++)this.rectList.push(this.twoGro.getChildAt(t+2));for(var t=0;3>t;t++)this.rectList.push(this.threeGro.getChildAt(t+3))},o.prototype.onChoose=function(t){var e,o=t.target;switch(o){case this.rectList[0]:e=this.tValueList[0];break;case this.rectList[1]:e=this.tValueList[1];break;case this.rectList[2]:e=this.tValueList[0];break;case this.rectList[3]:e=this.tValueList[1];break;case this.rectList[4]:e=this.tValueList[2];break;default:console.error("gang choose error")}(!e||e.length<3)&&console.error("gang choose list error"),console.log("chooseList===",e),this.hideCombo(),this.dispatchEventWith("selectComboEvent",!1,e)},o.prototype.onCancle=function(){this.hideCombo(),this.gameScene.selectBtnMod.reShow()},o.prototype.showCombo=function(t){if(!t||t.length<2||t[0].length<3)return void console.error("param error");this.tValueList=t,this.twoCardList[0].length<1&&this.initCard();var e,o=4;2==t.length?(this.twoGro.visible=!0,this.threeGro.visible=!1,e=this.twoCardList):3==t.length&&(this.twoGro.visible=!1,this.threeGro.visible=!0,e=this.threeCardList);for(var n=0;n<t.length;n++)for(var r=0;o>r;r++)e[n][r].setCardValueAndSHow(t[n][r]);this.visible=!0},o.prototype.hideCombo=function(){this.visible=!1},o.prototype.initCard=function(){for(var e=4,o=60,n=10,r=10,i=.65,a=t.CardFactory.getInstance(),s=0;s<this.twoCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.twoGro.getChildAt(s).addChild(h),h.x=n+o*c,h.y=r,h.scaleX=h.scaleY=i,this.twoCardList[s].push(h)}for(var s=0;s<this.threeCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.threeGro.getChildAt(s).addChild(h),h.x=n+o*c,h.y=r,h.scaleX=h.scaleY=i,this.threeCardList[s].push(h)}},o}(t.BaseGameMod);t.GameGangChooseMod=e,__reflect(e.prototype,"Tpm.GameGangChooseMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameHeadModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.headImg.mask=this.headMask},o.prototype.onEnable=function(){this.zhuangImg.visible=!1,this.reGoldLab(0)},o.prototype.onRemove=function(){},o.prototype.reHeadState=function(e){var o=t.App.DataCenter.UserInfo.getUserByPos(e);o?(this.visible=!0,this.reGoldLab(o.gold),this.reZhuangFlag(e)):this.visible=!1},o.prototype.reZhuangFlag=function(e){var o=t.App.DataCenter.UserInfo.getUserByPos(e);o&&o.zhuangFlag?this.zhuangImg.visible=!0:this.zhuangImg.visible=!1},o.prototype.reGoldLab=function(e){this.goldLab.text=t.NumberTool.formatGoldHead(e)},o}(t.BaseUI);t.GameHeadMod=e,__reflect(e.prototype,"Tpm.GameHeadMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.itemWidth=129,t.itemHeight=83,t.frameMaxWidth=536,t.frameMaxHeight=320,t.skinName=TpmSkin.GameHuTipsModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},o.prototype.onRemove=function(){this.hideTips()},o.prototype.showHuTips=function(e,o){if(this.curValue!=o&&this.curList!=e){this.curList=e,this.curValue=o;var n=e.length;if(1>n)return void console.error("valuelist error");var r=this.frameMaxWidth,i=this.frameMaxHeight;7>n&&n>3?i-=this.itemHeight+6:4>n&&(i-=2*(this.itemHeight+6)),2==n?r-=this.itemWidth:1==n&&(r-=2*this.itemWidth),this.framGro.width=r,this.framGro.height=i,this.validateNow();var a=new eui.ArrayCollection;a.source=e,this.fanList.dataProvider=a,this.fanList.itemRenderer=t.HuTipsItem,this.framGro.visible=!0}},o.prototype.showCancle=function(){this.visible=!0,this.framGro.visible=!1},o.prototype.hideTips=function(){this.curValue=null,this.visible=!1},o.prototype.onCancle=function(){this.hideTips(),this.gameScene.selectBtnMod.reShow(),this.gameScene.cardMod.tingCancleShow()},o}(t.BaseGameMod);t.GameHuTipsMod=e,__reflect(e.prototype,"Tpm.GameHuTipsMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=TpmSkin.GameMatchModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){},e.prototype.onRemove=function(){this.removeCircleTween()},e.prototype.setType=function(t){switch(this.uiType=t,this.removeCircleTween(),this.uiType){case o.common:this.matchGro.visible=!1,this.reMatchGro.visible=!1,this.jieSanGro.visible=!1;break;case o.match:this.matchGro.visible=!0,this.reMatchGro.visible=!1,this.jieSanGro.visible=!1,this.curentCircleImg=this.circleImg,this.circleRound();
break;case o.jieSan:this.matchGro.visible=!1,this.reMatchGro.visible=!1,this.jieSanGro.visible=!0,this.curentCircleImg=null;break;case o.reMatch:this.matchGro.visible=!1,this.reMatchGro.visible=!0,this.jieSanGro.visible=!1,this.curentCircleImg=this.circleImgRe,this.circleRound();break;default:console.error("type error")}},e.prototype.circleRound=function(){egret.Tween.get(this.curentCircleImg,{loop:!0}).to({rotation:360},1e3)},e.prototype.removeCircleTween=function(){this.curentCircleImg&&egret.Tween.removeTweens(this.curentCircleImg)},e}(t.BaseUI);t.GameMatchMod=e,__reflect(e.prototype,"Tpm.GameMatchMod");var o;!function(t){t[t.common=0]="common",t[t.match=1]="match",t[t.jieSan=2]="jieSan",t[t.reMatch=3]="reMatch"}(o=t.MatchType||(t.MatchType={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameMenuModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.initUI(),this.gameAddBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.gameRuleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.gameSetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this)},o.prototype.onRemove=function(){},o.prototype.initUI=function(){this.menuState=!1,this.bg.visible=this.menuState,this.addGro.visible=this.menuState},o.prototype.onRule=function(){t.App.PanelManager.open(t.PanelConst.PlayMethodPanel,!0),this.onAdd()},o.prototype.onSet=function(){t.App.PanelManager.open(t.PanelConst.SetPanel,!0),this.onAdd()},o.prototype.onAdd=function(){this.menuState=!this.menuState,this.bg.visible=this.menuState,this.addGro.visible=this.menuState,this.menuState?this.gameAddBtn.rotation=180:this.gameAddBtn.rotation=0},o}(t.BaseUI);t.GameMenuMod=e,__reflect(e.prototype,"Tpm.GameMenuMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.durationTime=2e3,t.skinName=TpmSkin.GameOutShowModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.upGro.visible=!1,this.downGro.visible=!1},o.prototype.onRemove=function(){egret.Tween.removeTweens(this)},o.prototype.showOutCard=function(e,o){t.App.DataCenter.runingData.latelyCardValue=e,this.upCard||this.initCard(),o==t.UserPosition.Down?(this.upGro.visible=!1,this.downGro.visible=!0,this.startHide(this.downGro),this.downCard.setCardValueAndSHow(e)):(this.upGro.visible=!0,this.downGro.visible=!1,this.startHide(this.upGro),this.upCard.setCardValueAndSHow(e))},o.prototype.initCard=function(){var e=20,o=17,n=t.CardFactory.getInstance();this.upCard=n.getHandCard(0,t.UserPosition.Down),this.upGro.addChild(this.upCard),this.upCard.x=e,this.upCard.y=o,this.downCard=n.getHandCard(0,t.UserPosition.Down),this.downGro.addChild(this.downCard),this.downCard.x=e,this.downCard.y=o},o.prototype.startHide=function(t){egret.Tween.get(this).wait(this.durationTime).call(function(){t.visible=!1})},o}(t.BaseUI);t.GameOutShowMod=e,__reflect(e.prototype,"Tpm.GameOutShowMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameReadyModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.beginBtn.touchEnabled=!0,this.beginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegin,this)},n.prototype.onRemove=function(){this.stopTimer(),this.beginBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegin,this)},n.prototype.setState=function(t,e){switch(void 0===e&&(e=!1),this.readyState=t,this.stopTimer(),this.readyState){case o.normal:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!1;break;case o.ready_00:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!0,this.startTimer();break;case o.ready_10:this.upReady.visible=!0,this.downReady.visible=!1,this.beginBtn.visible=!0,this.startTimer();break;case o.ready_01:this.upReady.visible=!1,this.downReady.visible=!0,this.beginBtn.visible=!1;break;case o.ready_11:this.upReady.visible=!0,this.downReady.visible=!0,this.beginBtn.visible=!1;break;default:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!1}e&&(this.downReady.visible=!1)},n.prototype.hideBeginBtn=function(){this.beginBtn.visible=!1},n.prototype.onBegin=function(){var t=this;this.beginBtn.touchEnabled=!1,setTimeout(function(){t.beginBtn.touchEnabled=!0},1e3),this.ctrl.sendMod.sendReady(),this.gameScene.clearDesk(!1)},n.prototype.startTimer=function(e){void 0===e&&(e=120),this.remainTime=e,this.backTimer&&this.backTimer.stop()&&this.backTimer.removeEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.backTimer=new t.DateTimer(1e3,e),this.backTimer.addEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.backTimer.reset(),this.backTimer.start()},n.prototype.onOutTime=function(){return this.remainTime<1?void this.stopTimer():void this.remainTime--},n.prototype.stopTimer=function(){this.backTimer&&this.backTimer.stop()},n}(t.BaseGameMod);t.GameReadyMod=e,__reflect(e.prototype,"Tpm.GameReadyMod");var o;!function(t){t[t.normal=0]="normal",t[t.ready_00=1]="ready_00",t[t.ready_10=2]="ready_10",t[t.ready_01=3]="ready_01",t[t.ready_11=4]="ready_11"}(o=t.ReadyState||(t.ReadyState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameSceneSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.ctrl.onRegister(),this.initUI(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.hallBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.selectBtnMod.addEventListener("sendActEvent",this.onActBtnTouch,this),this.headDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this),this.headUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this)},o.prototype.onRemove=function(){this.ctrl.onRemove(),this.clearDesk()},o.prototype.initUI=function(e){void 0===e&&(e=!0),this.reResidue(!1),this.diskMod.setState(t.DiskState.normal),this.flowerMod.initUI(),this.selectBtnMod.hide(),this.matchMod.setType(t.MatchType.common),this.tuoMod.setState(!1),this.eatChooseMod.hideCombo(),this.gangChooseMod.hideCombo(),this.huTipsMod.hideTips(),this.outShowMod.visible=!0,this.tingDown.setState(t.TingState.normal),this.tingUp.setState(t.TingState.normal),e&&(this.reDeskDesc(t.RoomType.noob),this.readyMod.setState(t.ReadyState.normal)),t.App.DataCenter.debugInfo.testState&&(this.cheatMod.visible=!0)},o.prototype.clearDesk=function(e){void 0===e&&(e=!0),this.cardMod.clearCardMovieGro(),this.cardMod.clearAllCard(),t.App.DataCenter.runingData.clearData(e),this.initUI(e)},o.prototype.intoRoom=function(){this.headDown.reHeadState(t.UserPosition.Down),this.headUp.reHeadState(t.UserPosition.Up),t.App.DataCenter.UserInfo.getUserNum()<2?this.matchMod.setType(t.MatchType.match):this.matchMod.setType(t.MatchType.common),t.App.DataCenter.debugInfo.autoReady?this.ctrl.sendMod.sendReady():(this.readyMod.visible=!0,this.readyMod.setState(t.ReadyState.ready_00)),this.reDeskDesc(t.App.DataCenter.runingData.curentRoomType)},o.prototype.reConnect=function(e){console.log("scene reConnect");var o=t.ProtocolDataRev.R_100010;o=e,t.App.DataCenter.runingData.gameState=t.GameState.Playing;for(var n=o.info.user_info,r=0;r<n.length;r++)if(n[r].user_id==t.App.DataCenter.UserInfo.myUserUid)t.App.DataCenter.UserInfo.myUserInfo.seatID=n[r].seat_id,t.App.DataCenter.UserInfo.myUserInfo.gold=n[r].point;else{var i=new t.UserVO;i.initUserFromSocket(n[r]),t.App.DataCenter.UserInfo.addUser(i)}var a=o.info.game_data.desk_info;t.App.DataCenter.runingData.curentRoomType=a.room_type,a.remain_count&&this.reResidue(!0,a.remain_count),this.reDeskDesc(t.App.DataCenter.runingData.curentRoomType);var s=o.info.game_data.player_info;this.headDown.reHeadState(t.UserPosition.Down),this.headUp.reHeadState(t.UserPosition.Up);var c=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Down),h=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Up);this.flowerMod.setFlowerState(t.UserPosition.Down,s[c].bu_hua_num),this.flowerMod.setFlowerState(t.UserPosition.Up,s[h].bu_hua_num),this.setTingState(s);var d=Math.floor(o.info.game_data.wait_task.end_time),p=o.info.game_data.player_info;if(p[c].hand_card_by_order[p[c].hand_card_by_order.length-2].length%3==2?(this.diskMod.setState(t.DiskState.down,d),t.App.DataCenter.runingData.bAllowOutCard=!0):p[h].hand_card_by_order[p[h].hand_card_by_order.length-2].length%3==2?this.diskMod.setState(t.DiskState.up,d||t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime):this.diskMod.setState(t.DiskState.up,d||t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),this.cardMod.reConnectCardShow(t.UserPosition.Down,o.info.game_data.player_info[c].hand_card_by_order,o.info.game_data.player_info[c].last_card,o.info.game_data.player_info[c].out_card),this.cardMod.reConnectCardShow(t.UserPosition.Up,o.info.game_data.player_info[h].hand_card_by_order,o.info.game_data.player_info[h].last_card,o.info.game_data.player_info[h].out_card),o.info.game_data.wait_task.params){var l=o.info.game_data.wait_task.params,u=t.App.DataCenter.UserInfo.getPosFromSeat(l.seat_id),g=u?t.DiskState.up:t.DiskState.down;if(this.diskMod.setState(g,d),l.seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){console.log("动作操作数据：",l),t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101001,l);var m=t.CardLogic.getInstance().getActListFromKey(l.act_info);this.selectBtnMod.showActBtn(m)}}},o.prototype.setTingState=function(e){var o=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Down),n=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Up),r=t.TingState.normal;e[o].is_ting&&(t.App.DataCenter.runingData.ownTingState=!0,r=e[o].guo_hu_num>0?t.TingState.guo:t.TingState.ting),r!=t.TingState.normal&&(t.App.DataCenter.runingData.ownTingState=!0),this.tingDown.setState(r,e[o].guo_hu_num),t.App.DataCenter.runingData.ownGuoTimes=e[o].guo_hu_num;var i=t.TingState.normal;e[n].is_ting&&(i=e[n].guo_hu_num>0?t.TingState.guo:t.TingState.ting),this.tingUp.setState(i,e[n].guo_hu_num)},o.prototype.reDeskDesc=function(e){var o=t.App.DataCenter.roomInfo.getConfigForType(e);return o?void(this.descLab.text=o.roomName+" "+o.minHuFan+"番起胡 底分"+o.baseBet):void console.error("roomInfo error")},o.prototype.reResidue=function(t,e){void 0===e&&(e=0),this.residueGro.visible=t,this.residueLab.text=e.toString()},o.prototype.onExit=function(){this.ctrl.sendMod.sendExitRoom()},o.prototype.onHead=function(e){var o=0;e.target==this.headDown?o=t.App.DataCenter.UserInfo.myUserUid:e.target==this.headUp&&(o=t.App.DataCenter.UserInfo.getUserByPos(t.UserPosition.Up).userID),this.ctrl.sendHeadInfo(o)},o.prototype.onTouchTap=function(t){},o.prototype.onActBtnTouch=function(e){var o=this;this.selectBtnMod.hide();var n=e.data;console.log("按钮动作==",n);switch(n){case t.ACT_state.Act_Chi:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);1==r.act_info[t.ACT_state.Act_Chi].length?this.ctrl.sendMod.sendAct(n,r.act_info[t.ACT_state.Act_Chi][0]):r.act_info[t.ACT_state.Act_Chi].length>1?(this.eatChooseMod.showCombo(r.act_info[t.ACT_state.Act_Chi]),this.eatChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedEatList==",t.data),o.ctrl.sendMod.sendAct(n,t.data)},this)):console.error("eat combo error");break;case t.ACT_state.Act_AnGang:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);if(1==r.act_info[t.ACT_state.Act_AnGang].length)this.ctrl.sendMod.sendAct(n,r.act_info[t.ACT_state.Act_AnGang][0]);else if(r.act_info[t.ACT_state.Act_AnGang].length>1){for(var i=[],a=0;a<r.act_info[t.ACT_state.Act_AnGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedAGangList==",t.data),o.ctrl.sendMod.sendAct(n,t.data[0])},this)}else console.error("angang combo error");break;case t.ACT_state.Act_BuGang:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);if(1==r.act_info[t.ACT_state.Act_BuGang].length)this.ctrl.sendMod.sendAct(n,r.act_info[t.ACT_state.Act_BuGang][0]);else if(r.act_info[t.ACT_state.Act_BuGang].length>1){for(var i=[],a=0;a<r.act_info[t.ACT_state.Act_BuGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedBGangList==",t.data),o.ctrl.sendMod.sendAct(n,t.data[0])},this)}else console.error("bugang combo error");break;case t.ACT_state.Act_ZuheGang:for(var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1),i=[],a=0;a<r.act_info[t.ACT_state.Act_AnGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),i.push(s)}for(var a=0;a<r.act_info[t.ACT_state.Act_BuGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(e){console.log("choosedZuheGangList==",e.data),e.data[0]==r.act_info[t.ACT_state.Act_BuGang][0][0]?o.ctrl.sendMod.sendAct(t.ACT_state.Act_BuGang,e.data[0]):o.ctrl.sendMod.sendAct(t.ACT_state.Act_AnGang,e.data[0])},this);break;case t.ACT_state.Act_Ting:t.App.DataCenter.runingData.bAllowOutCard=!0,this.huTipsMod.showCancle(),this.cardMod.tingCardShow();break;case t.ACT_state.Act_Guohu:this.ctrl.sendMod.sendAct(t.ACT_state.Act_Pass);break;default:this.ctrl.sendMod.sendAct(n)}},o.prototype.allowOutCardJudge=function(e,o){if(o==t.UserPosition.Down){var n=[t.ACT_state.Act_Chi,t.ACT_state.Act_Peng,t.ACT_state.Act_Gang,t.ACT_state.Act_AnGang,t.ACT_state.Act_BuGang];n.indexOf(e)>=0&&(t.App.DataCenter.runingData.bAllowOutCard=!0)}},o.prototype.onActDo=function(e,o,n,r){switch(console.log("处理动作：",e),e==t.ACT_state.Act_Out?this.outShowMod.showOutCard(n[0],o):this.dbMod.showActDb(e,o),this.allowOutCardJudge(e,o),e){case t.ACT_state.Act_Pass:break;case t.ACT_state.Act_Out:o==t.UserPosition.Down&&(t.App.DataCenter.runingData.bAllowOutCard=!1);var i=o?t.DiskState.down:t.DiskState.up;this.diskMod.setState(i,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),console.log("out card===",n[0]),this.cardMod.outCardShow(o,n[0]);break;case t.ACT_state.Act_Chi:this.cardMod.eatCardShow(n,o);break;case t.ACT_state.Act_Peng:n.push(n[0]),n.push(n[0]),this.cardMod.eatCardShow(n,o,!0);break;case t.ACT_state.Act_AnGang:this.cardMod.gangCardShow(e,n[0],o);break;case t.ACT_state.Act_BuGang:this.cardMod.gangCardShow(e,n[0],o);break;case t.ACT_state.Act_Gang:this.cardMod.gangCardShow(e,n[0],o);break;case t.ACT_state.Act_Ting:o==t.UserPosition.Down?(t.App.DataCenter.runingData.ownTingState=!0,this.huTipsMod.hideTips(),this.cardMod.tingDidShow(r),this.tingDown.setState(t.TingState.ting)):this.tingUp.setState(t.TingState.ting);break;case t.ACT_state.Act_DianHu:this.selectBtnMod.hide(),this.cardMod.dianHuCardShow(n[0],o);break;case t.ACT_state.Act_Guohu:this.selectBtnMod.hide(),o==t.UserPosition.Down?(this.tingDown.setState(t.TingState.guo,1,!0),t.App.DataCenter.runingData.ownGuoTimes++):this.tingUp.setState(t.TingState.guo,1,!0)}},o}(t.BaseScene);t.GameScene=e,__reflect(e.prototype,"Tpm.GameScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.btnList={},t.btnListTouch={},t.vectorWidth=1126,t.itemWidth=150,t.bInitRes=!1,t.skinName=TpmSkin.GameSelectBtnModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.btnList[t.ACT_state.Act_Pass]=this.passBtn,this.btnList[t.ACT_state.Act_Peng]=this.pengBtn,this.btnList[t.ACT_state.Act_Chi]=this.eatBtn,this.btnList[t.ACT_state.Act_Gang]=this.gangBtn,this.btnList[t.ACT_state.Act_BuGang]=this.gangBtn,this.btnList[t.ACT_state.Act_AnGang]=this.gangBtn,this.btnList[t.ACT_state.Act_DianHu]=this.huBtn,this.btnList[t.ACT_state.Act_Zimo]=this.huBtn,this.btnList[t.ACT_state.Act_Guohu]=this.guoHuBtn,this.btnList[t.ACT_state.Act_Cancle]=this.cancleBtn,this.btnList[t.ACT_state.Act_Ting]=this.tingBtn,this.btnListTouch[t.ACT_state.Act_Pass]=this.passBtn0,this.btnListTouch[t.ACT_state.Act_Peng]=this.pengBtn0,this.btnListTouch[t.ACT_state.Act_Chi]=this.eatBtn0,this.btnListTouch[t.ACT_state.Act_Gang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_BuGang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_AnGang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_DianHu]=this.huBtn0,this.btnListTouch[t.ACT_state.Act_Zimo]=this.huBtn0,this.btnListTouch[t.ACT_state.Act_Guohu]=this.guoHuBtn0,this.btnListTouch[t.ACT_state.Act_Cancle]=this.cancleBtn0,this.btnListTouch[t.ACT_state.Act_Ting]=this.tingBtn0,this.touchEnabled=!1},o.prototype.initRes=function(){0==this.bInitRes&&(this.bInitRes=!0,this.passBtn.setNewActSkin(t.ACT_act.Act_Pass),this.eatBtn.setNewActSkin(t.ACT_act.Act_Chi),this.pengBtn.setNewActSkin(t.ACT_act.Act_Peng),this.gangBtn.setNewActSkin(t.ACT_act.Act_Gang),this.huBtn.setNewActSkin(t.ACT_act.Act_Hu),this.guoHuBtn.setNewActSkin(t.ACT_act.Act_Guohu),this.cancleBtn.setNewActSkin(t.ACT_act.Act_cancle),this.tingBtn.setNewActSkin(t.ACT_act.Act_Ting),this.passBtn0.setSortWeight(t.ACT_act.Act_Pass),this.eatBtn0.setSortWeight(t.ACT_act.Act_Chi),this.pengBtn0.setSortWeight(t.ACT_act.Act_Peng),this.gangBtn0.setSortWeight(t.ACT_act.Act_Gang),this.huBtn0.setSortWeight(t.ACT_act.Act_Hu),this.guoHuBtn0.setSortWeight(t.ACT_act.Act_Guohu),this.cancleBtn0.setSortWeight(t.ACT_act.Act_cancle),this.tingBtn0.setSortWeight(t.ACT_act.Act_Ting))},o.prototype.onTouch=function(e){for(var o in this.btnListTouch)if(this.btnListTouch[o]==e.parent){this.btnListTouch[o]==this.gangBtn0?this.keyIn(t.ACT_state.Act_AnGang)&&this.keyIn(t.ACT_state.Act_BuGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_ZuheGang):this.keyIn(t.ACT_state.Act_AnGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_AnGang):this.keyIn(t.ACT_state.Act_BuGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_BuGang):this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_Gang):this.btnListTouch[o]==this.huBtn0?this.keyIn(t.ACT_state.Act_DianHu)&&!this.keyIn(t.ACT_state.Act_Zimo)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_DianHu):!this.keyIn(t.ACT_state.Act_DianHu)&&this.keyIn(t.ACT_state.Act_Zimo)&&this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_Zimo):this.dispatchEventWith("sendActEvent",!1,parseInt(o));break}},o.prototype.keyIn=function(t){for(var e=0;e<this.actList.length;e++)if(t==this.actList[e])return!0;return!1},o.prototype.showActBtn=function(e){if(console.log("btnlit===",e),this.actList=t.ArrayTool.deepCopy(e),(this.keyIn(t.ACT_state.Act_DianHu)||this.keyIn(t.ACT_state.Act_Zimo))&&t.App.DataCenter.runingData.guoHuFlag&&t.App.DataCenter.runingData.ownTingState)for(var o=0;o<this.actList.length;o++)if(this.actList[o]==t.ACT_state.Act_Pass){this.actList[o]=t.ACT_state.Act_Guohu,this.setTipsState(!0);break}this.initRes();var n=this.actList.length;this.showBtnList=[],this.touchBtnList=[];for(var o=n-1;o>=0;o--){var r=this.actList[o],i=this.btnList[r],a=this.btnListTouch[r];null!=i?this.btnAdded(i)?console.log("重复按钮"):(this.showBtnList.push(i),this.touchBtnList.push(a)):console.error("缺少动作操作按钮:",r)}for(var s in this.btnList)this.btnList[s].visible=!1;for(var s in this.btnListTouch)this.btnListTouch[s].visible=!1;for(var o=0;o<this.showBtnList.length;o++)this.showBtnList[o].visible=!0,this.showBtnList[o].playAnim(),this.touchBtnList[o].visible=!0;this.showBtnList.sort(function(t,e){return t.sortWeight-e.sortWeight}),this.touchBtnList.sort(function(t,e){return t.sortWeight-e.sortWeight});for(var c=this.showBtnList.length,h=this.vectorWidth-n*this.itemWidth,d=0,o=c-1;o>=0;o--){var p=this.showBtnList[o],l=this.touchBtnList[o];l.x=p.x=h+this.itemWidth*o+d}(this.actList.length>1||this.actList[0]!=t.ACT_state.Act_Out&&1==this.actList.length)&&this.show()},o.prototype.btnAdded=function(t){for(var e=0;e<this.showBtnList.length;e++)if(this.showBtnList[e]==t)return!0;return!1},o.prototype.show=function(){this.visible=!0,t.App.DataCenter.runingData.selectBtnState=!0},o.prototype.hide=function(){for(var e in this.btnList)this.btnList[e].stopAnim();this.visible=!1,t.App.DataCenter.runingData.selectBtnState=!1,this.setTipsState(!1)},o.prototype.reShow=function(){for(var e=0;e<this.showBtnList.length;e++)this.showBtnList[e].visible=!0,this.showBtnList[e].playAnim();(this.keyIn(t.ACT_state.Act_DianHu)||this.keyIn(t.ACT_state.Act_Zimo))&&(t.App.DataCenter.runingData.bAllowOutCard=!1),this.show()},o.prototype.setTipsState=function(e){if(this.tipsGro.visible=e,e){var o=t.App.DataCenter.runingData.ownGuoTimes+1;this.tipsLab.text="过胡"+o+"次，金币x"+Math.pow(2,o)}},o}(eui.Component);t.GameSelectBtnMod=e,__reflect(e.prototype,"Tpm.GameSelectBtnMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=TpmSkin.GameTingModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){this.setState(o.normal)},e.prototype.onRemove=function(){},e.prototype.setState=function(t,e,n){switch(void 0===e&&(e=1),void 0===n&&(n=!1),this.tingState=t,this.tingState){case o.normal:this.tingImg.visible=!1,this.guoGro.visible=!1,this.timesLab.text="0";break;case o.guo:this.tingImg.visible=!1,this.guoGro.visible=!0,n?this.timesLab.text=Number(this.timesLab.text)+e+"":this.timesLab.text=e.toString();break;case o.ting:this.tingImg.visible=!0,this.guoGro.visible=!1;break;default:this.tingImg.visible=!1,this.guoGro.visible=!1}},e}(t.BaseUI);t.GameTingMod=e,__reflect(e.prototype,"Tpm.GameTingMod");var o;!function(t){t[t.normal=0]="normal",t[t.ting=1]="ting",t[t.guo=2]="guo"}(o=t.TingState||(t.TingState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.tuoGuanState=!1,e.skinName=TpmSkin.GameTuogModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onRemove=function(){},e.prototype.setState=function(t){this.tuoGuanState=t,this.visible=this.tuoGuanState},e.prototype.onTouch=function(){},e}(t.BaseUI);t.GameTuogMod=e,__reflect(e.prototype,"Tpm.GameTuogMod")}(Tpm||(Tpm={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,o){function n(n){e.call(o,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Tpm;!function(t){var e=function(){function t(){}return t}();e.outCardPosXList=[230,1031],e.outCardPosYList=[536,127],e.outCardGapList=[50,46],e.handCardPosXList=[70,270],e.handCardPosYlist=[624,19],e.handCardGapList=[82,63],e.eatCardPosYList=[647,23],e.eatCardGapList=[73,60],e.eatCardOffset=[0,9],e.gangFourOffsetY=[-22,-19],e.angFourOffsetY=[-21,-18],e.moCardPosXList=[1179,185],e.moCardOffsetY=[-50,-19],e.huCardOffsetX=[30,-9],t.CardPos=e,__reflect(e.prototype,"Tpm.CardPos")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.HuTipsItemSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.posImg.visible=!1},o.prototype.dataChanged=function(){this.itemCard&&this.itemCard.parent&&this.removeChild(this.itemCard);var e=t.CardFactory.getInstance();this.itemCard=e.getHandCard(this.data.outCardValue,t.UserPosition.Down),this.itemCard.scaleX=this.itemCard.scaleY=.6,this.itemCard.x=8,this.itemCard.y=5,this.addChild(this.itemCard),this.fanLab.text=this.data.fanNum+"",this.sheetLab.text=this.data.residueNum+""},o}(eui.ItemRenderer);t.HuTipsItem=e,__reflect(e.prototype,"Tpm.HuTipsItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.cardList=[],t.skinName=TpmSkin.huTypeItemSkin,t.touchEnabled=!0,t}return __extends(o,e),o.prototype.dataChanged=function(){this.cardList=this.data.cardList,this.huLabel.text=this.data.hulabel,this.setCardList(this.cardList)},o.prototype.childrenCreated=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},o.prototype.onTouch=function(){var e=t.ProtocolDataSend.S_100999;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.test_type=4;var o={source_card:[],target_card:[]};o.target_card=this.cardList,e.test_params=JSON.stringify(o),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,e),t.Tips.showTop("发送成功"),t.App.SceneManager.getScene(t.SceneConst.GameScene).cheatMod.setFanGro(!1)},o.prototype.setCardList=function(e){for(var o,n=e.length,r=t.CardFactory.getInstance(),i=0;n>i;i++)o=r.getOutCard(e[i],t.UserPosition.Up),o.x=46*i,o.y=0,this.cardListGroup.addChild(o)},o}(eui.ItemRenderer);t.HuTypeItem=e,__reflect(e.prototype,"Tpm.HuTypeItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.resList=[],t.bInitRes=!1,t.skinName=TpmSkin.SelectActBtnSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.dbAmature=this.createDBArmature("tpm_NewProject_ske_json","tpm_NewProject_tex_json","tpm_NewProject_tex_png"),this.touchRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},o.prototype.onTouch=function(){console.log("touch rect"),t.App.SceneManager.getScene(t.SceneConst.GameScene).selectBtnMod.onTouch(this.touchRect)},Object.defineProperty(o.prototype,"sortWeight",{get:function(){return this._sortWeight},enumerable:!0,configurable:!0}),o.prototype.initRes=function(){if(0==this.bInitRes){this.bInitRes=!0;var e="annui_";this.resList[t.ACT_act.Act_Pass]="actBtnGuo",this.resList[t.ACT_act.Act_Chi]=e+"chi_erren",this.resList[t.ACT_act.Act_Peng]=e+"peng_erren",this.resList[t.ACT_act.Act_Gang]=e+"gang_erren",this.resList[t.ACT_act.Act_AnGang]=e+"gang_erren",this.resList[t.ACT_act.Act_Hu]=e+"hu_erren",this.resList[t.ACT_act.Act_Guohu]=e+"guohujiabei_erren",this.resList[t.ACT_act.Act_cancle]="actBtnCancle",this.resList[t.ACT_act.Act_Ting]=e+"ting_erren"}},o.prototype.setNewActSkin=function(e){this.initRes();var o=this.resList[e];this.dbKey=e,e==t.ACT_act.Act_Pass||e==t.ACT_act.Act_cancle?(this.img=new eui.Image("tpm_"+o+"_png"),this.img.x=19,this.img.y=19,this.btnGro.addChild(this.img)):(this.dbName=o,this.dbAmature.x=75,this.dbAmature.y=75,this.dbAmature.touchEnabled=!1,this.btnGro.addChild(this.dbAmature)),this.setSortWeight(e)},o.prototype.setSortWeight=function(e){var o=0;switch(e){case t.ACT_act.Act_Chi:o=10;break;case t.ACT_act.Act_Peng:o=20;break;case t.ACT_act.Act_Gang:o=30;break;case t.ACT_act.Act_AnGang:o=40;break;case t.ACT_act.Act_Hu:o=50;break;case t.ACT_act.Act_Ting:o=55;break;case t.ACT_act.Act_Guohu:o=60;break;case t.ACT_act.Act_Pass:o=70;break;case t.ACT_act.Act_cancle:o=80}this._sortWeight=o},o.prototype.playAnim=function(){this.dbName&&this.dbAmature.animation&&this.dbAmature.animation.play(this.dbName,0)},o.prototype.stopAnim=function(){this.dbName&&this.dbAmature.animation&&this.dbAmature.animation.stop()},o.prototype.createDBArmature=function(t,e,o){var n=new dragonBones.EgretFactory;n.parseDragonBonesData(RES.getRes(t)),n.parseTextureAtlasData(RES.getRes(e),RES.getRes(o));var r=n.buildArmatureDisplay("Armature");return r},o}(eui.Component);t.SelectActBtn=e,__reflect(e.prototype,"Tpm.SelectActBtn")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.playMethod=0]="playMethod",t[t.email=1]="email",t[t.share=2]="share",t[t.shop=3]="shop",t[t.set=4]="set"}(e=t.HallBtnMsg||(t.HallBtnMsg={}));var o=function(t){function o(){var e=t.call(this)||this;return e.skinName=TpmSkin.HallBtnModSkin,e}return __extends(o,t),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},o.prototype.onRemove=function(){},o.prototype.onTouch=function(t){if(!this.listener)return void console.error("按钮未设置监听");var o,n=t.target;switch(n){case this.hall_playMethod:o=e.playMethod;break;case this.hall_email:o=e.email;break;case this.hall_share:o=e.share;break;case this.hall_shop:o=e.shop;break;case this.hall_set:o=e.set}(o||0==o)&&this.listener(o)},o}(t.BaseUI);t.HallBtnMod=o,__reflect(o.prototype,"Tpm.HallBtnMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){return e.call(this)||this}return __extends(o,e),Object.defineProperty(o.prototype,"hallScene",{get:function(){return t.App.SceneManager.getScene(t.SceneConst.HallScene)},enumerable:!0,configurable:!0}),o.prototype.onRegister=function(){var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100104,this.revQuickBegin,this),e.register(t.ProtocolHeadRev.R_100105,this.revQuickBegin,this)},o.prototype.onRemove=function(){},o.prototype.sendChooseRoom=function(e){var o=t.ProtocolDataSend.S_100105;o.user_id=t.App.DataCenter.UserInfo.myUserUid,o.room_type=e,t.App.gameSocket.send(t.ProtocolHeadSend.S_100105,o)},o.prototype.sendQuickBegin=function(){var e=t.ProtocolDataSend.S_100104;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100104,e)},o.prototype.revQuickBegin=function(e){if(200==e.code){var o=t.ProtocolDataRev.R_100104;o=e,t.App.DataCenter.runingData.curentRoomType=o.info.room_type;for(var n in o.info.seat_info)if(o.info.seat_info[n].user_id==t.App.DataCenter.UserInfo.myUserUid)t.App.DataCenter.UserInfo.myUserInfo.seatID=o.info.seat_info[n].seat_id,t.App.DataCenter.UserInfo.myUserInfo.gold=o.info.seat_info[n].point;else{var r=new t.UserVO;r.initUserFromSocket(o.info.seat_info[n]),t.App.DataCenter.UserInfo.addUser(r)}var i=t.App.SceneManager.runScene(t.SceneConst.GameScene,t.App.getController(t.GameController.NAME));i.intoRoom()}else t.Tips.showTop(e.desc)},o.prototype.sendJieSanTest=function(){var e=t.ProtocolDataSend.S_100112;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100112,e)},o.prototype.sendRoomNum=function(){var e=new t.HttpSender,o=t.ProtocolHttp.getRoomNum;e.sendTest(o,this.revRoomNum,this)},o.prototype.revRoomNum=function(e){return e.ret?void(e.desc?t.Tips.showTop(e.desc):t.Tips.showTop("获取房间人数失败")):(t.App.DataCenter.roomInfo.reRoomNum(e.data.room_people_count),void this.hallScene.roomMod.reRoomNum(t.App.DataCenter.roomInfo.roomList))},o}(t.BaseController);e.NAME="HallController",t.HallController=e,__reflect(e.prototype,"Tpm.HallController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallHeadModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.headImg.mask=this.headMask},o.prototype.onEnable=function(){this.setDiamondVisible(),this.headGro.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPersonalInfo,this),this.arrowGro.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onArrow,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this)},o.prototype.onRemove=function(){this.headGro.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showPersonalInfo,this),this.arrowGro.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onArrow,this),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this)
},o.prototype.setDiamondVisible=function(t){void 0===t&&(t=!1),t?(this.arrowGro.visible=!1,this.diamondGro.visible=!0):(this.arrowGro.visible=!0,this.diamondGro.visible=!1)},Object.defineProperty(o.prototype,"arrowGroup",{get:function(){return this.arrowGro},enumerable:!0,configurable:!0}),o.prototype.onArrow=function(){var e=this;this.setDiamondVisible(!0),this.timeOut=setTimeout(function(){e.setDiamondVisible(!1),clearTimeout(e.timeOut)},3e3,this),t.HallHttpDataSend.sendGetDiamondAndGold()},o.prototype.showPersonalInfo=function(){t.HallHttpDataSend.sendGetUserInfo()},o.prototype.onAdd=function(){t.HallHttpDataSend.sendGetGoodsList()},o.prototype.updateDiamondAndGold=function(e,o){this.diamondLab.text=e+"",this.goldLab.text=t.NumberTool.formatMoney(o)},o.prototype.updatePersonalInfo=function(){this.nameLab.text=t.StringTool.formatNickName(t.App.DataCenter.UserInfo.myUserInfo.nickName,12),this.idLab.text="ID:"+t.App.DataCenter.UserInfo.myUserInfo.userID,this.diamondLab.text=t.App.DataCenter.UserInfo.myUserInfo.diamond+"",this.goldLab.text=t.NumberTool.formatMoney(t.App.DataCenter.UserInfo.myUserInfo.gold),this.headImg.source=t.App.DataCenter.UserInfo.myUserInfo.headUrl},o}(t.BaseUI);t.HallHeadMod=e,__reflect(e.prototype,"Tpm.HallHeadMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallRoomModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){this.initList()},o.prototype.onEnable=function(){this.lowBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.middleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.highBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},o.prototype.onRemove=function(){this.lowBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.middleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.highBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},o.prototype.initList=function(){this.betLabList=[],this.minGoldLabList=[],this.playerLabList=[],this.betLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("baseLab")),this.betLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("baseLabM")),this.betLabList.push(this.highBtn.getChildByName("highGro").getChildByName("baseLabH")),this.minGoldLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("mininumLab")),this.minGoldLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("mininumLabM")),this.minGoldLabList.push(this.highBtn.getChildByName("highGro").getChildByName("mininumLabH")),this.playerLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("playLab")),this.playerLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("playLabM")),this.playerLabList.push(this.highBtn.getChildByName("highGro").getChildByName("playLabH"))},o.prototype.initRoomUI=function(e){for(var o=0;o<e.length;o++)this.betLabList[o].text=e[o].baseBet+"",this.minGoldLabList[o].text=t.NumberTool.formatMoney(e[o].minEnterGold,2)+"金币以上",this.playerLabList[o].text=e[o].curPlayerCount+"人在玩"},o.prototype.reRoomNum=function(t){for(var e=0;e<t.length;e++)this.playerLabList[e].text=t[e].curPlayerCount+"人在玩"},o.prototype.onTouch=function(e){var o,n=e.target;switch(n){case this.lowBtn:o=t.RoomType.noob;break;case this.middleBtn:o=t.RoomType.middle;break;case this.highBtn:o=t.RoomType.high;break;default:o=t.RoomType.noob}t.App.getController(t.HallController.NAME).sendChooseRoom(o)},o}(t.BaseUI);t.HallRoomMod=e,__reflect(e.prototype,"Tpm.HallRoomMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallSceneSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){var t=this;this.btnMod.listener=function(e){t.onTouchBottomBtn(e)}},o.prototype.onEnable=function(){this.hallQuickBtn.touchEnabled=!0,this.ctrl.onRegister(),this.playQuick(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.hallBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.hallKefuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKefu,this),this.hallQuickBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuick,this),this.headMod.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this),t.App.DataCenter.debugInfo.skipNet||this.headMod.updatePersonalInfo(),this.ctrl.sendRoomNum()},o.prototype.onRemove=function(){this.ctrl.onRemove(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.hallBackBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.hallKefuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onKefu,this),this.hallQuickBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuick,this),this.headMod.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this)},o.prototype.onTap=function(t){t.target!=this.headMod.arrowGroup&&this.headMod.setDiamondVisible(!1)},o.prototype.onBack=function(){var e=this,o=t.App.MessageBoxManager.getBox();o.showMsg("您确定要退出游戏吗?",!0),o.ok=function(){e.ctrl.sendJieSanTest()}},o.prototype.onQuick=function(){var t=this;this.hallQuickBtn.touchEnabled=!1,setTimeout(function(){t.hallQuickBtn.touchEnabled=!0},1e3),this.ctrl.sendQuickBegin()},o.prototype.onKefu=function(){t.HallHttpDataSend.sendGetIncomeSupportMsg()},o.prototype.onHead=function(){},o.prototype.createQuickDb=function(){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes("tpm_NewProject_ske_json")),t.parseTextureAtlasData(RES.getRes("tpm_NewProject_tex_json"),RES.getRes("tpm_NewProject_tex_png")),this.quickDb=t.buildArmatureDisplay("Armature"),this.moveGro.addChild(this.quickDb),this.quickDb.x=667,this.quickDb.y=545},o.prototype.playQuick=function(){this.quickDb||this.createQuickDb(),this.quickDb.animation.play("kuaisukaishi",0)},o.prototype.onTouchBottomBtn=function(e){switch(e){case t.HallBtnMsg.playMethod:t.App.PanelManager.open(t.PanelConst.PlayMethodPanel);break;case t.HallBtnMsg.email:t.HallHttpDataSend.sendGetEmailList();break;case t.HallBtnMsg.share:t.App.PanelManager.open(t.PanelConst.SharePanel);break;case t.HallBtnMsg.shop:t.HallHttpDataSend.sendGetGoodsList();break;case t.HallBtnMsg.set:t.App.PanelManager.open(t.PanelConst.SetPanel);break;default:console.error("hallbtn error")}},o}(t.BaseScene);t.HallScene=e,__reflect(e.prototype,"Tpm.HallScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.reconnectFlag=!1,t}return __extends(o,e),o.prototype.onRegister=function(){this.addEvent(t.EventConst.SocketConnect,this.onSocketSuccess,this);var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100002,this.revSocketLogin,this),e.register(t.ProtocolHeadRev.R_100010,this.revReconnect,this)},o.prototype.loginGate=function(){t.App.LoadingLock.addLock("WEB服务登录中..."),this.sendHttpLogin(t.App.DataCenter.debugInfo.account,t.App.DataCenter.debugInfo.password)},o.prototype.sendHttpLogin=function(e,o){var n=new t.HttpSender,r={action:"Login",param:{}};r.param={user:e,password:o},n.post(r,this.revHttpLogin,this)},o.prototype.revHttpLogin=function(e){var o=t.ProtocolHttpData.LoginData;if(o=e,e.ret)t.Tips.showTop(o.desc);else{t.App.LoadingLock.minusLock();var n=o.data,r=new t.UserVO;r.initUserFromHttp(n),t.App.DataCenter.UserInfo.myUserUid=n.uid,t.App.DataCenter.UserInfo.addUser(r),t.App.DataCenter.ServerInfo.MD5PASS=n.password,t.App.DataCenter.ServerInfo.SERVER_URL="ws://"+n.ip+":"+n.port,t.App.DataCenter.debugInfo.skipGameServer?this.sendRoomInfo():this.connectGameServer()}},o.prototype.connectGameServer=function(){t.App.LoadingLock.addLock("游戏服务登录中..."),t.App.gameSocket.startConnect(t.App.DataCenter.ServerInfo.SERVER_URL,!0)},o.prototype.onSocketSuccess=function(){this.sendSocketLogin()},o.prototype.sendSocketLogin=function(){var e=t.ProtocolDataSend.S_100002;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.passwd=t.App.DataCenter.debugInfo.password,t.App.gameSocket.send(t.ProtocolHeadSend.S_100002,e)},o.prototype.revSocketLogin=function(e){var o=t.ProtocolDataRev.R_100002;o=e,200==o.code?(t.App.LoadingLock.minusLock(),o.info.reconnect&&(this.reconnectFlag=!0),this.sendRoomInfo()):t.Tips.showTop(e.desc)},o.prototype.sendRoomInfo=function(){var e=new t.HttpSender,o=t.ProtocolHttp.getRoomInfo;e.sendTest(o,this.revRoomInfo,this)},o.prototype.revRoomInfo=function(e){return e.ret?void console.error("get roominfo fail"):(t.App.DataCenter.roomInfo.initList(e.data.room_cfg_info),void(this.reconnectFlag?(this.sendReconnect(),this.reconnectFlag=!1):(t.App.SceneManager.runScene(t.SceneConst.HallScene,t.App.getController(t.HallController.NAME)),t.App.SceneManager.getScene(t.SceneConst.HallScene).roomMod.initRoomUI(t.App.DataCenter.roomInfo.roomList))))},o.prototype.sendReconnect=function(){var e=t.ProtocolDataSend.S_100010;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100010,e)},o.prototype.revReconnect=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ArrayTool.deepCopy(e),n=t.App.SceneManager.runScene(t.SceneConst.GameScene,t.App.getController(t.GameController.NAME));n.reConnect(o)},o}(t.BaseController);e.NAME="LoginController",t.LoginController=e,__reflect(e.prototype,"Tpm.LoginController")}(Tpm||(Tpm={}));var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.addBg()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName},e.prototype.addBg=function(){this.loadBg=new eui.Image,this.loadBg.source=Tpm.ResPathConfig.loadBg,this.addChild(this.loadBg),Tpm.App.LoadingLock.addLock("加载资源中..."),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.startApp,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("all")},e.prototype.startApp=function(){Tpm.App.LoadingLock.minusLock(),Tpm.App.getInstance().startUp()},e}(eui.UILayer);__reflect(Main.prototype,"Main");