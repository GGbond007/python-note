var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onEnable,n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,n.onRemove,n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){e.target instanceof eui.Button&&t.App.SoundManager.playEffect(t.SoundManager.button)},n),n}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){},n.prototype.onRemove=function(){},n.prototype.onDestroy=function(){},n.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},n}(eui.Component);t.BaseUI=e,__reflect(e.prototype,"Tpm.BaseUI")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),Object.defineProperty(n.prototype,"gameScene",{get:function(){return this.parent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ctrl",{get:function(){return t.App.getController(t.GameController.NAME)},enumerable:!0,configurable:!0}),n}(t.BaseUI);t.BaseGameMod=e,__reflect(e.prototype,"Tpm.BaseGameMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.getInstance=function(){var t=this;return null==t.instance&&(t.instance=new t),t.instance},t}();t.SingleClass=e,__reflect(e.prototype,"Tpm.SingleClass")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.moduleList={},t}return __extends(n,e),n.prototype.registerController=function(t,e){this.moduleList[t]=e},n.prototype.unRegisterController=function(t){this.moduleList[t].onRemove(),delete this.moduleList[t]},n.prototype.unRegisterControllerAll=function(){for(var t in this.moduleList)this.moduleList[t].onRemove()},n.prototype.getController=function(t){return this.moduleList[t]},n.prototype.sendEvent=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];(r=t.App.EventManager).sendEvent.apply(r,[e].concat(n));var r},n.prototype.addEvent=function(e,n,o){t.App.EventManager.addEvent(e,n,o)},n.prototype.removeEvent=function(e,n,o){t.App.EventManager.removeEvent(e,n,o)},n}(t.SingleClass);t.BaseApp=e,__reflect(e.prototype,"Tpm.BaseApp")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.prototype.onRegister=function(){},e.prototype.onRemove=function(){},e.prototype.sendEvent=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];t.App.EventManager.sendEvent(e,n)},e.prototype.addEvent=function(e,n,o){t.App.EventManager.addEvent(e,n,o)},e.prototype.removeEvent=function(e,n,o){t.App.EventManager.removeEvent(e,n,o)},e}();t.BaseController=e,__reflect(e.prototype,"Tpm.BaseController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.listenerVisible(),t}return __extends(n,e),n.prototype.listenerVisible=function(){var t=this;eui.Binding.bindHandler(this,["visible"],function(e){e||t.hide()},this)},n.prototype.show=function(e,n){void 0===e&&(e=!0),void 0===n&&(n=!0),t.App.PopUpManager.addPopUp(this,e,n)},n.prototype.hide=function(){t.App.PopUpManager.removePopUp(this)},n.prototype.recDataFun=function(t){this.recData=t},n}(t.BaseUI);t.BasePanel=e,__reflect(e.prototype,"Tpm.BasePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setController=function(t){this.ctrl=t},e}(t.BaseUI);t.BaseScene=e,__reflect(e.prototype,"Tpm.BaseScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),Object.defineProperty(n.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),n.prototype.initList=function(){this.outCardList=[[],[]],this.handCardList=[[],[]],this.chiCardList=[[],[]],this.pengCardList=[[],[]],this.gangCardList=[[],[]],this.angCardList=[[],[]],this.moCardList=[[],[]],this.huCardList=[[],[]]},n.prototype.drownAllHandCard=function(){for(var e=0;e<this.handCardList[t.UserPosition.Down].length;e++)this.handCardList[t.UserPosition.Down][e].toDown();this.moCardList[t.UserPosition.Down][0]&&this.moCardList[t.UserPosition.Down][0].toDown()},n.prototype.getEatAllLen=function(t){var e=Math.floor(this.chiCardList[t].length/3),n=Math.floor(this.pengCardList[t].length/3),o=Math.floor(this.gangCardList[t].length/4),r=Math.floor(this.angCardList[t].length/4),i=e+n+o+r;return i},n.prototype.addCardToOut=function(e,n){var o=0,r=t.CardPos.outCardPosYList[n];n==t.UserPosition.Down?o=t.CardPos.outCardPosXList[n]+t.CardPos.outCardGapList[n]*this.outCardList[n].length:n==t.UserPosition.Up&&(o=t.CardPos.outCardPosXList[n]-t.CardPos.outCardGapList[n]*this.outCardList[n].length),e.x=o,e.y=r,this.outCardList[n].push(e),this.outGro.addChild(e)},n.prototype.addCardToHand=function(e,n){var o=0,r=t.CardPos.handCardPosYlist[n],i=3,a=this.getEatAllLen(n);n==t.UserPosition.Down?o=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*(a*i+this.handCardList[n].length):n==t.UserPosition.Up&&(o=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*this.handCardList[n].length),e.x=o,e.y=r,this.handCardList[n].push(e),this.cardGro.addChild(e)},n.prototype.addCardToEat=function(e,n,o){if(void 0===o&&(o=!1),3!=e.length)return void console.error("添加吃、碰牌异常");for(var r=3,i=13,a=this.getEatAllLen(n),s=t.CardPos.eatCardPosYList[n],c=0,h=0;h<e.length;h++){var p=this.cardFactory.getEatCard(e[h],n);n==t.UserPosition.Down?c=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*r*a+t.CardPos.eatCardGapList[n]*h:n==t.UserPosition.Up&&(c=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*(i-(a+1)*r)+t.CardPos.eatCardOffset[n]+t.CardPos.eatCardGapList[n]*h),p.x=c,p.y=s,o?this.pengCardList[n].push(p):this.chiCardList[n].push(p),this.cardGro.addChild(p)}},n.prototype.addCardToGang=function(e,n,o){if(void 0===o&&(o=!1),4!=e.length)return void console.error("添加杠牌异常");for(var r=3,i=13,a=this.getEatAllLen(n),s=0,c=t.CardPos.eatCardPosYList[n],h=0;h<e.length;h++){var p;if(h==r){var d=1;o&&n==t.UserPosition.Up?(p=this.cardFactory.getAnGangCard(e[h],n),this.angCardList[n].push(p)):o?(p=this.cardFactory.getEatCard(e[h],n),this.angCardList[n].push(p)):(p=this.cardFactory.getEatCard(e[h],n),this.gangCardList[n].push(p)),n==t.UserPosition.Down?(s=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*r*a+t.CardPos.eatCardGapList[n]*d,o&&(s+=1)):n==t.UserPosition.Up&&(s=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*(i-(a+1)*r)+t.CardPos.eatCardOffset[n]+t.CardPos.eatCardGapList[n]*d),c+=o?t.CardPos.angFourOffsetY[n]:t.CardPos.gangFourOffsetY[n]}else o?(p=this.cardFactory.getAnGangCard(e[h],n),this.angCardList[n].push(p)):(p=this.cardFactory.getEatCard(e[h],n),this.gangCardList[n].push(p)),n==t.UserPosition.Down?s=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*r*a+t.CardPos.eatCardGapList[n]*h:n==t.UserPosition.Up&&(s=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*(i-(a+1)*r)+t.CardPos.eatCardOffset[n]+t.CardPos.eatCardGapList[n]*h);p.x=s,p.y=c,this.cardGro.addChild(p)}},n.prototype.addCardToBu=function(e,n){var o=0;console.log("bgbg===",e),console.log("pengList===",this.pengCardList[n]);for(var r=0;r<this.pengCardList[n].length;r++)if(this.pengCardList[n][r].cardValue==e&&(o++,2==o)){var i=this.cardFactory.getEatCard(e,n);return i.x=this.pengCardList[n][r].x,i.y=this.pengCardList[n][r].y+t.CardPos.gangFourOffsetY[n],this.cardGro.addChild(i),this.gangCardList[n].push(this.pengCardList[n][r-1]),this.gangCardList[n].push(this.pengCardList[n][r]),this.gangCardList[n].push(this.pengCardList[n][r+1]),this.gangCardList[n].push(i),this.pengCardList[n].splice(r+1,1),this.pengCardList[n].splice(r,1),void this.pengCardList[n].splice(r-1,1)}console.error("bu gang error")},n.prototype.addCardToMo=function(e,n){var o=t.CardPos.moCardPosXList[n],r=t.CardPos.handCardPosYlist[n];e.x=o,e.y=r,this.moCardList[n][0]=e,this.cardGro.addChild(e)},n.prototype.addCardToHu=function(e,n,o){void 0===o&&(o=!1);var r=3,i=this.getEatAllLen(n),a=t.CardPos.eatCardPosYList[n],s=0,c=0;o&&(c=t.CardPos.huCardOffsetX[n]);var h=this.cardFactory.getEatCard(e,n);n==t.UserPosition.Down?s=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*r*i+t.CardPos.eatCardGapList[n]*this.huCardList[n].length+c:n==t.UserPosition.Up&&(s=o?t.CardPos.handCardPosXList[n]+this.handCardList[n].length*t.CardPos.eatCardOffset[n]/r+t.CardPos.huCardOffsetX[n]-t.CardPos.eatCardGapList[n]:t.CardPos.handCardPosXList[n]+this.handCardList[n].length*t.CardPos.eatCardOffset[n]/r+t.CardPos.eatCardGapList[n]*this.huCardList[n].length),h.x=s,h.y=a,this.huCardList[n].push(h),this.cardGro.addChild(h)},n.prototype.reHandCardPos=function(e){t.CardLogic.getInstance().sortHandCardAB(this.handCardList[e]);for(var n=0;n<this.handCardList[e].length;n++){var o=this.handCardList[e][n],r=0,i=3,a=this.getEatAllLen(e);e==t.UserPosition.Down?r=t.CardPos.handCardPosXList[e]+t.CardPos.handCardGapList[e]*(a*i+n):e==t.UserPosition.Up&&(r=t.CardPos.handCardPosXList[e]+t.CardPos.handCardGapList[e]*n),o.x=r}},n.prototype.removeLastOutCard=function(t){this.outCardList[t][this.outCardList[t].length-1].recycle(),this.outCardList[t].pop()},n.prototype.deletHandCard=function(e,n,o){if(void 0===o&&(o=!1),n!=t.UserPosition.Up||t.App.DataCenter.runingData.ownTingState||(e=0),console.log("dddddddddddddd===vv=======",e),o)return void(this.moCardList[n][0]?(this.moCardList[n][0].recycle(),this.moCardList[n]=[]):console.error("delete mocard error"));for(var r=!1,i=0;i<this.handCardList[n].length;i++)if(this.handCardList[n][i].cardValue==e||0==e&&n==t.UserPosition.Up){this.handCardList[n][i].recycle(),this.handCardList[n].splice(i,1),r=!0;break}r||(this.moCardList[n][0]&&this.moCardList[n][0].cardValue==e?(this.moCardList[n][0].recycle(),this.moCardList[n]=[]):console.error("delete handcard error"))},n.prototype.reCardValue=function(e,n){if(0!=e&&0!=n){for(var o=t.UserPosition.Down,r=!0,i=0;i<this.handCardList[o].length;i++)if(this.handCardList[o][i].cardValue==e)return this.handCardList[o][i].setCardValueAndSHow(n),this.reHandCardPos(o),void(r=!1);r&&e==this.moCardList[o][0].cardValue&&this.moCardList[o][0].setCardValueAndSHow(n)}},n.prototype.initDb=function(){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes("tpm_fanpai_ske_json")),t.parseTextureAtlasData(RES.getRes("tpm_fanpai_tex_json"),RES.getRes("tpm_fanpai_tex_png")),this.cardDbMovieList=[];for(var e=0;13>e;e++){var n=t.buildArmatureDisplay("Armature");this.cardDbMovieList.push(n)}},n.prototype.showFanDb=function(e){if(!this.cardDbMovieList[e].parent){var n=t.UserPosition.Down;this.cardDbMovieList[e].y=t.CardPos.handCardPosYlist[n]+61,this.cardDbMovieList[e].x=t.CardPos.handCardPosXList[n]+t.CardPos.handCardGapList[n]*e+42.5,this.dbGro.addChild(this.cardDbMovieList[e])}this.cardDbMovieList[e].animation.play("fanpai_erren",1)},n.prototype.getCardResidue=function(e){if(e>83||17>e)return console.error("get residue cardvalue error"),0;for(var n=4,o=0;o<this.chiCardList.length;o++)n-=this.getCardNumFromList(e,this.chiCardList[o]);for(var o=0;o<this.pengCardList.length;o++)n-=this.getCardNumFromList(e,this.pengCardList[o]);for(var o=0;o<this.gangCardList.length;o++)n-=this.getCardNumFromList(e,this.gangCardList[o]);for(var o=0;o<this.outCardList.length;o++)n-=this.getCardNumFromList(e,this.outCardList[o]);for(var o=0;o<this.moCardList.length;o++)n-=this.getCardNumFromList(e,this.moCardList[o]);return n-=this.getCardNumFromList(e,this.angCardList[t.UserPosition.Down]),n-=this.getCardNumFromList(e,this.handCardList[t.UserPosition.Down]),0>n&&(console.error("residue error",n),n=0),n},n.prototype.getCardNumFromList=function(t,e){for(var n=0,o=0;o<e.length;o++)t==e[o].cardValue&&n++;return n},n.prototype.clearAllCard=function(){this.movieGro.removeChildren(),this.clearCardList(this.outCardList),this.clearCardList(this.handCardList),this.clearCardList(this.chiCardList),this.clearCardList(this.pengCardList),this.clearCardList(this.gangCardList),this.clearCardList(this.angCardList),this.clearCardList(this.huCardList),this.clearCardList(this.moCardList),this.outCardList=[[],[]],this.handCardList=[[],[]],this.chiCardList=[[],[]],this.pengCardList=[[],[]],this.gangCardList=[[],[]],this.angCardList=[[],[]],this.huCardList=[[],[]],this.moCardList=[[],[]],this.cardGro.removeChildren(),this.cardGro.addChild(this.outGro)},n.prototype.clearCardList=function(t){for(var e=0;e<t.length;e++){t[e]||console.error("list eeee");for(var n=0;n<t[e].length;n++)t[e][n].recycle()}},n}(t.BaseGameMod);t.CardModBase=e,__reflect(e.prototype,"Tpm.CardModBase")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.R_100002="100002",e.R_100010="100010",e.R_100100="100100",e.R_100103="100103",e.R_100104="100104",e.R_100105="100105",e.R_101001="101001",e.R_101002="101002",e.R_101003="101003",e.R_101004="101004",e.R_101005="101005",e.R_101006="101006",e.R_101007="101007",e.R_101008="101008",e.R_101100="101100",e.R_101101="101101",e.R_101105="101105",e.R_101106="101106",e.R_101107="101107",e.R_101109="101109",e.R_101110="101110",e.R_101112="101112",e.R_100999="100999",t.ProtocolHeadRev=e,__reflect(e.prototype,"Tpm.ProtocolHeadRev")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eventList={},e}return __extends(e,t),e.prototype.sendEvent=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this.eventList[t];if(null!=o)for(var r,i,a=o.length,s=0;a>s;s++){var c=o[s];r=c[0],i=c[1],r.apply(i,e)}},e.prototype.addEvent=function(t,e,n){var o=this.eventList[t];if(null==o)o=[],this.eventList[t]=o;else for(var r=o.length,i=0;r>i;i++)if(o[i][0]==e&&o[i][1]==n)return;o.push([e,n])},e.prototype.removeEvent=function(t,e,n){var o=this.eventList[t];if(null!=o)for(var r=o.length,i=r-1;i>=0;i--)o[i][0]==e&&o[i][1]==n&&o.splice(i,1);o&&0==o.length&&(this.eventList[t]=null,delete this.eventList[t])},e}(t.SingleClass);t.EventMananger=e,__reflect(e.prototype,"Tpm.EventMananger")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.sceneLayer=0]="sceneLayer",t[t.popLayer=1]="popLayer",t[t.msgLayer=2]="msgLayer",t[t.lockLayer=3]="lockLayer",t[t.tipLayer=4]="tipLayer"}(e=t.LayerConst||(t.LayerConst={}));var n=function(e){function n(){var n=e.call(this)||this;return n.rootLayer=new eui.UILayer,n.rootLayer.percentWidth=100,n.rootLayer.percentHeight=100,n.rootLayer.touchEnabled=!1,t.App.StageUtils.stage.addChild(n.rootLayer),n.sceneLayer=new eui.UILayer,n.sceneLayer.touchEnabled=!1,n.rootLayer.addChild(n.sceneLayer),n.popLayer=new eui.UILayer,n.popLayer.touchEnabled=!1,n.rootLayer.addChild(n.popLayer),n.lockLayer=new eui.UILayer,n.lockLayer.touchEnabled=!1,n.rootLayer.addChild(n.lockLayer),n.msgLayer=new eui.UILayer,n.msgLayer.touchEnabled=!1,n.rootLayer.addChild(n.msgLayer),n.tipLayer=new eui.UILayer,n.tipLayer.touchEnabled=!1,n.rootLayer.addChild(n.tipLayer),n.layerList=[n.sceneLayer,n.popLayer,n.lockLayer,n.msgLayer,n.tipLayer],n}return __extends(n,e),n.prototype.addChildToLayer=function(t,e){return this.layerList[e]&&t?void this.layerList[e].addChild(t):void console.log("add to layer fault")},n.prototype.removeChildFromLayer=function(t,e){return this.layerList[e]&&t?void this.layerList[e].removeChild(t):void console.log("remove from layer fault")},n.prototype.adjustIndex=function(t){this.popLayer.setChildIndex(t,this.popLayer.numChildren-2)},n.prototype.removeLayerChirdren=function(t){this.layerList[t].removeChildren()},n.prototype.getLayerChildrenNum=function(t){return this.layerList[t].numChildren},Object.defineProperty(n.prototype,"RootLayer",{get:function(){return this.rootLayer},enumerable:!0,configurable:!0}),n}(t.SingleClass);t.LayerManager=n,__reflect(n.prototype,"Tpm.LayerManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.panelList={},t.panelClassList={},t.assetList={},t}return __extends(n,e),n.prototype.register=function(t,e,n){void 0===n&&(n=null),this.panelClassList[t]=e,this.assetList[t]=n},n.prototype.registerAll=function(){for(var e in t.PanelConst){var n=Number(e),o=egret.getDefinitionByName("Tpm."+t.PanelConst[e]);this.register(n,o)}},n.prototype.open=function(e,n,o,r,i,a,s,c){var h=this;void 0===n&&(n=!1),void 0===o&&(o=null),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===a&&(a=!0),void 0===s&&(s=null),void 0===c&&(c=null),console.log("open Panel=="+e);var p=this.panelList[e];if(null==p){var d=this.panelClassList[e];if(null==d)return null;p=new d,this.panelList[e]=p}n?t.App.PopUpManager.changeTransparency(.5):t.App.PopUpManager.changeTransparency(.8),null!=s&&p.recDataFun(s);var l=this.assetList[e];return null!=l?(t.App.LoadingLock.addLock(),t.App.ResUtils.loadGroup(l,this,function(){t.App.LoadingLock.minusLock(),null!=o&&null!=r&&p.once(egret.Event.ADDED_TO_STAGE,function(){o.call(r,!0)},h),p.show(a,i)},null,10)):(null!=o&&null!=r&&p.once(egret.Event.ADDED_TO_STAGE,function(){o.call(r)},this),p.show(a,i)),p},n.prototype.close=function(t){var e=this.panelList[t];return null!=e&&e.hide(),e},n.prototype.getPanel=function(t){return this.panelList[t]},n.prototype.closeAllPanel=function(){t.App.ResUtils.deleteAllCallBack(),t.App.PopUpManager.removeAllPopUp(),t.App.LoadingLock.minusLock()},n}(t.SingleClass);t.PanelManager=e,__reflect(e.prototype,"Tpm.PanelManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.lockCount=0,t.clickClose=[],t.panelList=[],t.createLockBg(),t}return __extends(n,e),n.prototype.addPopUp=function(e,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0),this.curPanel==e&&(console.log("panel repitition!!!!!!!!!!!!!"),this.curPanel.hide()),n&&(this.lockCount++,t.App.LayerManager.addChildToLayer(this.lockBg,t.LayerConst.popLayer)),this.clickClose[this.lockCount]=o,t.App.LayerManager.addChildToLayer(e,t.LayerConst.popLayer),this.curPanel=e,this.panelList.push(e)},n.prototype.removePopUp=function(e){e.parent&&e.parent.removeChild(e),this.lockCount--,this.lockCount>0?t.App.LayerManager.adjustIndex(this.lockBg):(this.lockCount=0,this.clickClose[this.lockCount]=!1,this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg),this.curPanel=null),this.panelList.pop(),this.panelList.length>0&&(this.curPanel=this.panelList[this.panelList.length-1]),this.panelList.length<1&&(this.curPanel=null,this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg))},n.prototype.removeAllPopUp=function(){t.App.LayerManager.removeLayerChirdren(t.LayerConst.popLayer),this.lockBg.parent&&this.lockBg.parent.removeChild(this.lockBg),this.lockCount=0,this.clickClose.length=0,this.curPanel=null},n.prototype.changeTransparency=function(t){this.lockBg.alpha=t},n.prototype.createLockBg=function(){this.lockBg=new egret.Sprite,this.lockBg.graphics.beginFill(0,1);var e=t.App.StageUtils.stage;this.lockBg.graphics.drawRect(0,0,e.stageWidth,e.stageHeight),this.lockBg.graphics.endFill(),this.lockBg.touchEnabled=!0,this.lockBg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this)},n.prototype.onTouchTap=function(){this.clickClose[this.lockCount]&&this.curPanel.hide()},n}(t.SingleClass);t.PopUpManager=e,__reflect(e.prototype,"Tpm.PopUpManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.sceneClassList={},t.sceneList={},t}return __extends(n,e),n.prototype.register=function(t,e){this.sceneClassList[t]=e},n.prototype.runScene=function(e,n){this.curScene&&t.App.LayerManager.removeChildFromLayer(this.curScene,t.LayerConst.sceneLayer);var o=this.sceneList[e];if(null==o){var r=this.sceneClassList[e];if(null==r)return console.error("当前场景不存在:",e),null;o=new r,this.sceneList[e]=o}return this.curScene=o,n&&this.curScene.setController(n),t.App.LayerManager.addChildToLayer(this.curScene,t.LayerConst.sceneLayer),this.curScene},n.prototype.getScene=function(t){return this.sceneList[t]},n.prototype.setScene=function(t,e){this.sceneList[t]=e},n.prototype.getCurScene=function(){return this.curScene},n}(t.SingleClass);t.SceneManager=e,__reflect(e.prototype,"Tpm.SceneManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;n.soundList={},n._allowPlayEffect=!0,n._allowPlayBGM=!0,n._effectVolume=1,n._bgmVolume=1,n.girlCard=[],n.girlAct=[],n.boyCard=[],n.boyAct=[],n.gd_girlCard=[],n.gd_girlAct=[],n.gd_boyCard=[],n.gd_boyAct=[],n.boyChat=[],n.girlChat=[],n.gd_boyChat=[],n.gd_girlChat=[],n.isGuangDongSpeak=!1;for(var o=0;3>o;o++)n.boyCard[49+o]="man"+(o+51)+"_mp3",n.girlCard[49+o]="woman"+(o+51)+"_mp3",n.gd_boyCard[49+o]="gd_man"+(o+51)+"_mp3",n.gd_girlCard[49+o]="gd_woman"+(o+51)+"_mp3";for(var o=0;9>o;o++)n.boyCard[17+o]="man"+(o+31)+"_mp3",n.boyCard[33+o]="man"+(o+21)+"_mp3",n.girlCard[17+o]="woman"+(o+31)+"_mp3",n.girlCard[33+o]="woman"+(o+21)+"_mp3",n.gd_boyCard[17+o]="gd_man"+(o+31)+"_mp3",n.gd_boyCard[33+o]="gd_man"+(o+21)+"_mp3",n.gd_girlCard[17+o]="gd_woman"+(o+31)+"_mp3",n.gd_girlCard[33+o]="gd_woman"+(o+21)+"_mp3";n.boyAct[t.ACT_act.Act_Chi]=[],n.boyAct[t.ACT_act.Act_AnGang]=[],n.boyAct[t.ACT_act.Act_Gang]=[],n.boyAct[t.ACT_act.Act_Hu]=[],n.boyAct[t.ACT_act.Act_Peng]=[],n.boyAct[t.ACT_act.Act_zimo]=[],n.girlAct[t.ACT_act.Act_Chi]=[],n.girlAct[t.ACT_act.Act_AnGang]=[],n.girlAct[t.ACT_act.Act_Gang]=[],n.girlAct[t.ACT_act.Act_Hu]=[],n.girlAct[t.ACT_act.Act_Peng]=[],n.girlAct[t.ACT_act.Act_zimo]=[],n.gd_boyAct[t.ACT_act.Act_Chi]=[],n.gd_boyAct[t.ACT_act.Act_AnGang]=[],n.gd_boyAct[t.ACT_act.Act_Gang]=[],n.gd_boyAct[t.ACT_act.Act_Hu]=[],n.gd_boyAct[t.ACT_act.Act_Peng]=[],n.gd_boyAct[t.ACT_act.Act_zimo]=[],n.gd_girlAct[t.ACT_act.Act_Chi]=[],n.gd_girlAct[t.ACT_act.Act_AnGang]=[],n.gd_girlAct[t.ACT_act.Act_Gang]=[],n.gd_girlAct[t.ACT_act.Act_Hu]=[],n.gd_girlAct[t.ACT_act.Act_Peng]=[],n.gd_girlAct[t.ACT_act.Act_zimo]=[];for(var o=0;3>o;o++)n.boyAct[t.ACT_act.Act_Chi][o]="man_chi"+o+"_mp3",n.boyAct[t.ACT_act.Act_AnGang][o]="man_gang"+o+"_mp3",n.boyAct[t.ACT_act.Act_Gang][o]="man_gang"+o+"_mp3",n.boyAct[t.ACT_act.Act_Hu][o]="man_hu"+o+"_mp3",n.boyAct[t.ACT_act.Act_Peng][o]="man_peng"+o+"_mp3",n.boyAct[t.ACT_act.Act_zimo][o]="man_zimo"+o+"_mp3",n.girlAct[t.ACT_act.Act_Chi][o]="woman_chi"+o+"_mp3",n.girlAct[t.ACT_act.Act_AnGang][o]="woman_gang"+o+"_mp3",n.girlAct[t.ACT_act.Act_Gang][o]="woman_gang"+o+"_mp3",n.girlAct[t.ACT_act.Act_Hu][o]="woman_hu"+o+"_mp3",n.girlAct[t.ACT_act.Act_Peng][o]="woman_peng"+o+"_mp3",n.girlAct[t.ACT_act.Act_zimo][o]="woman_zimo"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_Chi][o]="gd_man_chi"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_AnGang][o]="gd_man_gang"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_Gang][o]="gd_man_gang"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_Hu][o]="gd_man_hu"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_Peng][o]="gd_man_peng"+o+"_mp3",n.gd_boyAct[t.ACT_act.Act_zimo][o]="gd_man_zimo"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_Chi][o]="gd_woman_chi"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_AnGang][o]="gd_woman_gang"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_Gang][o]="gd_woman_gang"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_Hu][o]="gd_woman_hu"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_Peng][o]="gd_woman_peng"+o+"_mp3",n.gd_girlAct[t.ACT_act.Act_zimo][o]="gd_woman_zimo"+o+"_mp3";for(var o=0;7>=o;o++)n.boyChat.push("man_chat"+o+"_mp3"),n.gd_boyChat.push("gd_man_chat"+o+"_mp3"),n.girlChat.push("woman_chat"+o+"_mp3"),n.gd_girlChat.push("gd_woman_chat"+o+"_mp3");return n}return __extends(n,e),n.prototype.playOutCard=function(e,n){void 0===n&&(n=t.SEX_TYPE.boy),n==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.playEffect(this.gd_boyCard[e]):this.playEffect(this.boyCard[e]):this.isGuangDongSpeak?this.playEffect(this.gd_girlCard[e]):this.playEffect(this.girlCard[e])},n.prototype.playAct=function(e,n){void 0===n&&(n=t.SEX_TYPE.boy);var o=t.NumberTool.getRandInt(0,2);n==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.gd_boyAct[e]&&this.playEffect(this.gd_boyAct[e][o]):this.boyAct[e]&&this.playEffect(this.boyAct[e][o]):this.isGuangDongSpeak?this.gd_girlAct[e]&&this.playEffect(this.gd_girlAct[e][o]):this.girlAct[e]&&this.playEffect(this.girlAct[e][o])},n.prototype.playChat=function(e,n){void 0===n&&(n=t.SEX_TYPE.boy),n==t.SEX_TYPE.boy?this.isGuangDongSpeak?this.gd_boyChat[e]&&this.playEffect(this.gd_boyChat[e]):this.boyChat[e]&&this.playEffect(this.boyChat[e]):this.isGuangDongSpeak?this.gd_girlChat[e]&&this.playEffect(this.gd_girlChat[e]):this.girlChat[e]&&this.playEffect(this.girlChat[e])},n.prototype.playEffect=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=1),0!=this.allowPlayEffect){var o=this.soundList[t];if(null==o&&(o=RES.getRes(t),null!=o&&(this.soundList[t]=o)),o){o.type=egret.Sound.EFFECT;var r=o.play(e,n);r.volume=this._effectVolume}}},n.prototype.playBGM=function(e,n,o){if(void 0===n&&(n=0),void 0===o&&(o=Number.MAX_VALUE),0!=this.allowPlayBGM&&null==this.bgmChannel&&t.App.SceneManager.getCurScene()!=t.App.SceneManager.getScene(t.SceneConst.HallScene)&&t.App.SceneManager.getCurScene()!=t.App.SceneManager.getScene(t.SceneConst.LoginScene)){this.stopBGM();var r=this.soundList[e];null==r&&(r=RES.getRes(e),r&&(this.soundList[e]=r)),r&&(r.type=egret.Sound.MUSIC,this.bgmChannel=r.play(n,o),this.bgmChannel.volume=this._bgmVolume)}},n.prototype.stopBGM=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},Object.defineProperty(n.prototype,"allowPlayEffect",{get:function(){return this._allowPlayEffect},set:function(t){this._allowPlayEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allowPlayBGM",{get:function(){return this._allowPlayBGM},set:function(t){this._allowPlayBGM=t,0==this._allowPlayBGM?this.stopBGM():this.playBGM(n.bgm)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"effectVolume",{get:function(){return this._effectVolume},set:function(t){this._effectVolume=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bgmVolume",{get:function(){return this._bgmVolume},set:function(t){this._bgmVolume=t,this.bgmChannel&&(this.bgmChannel.volume=this._bgmVolume)},enumerable:!0,configurable:!0}),n.prototype.stopAllSound=function(){this.stopBGM()},n}(t.SingleClass);e.win="audio_win_mp3",e.lose="audio_lose_mp3",e.warn="audio_warn_mp3",e.hall_click="tpm_audio_button_click_mp3",e.clickCard="audio_card_click_mp3",e.enter="audio_enter_mp3",e.bgm="Audio_Game_Back_mp3",e.user_left="audio_left_mp3",e.liuju="audio_liuju_mp3",e.ready="audio_ready_mp3",e.shazi="audio_shaizi_mp3",e.tuoGuan="audio_tuo_guan_mp3",e.button="tpm_audio_button_click_mp3",t.SoundManager=e,__reflect(e.prototype,"Tpm.SoundManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.name="",this.callBackList={},this.objList={},this.reconnecting=!1,this.reconInvalTime=3e3,this.curReconnectCount=0,this.reconnenctLimit=5,this.bAllowReconnnect=!1,this.protoBuffer="",this.dataBuffer=null,this.url="",this.headSize=12,this.getMessage=0,this.timer=new egret.Timer(5e3,0)}return e.prototype.register=function(t,e,n){this.callBackList[t]=e,this.objList[t]=n},e.prototype.unRegister=function(t){delete this.callBackList[t],delete this.objList[t]},e.prototype.startConnect=function(e,n){void 0===n&&(n=!1),console.log("开始连接:"+e),t.App.LoadingLock.addLock("网络连接中..."),this.url=e,this.bAllowReconnnect=n,this.createSocket(),this.socket.connectByUrl(e),this.getMessage=0,this.timeId=egret.setTimeout(this.netError,this,4500)},e.prototype.netError=function(){this.isConnected()||t.App.EventManager.sendEvent(t.EventConst.SocketClose,this)},e.prototype.createSocket=function(){this.socket&&(this.socket.removeEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this),this.socket.connected&&this.socket.close()),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.addEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this)},e.prototype.onConnect=function(e){egret.log(" connect success"),t.App.LoadingLock.minusLock(),this.resetReconnenct(),t.App.EventManager.sendEvent(t.EventConst.SocketConnect,this),this.sendHeart()},e.prototype.onClose=function(e){egret.log("socket close"),t.App.LoadingLock.minusLock(),t.App.EventManager.sendEvent(t.EventConst.SocketClose,this),this.timer.stop()},e.prototype.onError=function(e){egret.log("socket error"),this.timer.stop(),0==this.tryReconnect()&&t.App.EventManager.sendEvent(t.EventConst.SocketIOError,this)},e.prototype.tryReconnect=function(){return 0==this.bAllowReconnnect?!1:(this.curReconnectCount++,this.curReconnectCount<=this.reconnenctLimit?(1==this.curReconnectCount&&t.App.EventManager.sendEvent(t.EventConst.StartReconnect,this),egret.setTimeout(this.startConnect,this,this.reconInvalTime,this.url,!0),!0):!1)},e.prototype.close=function(){this.timer.stop(),egret.clearTimeout(this.timeId),this.socket&&(this.socket.removeEventListener(egret.Event.CONNECT,this.onConnect,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onClose,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onRecieve,this),this.socket.connected&&this.socket.close()),this.resetReconnenct(),this.dataBuffer=null,this.protoBuffer=null},e.prototype.resetReconnenct=function(){this.reconnecting=!1,this.curReconnectCount=0},e.prototype.isConnected=function(){return this.socket&&this.socket.connected?!0:!1},e.prototype.send=function(e,n){if(void 0===n&&(n={}),this.socket&&this.socket.connected){var o=new egret.ByteArray,r=JSON.stringify(n);o.writeUTFBytes(r);var i=this.headSize+o.length,a=e.split("_"),s=this.getHead(i,a[0]);s.writeBytes(o),this.socket.writeBytes(s),this.socket.flush(),console.log("send:",e,JSON.stringify(n))}else egret.log("socket is not connected"),this.dataBuffer=n,this.protoBuffer=e,t.App.EventManager.sendEvent(t.EventConst.SocketNotConnect,this),t.App.EventManager.sendEvent(t.EventConst.SocketClose,this)},e.prototype.onRecieve=function(t){this.getMessage=0;var e=new egret.ByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,this.socket.readBytes(e),this.process(e)},e.prototype.process=function(t){var e=t.readInt();if(e!=t.length)return void console.error("data error!!");var n,o=t.readInt(),r=(t.readInt(),t.readUTFBytes(t.length-this.headSize));""!=r&&(n=JSON.parse(r));var i=o+"",a=this.callBackList[i],s=this.objList[i];console.log("rev:",i,n),a&&s?a.call(s,n):console.log("no receive callback:",i)},e.prototype.getHead=function(t,e){var n=new egret.ByteArray;return n.endian=egret.Endian.LITTLE_ENDIAN,n.writeInt(t),n.writeInt(e),n.writeInt(0),n},e.prototype.sendHeart=function(){},e.prototype.timerLisener=function(){0==this.getMessage?(this.send("",""),this.getMessage++):this.socket.close()},e}();t.ClientSocket=e,__reflect(e.prototype,"Tpm.ClientSocket")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.send=function(e,n,o,r){void 0===r&&(r=!0);var i=this.extendObj(t.ProtocolHttp.httpHead,e),a=JSON.stringify(i),s=t.App.DataCenter.ServerInfo.WEB_URL+e.action.toLowerCase()+"?base="+a;console.log("send url:"+s);var c=new egret.HttpRequest;c.open(s,egret.HttpMethod.GET),c.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;
console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}505==i.code&&t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1),n.call(o,i)},this),c.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("error : event="+e),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),c.send()},n.prototype.sendTest=function(e,n,o,r){void 0===r&&(r=!0);var i=this.extendObj(t.ProtocolHttp.httpHead,e),a=JSON.stringify(i),s="http://127.0.0.1:8889/mj/"+e.action.toLowerCase()+"?base="+a,s="http://127.0.0.1:8889/mj/"+e.action.toLowerCase()+"?base="+a;console.log("send url:"+s);var c=new egret.HttpRequest;c.open(s,egret.HttpMethod.GET),c.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}505==i.code&&t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1),n.call(o,i)},this),c.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("error : event="+e),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),c.send()},n.prototype.post=function(e,n,o){var r=(this.extendObj(t.ProtocolHttp.httpHead,e),JSON.stringify(e.param)),i=t.App.DataCenter.ServerInfo.WEB_URL+e.action.toLowerCase();console.log("post url:"+i);var a=new egret.HttpRequest;a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.open(i,egret.HttpMethod.POST),a.once(egret.Event.COMPLETE,function(e){var r=e.currentTarget;console.log("requet.response:"+r.response);try{var i=JSON.parse(r.response)}catch(a){return void t.Tips.showTop("返回数据有误")}n.call(o,i)},this),a.once(egret.IOErrorEvent.IO_ERROR,function(e){console.log("post error"),t.App.LoadingLock.minusLock(),t.App.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},this),console.log("loginsend:",r),a.send(r)},n.prototype.extendObj=function(e,n){var o=new Object;for(var r in n)if(!o.hasOwnProperty(r)&&"action"!=r&&(o[r]=n[r],"skey"==r&&t.App.DataCenter.UserInfo.myUserUid&&(o[r]=t.App.DataCenter.UserInfo.myUserInfo.skey),"uid"==r&&t.App.DataCenter.UserInfo.myUserUid&&(o[r]=t.App.DataCenter.UserInfo.myUserInfo.userID),t.App.DataCenter.UserInfo.myUserUid&&console.log("skey:::",t.App.DataCenter.UserInfo.myUserInfo.skey),"param"==r))for(var i in o[r])"playerID"==i&&t.App.DataCenter.UserInfo.myUserUid&&(o[r][i]=t.App.DataCenter.UserInfo.myUserInfo.userID);return o},n}(t.SingleClass);t.HttpSender=e,__reflect(e.prototype,"Tpm.HttpSender")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.dataList={},this.callBackList={},this.objList={}}return e.prototype.addMsg=function(t,e,n,o){this.dataList[t]=e,this.callBackList[t]=n,this.objList[t]=o},e.prototype.minusMsg=function(t){delete this.dataList[t],delete this.callBackList[t],delete this.objList[t]},e.prototype.exeMsg=function(t,e){void 0===e&&(e=!0);var n=this.callBackList[t],o=this.objList[t],r=this.dataList[t];n&&o&&n.call(o,r),e&&this.minusMsg(t)},e.prototype.addMsgData=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1),n?(this.dataList[t]||(this.dataList[t]=[]),this.dataList[t].push(e)):this.dataList[t]=e},e.prototype.getMsgData=function(e,n){void 0===n&&(n=!0);var o=t.ArrayTool.deepCopy(this.dataList[e]);return n&&this.minusMsg(e),o},e}();t.MsgCache=e,__reflect(e.prototype,"Tpm.MsgCache")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.gameSocket=new t.ClientSocket,n.gameSocket.name="gameSocket",n}return __extends(n,e),n}(t.SingleClass);t.GameSocket=e,__reflect(e.prototype,"Tpm.GameSocket")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.swap=function(t,e,n){var o=t[e];t[e]=t[n],t[n]=o},e.randSort=function(e){for(var n=e.length,o=0;n>o;o++)this.swap(e,o,t.NumberTool.getRandInt(0,n-1))},e.formatDate=function(t){var e=new Date(1e3*parseInt(t));return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()},e.formatDate1=function(t){var n=new Date(1e3*parseInt(t));return e.aze(n.getFullYear())+"-"+e.aze(n.getMonth()+1)+"-"+e.aze(n.getDate())},e.formatDate2=function(t){var n=new Date(1e3*parseInt(t));return e.aze(n.getHours())+":"+e.aze(n.getMinutes())+":"+e.aze(n.getSeconds())},e.aze=function(t){return t>9?""+t:"0"+t},e.getObjectLength=function(t){var e=0;for(var n in t)e++;return e},e.deepCopy=function(t){var n;if("object"==typeof t)if(null===t)n=null;else if(void 0==t)n=void 0;else if(t instanceof Array){n=[];for(var o=0,r=t.length;r>o;o++)n.push(e.deepCopy(t[o]))}else{n={};for(var i in t)n[i]=e.deepCopy(t[i])}else n=t;return n},e}();t.ArrayTool=e,__reflect(e.prototype,"Tpm.ArrayTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(e,n){void 0===n&&(n=0);var o=t.call(this)||this;return o.delay=e,o.repeatCount=n,o}return __extends(e,t),e.prototype.start=function(){this.previous=egret.getTimer(),this.accTime=0,egret.startTick(this.update,this)},e.prototype.reset=function(){this.previous=egret.getTimer(),this.accTime=0,this.currentCount=0},e.prototype.stop=function(){egret.stopTick(this.update,this)},e.prototype.update=function(){for(this.curTime=egret.getTimer(),this.passTime=this.curTime-this.previous,this.previous=this.curTime,this.accTime+=this.passTime;this.accTime>=this.delay;)this.accTime-=this.delay,this.currentCount++,this.repeatCount>0&&this.currentCount==this.repeatCount&&(this.dispatchEvent(new egret.TimerEvent(egret.TimerEvent.TIMER_COMPLETE)),this.stop()),this.dispatchEvent(new egret.TimerEvent(egret.TimerEvent.TIMER));return!1},e}(egret.EventDispatcher);t.DateTimer=e,__reflect(e.prototype,"Tpm.DateTimer")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.lockNum=0,n.lockBg=new eui.Rect,n.lockBg.width=1334,n.lockBg.height=750,n.lockBg.fillAlpha=.5,n.circle=new eui.Image,n.circle.source=t.ResPathConfig.lockRotat,n.circle.anchorOffsetX=n.circle.width/2,n.circle.anchorOffsetY=n.circle.height/2,n.circle.verticalCenter=0,n.circle.horizontalCenter=0,n.descLab=new eui.Label,n.descLab.verticalCenter=50,n.descLab.horizontalCenter=0,n.descLab.textColor=t.App.ArtConfig.getColor(t.ColorConst.white),n.descLab.text="",n.descLab.fontFamily=t.App.ArtConfig.getFont(t.FontConst.Microsoft),n}return __extends(n,e),n.prototype.addLock=function(e){void 0===e&&(e=""),this.lockNum<0&&(this.lockNum=0),this.lockNum++,egret.Tween.removeTweens(this.circle),this.descLab.text=e,egret.Tween.get(this.circle,{loop:!0}).to({rotation:360},1e3),t.App.LayerManager.addChildToLayer(this.lockBg,t.LayerConst.lockLayer),t.App.LayerManager.addChildToLayer(this.circle,t.LayerConst.lockLayer),t.App.LayerManager.addChildToLayer(this.descLab,t.LayerConst.lockLayer)},n.prototype.minusLock=function(){this.lockNum--,this.lockNum<=0&&this.circle&&this.circle.parent&&(egret.Tween.removeTweens(this.circle),t.App.LayerManager.removeChildFromLayer(this.lockBg,t.LayerConst.lockLayer),t.App.LayerManager.removeChildFromLayer(this.circle,t.LayerConst.lockLayer),t.App.LayerManager.removeChildFromLayer(this.descLab,t.LayerConst.lockLayer))},n}(t.SingleClass);t.LoadingLock=e,__reflect(e.prototype,"Tpm.LoadingLock")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.formatTime=function(t){return t>=0&&10>t?"0"+t:t+""},t.getRandInt=function(t,e){return Math.round(Math.random()*(e-t))+t},t.formatCapital=function(t){return 0>=t||t>=10?"":["一","二","三","四","五","六","七","八","九"][t-1]},t.formatMoney=function(t,e){void 0===e&&(e=1);var n="";return t>=1e3&&9999>t&&(n=2==e?(t/1e3).toFixed(0)+"千":t+""),t>=1e4&&99999>t&&(n=t%1e4==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(3)+"万"),t>=1e5&&999999>t&&(n=t%1e5==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(2)+"万"),t>=1e6&&9999999>t&&(n=t%1e6==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(1)+"万"),t>=1e7&&99999999>t&&(n=t%1e7==0?(t/1e4).toFixed(0)+"万":(t/1e4).toFixed(0)+"万"),t>=1e8&&999999999>t&&(n=t%1e8==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(3)+"亿"),t>=1e9&&9999999999>t&&(n=t%1e9==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(2)+"亿"),t>=1e10&&99999999999>t&&(n=t%1e10==0?(t/1e8).toFixed(0)+"亿":(t/1e8).toFixed(1)+"亿"),n},t.sperateMoney=function(t){for(var e=t.toString(),n=e.length,o=0,r="",i=n-1;i>=0;i--)r=r.concat(e[i]),o++,o%3==0&&(r=r.concat(","));for(var a=r.length,s="",i=a-1;i>=0;i--)s=s.concat(r[i]);return","==s[0]&&(s=s.substr(1,a-1)),s},t.formatGoldHead=function(t){if(0==t)return"0";var e="",n="";if(t>=1e8)n="亿",e=(t/1e8).toFixed(4)+"";else{if(!(t>=1e4))return e=t+"";n="万",e=(t/1e4).toFixed(4)+""}e=e.substr(0,5),"."==e.substr(4,1)&&(e=e.substr(0,4));for(var o=0;o<e.length&&"0"==e.substr(e.length-1,1);o++)e=e.substr(0,e.length-2);return e+=n},t}();t.NumberTool=e,__reflect(e.prototype,"Tpm.NumberTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(t){this.className="Tpm."+t,this.list=[]}return t.prototype.getObject=function(){if(this.list.length>0)return this.list.shift();var t=egret.getDefinitionByName(this.className);return new t},t.prototype.returnObject=function(t){this.list.push(t)},t.getPool=function(e,n){if(void 0===n&&(n=0),!t.pool[e]&&(t.pool[e]=new t(e),0!=n))for(var o=egret.getDefinitionByName(e),r=t.pool[e],i=0;n>i;i++)r.returnObject(new o);return t.pool[e]},t}();e.pool={},t.ObjectPool=e,__reflect(e.prototype,"Tpm.ObjectPool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},t.formatNickName=function(t,e){if(void 0===e&&(e=10),t){var n=this.getStrLength(t,e),o=n[0];return o>e?t.substr(0,n[1])+"...":t}},t.getStrLength=function(t,e){void 0===e&&(e=10);for(var n=0,o=0,r=0,i=0;i<t.length;i++)o=t.charCodeAt(i),o>127||o>=65&&90>=o?(n+=2,e>=n&&r++):(n++,e>=n&&r++);return[n,r]},t}();t.StringTool=e,__reflect(e.prototype,"Tpm.StringTool")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(e){function n(t){i(t)}function o(t){r(t)}function r(e){var n=new eui.Group;n.width=t.App.StageUtils.stageWidth,n.height=100,n.touchEnabled=!1;var o=new eui.Image;o.texture=RES.getRes(t.ResPathConfig.tipsTopBg),o.horizontalCenter=0,n.y=-o.height;var r=new eui.Label;r.size=30,r.textColor=t.App.ArtConfig.getColor(t.ColorConst.topTips),r.text=e,r.horizontalCenter=0,r.y=(o.height-r.size)/2-3,n.addChild(o),n.addChild(r),t.App.LayerManager.getLayerChildrenNum(t.LayerConst.tipLayer)>0&&(egret.Tween.removeTweens(n),t.App.LayerManager.removeLayerChirdren(t.LayerConst.tipLayer)),t.App.LayerManager.addChildToLayer(n,t.LayerConst.tipLayer);var i=egret.setTimeout(function(){n&&n.parent&&t.App.LayerManager.removeChildFromLayer(n,t.LayerConst.tipLayer)},this,4e3);egret.Tween.get(n).to({y:0},200).wait(2e3).to({y:-o.height,alpha:0},300).call(function(){egret.clearTimeout(i),egret.Tween.removeTweens(n),n&&n.parent&&t.App.LayerManager.removeChildFromLayer(n,t.LayerConst.tipLayer)})}function i(e){var n=new eui.Group;n.width=1334,n.height=50,n.y=335,n.alpha=0;var o=new eui.Image;o.texture=RES.getRes(t.ResPathConfig.tipsBg),o.horizontalCenter=0;var r=new eui.Label;r.size=30,r.textColor=t.App.ArtConfig.getColor(t.ColorConst.middleTips),r.text=e,r.horizontalCenter=0,r.y=14,n.addChild(o),n.addChild(r),t.App.LayerManager.getLayerChildrenNum(t.LayerConst.tipLayer)>0&&(egret.Tween.removeTweens(n),t.App.LayerManager.removeLayerChirdren(t.LayerConst.tipLayer)),t.App.LayerManager.addChildToLayer(n,t.LayerConst.tipLayer);var i=egret.setTimeout(function(){n&&n.parent&&t.App.LayerManager.removeChildFromLayer(n,t.LayerConst.tipLayer)},this,4e3);egret.Tween.get(n).to({alpha:1},200).wait(1300).to({y:n.y-187.5,alpha:0},500).call(function(){egret.clearTimeout(i),egret.Tween.removeTweens(n),n&&n.parent&&t.App.LayerManager.removeChildFromLayer(n,t.LayerConst.tipLayer)})}e.showMiddle=n,e.showTop=o}(e=t.Tips||(t.Tips={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"IsWeb",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsIos",{get:function(){return"iOS"==egret.Capabilities.os},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsAndroid",{get:function(){return"Android"==egret.Capabilities.os},enumerable:!0,configurable:!0}),e}(t.SingleClass);t.DeviceUtils=e,__reflect(e.prototype,"Tpm.DeviceUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){function e(t,e){void 0===e&&(e=1e3),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.scaleX=4,t.scaleY=4,t.alpha=0,egret.Tween.get(t).to({scaleX:1,scaleY:1,alpha:1},200).wait(e).call(function(){t.parent&&t.parent.removeChild(t)})}function n(t,e){void 0===e&&(e=1e3);var n=t.y,o=new Date,r=o.getSeconds();egret.Tween.get(t).wait(e).to({y:n-100,alpha:.5},250).call(function(){var e=new Date,n=e.getSeconds(),o=n-r;console.log("tips显示时间="+o),t.parent&&t.parent.removeChild(t)})}function o(t,e,n,o){void 0===e&&(e=200),void 0===n&&(n=0),void 0===o&&(o=0);var r=t.y;egret.Tween.get(t,{loop:!0}).wait(n).to({y:r-t.height/3},e/2).to({y:r},e/2).wait(o)}function r(e){for(var n=e.length,o=400,r=0,i=0,a=.5,s=0;n>s;s++)r=s*(o*(1-a)),i=(n-s)*(o*(1-a)),t.bounce(e[s],o,r,i)}function i(t){egret.Tween.removeTweens(t)}function a(e){for(var n=e.length,o=0;n>o;o++)t.removeTween(e[o])}t.showMax2Min=e,t.showFload=n,t.bounce=o,t.bounceOneByOne=r,t.removeTween=i,t.removeObjsTween=a}(e=t.EffectUtils||(t.EffectUtils={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=RES.getRes("kwx_keywordConfig_json");this.keyWordList=t.keyword.split("|")},e.prototype.filteString=function(t){if(this.isInit()){for(var e,n=this.keyWordList.length,o=0;n>o;o++)if(e=new RegExp(this.keyWordList[o],"i"),-1!=t.search(e)){console.log("包含敏感关键词:",this.keyWordList[o]);for(var r=this.keyWordList[o].length,i="",a=0;r>a;a++)i+="*";t=t.replace(e,i)}return t}return"***"},e.prototype.checkStringOK=function(t){if(this.isInit()){for(var e,n=this.keyWordList.length,o=0;n>o;o++)if(e=new RegExp(this.keyWordList[o],"i"),null!=t.match(e))return!1;return!0}return!1},e.prototype.isInit=function(){return null!=this.keyWordList},e}(t.SingleClass);t.KeyWord=e,__reflect(e.prototype,"Tpm.KeyWord")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"allowMusic",{get:function(){var t=this.loadItem("tpm_allowMusic");return null==t&&(this.allowMusic=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_allowMusic",t?"1":"0")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowEffect",{get:function(){var t=this.loadItem("tpm_allowEffect");return null==t&&(this.allowEffect=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_allowEffect",t?"1":"0")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoVoice",{get:function(){var t=this.loadItem("tpm_autoVoice");return null==t&&(this.autoVoice=!0,t="1"),!!parseInt(t)},set:function(t){this.saveItem("tpm_autoVoice",t?"1":"0")},enumerable:!0,configurable:!0}),e.prototype.saveItem=function(t,e){t&&egret.localStorage.setItem(t,e)},e.prototype.loadItem=function(t){return t?egret.localStorage.getItem(t):void 0},e}(t.SingleClass);t.LocalStorageUtil=e,__reflect(e.prototype,"Tpm.LocalStorageUtil")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initResVersion(),e.groupList=new Array,e.configList=new Array,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,e.onResourceLoadComplete,e),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,e.onResourceLoadProgress,e),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,e.onResourceLoadError,e),e}return __extends(e,t),e.prototype.initResVersion=function(){window&&window.version&&(RES.web.Html5VersionController.prototype.getVirtualUrl=function(t){var e=window.version;return t+=-1==t.indexOf("?")?"?ver="+e:"&ver="+e})},e.prototype.addConfig=function(t,e){this.configList.push([t,e])},e.prototype.loadConfig=function(t,e){this.onConfigComplete=t,this.onConfigCompleteTarget=e,this.loadNextConfig()},e.prototype.loadNextConfig=function(){if(0==this.configList.length)return this.onConfigComplete.call(this.onConfigCompleteTarget),this.onConfigComplete=null,void(this.onConfigCompleteTarget=null);var t=this.configList.shift();RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),RES.loadConfig(t[0],t[1])},e.prototype.onConfigCompleteHandle=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigCompleteHandle,this),this.loadNextConfig()},e.prototype.loadGroupQuiet=function(t,e){void 0===e&&(e=1);var n=this.combGroupName(t);RES.loadGroup(n,e)},e.prototype.loadGroup=function(t,e,n,o,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===r&&(r=1);var i=this.combGroupName(t);this.groupList[i]=[n,o,e],this.loadGroupQuiet(t,r)},e.prototype.onResourceLoadComplete=function(t){var e=t.groupName;if(console.log("加载资源组完成:",e),this.groupList[e]){var n=this.groupList[e][0],o=this.groupList[e][2];null!=n&&n.call(o),this.deleteCallBack(e)}},e.prototype.onResourceLoadProgress=function(t){var e=t.groupName;if(this.groupList[e]){var n=this.groupList[e][1],o=this.groupList[e][2];null!=n&&n.call(o,t)}},e.prototype.onResourceLoadError=function(t){console.error(t.groupName+"资源组加载失败"),this.onResourceLoadComplete(t)},e.prototype.deleteCallBack=function(t){console.log("取消加载资源组回调:"+t),this.groupList[t]=null,delete this.groupList[t]},e.prototype.deleteAllCallBack=function(){for(var t in this.groupList)this.deleteCallBack(t)},e.prototype.combGroupName=function(t){var e="";if("string"==typeof t)e=t;else{for(var n=t.length,o=0;n>o;o++)e+=t[o];RES.createGroup(e,t)}return e},e}(t.SingleClass);t.ResUtils=e,__reflect(e.prototype,"Tpm.ResUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfStageWidth",{get:function(){return this.stage.stageWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"halfStageHeight",{get:function(){return this.stage.stageHeight/2},enumerable:!0,configurable:!0}),e.prototype.runBrowserAdapt=function(){this.stage.addEventListener(egret.StageOrientationEvent.ORIENTATION_CHANGE,this.changeScaleMode,this)},e.prototype.changeScaleMode=function(){console.log("当前适配模式:",this.stage.scaleMode)},e}(t.SingleClass);t.StageUtils=e,__reflect(e.prototype,"Tpm.StageUtils")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(e){function n(e,n,o,r){void 0===o&&(o=null),void 0===r&&(r=100);var i=Math.round(n/r);if(0>=i)return void(e&&e.call(o));var a=new t.DateTimer(r,i),s=0;a.addEventListener(egret.TimerEvent.TIMER,function(){s++,s==i&&(a.stop(),e&&e.call(o))},this),a.start()}e.setTimeOut=n}(e=t.Utils||(t.Utils={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.startUp=function(){this.registerController(t.LoginController.NAME,new t.LoginController),this.registerController(t.HallController.NAME,new t.HallController),this.registerController(t.GameController.NAME,new t.GameController);var e=n.getController(t.LoginController.NAME);e.onRegister();var o=n.SceneManager;o.register(t.SceneConst.HallScene,t.HallScene),o.register(t.SceneConst.GameScene,t.GameScene),o.register(t.SceneConst.LoginScene,t.LoginScene);var r=n.PanelManager;r.registerAll(),this.addEvent(t.EventConst.SocketClose,this.onSocketClose,this),n.GameConfig.init(),n.DataCenter.debugInfo.skipNet?n.DataCenter.debugInfo.skipHall?n.SceneManager.runScene(t.SceneConst.GameScene,this.getController(t.GameController.NAME)):n.SceneManager.runScene(t.SceneConst.HallScene,this.getController(t.HallController.NAME)):n.SceneManager.runScene(t.SceneConst.LoginScene,this.getController(t.LoginController.NAME))},n.prototype.onSocketClose=function(){n.PanelManager.open(t.PanelConst.SocketClosePanel,!1,null,null,!1)},n.getController=function(t){return n.getInstance().getController(t)},Object.defineProperty(n,"DataCenter",{get:function(){return t.DataCenter.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DeviceUtils",{get:function(){return t.DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"StageUtils",{get:function(){return t.StageUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ResUtils",{get:function(){return t.ResUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LayerManager",{get:function(){return t.LayerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SoundManager",{get:function(){return t.SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PopUpManager",{get:function(){return t.PopUpManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"MessageBoxManager",{get:function(){return t.MessageBoxManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EventManager",{get:function(){return t.EventMananger.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LoadingLock",{get:function(){return t.LoadingLock.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PanelManager",{get:function(){return t.PanelManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SceneManager",{get:function(){return t.SceneManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"PlatformBridge",{get:function(){return t.PlatformBridge.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"gameSocket",{get:function(){return t.GameSocket.getInstance().gameSocket},enumerable:!0,configurable:!0}),Object.defineProperty(n,"httpSender",{get:function(){return t.HttpSender.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LocalStorageUtil",{get:function(){return t.LocalStorageUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"GameConfig",{get:function(){return t.StorageConfig.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ArtConfig",{get:function(){return t.ArtConfig.getInstance()},enumerable:!0,configurable:!0}),n}(t.BaseApp);t.App=e,__reflect(e.prototype,"Tpm.App")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.Preload="preload",t.AssetConst=e,__reflect(e.prototype,"Tpm.AssetConst")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.SocketConnect="SocketConnect",e.StartReconnect="StartReconnect",e.SocketNotConnect="SocketNotConnect",e.SocketIOError="SocketIOError",e.SocketClose="SocketClose",t.EventConst=e,__reflect(e.prototype,"Tpm.EventConst")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.LoginPanel=0]="LoginPanel",t[t.RegistPanel=1]="RegistPanel",t[t.SocketClosePanel=2]="SocketClosePanel",t[t.SetPanel=3]="SetPanel",t[t.SharePanel=4]="SharePanel",t[t.ShopMallPanel=5]="ShopMallPanel",t[t.EmailPanel=6]="EmailPanel",t[t.PlayMethodPanel=7]="PlayMethodPanel",t[t.GiveMoneyPanel=8]="GiveMoneyPanel",t[t.MoneyNotEnoughPanel=9]="MoneyNotEnoughPanel",t[t.EmailDetailPanel=10]="EmailDetailPanel",t[t.PersonalInfoPanel=11]="PersonalInfoPanel",t[t.CommonMessageBoxPanel=12]="CommonMessageBoxPanel",t[t.ResultPanel=13]="ResultPanel"}(e=t.PanelConst||(t.PanelConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.PreloadScene=0]="PreloadScene",t[t.LoginScene=1]="LoginScene",t[t.HallScene=2]="HallScene",t[t.GameScene=3]="GameScene"}(e=t.SceneConst||(t.SceneConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.initList(),e}return __extends(e,t),e.prototype.initList=function(){this.colorList=[0,16777215,16381141,7143430],this.fontList=["Microsoft YaHei"],this.sizeList=[]},e.prototype.getColor=function(t){return this.colorList[t]||0==this.colorList[t]||console.error("color null"),this.colorList[t]},e.prototype.getFont=function(t){return this.fontList[t]||console.error("font null"),this.fontList[t]},e.prototype.getSize=function(t){return this.sizeList[t]||console.error("size null"),this.sizeList[t]},e}(t.SingleClass);t.ArtConfig=e,__reflect(e.prototype,"Tpm.ArtConfig");var n;!function(t){t[t.black=0]="black",t[t.white=1]="white",t[t.middleTips=2]="middleTips",t[t.topTips=3]="topTips"}(n=t.ColorConst||(t.ColorConst={}));var o;!function(t){t[t.Microsoft=0]="Microsoft"}(o=t.FontConst||(t.FontConst={}));var r;!function(t){}(r=t.SizeConst||(t.SizeConst={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.UserInfo=new t.UserInfo,n.ServerInfo=new t.ServerInfo,n.deskInfo=new t.DeskInfo,n.runingData=new t.RuningData,n.debugInfo=new t.DebugInfo,n.MsgCache=new t.MsgCache,n.roomInfo=new t.RoomInfo,n}return __extends(n,e),n}(t.SingleClass);t.DataCenter=e,__reflect(e.prototype,"Tpm.DataCenter")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){this.password="123456"}return Object.defineProperty(t.prototype,"isDebug",{get:function(){return null!=egret.getOption("debug")&&""!=egret.getOption("debug")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocalPhp",{get:function(){return parseInt(egret.getOption("local"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Sever",{get:function(){return Number(egret.getOption("server"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"account",{get:function(){egret.getOption("debug");return"oldboy1"+egret.getOption("debug")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipHall",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipNet",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipGameServer",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"testState",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoReady",{get:function(){return!1},enumerable:!0,configurable:!0}),t}();t.DebugInfo=e,__reflect(e.prototype,"Tpm.DebugInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){this.deskID=0,this.ownerID=0,this.deskCode=0,this.gameID=0,this.basePoint=0,this.deskLevel=0,this.maxPlayCount=0,this.ownerName="",this.chip=0,this.deskNo=0,this.isGameRunning=!1,this.isPlaying=!1,this.peoplecount=0,this.playCount=0}return t.prototype.readData=function(t){this.deskID=t.deskID,this.ownerID=t.ownerID,this.deskCode=t.deskCode,this.gameID=t.gameid,this.deskLevel=t.deskLevel,this.chip=t,this.curPlayCount=t,this.curSitPeopleCoiunt=t,this.deposit=t.deposit,this.deskDesc=t.deskDesc,this.deskName=t.deskName,this.deskNo=t.deskNo,this.isGameRunning=t.isGameRunning,this.isPlaying=t.isPlaying,this.ownerName=t.ownerName,this.peoplecount=t.peoplecount,this.playCount=t.playCount,this.gameConfig=t.gameConfig,t.basepoint?this.basePoint=t.basepoint:t.basePoint&&(this.basePoint=t.basePoint)},t}();t.DeskInfo=e,__reflect(e.prototype,"Tpm.DeskInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();t.GameInfo=e,__reflect(e.prototype,"Tpm.GameInfo");var n;!function(t){t[t.Act_Cancle=-1]="Act_Cancle",t[t.Act_Pass=0]="Act_Pass",t[t.Act_Out=10]="Act_Out",t[t.Act_Chi=20]="Act_Chi",t[t.Act_Peng=30]="Act_Peng",t[t.Act_Gang=40]="Act_Gang",t[t.Act_BuGang=50]="Act_BuGang",t[t.Act_AnGang=60]="Act_AnGang",t[t.Act_Ting=70]="Act_Ting",t[t.Act_DianHu=80]="Act_DianHu",t[t.Act_Zimo=90]="Act_Zimo",t[t.Act_Fa=100]="Act_Fa",t[t.Act_Guohu=104]="Act_Guohu",t[t.Act_ZuheGang=101]="Act_ZuheGang",t[t.Act_Buhua=103]="Act_Buhua"}(n=t.ACT_state||(t.ACT_state={}));var o;!function(t){t[t.Act_cancle=-3]="Act_cancle",t[t.Act_ChangeCard=-2]="Act_ChangeCard",t[t.Act_GetCard=-1]="Act_GetCard",t[t.Act_Pass=0]="Act_Pass",t[t.Act_NormalDo=1]="Act_NormalDo",t[t.Act_Ting=2]="Act_Ting",t[t.Act_Chi=3]="Act_Chi",t[t.Act_Peng=4]="Act_Peng",t[t.Act_Gang=5]="Act_Gang",t[t.Act_AnGang=6]="Act_AnGang",t[t.Act_Hu=7]="Act_Hu",t[t.Act_Buhua=8]="Act_Buhua",t[t.Act_zimo=9]="Act_zimo",t[t.Act_Guohu=10]="Act_Guohu"}(o=t.ACT_act||(t.ACT_act={}));var r;!function(t){t[t.GS_WAIT_SETGAME=0]="GS_WAIT_SETGAME",t[t.GS_WAIT_ARGEE=1]="GS_WAIT_ARGEE",t[t.GS_GAME_PLAYING=2]="GS_GAME_PLAYING",t[t.GS_GAME_FINSHED=3]="GS_GAME_FINSHED"}(r=t.GS_GAME_STATION||(t.GS_GAME_STATION={}));var i;!function(t){t[t.TRSHIP=1]="TRSHIP",t[t.ESC=2]="ESC",t[t.READY=4]="READY",t[t.SETTLE=8]="SETTLE"}(i=t.PLAYER_STATE||(t.PLAYER_STATE={}));var a;!function(t){t[t.NULL=-1]="NULL",t[t.Down=0]="Down",t[t.Up=1]="Up",t[t.R=2]="R",t[t.L=3]="L"}(a=t.UserPosition||(t.UserPosition={}));var s;!function(t){t[t.boy=1]="boy",t[t.girl=2]="girl",t[t.unknow=3]="unknow"}(s=t.SEX_TYPE||(t.SEX_TYPE={}));var c;!function(t){t[t.Free=0]="Free",t[t.Ready=1]="Ready",t[t.DealCard=2]="DealCard",t[t.Playing=3]="Playing",t[t.Over=4]="Over"}(c=t.GameState||(t.GameState={}));var h;!function(t){t[t.UNREADY=1]="UNREADY",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.ESCAPE=4]="ESCAPE",t[t.OFFLINE=5]="OFFLINE"}(h=t.UserState||(t.UserState={}));var p=function(){function t(){}return t}();p.Name={17:"一万",18:"二万",19:"三万",20:"四万",21:"五万",22:"六万",23:"七万",24:"八万",25:"九万",65:"东",66:"南",67:"西",68:"北",81:"中",82:"发",83:"白"},t.CardName=p,__reflect(p.prototype,"Tpm.CardName");var d=function(){function t(){}return t.getHuTypeFan=function(t){return Math.floor(t%1e3/10)||1},t}();d.HuTypeName={1000:"屁胡",1001:"一般高",1002:"连六",1003:"老少妇",1004:"幺九刻",1005:"明杠",1006:"边张",1007:"坎张",1008:"单钓将",1009:"自摸",1021:"箭刻",1022:"门前清",1023:"平胡",1024:"四归一",1025:"双暗刻",1026:"暗杠",1027:"断幺",1028:"报听",1041:"全带幺",1042:"不求人",1043:"双明杠",1044:"胡绝张",1061:"碰碰胡",1062:"混一色",1063:"全球人",1064:"双箭刻",1081:"妙手回春",1082:"海底捞月",1083:"杠上开花",1084:"抢杠胡",1085:"双暗杠",1121:"三风刻",1161:"清龙",1162:"一色三步高",1163:"三暗刻",1242:"清一色",1243:"一色三同顺",1244:"一色三节高",1321:"一色四步高",1322:"三杠",1323:"混幺九",1324:"天听",1481:"一色四同顺",1482:"一色四节高",1641:"小四喜",1642:"小三元",1643:"四暗刻",1644:"字一色",1645:"一色双龙会",1646:"人胡",1881:"大四喜",1882:"大三元",1883:"九莲宝灯",1884:"四杠",1886:"天胡",1887:"地胡",2000:"七对",2885:"七连对",3000:"十三幺"},t.HuType=d,__reflect(d.prototype,"Tpm.HuType")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.emailItemData={icon:"",title:"",content:"",time:"",id:0},e.emailDetailData={icon:"",title:"",content:"",time:"",id:0},t.EmailData=e,__reflect(e.prototype,"Tpm.EmailData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.mallItemData={icon:"",money:"",price:""},t.MallData=e,__reflect(e.prototype,"Tpm.MallData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.infoData={action:"PersonalInfoHandler",data:{point:-77,accid:1,uid:9123,ratewinning:"5%",avater_url:"",totalgames:165,sex:1,highest_winning_streak:2,name:"abc"},ret:0,desc:"success"},t.PersonalInfoData=e,__reflect(e.prototype,"Tpm.PersonalInfoData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.wxShareData={shareType:"wxShare",type:0,title:"",content:"",picUrlstr:""},e.qqShareData={shareType:"qqShare",title:"",url:"",description:"",picUrlstr:""},t.ShareData=e,__reflect(e.prototype,"Tpm.ShareData")
}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.loadBg="tpm_hall_bg_png",e.tipsBg="tpm_tips_bg_png",e.tipsTopBg="tpm_tips_top_bg_png",e.lockRotat="",t.ResPathConfig=e,__reflect(e.prototype,"Tpm.ResPathConfig")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t.prototype.initData=function(t){this.roomType=t.room_type,this.roomName=t.name,this.minEnterGold=t.min_enter_gold,this.maxEnterGold=t.max_enter_gold,this.minPlayGold=t.min_play_gold,this.recommendPayNum=t.recommend_pay_num,this.outCardTime=t.draw_card_time,this.serviceCharge=t.service_charge,this.baseBet=t.base_bet,this.minHuFan=t.min_hu_fan,this.maxHuFan=t.max_hu_fan,this.specialRule=t.special_rule,this.curPlayerCount=t.cur_player_count},t}();t.RoomData=e,__reflect(e.prototype,"Tpm.RoomData");var n;!function(t){t[t.noob=0]="noob",t[t.middle=1]="middle",t[t.high=2]="high"}(n=t.RoomType||(t.RoomType={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.prototype.initList=function(e){this.roomList=[];for(var n=0;n<e.length;n++){var o=new t.RoomData;o.initData(e[n]),this.roomList.push(o)}this.roomList.sort(function(t,e){return t.roomType-e.roomType}),console.log("房间配置表：",this.roomList)},e.prototype.getConfigForType=function(t){return this.roomList?this.roomList[t]:void console.error("roominfo not init")},e.prototype.reRoomNum=function(t){if(!t||t.length<3)return void console.log("roomnum error");for(var e=0;e<t.length;e++)this.roomList[e].curPlayerCount=t[e]},e}();t.RoomInfo=e,__reflect(e.prototype,"Tpm.RoomInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.gameState=t.GameState.Free,this.socketClose=!1,this.bAllowOutCard=!1,this.ownTingState=!1,this.curentRoomType=t.RoomType.noob,this.selectBtnState=!1,this.ownGuoTimes=0}return Object.defineProperty(e.prototype,"guoHuFlag",{get:function(){return this.curentRoomType!=t.RoomType.noob?!0:!1},enumerable:!0,configurable:!0}),e.prototype.clearData=function(e){void 0===e&&(e=!0),this.gameState=t.GameState.Free,this.socketClose=!1,this.bAllowOutCard=!1,this.ownTingState=!1,this.selectBtnState=!1,e&&(this.curentRoomType=t.RoomType.noob),this.ownGuoTimes=0},e}();t.RuningData=e,__reflect(e.prototype,"Tpm.RuningData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.HTTP_FLAG_TEST=!0}return Object.defineProperty(e.prototype,"WEB_URL",{get:function(){var e="";switch(t.App.DataCenter.debugInfo.isLocalPhp){case 1:e="http://39.108.10.161:50006/majapi/";break;case 2:e="http://"+t.App.DataCenter.ServerInfo.HTTP_LOGIN_IP+"/majapi/";break;default:e="http://"+t.App.DataCenter.ServerInfo.HTTP_LOGIN_IP+"/majapi/"}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HTTP_LOGIN_IP",{get:function(){var t="127.0.0.1:8889";return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SERVER_URL",{get:function(){if(this._SERVER_URL&&!t.App.DataCenter.debugInfo.Sever)return this._SERVER_URL;t.App.DataCenter.debugInfo.Sever;return"ws://127.0.0.1:10000"},set:function(t){this._SERVER_URL=t},enumerable:!0,configurable:!0}),e}();t.ServerInfo=e,__reflect(e.prototype,"Tpm.ServerInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),n.prototype.init=function(){t.App.SoundManager.allowPlayBGM=t.App.LocalStorageUtil.allowMusic,t.App.SoundManager.allowPlayEffect=t.App.LocalStorageUtil.allowEffect},n}(t.SingleClass);t.StorageConfig=e,__reflect(e.prototype,"Tpm.StorageConfig")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.userList={}}return Object.defineProperty(e.prototype,"myUserInfo",{get:function(){if(!this.myUserUid)return void console.error("uid null");var t=this.getUser(this.myUserUid);return t?t:void console.error("userinfo null")},enumerable:!0,configurable:!0}),e.prototype.addUser=function(t){this.userList[t.userID]?console.log("用户重复添加:",t.userID):this.userList[t.userID]=t;var e=this.getUserNum();e>2&&console.error("user > 2"),console.log("自己ID==",this.myUserUid),console.log("玩家列表==",this.userList)},e.prototype.getUser=function(t){return this.userList[t]},e.prototype.isExist=function(t){return this.getUser(t)?!0:!1},e.prototype.getUserBySeatID=function(t){for(var e in this.userList)if(this.userList[e].seatID==t)return this.userList[e]},e.prototype.getUserByPos=function(t){for(var e in this.userList)if(this.userList[e].userPos==t)return this.userList[e];return null},e.prototype.getUserByUserID=function(t){for(var e in this.userList)if(this.userList[e].userID==t)return this.userList[e]},e.prototype.deleteUser=function(t){delete this.userList[t]},e.prototype.deleteAllUserExcptMe=function(){for(var t in this.userList)parseInt(t)!=this.myUserInfo.userID&&delete this.userList[t]},e.prototype.deleteAllUser=function(){for(var t in this.userList)delete this.userList[t]},e.prototype.getUserNum=function(){return t.ArrayTool.getObjectLength(this.userList)},e.prototype.getPosFromSeat=function(e){return console.log("isMine--------",this.myUserInfo.seatID==e),this.myUserInfo.seatID==e?t.UserPosition.Down:t.UserPosition.Up},e.prototype.getSeatFromPos=function(t){var e=this.getUserByPos(t);return e.seatID},e.prototype.isZhuang=function(t){var e=this.getUserByUserID(t);return e.zhuangFlag?!0:!1},e.prototype.clearZhuang=function(){for(var t in this.userList)this.userList[t].zhuangFlag=!1},e}();t.UserInfo=e,__reflect(e.prototype,"Tpm.UserInfo")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this._userID=0,this.nickName="",this.sex=t.SEX_TYPE.girl,this._headUrl="",this.skey="",this.deviceID="111",this.diamond=0,this.seatID=0,this.gold=0,this.zhuangFlag=!1}return e.prototype.initUserFromHttp=function(e){this._userID=e.uid,this.nickName=e.nick_name,this.headUrl="1"==e.avater_url?"":e.avater_url,this.skey=e.skey,this.sex=e.sex,this.diamond=e.diamond,this.gold=e.money,this.userPos=t.UserPosition.Down},e.prototype.initUserFromSocket=function(e){this._userID=e.user_id,this.nickName=e.nick,this.seatID=e.seat_id,this.gold=e.point,this.state=e.status,this._userID==t.App.DataCenter.UserInfo.myUserUid?this.userPos=t.UserPosition.Down:this.userPos=t.UserPosition.Up},Object.defineProperty(e.prototype,"headUrl",{get:function(){return this._headUrl},set:function(t){1==t?this._headUrl="":this._headUrl=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userID",{get:function(){return this._userID},enumerable:!0,configurable:!0}),e}();t.UserVO=e,__reflect(e.prototype,"Tpm.UserVO")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.revGoodsList=function(e){var n=t.ProtocolHttpData.GoodsListData;n=e,n.ret?t.Tips.showTop(n.desc):t.App.PanelManager.open(t.PanelConst.ShopMallPanel,!1,null,null,!0,!0,n.data)},n.revBuyProp=function(e){var n=t.ProtocolHttpData.GoodsListData;n=e,n.ret&&(303==n.ret?t.App.PlatformBridge.sendPlatformEvent(t.PlatFormEventConst.payStart):t.Tips.showTop(n.desc))},n.revEmailList=function(e){var n=t.ProtocolHttpData.EmailListData;n=e,n.ret&&400!=n.ret?t.Tips.showTop(n.desc):t.App.PanelManager.open(t.PanelConst.EmailPanel,!1,null,null,!0,!0,n.data)},n.revEmailDetail=function(e){var n=t.ProtocolHttpData.emailDeatilData;n=e,n.ret?t.Tips.showTop(n.desc):t.App.PanelManager.open(t.PanelConst.EmailDetailPanel,!1,null,null,!0,!0,n.data)},n.revUserInfo=function(e){var n=t.ProtocolHttpData.PersonalInfoData;n=e,n.ret?t.Tips.showTop(n.desc):t.App.PanelManager.open(t.PanelConst.PersonalInfoPanel,!1,null,null,!0,!0,n.data)},n.revMoneyMsg=function(e){var n=t.ProtocolHttpData.PersonalInfoData;if(n=e,n.ret)t.Tips.showTop(n.desc);else{var o=t.App.SceneManager.getScene(t.SceneConst.HallScene);o&&o.headMod.updateDiamondAndGold(n.data.diamond,n.data.money)}},n.revIncomeSupportMsg=function(e){var n=t.ProtocolHttpData.GiveMoneyData;n=e,n.ret?t.Tips.showTop(n.desc):t.App.PanelManager.open(t.PanelConst.GiveMoneyPanel,!1,null,this,!1,!0,n.data)},n.revIncomeSupport=function(e){var n=t.ProtocolHttpData.GiveMoneyData;if(n=e,n.ret)t.Tips.showTop(n.desc);else{t.App.SceneManager.getScene(t.SceneConst.HallScene)}},n}(t.SingleClass);t.HallHttpDataReceive=e,__reflect(e.prototype,"Tpm.HallHttpDataReceive")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.sendGetGoodsList=function(e){void 0===e&&(e=1);var n=t.ProtocolHttp.GetGoodsList;n.param.type=e,t.App.httpSender.send(n,t.HallHttpDataReceive.revGoodsList,this)},n.sendBuyProp=function(e){void 0===e&&(e=1);var n=t.ProtocolHttp.BuyProp;n.param.goodid=e,t.App.httpSender.send(n,t.HallHttpDataReceive.revBuyProp,this)},n.sendGetEmailList=function(){var e=t.ProtocolHttp.GetEmailList;t.App.httpSender.send(e,t.HallHttpDataReceive.revEmailList,this)},n.sendReadEmail=function(e){var n=t.ProtocolHttp.ReadEmail;n.param.id=e,t.App.httpSender.send(n,t.HallHttpDataReceive.revEmailDetail,this)},n.sendGetUserInfo=function(){var e=t.ProtocolHttp.getUserInfo;t.App.httpSender.send(e,t.HallHttpDataReceive.revUserInfo,this)},n.sendGetDiamondAndGold=function(){var e=t.ProtocolHttp.getMoneyMsg;t.App.httpSender.send(e,t.HallHttpDataReceive.revMoneyMsg,this)},n.sendGetIncomeSupportMsg=function(){var e=t.ProtocolHttp.GetIncomeSupportMsg;t.App.httpSender.send(e,t.HallHttpDataReceive.revIncomeSupportMsg,this)},n.sendGetIncomeSupport=function(){var e=t.ProtocolHttp.GetIncomeSupport;t.App.httpSender.send(e,t.HallHttpDataReceive.revIncomeSupport,this)},n}(t.SingleClass);t.HallHttpDataSend=e,__reflect(e.prototype,"Tpm.HallHttpDataSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._gameVersion="1.0.0",t._ContentSize={contentWidth:750,contentHeight:1334},t}return __extends(n,e),n.prototype.setUserInfo=function(t){this.userInfo=t},Object.defineProperty(n.prototype,"gameVersion",{get:function(){return this._gameVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ContentSize",{get:function(){return this._ContentSize},enumerable:!0,configurable:!0}),n.prototype.linstenPlatformEvent=function(e,n){switch(void 0===n&&(n=null),e){case t.PlatFormEventConst.gameStart:break;case t.PlatFormEventConst.payEnd:break;case t.PlatFormEventConst.shareEnd:}},n.prototype.sendPlatformEvent=function(t,e){return void 0===e&&(e=null),this.platformCallback?this.platformCallback(t,e):void console.error("platformCallback is null")},n}(t.SingleClass);t.PlatformBridge=e,__reflect(e.prototype,"Tpm.PlatformBridge")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.setUseInfo="setUseInfo",e.gameStart="gameStart",e.gameEnd="gameEnd",e.payStart="payStart",e.payEnd="payEnd",e.shareStart="shareStart",e.shareEnd="shareEnd",t.PlatFormEventConst=e,__reflect(e.prototype,"Tpm.PlatFormEventConst")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.R_Fail={code:110,desc:"fail desc"},e.R_100002={code:200,info:{room:null,old_session:null,reconnect:!1}},e.R_100010={code:200,info:{game_data:{desk_info:{bank_seat_id:0,desk_id:0,remain_count:0,room_type:0,status:0},player_info:[{seat_id:0,bu_hua_num:0,guo_hu_num:0,is_ting:0,last_card:0,hand_card_by_order:[[],[],[]],out_card:[]}],wait_task:{command_id:0,end_time:1,params:{seat_id:0,end_time:0,act_info:{}}}},user_info:[]}},e.R_100100={code:200,info:{ready:0}},e.R_100104={code:200,info:{desk_id:1e5,room_type:1,seat_info:{0:{status:1,nick:"11",seat_id:0,user_id:1,point:4e3}}}},e.R_100105={code:200,info:{desk_id:0,seat_info:{0:{status:1,nick:"11",seat_id:0,user_id:1,point:4e3}}}},e.R_101001={code:200,info:{seat_id:0,act_info:{}}},e.R_101002={code:200,info:{seat_id:0,remain_count:0,card_list:[]}},e.R_101003={code:200,info:{player_info:{0:{hand_card:[[],[]]},1:{hand_card:[[],[]]}}}},e.R_101004={code:200,info:{bank_seat_id:0,dice:[]}},e.R_101005={code:200,info:{card_list:[{seat_id:0,card_list:[]},{seat_id:0,card_list:[]}]}},e.R_101006={code:200,info:{total_points:[],detail:[{params:{guo_hu_count:0,hand_card_for_settle_show:[],hu_fan_count:0,hu_seat_id:0,source_seat_id:0,type_list:[]},points:[],type:1}]}},e.R_101008={code:200,info:{seat_id:0,hua_card:[],bu_cards:[]}},e.R_101100={code:200,info:{user_id:0,seat_id:0,point:0}},e.R_101101={code:200,info:{code:0,desc:[]}},e.R_101105={code:200,info:{user_id:0,nick:""}},e.R_101106={code:200,info:{user_id:0,nick:"",ready:0}},e.R_101107={code:200,info:{status:0,nick:"",seat_id:0,user_id:0,point:0}},e.R_101109={code:200,info:{user_id:0,nick:""}},e.R_101110={code:200,info:{user_id:0,nick:"",status:0}},e.R_101112={code:200,info:{card_list:[97],seat_id:0,all_hand_cards:{0:{an_gang_cards:[],hand_card:[]},1:{an_gang_cards:[],hand_card:[]}},act_type:10}},e.R_101007={code:200,info:{hua_card_list:[],seat_id:0}},e.R_100999={code:200,info:{test_type:0,hand_card:[],cards:[]}},t.ProtocolDataRev=e,__reflect(e.prototype,"Tpm.ProtocolDataRev")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.S_common={},e.S_100002={user_id:0,passwd:""},e.S_100010={user_id:0},e.S_100100={user_id:0,ready:0},e.S_100103={user_id:0},e.S_100104={user_id:0},e.S_100105={user_id:0,room_type:0},e.S_100130={user_id:0},e.S_100140={user_id:0,act:0,act_params:null},e.S_100112={user_id:0},e.S_100999={user_id:0,test_type:0,test_params:"{}"},t.ProtocolDataSend=e,__reflect(e.prototype,"Tpm.ProtocolDataSend")}(Tpm||(Tpm={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,o){function r(t){e.call(o,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Tpm;!function(t){var e=function(){function t(){}return t}();e.S_100002="100002",e.S_100010="100010",e.S_100100="100100",e.S_100103="100103",e.S_100104="100104",e.S_100105="100105",e.S_100130="100130",e.S_100140="100140",e.S_100112="100112",e.S_100999="100999",t.ProtocolHeadSend=e,__reflect(e.prototype,"Tpm.ProtocolHeadSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.httpHead={ver:"1.6.1",AssetID:1,mainID:100},e.rev_z_login={ret:0,desc:"",action:"",mainID:0,AssetID:0,data:{hadinvited:1,deskTime:"",user:"",name:"",sex:-1,skey:"",avater_url:"",password:"",is_overtime:0,last_ip:"",uid:0,ip:"",port:"",prushport:"",excluroom_name:"",excluroom_code:"",round_card_num:0,login_days:0,payment:"",point:0,is_visitor:0}},e.GetGoodsList={action:"getgood",skey:"",uid:0,param:{type:0}},e.BuyProp={action:"BuyProp",skey:"",uid:0,param:{goodid:0}},e.send_z_buySure={action:"PlaceOrder",skey:"",uid:0,param:{goodsid:1,pay_type:1,independent:0,platform:1}},e.GetEmailList={action:"GetEmail",skey:"",uid:0,param:[]},e.ReadEmail={action:"ReadEmail",skey:"",uid:0,param:{id:0}},e.GetReward={action:"confirmemail",skey:"",uid:0,param:{id:0}},e.GetIncomeSupportMsg={action:"getincomesupport",skey:"",uid:0,param:[]},e.GetIncomeSupport={action:"receiveincomesupport",skey:"",uid:0,param:[]},e.getUserInfo={action:"getpersonal",skey:"",uid:0,param:{}},e.getMoneyMsg={action:"getcurrency",skey:"",uid:0,param:{}},e.getShareRecord={action:"CombatGainsShare",skey:"",uid:0,param:{deskBuildDate:"0",deskCode:"0"}},e.getQrCodeImg={action:"ShareByQrcode",skey:"",uid:0,param:{}},e.getRoomInfo={action:"get_hall_room_info",skey:"",uid:0,param:{}},e.getRoomNum={action:"get_hall_room_people_count",skey:"",uid:0,param:{}},e.getHeadInfo={action:"get_userinfo",skey:"",uid:0,param:{base:{uid:0}}},t.ProtocolHttp=e,__reflect(e.prototype,"Tpm.ProtocolHttp")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function t(){}return t}();e.LoginData={ret:0,action:"handler.login_handler",data:{diamond:0,uid:0,avater_url:"",ip:"",sex:0,user:"",password:"",port:0,accid:0,skey:"",name:"",point:0,payment:0,is_visitor:0,money:0},desc:"success"},e.RegisterData={ret:0,action:"handler.register_handler",data:{diamond:0,uid:0,avater_url:"",ip:"",sex:0,user:"",password:"",port:0,accid:0,skey:"",name:"",point:0,payment:0,is_visitor:0,money:0},desc:"success"},e.GoodsListData={ret:-1,action:"",data:[],desc:""},e.GoodsListItemData={icon:"",title:"",rmb_price:0,selling_price:0,id:0},e.EmailListData={ret:-1,action:"",data:[],desc:""},e.EmailListItemData={icon:"",time_desc:"",id:0,title:"",content:""},e.emailDeatilData={data:{content:"",reward:[],is_receive:"0",eid:0,title:""},ret:-1,desc:"success"},e.RewardItem={reward_name:"局数卡",reward_quantity:"0",reward_icon:0},e.PersonalInfoData={data:{point:0,accid:-1,uid:0,winning_rate:"0",avater_url:"",total:0,sex:0,highest_winning_streak:0,nick_name:"",diamond:0,money:0},ret:0,desc:""},e.MoneyNotEnoughData={lowestmoney:8e3,type:"高",selling_price:10,quantity:5e3},e.GiveMoneyData={ret:0,desc:"success",data:{income_support_times:0,allcount:"三",money:8e4}},e.RoomInfoData={ret:0,desc:"success",data:{room_cfg_info:[{max_enter_gold:0,recommend_pay_num:0,draw_card_time:0,id:1,service_charge:0,base_bet:0,max_hu_fan:0,min_hu_fan:6,name:"初级场",cur_player_count:0,min_play_gold:0,special_rule:"{}",min_enter_gold:0,room_type:0}]}},t.ProtocolHttpData=e,__reflect(e.prototype,"Tpm.ProtocolHttpData")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.touchEnabled=!0,t}return __extends(n,e),n.prototype.showMsg=function(e,n,o,r,i){void 0===n&&(n=!1),void 0===o&&(o=null),void 0===r&&(r=null),void 0===i&&(i=null),this.ok=o,this.thisObject=r,this.cancel=i,this.blackBg.visible=n,null==this.parent&&(t.App.LayerManager.msgLayer.addChild(this),this.x=(t.App.StageUtils.stageWidth-this.width)/2,this.y=(t.App.StageUtils.stageHeight-this.height)/2),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.cancelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBt,this),this.msgLabel.text=e},n.prototype.onTouch=function(t){switch(t.target){case this.sureBtn:this.ok&&this.ok.call(this.thisObject),this.hideAndRecycle();break;case this.cancelBtn||this.close:this.cancel&&this.cancel.call(this.thisObject),this.hideAndRecycle()}},n.prototype.closeBt=function(){this.hideAndRecycle()},n.prototype.leftTitle=function(t){this.cancelBtn.label=t},n.prototype.centerTitle=function(t){this.sureBtn.label=t},n.prototype.rightTitle=function(t){this.sureBtn.label=t},n.prototype.hideAndRecycle=function(){egret.Tween.removeTweens(this),this.ok=null,this.cancel=null,this.thisObject=null,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.cancelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.closeBt,this),this.hide()},n.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},n}(eui.Component);e.NAME="MessageBox",t.MessageBox=e,__reflect(e.prototype,"Tpm.MessageBox")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.boxPool=t.ObjectPool.getPool(t.MessageBox.NAME),n}return __extends(n,e),n.prototype.getBox=function(){var t=this.boxPool.getObject();return t.skinName="TpmSkin.MessageBoxSkin",t},n.prototype.recycle=function(t){this.boxPool.returnObject(t)},n.prototype.recycleAllBox=function(){for(var e=t.App.LayerManager.msgLayer,n=e.numChildren,o=n-1;o>=0;o--){var r=e.getChildAt(o);r&&r instanceof t.MessageBox&&r.hideAndRecycle()}},n}(t.SingleClass);t.MessageBoxManager=e,__reflect(e.prototype,"Tpm.MessageBoxManager")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TpmSkin.CommonMessageBoxPanelSkin",e}return __extends(e,t),e.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},e.prototype.recDataFun=function(t){t.content&&""!=t.content&&(this.tipsMessage.text=t.content)},e.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},e}(t.BasePanel);t.CommonMessageBoxPanel=e,__reflect(e.prototype,"Tpm.CommonMessageBoxPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailDetailPanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.NcloseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.HcloseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.getGiftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){var n=t.ProtocolHttpData.emailDeatilData.data;n=e;var o=n.reward.length;if(0==o)this.hasGiftGroup.visible=!1,this.noGiftGroup.visible=!0,this.NemailDetailtitle.text=n.title,this.NemailDetailcontent.text=n.content;else{this.hasGiftGroup.visible=!0,this.noGiftGroup.visible=!1;var r=t.ProtocolHttpData.RewardItem;r=n.reward[0],this.giftNum.text="×"+r.reward_quantity,this.HemailDetailtitle.text=n.title,this.HemailDetailcontent.text=n.content}},n.prototype.getReward=function(){},n.prototype.onRemove=function(){this.HcloseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.NcloseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.getGiftBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.getReward,this),this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n}(t.BasePanel);t.EmailDetailPanel=e,__reflect(e.prototype,"Tpm.EmailDetailPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailItemSkin",t}return __extends(n,e),n.prototype.dataChanged=function(){var e=t.ProtocolHttpData.EmailListItemData;e=this.data,""!=e.icon&&(this.emailIcon.source=e.icon),this.emailTitle.text=e.title,this.emailContent.text=e.content,this.sendTime.text=e.time_desc.substr(5),this.id=e.id},n.prototype.childrenCreated=function(){this.readEmailBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readEmail,this)},n.prototype.readEmail=function(e){t.HallHttpDataSend.sendReadEmail(this.id)},n}(eui.ItemRenderer);t.EmailItem=e,__reflect(e.prototype,"Tpm.EmailItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.EmailPanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){var n=new eui.ArrayCollection,o=[],r=e.length;if(r>0){this.emailEmptyGroup.visible=!1;for(var i=0;r>i;i++){var a=t.ArrayTool.deepCopy(t.ProtocolHttpData.EmailListItemData);a.id=e[i].id,a.content=t.StringTool.formatNickName(e[i].content,26),a.title=t.StringTool.formatNickName(e[i].title,20),a.time_desc=e[i].time_desc,o.push(a)}n.source=o,this.emailList.itemRenderer=t.EmailItem,this.emailList.dataProvider=n}else this.emailEmptyGroup.visible=!0},n.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n}(t.BasePanel);t.EmailPanel=e,__reflect(e.prototype,"Tpm.EmailPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.GiveMoneyPanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.getMoneyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.onRemove=function(){this.getMoneyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){this.recData=e;var n=t.ProtocolHttpData.GiveMoneyData.data;n=e;var o=t.NumberTool.sperateMoney(n.money);this.contentText.text="您的金币不足！系统赠送您"+o+"金币，今天第"+t.NumberTool.formatCapital(n.income_support_times)+"次领取，一共可领取三次",this.moneyText.text=o},n.prototype.onSure=function(e){t.HallHttpDataSend.sendGetIncomeSupport()},n}(t.BasePanel);t.GiveMoneyPanel=e,__reflect(e.prototype,"Tpm.GiveMoneyPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.MoneyNotEnoughPanelSkin,t}return __extends(n,e),n.prototype.onEnable=function(){this.buyMoneyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.onRemove=function(){this.buyMoneyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){this.recData=e;var n=t.ProtocolHttpData.MoneyNotEnoughData,o=t.NumberTool.sperateMoney(n.lowestmoney),r=t.NumberTool.sperateMoney(n.quantity),i=n.type,a={size:28,textColor:16576476,fontFamily:"Microsoft YaHei"},s={size:28,textColor:16771840,fontFamily:"SimHei",bold:"true"};this.tipsText.textFlow=[{text:"您需要拥有  ",style:a},{text:o+"金币",style:s},{text:"才能进入"+i+"级场",style:a}],this.moneyText.text=r,this.priceText.text="价值"+n.selling_price+"元"},n.prototype.updateRecommendGood=function(e){var n=t.ProtocolHttpData.MoneyNotEnoughData;n=e,this.moneyText.text=n.quantity+"",this.priceText.text="价值"+n.selling_price+"元"},n.prototype.onSure=function(t){},n}(t.BasePanel);t.MoneyNotEnoughPanel=e,__reflect(e.prototype,"Tpm.MoneyNotEnoughPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.skinName="TpmSkin.LoginPanelSkin",n.ctrl=t.App.getController(t.LoginController.NAME),n}return __extends(n,e),n.prototype.onEnable=function(){this.loginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this.registBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegist,this)},n.prototype.onRemove=function(){this.loginBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLogin,this),this.registBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegist,this),this.nameEdit.text=null,this.passEdit.text=null},n.prototype.onLogin=function(){this.nameEdit.text&&this.passEdit.text?this.ctrl.sendHttpLogin(this.nameEdit.text,this.passEdit.text):t.Tips.showTop("账号或密码不能为空")},n.prototype.onRegist=function(){this.hide(),t.App.PanelManager.open(t.PanelConst.RegistPanel,!1,null,null,!0,!0,null)},n}(t.BasePanel);t.LoginPanel=e,__reflect(e.prototype,"Tpm.LoginPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.skinName="TpmSkin.RegistPanelSkin",n.ctrl=t.App.getController(t.LoginController.NAME),n}return __extends(n,e),n.prototype.onEnable=function(){this.registBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegister,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this)},n.prototype.onRemove=function(){this.registBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRegister,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.nameEdit.text=null,this.nickNameEdit.text=null,this.passEdit.text=null},n.prototype.onRegister=function(){this.nameEdit.text&&this.passEdit.text&&this.nickNameEdit.text?this.ctrl.sendHttpRegister(this.nameEdit.text,this.passEdit.text,this.nickNameEdit.text):t.Tips.showTop("账号、昵称或密码不能为空")},n.prototype.clearInput=function(){this.nameEdit.text=null,this.passEdit.text=null,this.nickNameEdit.text=null},n.prototype.onBack=function(){this.hide(),t.App.PanelManager.open(t.PanelConst.LoginPanel,!1,null,null,!0,!0,null)},n}(t.BasePanel);t.RegistPanel=e,__reflect(e.prototype,"Tpm.RegistPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.ShopMallItemSkin,t}return __extends(n,e),n.prototype.dataChanged=function(){var e=t.ProtocolHttpData.GoodsListItemData;e=this.data,this.moneyIcon.source="tpm_moneyIcon"+e.icon+"_png",this.moneyText.text=e.title,this.priceText.text="价值"+e.rmb_price+"元",this.buyBtn.getChildAt(2).text=e.selling_price+"",this.id=e.id},n.prototype.childrenCreated=function(){this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBuy,this)},n.prototype.onBuy=function(e){t.HallHttpDataSend.sendBuyProp(this.id)},n}(eui.ItemRenderer);t.ShopMallItem=e,__reflect(e.prototype,"Tpm.ShopMallItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.ShopMallPanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){var n=new eui.ArrayCollection,o=[],r=t.ProtocolHttpData.GoodsListData.data;r=e;for(var i=r.length,a=0;i>a;a++){var s=t.ArrayTool.deepCopy(t.ProtocolHttpData.GoodsListItemData);s.icon=r[a].icon,s.id=r[a].id,s.selling_price=r[a].selling_price,s.rmb_price=r[a].rmb_price,s.title=r[a].title,o.push(s)}n.source=o,this.mallList.itemRenderer=t.ShopMallItem,this.mallList.dataProvider=n},n.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n}(t.BasePanel);t.ShopMallPanel=e,__reflect(e.prototype,"Tpm.ShopMallPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.SocketClosePanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.sureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this)},n.prototype.onRemove=function(){this.sureBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSure,this)},n.prototype.onSure=function(e){t.App.DataCenter.runingData.clearData(),t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),t.App.getController(t.LoginController.NAME).connectGameServer(),t.App.PanelManager.closeAllPanel(),this.hide()},n}(t.BasePanel);t.SocketClosePanel=e,__reflect(e.prototype,"Tpm.SocketClosePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.PersonalInfoPanelSkin,t}return __extends(n,e),n.prototype.onEnable=function(){this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.recDataFun=function(e){var n=t.ProtocolHttpData.PersonalInfoData.data;n=e,this.headImg.source=n.avater_url,this.nick.text=t.StringTool.formatNickName(n.nick_name,12),this.id.text=n.uid+"",this.golds.text=t.NumberTool.sperateMoney(n.money),this.diamonds.text=n.diamond+"",this.totalCount.text=n.total+"",this.highestWinCount.text=n.highest_winning_streak+"场",this.winRate.text=n.winning_rate},n.prototype.onRemove=function(){this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n}(t.BasePanel);t.PersonalInfoPanel=e,__reflect(e.prototype,"Tpm.PersonalInfoPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.FanTypeItemSkin",t}return __extends(n,e),n.prototype.setName=function(t){this.nameLabel.text=t},n.prototype.setDescripe=function(t){if(this.descripeLabel.text=t,this.descripeLabel.numLines>=2){var e=this.descripeLabel.size*(this.descripeLabel.numLines-1);this.cardGroup.y+=e,this.height+=e}},n.prototype.setCardList=function(e){for(var n,o=e.length,r=t.CardFactory.getInstance(),i=0;o>i;i++)n=r.getOutCard(e[i],t.UserPosition.Down),n.scaleX=.9,n.scaleY=.9,n.x=.8*58*i,n.y=0,this.cardGroup.addChild(n);0==o&&(this.height=this.height-this.cardGroup.height)},n}(eui.Component);t.FanTypeItem=e,__reflect(e.prototype,"Tpm.FanTypeItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.contentList=[],t.styleList=[],t.skinName=TpmSkin.PlayMethodPanelSkin,t}return __extends(n,e),n.prototype.onEnable=function(){this.showTargetScroller(0,!0),this.setContenTex(),this.setFanType(),this.playMethodtabBar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPlayMethod,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)
},n.prototype.onRemove=function(){this.playMethodtabBar.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showPlayMethod,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.onDestory=function(){this.removeChildren()},n.prototype.showPlayMethod=function(t){this.showTargetScroller(this.playMethodtabBar.selectedIndex)},n.prototype.setContenTex=function(){if(!this.textIsInt){var t={size:27.2,textColor:3607296,fontFamily:"SimHei",bold:"true"},e={size:26.2,textColor:3607296,fontFamily:"SimHei"};this.contentList=[this.baseRuleText,this.tsRuleText,this.resultRuleText],this.styleList=[t,e],this.setAllTextContent(),this.textIsInt=!0}},n.prototype.addLine=function(t,e){var n=new eui.Image;n.source=RES.getRes("tpm_line_png"),n.x=t,n.y=e,n.width=this.baseRuleText.width,n.height=1,this.baseRuleScroller.viewport.addChild(n)},n.prototype.setAllTextContent=function(){for(var t=RES.getRes("tpm_baseRuleConf_json"),e=t.content.length,n=(this.contentGroup.numChildren,0);e>n;n++)this.setTextContent(this.contentList[n],t.content[n]);this.addLine(40,90),this.addLine(40,310)},n.prototype.setTextContent=function(t,e){for(var n=e.length,o=[],r=0;n>r;r++){var i={};i.text=e[r].text,i.style=this.styleList[Number(e[r].style)],o.push(i)}t.textFlow=o},n.prototype.setFanType=function(){if(!this.fanTypeIsInt){for(var e=RES.getRes("tpm_fanTypeConf_json"),n=e.content.length,o=this.baseTypeScroller.viewport,r=this.baseTypeScroller.width,i=n-1;i>0;i--)for(var a=e.content[i].length,s=0;a>s;s++){var c=e.content[i][s];if(0==s){var h=new eui.Label(c.fanNum);h.size=27.2,h.width=r,h.textColor=3607296,h.fontFamily="SimHei",h.textAlign="left",o.addChild(h),s=1,c=e.content[i][s]}var p=new t.FanTypeItem;p.setDescripe(c.name+"："+c.descripe),p.setCardList(c.cardList),o.addChild(p)}this.fanTypeIsInt=!0}},n.prototype.showTargetScroller=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),this.playMethodtabBar.selectedIndex=t;for(var n=this.contentGroup.numChildren,o=0;n>o;o++){var r=this.contentGroup.getChildAt(o);o==t?r.visible=!0:r.visible=!1,e&&(r.viewport.scrollV=0)}},n}(t.BasePanel);t.PlayMethodPanel=e,__reflect(e.prototype,"Tpm.PlayMethodPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TpmSkin.ResultFanItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.nameLab.text=this.data.name,this.fanLab.text=this.data.fan+""},e}(eui.ItemRenderer);t.ResultFanItem=e,__reflect(e.prototype,"Tpm.ResultFanItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName="TpmSkin.ResultPanelSkin",t}return __extends(o,e),Object.defineProperty(o.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.showResult(),this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.changeBtnT.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.continueBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.continueBtnT.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this)},o.prototype.onRemove=function(){this.cardGro.removeChildren(),this.changeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.changeBtnT.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.continueBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.continueBtnT.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onContinue,this),this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this)},o.prototype.onChange=function(){t.App.SceneManager.getScene(t.SceneConst.GameScene).clearDesk(!1),t.App.getController(t.GameController.NAME).sendMod.sendReady(),this.hide()},o.prototype.onContinue=function(){t.App.SceneManager.getScene(t.SceneConst.GameScene).clearDesk(!1),t.App.getController(t.GameController.NAME).sendMod.sendReady(),this.hide()},o.prototype.onBack=function(){var e=t.App.SceneManager.getScene(t.SceneConst.GameScene).readyMod;e.visible=!0,e.setState(t.ReadyState.ready_00),this.hide()},o.prototype.showResult=function(){var e=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101006);if(200!=e.code)return void t.Tips.showTop(e.desc);var o=t.ProtocolDataRev.R_101006.info;o=e.info;var r;if(o.detail[0].params.hu_seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID)r=n.win;else{if(-1==o.detail[0].params.hu_seat_id)return r=n.liu,void this.showResultType(r);r=n.lose}this.showResultType(r);var i=t.ArrayTool.deepCopy(o.detail[0].params.hand_card_for_settle_show);this.showCardList(i),this.fanNumLab.text=o.detail[0].params.hu_fan_count+"",t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob?(this.guoGro.visible=!0,this.guoTimesLab.text=o.detail[0].params.guo_hu_count+""):this.guoGro.visible=!1;var a="+";this.goldLab.font="tpm_result_win_fnt",o.detail[0].points[t.App.DataCenter.UserInfo.myUserInfo.seatID]<0&&(a="",this.goldLab.font="tpm_result_lose_fnt"),this.goldLab.text=a+o.detail[0].points[t.App.DataCenter.UserInfo.myUserInfo.seatID]+"",this.showFanType(o.detail[0].params.type_list)},o.prototype.showResultType=function(t){switch(t){case n.liu:this.liuGro.visible=!0,this.huGro.visible=!1;break;case n.lose:this.liuGro.visible=!1,this.huGro.visible=!0,this.loseBgGro.visible=!0,this.winBgGro.visible=!1;break;case n.win:this.liuGro.visible=!1,this.huGro.visible=!0,this.loseBgGro.visible=!1,this.winBgGro.visible=!0;break;default:console.error("result type error")}},o.prototype.showFanType=function(e){for(var n=[],o=0;o<e.length;o++){var r={name:"",fan:0};r.name=t.HuType.HuTypeName[e[o]],r.fan=t.HuType.getHuTypeFan(e[o]),n.push(r)}var i=new eui.ArrayCollection;i.source=n,this.fanList.itemRenderer=t.ResultFanItem,this.fanList.dataProvider=i},o.prototype.showCardList=function(e){for(var n=0,o=70,r=t.UserPosition.Down,i=0;i<e.length;i++){var a=e[i];if(i==e.length-1){var s=this.cardFactory.getHandCard(a[0],r);s.x=t.CardPos.moCardPosXList[r],s.y=14,this.cardGro.addChild(s)}else if(i==e.length-2)for(var c=0,h=0;h<a.length;h++){var s=this.cardFactory.getHandCard(a[h],r);s.x=o+t.CardPos.handCardGapList[r]*(3*n+c),s.y=14,this.cardGro.addChild(s),c++}else if(3==a.length){for(var h=0;3>h;h++){var s=this.cardFactory.getEatCard(a[h],r);s.x=o+3*t.CardPos.handCardGapList[r]*n+t.CardPos.eatCardGapList[r]*h,s.y=37,this.cardGro.addChild(s)}n++}else if(4==a.length&&0!=a[1]){for(var h=0;4>h;h++){var s=this.cardFactory.getEatCard(a[h],r);3>h?(s.x=o+3*t.CardPos.handCardGapList[r]*n+t.CardPos.eatCardGapList[r]*h,s.y=37):(s.x=o+3*t.CardPos.handCardGapList[r]*n+1*t.CardPos.eatCardGapList[r],s.y=15),this.cardGro.addChild(s)}n++}else if(4==a.length&&0==a[1]){a[3]=a[0],a[0]=0;for(var h=0;4>h;h++)if(3>h){var s=this.cardFactory.getAnGangCard(a[h],r);s.x=o+3*t.CardPos.handCardGapList[r]*n+t.CardPos.eatCardGapList[r]*h,s.y=37,this.cardGro.addChild(s)}else{var s=this.cardFactory.getEatCard(a[h],r);s.x=o+3*t.CardPos.handCardGapList[r]*n+1*t.CardPos.eatCardGapList[r],s.y=15,this.cardGro.addChild(s)}n++}}},o}(t.BasePanel);t.ResultPanel=e,__reflect(e.prototype,"Tpm.ResultPanel");var n;!function(t){t[t.win=0]="win",t[t.lose=1]="lose",t[t.liu=2]="liu"}(n||(n={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.SetPanelSkin",t}return __extends(n,e),n.prototype.childrenCreated=function(){this.hallSetGroup.visible=!1,this.bgMusic_hallBtn.selected=!t.App.LocalStorageUtil.allowMusic,this.effectMusic_hallBtn.selected=!t.App.LocalStorageUtil.allowEffect},n.prototype.onEnable=function(){this.hallSetGroup.visible=!1,this.gameBool?this.hallSetGroup.visible=!1:(this.hallSetGroup.visible=!0,this.bgMusic_Btn=this.bgMusic_hallBtn,this.effectMusic_Btn=this.effectMusic_hallBtn,this.closeBtn=this.closeBtnHall),this.bgMusic_Btn.selected=!t.App.LocalStorageUtil.allowMusic,this.effectMusic_Btn.selected=!t.App.LocalStorageUtil.allowEffect,this.hallSetGroup.visible=!0,this.bgMusic_Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.effectMusic_Btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},n.prototype.onRemove=function(){this.bgMusic_Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.effectMusic_Btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setToggleSwitchTouch,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this.gameBool=!1},n.prototype.onClose=function(){this.hide()},n.prototype.setToggleSwitchTouch=function(e){var n=!e.target.selected;switch(e.target){case this.bgMusic_Btn:t.App.LocalStorageUtil.allowMusic=t.App.SoundManager.allowPlayBGM=n,t.App.SoundManager.allowPlayBGM&&t.App.SceneManager.getCurScene()instanceof t.GameScene||t.App.SoundManager.stopBGM();break;case this.effectMusic_Btn:t.App.LocalStorageUtil.allowEffect=t.App.SoundManager.allowPlayEffect=n}},n}(t.BasePanel);t.SetPanel=e,__reflect(e.prototype,"Tpm.SetPanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="TpmSkin.SharePanelSkin",t}return __extends(n,e),n.prototype.onEnable=function(){this.wxShareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.wxShareFriendBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.qqShareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.onRemove=function(){this.wxShareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.wxShareFriendBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.qqShareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.setShareType,this),this.closeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this)},n.prototype.setShareType=function(t){var e=0;switch(t.target){case this.wxShareBtn:e=0;break;case this.wxShareFriendBtn:e=1;break;case this.qqShareBtn:e=2}this.onShare(e)},n.prototype.onShare=function(e){var n;switch(e){case 0:n=t.ShareData.wxShareData,n.type=0;break;case 1:n=t.ShareData.wxShareData,n.type=1;break;case 2:n=t.ShareData.qqShareData}t.App.PlatformBridge.sendPlatformEvent(t.PlatFormEventConst.shareStart,n),t.Tips.showTop("分享请求已发送！")},n}(t.BasePanel);t.SharePanel=e,__reflect(e.prototype,"Tpm.SharePanel")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.bmdList=[],e.curFrame=0,e.totalFrame=0,e.delay=33,e.loop=1,e}return __extends(e,t),e.prototype.setImgBuffer=function(t,e,n){for(var o=n-e,r=0;o>=r;r++)this.bmdList.push(RES.getRes(t+r+"_png"));this.curFrame=0,this.bitmapData=this.bmdList[0],this.totalFrame=this.bmdList.length},e.prototype.play=function(t){void 0===t&&(t=1),this.loop=t,this.startTimer()},e.prototype.gotoAndPlay=function(t,e){void 0===e&&(e=1),this.curFrame=t,this.bitmapData=this.bmdList[this.curFrame],this.play(e)},e.prototype.stop=function(){this.stopTimer()},e.prototype.startTimer=function(){this.animTimer||(this.animTimer=new egret.Timer(this.delay)),this.animTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.animTimer.delay=this.delay,this.animTimer.reset(),this.animTimer.start()},e.prototype.onTimer=function(){if(this.curFrame==this.totalFrame){if(this.loop--,!(this.loop>0))return this.stopTimer(),void this.dispatchEvent(new egret.Event(egret.Event.COMPLETE));this.gotoAndPlay(0,this.loop)}this.bitmapData=this.bmdList[this.curFrame],this.curFrame++},e.prototype.stopTimer=function(){this.animTimer&&(this.animTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.animTimer.stop())},e}(egret.Bitmap);t.BitmapMovie=e,__reflect(e.prototype,"Tpm.BitmapMovie")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.upDist=20,t.initPosY=0,t.cardBg=new eui.Image,t.cardImg=new eui.Image,t.addChild(t.cardBg),t.addChild(t.cardImg),t.touchChildren=!1,t.touchEnabled=!1,t._bUp=!1,t}return __extends(n,e),Object.defineProperty(n.prototype,"cardValue",{get:function(){return this._cardValue},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"userPos",{get:function(){return this._userPos},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bUp",{get:function(){return this._bUp},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"initY",{get:function(){return this.initPosY},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"arrowState",{get:function(){return this._arrowState},enumerable:!0,configurable:!0}),n.prototype.setArrow=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):(this._arrowState=e,this.cardArrow&&this.cardArrow.parent&&this.cardArrow.parent.removeChild(this.cardArrow),void(e&&(this.cardArrow=new eui.Image,this.cardArrow.source=RES.getRes("tpm_card_arrow_png"),this.cardArrow.x=24,this.cardArrow.y=-41,this.addChild(this.cardArrow))))},n.prototype.setGray=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):void(e?(this.cardMask.visible=!0,this.touchEnabled=!1):(this.cardMask.visible=!1,this.touchEnabled=!0))},n.prototype.setBack=function(e){return void 0===e&&(e=!1),this._userPos!=t.UserPosition.Down?void console.error("not yourself card"):void(e?(this.cardBack.visible=!0,this.touchEnabled=!1):(this.cardBack.visible=!1,this.touchEnabled=!0))},n.prototype.setCardValueAndSHow=function(t){this._cardValue=t,this.cardImg.source=RES.getRes("tpm_card_big_"+t+"_png")},n.prototype.setCardValueAndShowOut=function(t){this._cardValue=t,this.cardImg.source=RES.getRes("tpm_card_small_"+t+"_png")},n.prototype.setHandSkin=function(e,n,o){void 0===o&&(o=!1),this._cardValue=e,this._userPos=n,n==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_5_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardImg.x=5,this.initPosY=624,this.cardBack=new eui.Image,this.cardBack.source=RES.getRes("tpm_cardbg_6_png"),this.cardBack.width=86,this.cardBack.height=120,this.addChild(this.cardBack),this.cardBack.visible=!1,this.cardMask=new eui.Rect,this.cardMask.width=83,this.cardMask.height=118,this.cardMask.alpha=.5,this.cardMask.x=1,this.addChild(this.cardMask),this.cardMask.visible=!1):n==t.UserPosition.Up&&(o?(this.cardBg.source=RES.getRes("tpm_cardbg_5_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardImg.x=3,this.cardImg.y=2,this.cardBg.scaleX=.8,this.cardBg.scaleY=.75,this.cardImg.scaleX=.8,this.cardImg.scaleY=.75):(this.cardBg.source=RES.getRes("tpm_cardbg_1_png"),this.cardImg.source=null),this.initPosY=19)},n.prototype.setOutSkin=function(e,n){this._cardValue=e,this._userPos=n,n==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_7_png"),this.cardImg.source=RES.getRes("tpm_card_small_"+e+"_png"),this.cardImg.x=12,this.cardImg.y=8):n==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_7_png"),this.cardImg.source=RES.getRes("tpm_card_small_"+e+"_png"),this.cardImg.x=11,this.cardImg.y=8,this.cardBg.scaleX=.94,this.cardBg.scaleY=.94)},n.prototype.setEatSkin=function(e,n){this._cardValue=e,this._userPos=n,n==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_4_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardBg.scaleX=1.1,this.cardImg.x=7,this.cardImg.y=-10,this.cardImg.scaleX=.8,this.cardImg.scaleY=.8):n==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_8_png"),this.cardImg.source=RES.getRes("tpm_card_big_"+e+"_png"),this.cardBg.scaleX=.98,this.cardBg.scaleY=.98,this.cardImg.x=3,this.cardImg.y=-14,this.cardImg.scaleX=.79,this.cardImg.scaleY=.79)},n.prototype.setAnGangSkin=function(e,n){this._cardValue=e,this._userPos=n,n==t.UserPosition.Down?(this.cardBg.source=RES.getRes("tpm_cardbg_6_png"),this.cardImg.source=null,this.cardBg.scaleX=1.08):n==t.UserPosition.Up&&(this.cardBg.source=RES.getRes("tpm_cardbg_6_png"),this.cardImg.source=null,this.cardBg.scaleX=.9,this.cardBg.scaleY=.9)},n.prototype.toUp=function(){0==this.bUp&&(this.y=this.initPosY-this.upDist,this._bUp=!0)},n.prototype.toDown=function(){1==this.bUp&&(this.y=this.initPosY,this._bUp=!1)},n.prototype.recycle=function(){this._bUp=!1,this._userPos=0,this._cardValue=0,this.touchEnabled=!1,this.touchChildren=!1,this.cardBg.source=null,this.cardImg.source=null,this.x=0,this.y=0,this.cardBg.x=0,this.cardBg.y=0,this.cardImg.x=0,this.cardImg.y=0,this.scaleX=1,this.scaleY=1,this.cardImg.scaleX=1,this.cardImg.scaleY=1,this.cardBg.scaleX=1,this.cardBg.scaleY=1,this.parent&&this.parent.removeChild(this),this.alpha=1,this.cardArrow&&this.cardArrow.parent&&this.cardArrow.parent.removeChild(this.cardArrow),this.cardMask&&this.cardMask.parent&&this.cardMask.parent.removeChild(this.cardMask),this.cardBack&&this.cardBack.parent&&this.cardBack.parent.removeChild(this.cardBack),t.ObjectPool.getPool(n.NAME).returnObject(this)},n}(egret.DisplayObjectContainer);e.NAME="Card",t.Card=e,__reflect(e.prototype,"Tpm.Card")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){this.cardPool=t.ObjectPool.getPool(t.Card.NAME)}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.getHandCard=function(e,n,o){void 0===o&&(o=!1);var r=this.cardPool.getObject();return t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob?r.setHandSkin(e,n,o):r.setHandSkin(e,n),r.touchEnabled=n==t.UserPosition.Down?!0:!1,r},e.prototype.getOutCard=function(t,e){var n=this.cardPool.getObject();return n.setOutSkin(t,e),n},e.prototype.getEatCard=function(t,e){var n=this.cardPool.getObject();return n.setEatSkin(t,e),n},e.prototype.getAnGangCard=function(t,e){var n=this.cardPool.getObject();return n.setAnGangSkin(t,e),n},e}();t.CardFactory=e,__reflect(e.prototype,"Tpm.CardFactory")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(){}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.sortHandCard=function(t){for(var e,n,o,r=t.length,i=0;r>i;i++)for(var a=i+1;r>a;a++)e=t[i],n=t[a],e.cardValue<n.cardValue&&(o=t[i],t[i]=t[a],t[a]=o)},e.prototype.sortHandCardAB=function(t){for(var e,n,o,r=t.length,i=0;r>i;i++)for(var a=i+1;r>a;a++)e=t[i],n=t[a],e.cardValue>n.cardValue&&(o=t[i],t[i]=t[a],t[a]=o)},e.prototype.changeSeat=function(e){var n,o=t.App.DataCenter.UserInfo.myUserInfo.seatID;return n=e==o?0:e>o?e-o:4-o+e},e.prototype.changeStateToAct=function(t){for(var e=1,n=0;8>n;n++){var o=e<<n;if(o==t)break}return n},e.prototype.checkActState=function(t,e){return 0==(t&e)?!1:!0},e.prototype.getSameList=function(t,e){for(var n=t.length,o=[],r=0;n>r;r++){for(var i=1,a=t[r].cardValue,s=r+1;n>s;s++)a==t[s].cardValue&&i++;i>=e&&o.push(a)}return o},e.prototype.checkSameByValue=function(t,e,n){for(var o=t.length,r=0,i=0;o>i;i++)t[i].cardValue==e&&r++;return r>=n?!0:!1},e.prototype.getBuGang=function(t,e){for(var n=[],o=[],r=e.length,i=0;r>i;i++)n=n.concat(e[i]);r=n.length;for(var a=t.length,i=0;a>i;i++){for(var s=0,c=t[i].cardValue,h=0;r>h;h++)n[h].cardValue==c&&s++;s>=3&&o.push(c)}return o},e.prototype.getJoinCardPos=function(t,e){for(var n,o=e.length-1,r=t.cardValue,i=0;o>i&&(n=e[i],!(r>=n.cardValue));i++);return i},e.prototype.getActListFromKey=function(e){if("object"!=typeof e)return void console.error("actinfo error");var n=[];for(var o in e)if(Number(o)!=t.ACT_state.Act_Out){n.push(Number(o));var r=t.App.SceneManager.getScene(t.SceneConst.GameScene).cardMod.getOwnMoFlag();r&&(Number(o)==t.ACT_state.Act_Ting||Number(o)==t.ACT_state.Act_BuGang||Number(o)==t.ACT_state.Act_AnGang)&&(t.App.DataCenter.runingData.bAllowOutCard=!0)}else t.App.DataCenter.runingData.bAllowOutCard=!0;for(var o in e)if(Number(o)==t.ACT_state.Act_DianHu||Number(o)==t.ACT_state.Act_Zimo){t.App.DataCenter.runingData.bAllowOutCard=!1;break}return n},e}();t.CardLogic=e,__reflect(e.prototype,"Tpm.CardLogic")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.dragCardValue=0,t.skinName=TpmSkin.GameCardModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.initDb()},n.prototype.onEnable=function(){this.cardTestGro&&(this.cardTestGro.visible=!1),this.initList(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},n.prototype.onRemove=function(){},n.prototype.getOwnMoFlag=function(){return this.moCardList[t.UserPosition.Down][0]?!0:!1},n.prototype.onTouchTap=function(e){var n=e.target;if(console.log("ontouch--------"),n instanceof t.Card){if(n.userPos==t.UserPosition.Up||n.parent!=this.cardGro)return void console.log("target error==",n);if(t.App.DataCenter.runingData.bAllowOutCard?n.bUp?n.arrowState?this.ctrl.sendMod.sendAct(t.ACT_state.Act_Ting,[n.cardValue]):this.ctrl.sendMod.sendAct(t.ACT_state.Act_Out,[n.cardValue]):(this.drownAllHandCard(),n.toUp()):n.bUp?n.toDown():(this.drownAllHandCard(),n.toUp()),n.arrowState&&n.bUp){var o=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);console.log("听牌数据：",o);var r=[];for(var i in o.act_info[t.ACT_state.Act_Ting][n.cardValue]){var a={outCardValue:Number(i),fanNum:o.act_info[t.ACT_state.Act_Ting][n.cardValue][i].fan,residueNum:this.gameScene.cardMod.getCardResidue(Number(i))};r.push(a);for(var s=o.act_info[t.ACT_state.Act_Ting][n.cardValue][i].type_list,c="",h=0;h<s.length;h++)c+=t.HuType.HuTypeName[s[h]],c+=";";console.log(t.CardName.Name[i]+":"+c)}this.gameScene.huTipsMod.showHuTips(r,n.cardValue)}}},n.prototype.onTouchBegin=function(e){if(e.target instanceof t.Card){var n=e.target;n.parent!=this.cardGro||n.arrowState||(this.curTouchCard=n,this.dragCardValue=n.cardValue,t.App.LayerManager.RootLayer.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragMove,this),t.App.LayerManager.RootLayer.addEventListener(egret.TouchEvent.TOUCH_END,this.onDragEnd,this))}},n.prototype.onDragMove=function(e){0!=this.dragCardValue&&(null==this.dragMoveCard&&e.stageY<t.CardPos.handCardPosYlist[t.UserPosition.Down]&&(this.dragMoveCard=this.cardFactory.getHandCard(this.dragCardValue,t.UserPosition.Down),this.movieGro.addChild(this.dragMoveCard)),this.dragMoveCard&&(this.dragMoveCard.x=e.stageX-this.dragMoveCard.width/2,this.dragMoveCard.y=e.stageY-this.dragMoveCard.height/2))},n.prototype.onDragEnd=function(e){if(this.dragCardValue=0,this.dragMoveCard){this.dragMoveCard.cardValue;this.clearDragCard(),t.App.DataCenter.runingData.bAllowOutCard&&e.stageY<t.CardPos.handCardPosYlist[t.UserPosition.Down]&&(this.curTouchOutCard=this.curTouchCard,this.ctrl.sendMod.sendAct(t.ACT_state.Act_Out,[this.curTouchOutCard.cardValue]))}},n.prototype.clearDragCard=function(){t.App.LayerManager.RootLayer.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onDragMove,this),t.App.LayerManager.RootLayer.removeEventListener(egret.TouchEvent.TOUCH_END,this.onDragEnd,this),this.dragCardValue=0,this.dragMoveCard&&(this.dragMoveCard.recycle(),this.dragMoveCard=null)},n.prototype.testOut=function(t){for(var e=[17,18,19,20,22,23,24,53,54,55],n=0;n<e.length;n++){var o=this.cardFactory.getOutCard(e[n],t);this.addCardToOut(o,t)}},n.prototype.testHand=function(e){for(var n=[66,67,81,82,97,102,104],o=0;o<n.length;o++){var r=this.cardFactory.getHandCard(n[o],e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(r,e)}},n.prototype.testChi=function(t){var e=[23,23,23];this.addCardToEat(e,t)},n.prototype.testGang=function(t,e){void 0===e&&(e=!1);var n=[23,23,23,24];this.addCardToGang(n,t,e)},n.prototype.testMo=function(e){var n=0;n=e?0:53;var o=this.cardFactory.getHandCard(n,e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(o,e)},n.prototype.dealCardShow=function(e){for(var n=13,o=[0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;n>r;r++){var i=this.cardFactory.getHandCard(e[r],t.UserPosition.Down);this.addCardToHand(i,t.UserPosition.Down),i.visible=!1;var a=this.cardFactory.getHandCard(o[r],t.UserPosition.Up);this.addCardToHand(a,t.UserPosition.Up),a.visible=!1}for(var r=0;4>r;r++)this.delayShowAGroup(r,t.UserPosition.Down),this.delayShowAGroup(r,t.UserPosition.Up)},n.prototype.delayShowAGroup=function(e,n){var o=this,r=900,i=13;n==t.UserPosition.Down?setTimeout(function(){for(var t=4*e;4*e+4>t&&!(t>=i);t++){var r=o.handCardList[n][t];r.setBack(!0),o.showFanDb(t);var a=t;egret.setTimeout(function(){a==i-1&&egret.setTimeout(function(){o.downCardBackSHow()},o,200);for(var e=t-1;e>t-4-1&&o.handCardList[n][e];e--)o.handCardList[n][e].setBack(!1),o.handCardList[n][e].visible=!0},o,730)}},r*e,this):setTimeout(function(){for(var r=i-1-4*e;r>i-1-4*e-4&&!(0>r);r--){var a=o.handCardList[n][r];a.y=a.initY+t.CardPos.moCardOffsetY[n],a.visible=!0,egret.Tween.get(a).wait(200).to({y:a.initY},50)}},r*e,this)},n.prototype.downCardBackSHow=function(){for(var e=this,n=0;n<this.handCardList[t.UserPosition.Down].length;n++){var o=this.handCardList[t.UserPosition.Down][n];o.setBack(!0),o.visible=!1}this.dealCardBuHua(),t.CardLogic.getInstance().sortHandCardAB(this.handCardList[t.UserPosition.Down]);for(var n=0;n<this.handCardList[t.UserPosition.Down].length;n++)this.handCardList[t.UserPosition.Down][n].x=t.CardPos.handCardPosXList[t.UserPosition.Down]+n*t.CardPos.handCardGapList[t.UserPosition.Down];for(var n=0;13>n;n++)this.showFanDb(n);setTimeout(function(){for(var n=0;n<e.handCardList[t.UserPosition.Down].length;n++){var o=e.handCardList[t.UserPosition.Down][n];o.setBack(!1),o.visible=!0}e.ctrl.sendMod.sendAct(t.ACT_state.Act_Fa,[]),t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101001,!1),t.App.DataCenter.runingData.gameState=t.GameState.Playing},740,this)},n.prototype.dealCardBuHua=function(){var e=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101008);if(e)for(var n=0;n<e.length;n++)if(e[n].seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,t.UserPosition.Down),this.gameScene.flowerMod.setFlowerState(t.UserPosition.Down,e[n].hua_card.length);for(var o=0;o<e[n].hua_card.length;o++)for(var r=0;r<this.handCardList[t.UserPosition.Down].length;r++)this.handCardList[t.UserPosition.Down][r].cardValue==e[n].hua_card[o]&&this.handCardList[t.UserPosition.Down][r].setCardValueAndSHow(e[n].bu_cards[o])}else this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,t.UserPosition.Up),this.gameScene.flowerMod.setFlowerState(t.UserPosition.Up,e[n].hua_card.length)},n.prototype.moCardBuHua=function(e){var n=this;return this.gameScene.dbMod.showActDb(t.ACT_state.Act_Buhua,e),this.moCardList[e][0]?void(this.moCardList[e][0].cardValue>96&&egret.Tween.get(this.moCardList[e][0]).to({alpha:.8},500).to({alpha:0},200).call(function(){egret.Tween.removeTweens(n.moCardList[e][0])})):void console.error("mo card error")},n.prototype.moCardShow=function(e,n){this.moCardList[n][0]&&(this.moCardList[n][0].recycle(),this.moCardList[n].pop());var o=this.cardFactory.getHandCard(e,n,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(o,n),o.visible=!1;var r=this.cardFactory.getHandCard(e,n,t.App.DataCenter.runingData.ownTingState);r.x=o.x,r.y=o.y+t.CardPos.moCardOffsetY[n],this.movieGro.addChild(r),n==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&(o.setGray(!0),r.setGray(!0)),egret.Tween.get(r).wait(200).to({y:this.moCardList[n][0].initY},50).call(function(){o.visible=!0,r&&r.parent&&r.parent.removeChild(r),egret.Tween.removeTweens(r)})},n.prototype.outCardShow=function(e,n){var o=this;void 0===e&&(e=t.UserPosition.Down),void 0===n&&(n=0);var r;if(this.moCardList[e][0].cardValue==n)r=this.moCardList[e][0];else if(e!=t.UserPosition.Up||t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob&&t.App.DataCenter.runingData.ownTingState){for(var i=0;i<this.handCardList[e].length;i++)if(this.handCardList[e][i].cardValue==n){r=this.handCardList[e][i];break}}else r=this.moCardList[e][0];if(!r)return void console.error("out card null");var a=r.cardValue||n;e==t.UserPosition.Up&&(a=n);var s=this.cardFactory.getOutCard(a,e);this.addCardToOut(s,e),s.visible=!1;var c=this.cardFactory.getOutCard(a,e);c.x=r.x,c.y=r.y+t.CardPos.moCardOffsetY[e],this.movieGro.addChild(c);var h=!1;if(r==this.moCardList[e][0])r.recycle(),this.moCardList[e].pop(),h=!0;else{for(var i=0;i<this.handCardList[e].length;i++)if(this.handCardList[e][i]==r){r.recycle(),this.handCardList[e].splice(i,1);break}h=!1}this.drownAllHandCard(),egret.Tween.get(c).to({x:s.x,y:s.y},200).call(function(){c&&c.parent&&c.parent.removeChild(c),s.visible=!0,h||o.moveMoCardToHand(e)},this)},n.prototype.moveMoCardToHand=function(e){var n=this;void 0===e&&(e=t.UserPosition.Down);var o=[-130,-10],r=this.moCardList[e][0];if(!r)return void console.error("have not mocard");var i=this.cardFactory.getHandCard(r.cardValue,e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(i,e),i.visible=!1,t.App.DataCenter.runingData.ownTingState&&e==t.UserPosition.Down&&i.setGray(!0);var a=this.cardFactory.getHandCard(r.cardValue,e,t.App.DataCenter.runingData.ownTingState);a.x=r.x,a.y=r.y,this.movieGro.addChild(a),t.App.DataCenter.runingData.ownTingState&&e==t.UserPosition.Down&&a.setGray(!0),r.recycle(),this.moCardList[e].pop(),egret.Tween.get(a).to({y:i.initY+o[e]},100).call(function(){n.reHandCardPos(e),egret.Tween.get(a).to({x:i.x},200).to({y:i.initY},100).call(function(){i.visible=!0,a&&a.parent&&a.parent.removeChild(a)},n)},this)},n.prototype.eatCardShow=function(e,n,o){void 0===o&&(o=!1);var r=3,i=0;if(0==n&&(i=1),this.removeLastOutCard(i),this.addCardToEat(e,n,o),n==t.UserPosition.Down||t.App.DataCenter.runingData.ownTingState&&t.App.DataCenter.runingData.guoHuFlag){for(var a=0;a<e.length;a++)if(e[a]==t.App.DataCenter.runingData.latelyCardValue){e.splice(a,1);break}for(var a=0;a<e.length;a++)this.deletHandCard(e[a],n)}else for(var a=r;a>1;a--)this.handCardList[n][this.handCardList[n].length-1].recycle(),this.handCardList[n].pop();var s=this.cardFactory.getHandCard(this.handCardList[n][this.handCardList[n].length-1].cardValue,n,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(s,n),this.handCardList[n][this.handCardList[n].length-1].recycle(),this.handCardList[n].pop(),this.reHandCardPos(n)},n.prototype.gangCardShow=function(e,n,o){var r=4,i=!1;if(e==t.ACT_state.Act_AnGang&&(i=!0),e==t.ACT_state.Act_BuGang)this.addCardToBu(n,o);else{for(var a=[],s=0;r>s;s++)a.push(n);this.addCardToGang(a,o,i)}if(e==t.ACT_state.Act_Gang){var c=0;0==o&&(c=1),this.removeLastOutCard(c),this.deletHandCard(n,o),this.deletHandCard(n,o),this.deletHandCard(n,o)}else e==t.ACT_state.Act_BuGang?(this.deletHandCard(n,o),this.moCardList[o].length>0&&(this.handCardList[o].push(this.moCardList[o][0]),this.moCardList[o]=[])):(this.deletHandCard(n,o),this.deletHandCard(n,o),this.deletHandCard(n,o),this.deletHandCard(n,o),this.moCardList[o].length>0&&(this.handCardList[o].push(this.moCardList[o][0]),this.moCardList[o]=[]));this.reHandCardPos(o)},n.prototype.dianHuCardShow=function(e,n){var o=this.cardFactory.getHandCard(e,n,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(o,n);var r=0;0==n&&(r=1),this.removeLastOutCard(r),e!=this.moCardList[n][0].cardValue&&console.error("dianHu card error")},n.prototype.testHu=function(t,e){void 0===e&&(e=null);for(var n=[66,67,81,82,97,102,104],e=e||n,o=0;o<e.length;o++)this.addCardToHu(e[o],t)},n.prototype.clearCardMovieGro=function(){this.movieGro.removeChildren()},n.prototype.tingCardShow=function(){this.drownAllHandCard();var e=t.UserPosition.Down,n=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1),o=[];for(var r in n.act_info[t.ACT_state.Act_Ting])o.push(Number(r));for(var i=0;i<this.handCardList[e].length;i++){for(var a=!0,s=0;s<o.length;s++)if(this.handCardList[e][i].cardValue==o[s]){this.handCardList[e][i].setArrow(!0),a=!1;
break}this.handCardList[e][i].setGray(a)}for(var c=!1,i=0;i<o.length;i++)o[i]==this.moCardList[e][0].cardValue&&(c=!0);this.moCardList[e][0].setGray(!0),c&&(this.moCardList[e][0].setGray(!1),this.moCardList[e][0].setArrow(!0))},n.prototype.tingDidShow=function(e){for(var n=t.UserPosition.Down,o=0;o<this.handCardList[n].length;o++)this.handCardList[n][o].setArrow(!1),this.handCardList[n][o].setGray(!0);this.moCardList[n][0].setArrow(!1),this.moCardList[n][0].setGray(!0),this.tingDidCardShow(e)},n.prototype.tingDidCardShow=function(e){if(t.App.DataCenter.runingData.curentRoomType!=t.RoomType.noob&&t.App.DataCenter.runingData.ownTingState)for(var n=t.UserPosition.Up,o=e[t.App.DataCenter.UserInfo.getUserByPos(n).seatID].hand_card,r=0;r<o.length;r++){var i=o[r];i&&this.handCardList[n][r].setHandSkin(i,n,t.App.DataCenter.runingData.ownTingState)}},n.prototype.tingCancleShow=function(){var e=t.UserPosition.Down;this.drownAllHandCard();for(var n=0;n<this.handCardList[e].length;n++)this.handCardList[e][n].setArrow(!1),this.handCardList[e][n].setGray(!1);this.moCardList[e][0].setArrow(!1),this.moCardList[e][0].setGray(!1)},n.prototype.huCardShow=function(e,n){var o=n.length;if(!o)return void console.error("game over handcard error");for(var r=0;r<n[o-2].length;r++)this.addCardToHu(n[o-2][r],e);n[o-1].length>0&&this.addCardToHu(n[o-1][0],e,!0);for(var r=0;r<this.handCardList[e].length;r++)this.handCardList[e][r].recycle();if(this.handCardList[e]=[],this.moCardList[e][0]&&(this.moCardList[e][0].recycle(),this.moCardList[e]=[]),e==t.UserPosition.Up){for(var i=[],r=0;r<n.length;r++)4==n[r].length&&0==n[r][1]&&i.push(n[r][0]);if(i.length<1)return;console.log("this.angCardList[pos]======",this.angCardList[e]);for(var r=0;r<this.angCardList[e].length/4;r++){var a=this.angCardList[e][4*r+3],s=this.cardFactory.getEatCard(i[r],e);s.x=a.x,s.y=a.y,this.cardGro.addChild(s),a.recycle(),this.angCardList[e][4*r+3]=s}}},n.prototype.reConnectCardShow=function(e,n,o,r){for(var i,a=0;a<n.length;a++){var s=t.ArrayTool.deepCopy(n[a]),c=s.length;if(a==n.length-1){if(c>0){var h=this.cardFactory.getHandCard(s[0],e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(h,e)}}else a==n.length-2?i=s:3==c?s[0]==s[1]?this.addCardToEat(s,e,!0):this.addCardToEat(s,e,!1):4==c&&(0==s[1]?(s[3]=s[0],s[0]=0,this.addCardToGang(s,e,!0)):this.addCardToGang(s,e,!1))}if(i.length%3==2){for(var p=!0,a=0;a<i.length;a++)if(i[a]==o){p=!1;var h=this.cardFactory.getHandCard(o,e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(h,e),i.splice(a,1),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0);break}if(p){var d=i[i.length-1],h=this.cardFactory.getHandCard(d,e,t.App.DataCenter.runingData.ownTingState);this.addCardToMo(h,e),i.splice(i.length-1,1),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0)}}for(var a=0;a<i.length;a++){var h=this.cardFactory.getHandCard(i[a],e,t.App.DataCenter.runingData.ownTingState);this.addCardToHand(h,e),e==t.UserPosition.Down&&t.App.DataCenter.runingData.ownTingState&&h.setGray(!0)}for(var a=0;a<r.length;a++){var h=this.cardFactory.getOutCard(r[a],e);this.addCardToOut(h,e)}},n}(t.CardModBase);t.GameCardMod=e,__reflect(e.prototype,"Tpm.GameCardMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameCheatModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.selectGroup=new eui.Group},n.prototype.onEnable=function(){var e=this;this.state=!1,this.reShowState(this.state),this.setFanGro(!1),this.setFanData(),t.App.DataCenter.debugInfo.testState?this.init():this.visible=!1,this.fanGro.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.setFanGro(!1)},this)},n.prototype.onRemove=function(){},n.prototype.init=function(){var e=this;this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=0,e.showSwapCard()},this),this.changeToBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=1,e.showSwapCard()},this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curSelcet=2,e.showSwapCard()},this),this.lastBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.ProtocolDataSend.S_100999;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.test_type=3;var n={source_card:[],target_card:[]};e.test_params=JSON.stringify(n),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,e)},this),this.huBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),e.setFanGro(!0)},this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),t.App.gameSocket.close(),t.App.EventManager.sendEvent(t.EventConst.SocketClose,t.App.gameSocket)},this),this.jiesanBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup),e.ctrl.sendMod.sendJieSanTest()},this),this.card_s0=this.cardFactory.getOutCard(0,0),this.card_s0.x=145,this.card_s0.y=10,this.card_s0.scaleX=this.card_s0.scaleY=.6,this.btnBro.addChild(this.card_s0),this.card_s1=this.cardFactory.getOutCard(0,0),this.card_s1.x=145,this.card_s1.y=70,this.card_s1.scaleX=this.card_s1.scaleY=.6,this.btnBro.addChild(this.card_s1),this.card_s2=this.cardFactory.getOutCard(0,0),this.card_s2.x=145,this.card_s2.y=130,this.card_s2.scaleX=this.card_s2.scaleY=.6,this.btnBro.addChild(this.card_s2),this.card_s3=this.cardFactory.getOutCard(0,0),this.card_s3.x=145,this.card_s3.y=190,this.card_s3.scaleX=this.card_s3.scaleY=.6,this.btnBro.addChild(this.card_s3)},Object.defineProperty(n.prototype,"cardFactory",{get:function(){return t.CardFactory.getInstance()},enumerable:!0,configurable:!0}),n.prototype.onRule=function(){this.state=!this.state,this.reShowState(this.state)},n.prototype.reShowState=function(t){t?this.allGro.x=0:this.allGro.x=-200},n.prototype.showSwapCard=function(){var e=this;if(this.selectGroup.parent&&this.removeChild(this.selectGroup),this.selectGroup.numChildren>15){this.addChild(this.selectGroup);var n="";return 0==this.curSelcet?n="换牌前":1==this.curSelcet?n="换牌后":2==this.curSelcet&&(n="下一张"),void(this.tipsLabel.text=n)}this.selectGroup.removeChildren();var o=58,r=81,i=9*o,a=3*r;this.selectGroup.width=i,this.selectGroup.height=a,this.selectGroup.x=200,this.selectGroup.y=130;var s=new egret.Sprite;s.graphics.beginFill(0,.5),s.graphics.drawRect(0,0,i,a),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectGroup.parent&&e.removeChild(e.selectGroup)},this),this.selectGroup.addChild(s),this.addChild(this.selectGroup);for(var c,h=0;9>h;h++)c=this.cardFactory.getOutCard(17+h,0),c.x=o*h,c.y=10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);for(var h=0;4>h;h++)c=this.cardFactory.getOutCard(65+h,0),c.x=o*h,c.y=r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);for(var h=4;7>h;h++)c=this.cardFactory.getOutCard(77+h,0),c.x=o*h,c.y=r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);this.tipsLabel=new eui.Label,this.tipsLabel.x=7*o+10,this.tipsLabel.y=r+10+10,this.tipsLabel.textColor=t.App.ArtConfig.getColor(t.ColorConst.white),this.tipsLabel.touchEnabled=!1,this.selectGroup.addChild(this.tipsLabel);var n="";0==this.curSelcet?n="换牌前":1==this.curSelcet?n="换牌后":2==this.curSelcet&&(n="下一张"),this.tipsLabel.text=n;for(var h=0;8>h;h++)c=this.cardFactory.getOutCard(97+h,0),c.x=o*h,c.y=2*r+10,c.scaleX=.8,c.scaleY=.8,c.touchEnabled=!0,this.selectGroup.addChild(c);this.selectGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect,this)},n.prototype.onSelect=function(e){if(e.target instanceof t.Card){var n=e.target;if(0==this.curSelcet)this.selectValue0=n.cardValue,this.card_s0.setCardValueAndShowOut(this.selectValue0),this.selectGroup.parent&&this.removeChild(this.selectGroup);else if(1==this.curSelcet){this.selectValue1=n.cardValue;var o=t.ProtocolDataSend.S_100999;o.user_id=t.App.DataCenter.UserInfo.myUserUid,o.test_type=1;var r={source_card:[],target_card:[]};r.source_card.push(this.selectValue0),r.target_card.push(this.selectValue1),o.test_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,o),console.log("发送换牌:",this.selectValue0,this.selectValue1),this.card_s1.setCardValueAndShowOut(this.selectValue1),this.selectGroup.parent&&this.removeChild(this.selectGroup)}else if(2==this.curSelcet){var i=t.ProtocolDataSend.S_100999;i.user_id=t.App.DataCenter.UserInfo.myUserUid,i.test_type=2;var r={source_card:[],target_card:[]};r.target_card.push(n.cardValue),i.test_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,i),console.log("发送确认下一张牌，牌值",n.cardValue),this.card_s2.setCardValueAndShowOut(n.cardValue),this.selectGroup.parent&&this.removeChild(this.selectGroup)}}},n.prototype.clearSelect=function(){this.selectValue0=0,this.selectValue1=0,this.card_s0.setCardValueAndShowOut(0),this.card_s1.setCardValueAndShowOut(0)},n.prototype.setFanGro=function(t){this.fanGro.visible=t},n.prototype.setFanData=function(){var e=new eui.ArrayCollection,n=[];n.push({cardList:[17,17,18,18,19,19,20,20,21,21,22,22,22,98],hulabel:"补一花"}),n.push({cardList:[17,17,17,18,18,18,18,20,21,21,22,22,97,98],hulabel:"起手杠"}),n.push({cardList:[17,17,17,18,18,18,18,20,20,20,20,22,97,98],hulabel:"起手杠2"}),n.push({cardList:[18,18,18,19,19,19,20,20,20,23,24,25,82,82],hulabel:"三暗刻"}),n.push({cardList:[17,17,17,17,18,19,20,21,22,23,24,25,25,25],hulabel:"九莲宝灯"}),n.push({cardList:[17,18,19,21,21,21,23,23,23,81,81,81,65,65],hulabel:"混一色"}),n.push({cardList:[17,18,19,20,21,22,23,24,25,17,18,19,82,82],hulabel:"清龙"}),n.push({cardList:[19,20,21,20,21,22,21,22,23,20,21,22,82,82],hulabel:"一色三步高"}),n.push({cardList:[17,18,19,17,18,19,17,18,19,20,21,22,82,82],hulabel:"一色三同顺"}),n.push({cardList:[21,21,21,22,22,22,23,23,23,23,24,25,81,81],hulabel:"一色三节高"}),n.push({cardList:[18,19,20,19,20,21,20,21,22,21,22,23,68,68],hulabel:"一色四步高"}),n.push({cardList:[17,17,22,22,23,23,24,24,25,25,66,66,82,82],hulabel:"七对"}),n.push({cardList:[17,18,19,17,18,19,20,21,22,23,24,25,17,17],hulabel:"清一色"}),n.push({cardList:[17,17,17,18,18,18,19,19,19,20,20,20,25,25],hulabel:"一色四同顺"}),n.push({cardList:[17,17,17,25,25,25,67,67,67,83,83,83,65,65],hulabel:"混幺九"}),n.push({cardList:[65,65,65,66,66,66,67,67,67,68,68,23,23,23],hulabel:"小四喜"}),n.push({cardList:[81,81,81,82,82,82,83,83,17,17,17,18,19,20],hulabel:"小三元"}),n.push({cardList:[65,65,65,66,66,66,67,67,67,82,82,82,83,83],hulabel:"字一色"}),n.push({cardList:[17,18,19,17,18,19,21,21,23,24,25,23,24,25],hulabel:"一色双龙会"}),n.push({cardList:[65,65,65,66,66,66,67,67,67,68,68,68,23,23],hulabel:"大四喜"}),n.push({cardList:[81,81,81,82,82,82,83,83,83,17,17,18,19,20],hulabel:"大三元"}),n.push({cardList:[17,17,18,18,19,19,20,20,21,21,22,22,23,23],hulabel:"七连对"}),e.source=n,this.cardList.dataProvider=e,this.cardList.itemRenderer=t.HuTypeItem},n}(t.BaseGameMod);t.GameCheatMod=e,__reflect(e.prototype,"Tpm.GameCheatMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.sendMod=new t.GameCtrlSend(n),n.receiveMod=new t.GameCtrlReceive(n),n}return __extends(n,e),Object.defineProperty(n.prototype,"gameScene",{get:function(){return t.App.SceneManager.getScene(t.SceneConst.GameScene)},enumerable:!0,configurable:!0}),n.prototype.onRegister=function(){this.receiveMod.onRegister()},n.prototype.onRemove=function(){this.receiveMod.onRemove()},n.prototype.sendHeadInfo=function(e){var n=new t.HttpSender,o=t.ProtocolHttp.getHeadInfo;o.uid=t.App.DataCenter.UserInfo.myUserUid,o.param.base.uid=e,n.send(o,this.revHeadInfo,this)},n.prototype.revHeadInfo=function(e){return e.ret?void(e.desc?t.Tips.showTop(e.desc):t.Tips.showTop("获取个人信息失败")):void t.App.PanelManager.open(t.PanelConst.PersonalInfoPanel,!0,null,null,!0,!0,e.data)},n}(t.BaseController);e.NAME="GameController",t.GameController=e,__reflect(e.prototype,"Tpm.GameController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(t){this.gameCtrl=t}return Object.defineProperty(e.prototype,"gameScene",{get:function(){return this.gameCtrl.gameScene},enumerable:!0,configurable:!0}),e.prototype.onRegister=function(){var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100100,this.revReady,this),e.register(t.ProtocolHeadRev.R_100103,this.revExit,this),e.register(t.ProtocolHeadRev.R_101001,this.revAct,this),e.register(t.ProtocolHeadRev.R_101004,this.revDingZhuang,this),e.register(t.ProtocolHeadRev.R_101105,this.revElseExit,this),e.register(t.ProtocolHeadRev.R_101107,this.revUserInto,this),e.register(t.ProtocolHeadRev.R_101109,this.revUserReconnect,this),e.register(t.ProtocolHeadRev.R_101110,this.revUserConnectState,this),e.register(t.ProtocolHeadRev.R_101005,this.revDealCard,this),e.register(t.ProtocolHeadRev.R_101008,this.revDealHua,this),e.register(t.ProtocolHeadRev.R_101002,this.revMoCard,this),e.register(t.ProtocolHeadRev.R_101112,this.revActDo,this),e.register(t.ProtocolHeadRev.R_101007,this.revMoHua,this),e.register(t.ProtocolHeadRev.R_100999,this.revCheat,this),e.register(t.ProtocolHeadRev.R_101003,this.revOver,this),e.register(t.ProtocolHeadRev.R_101006,this.revResult,this)},e.prototype.onRemove=function(){},e.prototype.revReady=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_100100.info;n=e.info,t.App.DataCenter.runingData.gameState=t.GameState.Ready,this.gameScene.readyMod.hideBeginBtn()},e.prototype.revExit=function(e){return 200!=e.code?void t.Tips.showTop("游戏已经开始，无法退出。"):(t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),t.App.DataCenter.UserInfo.clearZhuang(),void t.App.SceneManager.runScene(t.SceneConst.HallScene,t.App.getController(t.HallController.NAME)))},e.prototype.revElseExit=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):(t.App.DataCenter.UserInfo.deleteAllUserExcptMe(),void this.gameScene.headUp.reHeadState(t.UserPosition.Up))},e.prototype.revUserReconnect=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void 0},e.prototype.revUserConnectState=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void e.info.is_offline},e.prototype.revDingZhuang=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101004.info;n=e.info,t.App.DataCenter.UserInfo.clearZhuang(),t.App.DataCenter.UserInfo.getUserBySeatID(n.bank_seat_id).zhuangFlag=!0,n.dice.length>1?this.gameScene.diskMod.setState(t.DiskState.dice,0,n.dice):(this.gameScene.headDown.reZhuangFlag(t.UserPosition.Down),this.gameScene.headUp.reZhuangFlag(t.UserPosition.Up),setTimeout(function(){console.log("deal card"),t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101005)},1100)),t.App.DataCenter.runingData.gameState=t.GameState.DealCard},e.prototype.revUserInto=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101107.info;n=e.info;var o=new t.UserVO;o.initUserFromSocket(n),t.App.DataCenter.UserInfo.addUser(o),this.gameScene.headUp.reHeadState(t.UserPosition.Up),this.gameScene.matchMod.setType(t.MatchType.common)},e.prototype.revDealCard=function(e){t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101005,e,this.exeDealCard,this)},e.prototype.exeDealCard=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101005.info;n=e.info;for(var o=0;o<n.card_list.length;o++)n.card_list[o].seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID&&this.gameScene.cardMod.dealCardShow(n.card_list[o].card_list)},e.prototype.revDealHua=function(e){return 200!=e.code?void t.Tips.showTop(e.desc):void t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101008,e.info,!0)},e.prototype.revAct=function(e){console.log("gameState==",t.App.DataCenter.runingData.gameState),t.App.DataCenter.runingData.gameState==t.GameState.Playing?this.exeAct(e):t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101001,e,this.exeAct,this)},e.prototype.exeAct=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101001.info;n=e.info;var o=t.App.DataCenter.UserInfo.getPosFromSeat(n.seat_id),r=o?t.DiskState.up:t.DiskState.down;if(this.gameScene.diskMod.setState(r,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),console.log("接收动作,seat_id=="+n.seat_id+"----mySeatId=="+t.App.DataCenter.UserInfo.myUserInfo.seatID),n.seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){console.log("动作操作数据：",n),t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101001,n);var i=t.CardLogic.getInstance().getActListFromKey(n.act_info);this.gameScene.selectBtnMod.showActBtn(i)}},e.prototype.revMoCard=function(t){this.exeMoCard(t)},e.prototype.exeMoCard=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101002.info;n=e.info;var o=t.App.DataCenter.UserInfo.getPosFromSeat(n.seat_id);this.gameScene.cardMod.moCardShow(n.card_list[0],o);var r=o?t.DiskState.up:t.DiskState.down;this.gameScene.diskMod.setState(r,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),o==t.UserPosition.Down&&(t.App.DataCenter.runingData.bAllowOutCard=!0),this.gameScene.reResidue(!0,n.remain_count)},e.prototype.revMoHua=function(t){this.exeMoHua(t)},e.prototype.exeMoHua=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101007.info;n=e.info;var o=t.App.DataCenter.UserInfo.getPosFromSeat(n.seat_id);this.gameScene.cardMod.moCardBuHua(o),this.gameScene.flowerMod.setFlowerState(o,1)},e.prototype.revActDo=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101112.info;n=e.info;var o=n.act_type;110==o&&(o=t.ACT_state.Act_Guohu);var r=t.App.DataCenter.UserInfo.getPosFromSeat(n.seat_id),i=n.card_list;this.gameScene.onActDo(o,r,i,n.all_hand_cards)},e.prototype.revCheat=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_100999.info;n=e.info,1==n.test_type?(this.gameScene.cardMod.reCardValue(this.gameScene.cheatMod.selectValue0,this.gameScene.cheatMod.selectValue1),this.gameScene.cheatMod.clearSelect()):3==n.test_type&&this.gameScene.cheatMod.card_s3.setCardValueAndShowOut(n.cards[0])},e.prototype.revOver=function(e){var n=t.ArrayTool.deepCopy(e);t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101003,n,this.exeOver,this),this.exeOver(n)},e.prototype.exeOver=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101003.info;n=t.ArrayTool.deepCopy(e.info);for(var o in n.player_info){var r=t.App.DataCenter.UserInfo.getPosFromSeat(Number(o));this.gameScene.cardMod.huCardShow(r,n.player_info[o].hand_card)}t.App.DataCenter.runingData.gameState=t.GameState.Over,this.gameScene.diskMod.setState(t.DiskState.normal)},e.prototype.revResult=function(e){var n=this;t.App.DataCenter.MsgCache.addMsg(t.ProtocolHeadRev.R_101006,e,this.exeResult,this),setTimeout(function(){n.exeResult(e)},2e3)},e.prototype.exeResult=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ProtocolDataRev.R_101006.info;n=e.info,t.App.PanelManager.open(t.PanelConst.ResultPanel)},e}();t.GameCtrlReceive=e,__reflect(e.prototype,"Tpm.GameCtrlReceive")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(){function e(t){this.gameCtrl=t}return e.prototype.sendExitRoom=function(){var e=t.ProtocolDataSend.S_100103;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100103,e)},e.prototype.sendReady=function(){var e=t.ProtocolDataSend.S_100100;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.ready=1,t.App.gameSocket.send(t.ProtocolHeadSend.S_100100,e)},e.prototype.sendAct=function(e,n){void 0===n&&(n=null),e==t.ACT_state.Act_Guohu&&(e=t.ACT_state.Act_Pass),console.log("发送操作："+e+"  参数："+n);var o=t.ProtocolDataSend.S_100140;o.user_id=t.App.DataCenter.UserInfo.myUserUid,o.act=e;var r={card:0,used_card:[],chu_card:0};switch(e){case t.ACT_state.Act_Out:if(r.card=n[0],console.log("out--selectBtnState-----",t.App.DataCenter.runingData.selectBtnState),t.App.DataCenter.runingData.selectBtnState){var i=t.ArrayTool.deepCopy(t.ProtocolDataSend.S_100140);i.user_id=t.App.DataCenter.UserInfo.myUserUid,i.act=t.ACT_state.Act_Pass,t.App.gameSocket.send(t.ProtocolHeadSend.S_100140,i)}break;case t.ACT_state.Act_Chi:r.used_card=n;break;case t.ACT_state.Act_AnGang:r.used_card.push(n);break;case t.ACT_state.Act_BuGang:r.used_card.push(n);break;case t.ACT_state.Act_Ting:r.chu_card=n[0]}o.act_params=JSON.stringify(r),t.App.gameSocket.send(t.ProtocolHeadSend.S_100140,o)},e.prototype.sendJieSanTest=function(){var e=t.ProtocolDataSend.S_100112;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100112,e)},e.prototype.sendReconnect=function(){var e=t.ProtocolDataSend.S_100010;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100010,e)},e}();t.GameCtrlSend=e,__reflect(e.prototype,"Tpm.GameCtrlSend")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameDbModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.dbAmaureList=this.createDBArmatureList("tpm_NewProject_ske_json","tpm_NewProject_tex_json","tpm_NewProject_tex_png")},n.prototype.onEnable=function(){},n.prototype.onRemove=function(){},n.prototype.showActDb=function(e,n){switch(e){case t.ACT_state.Act_Chi:this.showDB("chi_erren",n);break;case t.ACT_state.Act_Peng:this.showDB("peng_erren",n);break;case t.ACT_state.Act_Gang:this.showDB("gang_erren",n);break;case t.ACT_state.Act_AnGang:this.showDB("gang_erren",n);break;case t.ACT_state.Act_BuGang:this.showDB("gang_erren",n);break;case t.ACT_state.Act_DianHu:this.showDB("hu__erren",n);break;case t.ACT_state.Act_Zimo:this.showDB("hu__erren",n);break;case t.ACT_state.Act_Buhua:this.showDB("BuHua",n);break;case t.ACT_state.Act_Guohu:this.showDB("guohu_erren",n);break;case t.ACT_state.Act_Ting:this.showDB("ting_erren",n);break;default:console.error("act error db")}},n.prototype.showDB=function(t,e){var n=[0,0],o=[170,-250];this.dbAmaureList[e].y=375+o[e],"BuHua"==t?this.dbAmaureList[e].x=667+n[e]+30:this.dbAmaureList[e].x=667+n[e],this.dbAmaureList[e].parent||this.addChild(this.dbAmaureList[e]),this.dbAmaureList[e].animation.play(t,1)},n.prototype.createDBArmatureList=function(t,e,n){var o=new dragonBones.EgretFactory;o.parseDragonBonesData(RES.getRes(t)),o.parseTextureAtlasData(RES.getRes(e),RES.getRes(n));for(var r=[],i=0;2>i;i++){var a=o.buildArmatureDisplay("Armature");r.push(a)}return r},n}(t.BaseUI);t.GameDbMod=e,__reflect(e.prototype,"Tpm.GameDbMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameDiskModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){},o.prototype.onRemove=function(){this.stopTimer()},o.prototype.setState=function(t,e,o){switch(void 0===e&&(e=15),void 0===o&&(o=[]),this.diskState=t,this.diskState){case n.normal:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1;break;case n.down:this.arrowDown.visible=!0,this.arrowUp.visible=!1,this.timeGro.visible=!0,this.diceGro.visible=!1,this.startTimer(e);break;case n.up:this.arrowDown.visible=!1,this.arrowUp.visible=!0,this.timeGro.visible=!0,this.diceGro.visible=!1,this.startTimer(e);break;case n.dice:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1,this.playAnimation(o);default:this.arrowDown.visible=!1,this.arrowUp.visible=!1,this.timeGro.visible=!1,this.diceGro.visible=!1}},o.prototype.startTimer=function(e){void 0===e&&(e=15),this.curTime=e,this.timeLab.text=t.NumberTool.formatTime(this.curTime),this.outTimer&&this.outTimer.stop()&&this.outTimer.removeEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.outTimer=new t.DateTimer(1e3,this.curTime),this.outTimer.addEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.outTimer.reset(),this.outTimer.start()},o.prototype.onOutTime=function(){return Number(this.curTime)<1?(this.timeLab.text="00",void this.stopTimer()):(this.curTime--,void(this.timeLab.text=t.NumberTool.formatTime(this.curTime)))},o.prototype.stopTimer=function(){this.outTimer&&this.outTimer.stop()},o.prototype.initMovieClip=function(){this.mc&&this.mc.parent&&this.mc.parent.removeChild(this.mc);var t="tpm_shaizi",e=RES.getRes(t+"_mc_json"),n=RES.getRes(t+"_tex_png"),o=new egret.MovieClipDataFactory(e,n);this.mc=new egret.MovieClip(o.generateMovieClipData("shaizi")),this.mc.x=99,this.mc.y=94,this.addChild(this.mc)},o.prototype.playAnimation=function(e){var n=this;if(e.length<2)return void console.error("dice number error");var o=4;this.initMovieClip(),this.mc.gotoAndPlay(0,o),this.diceGro.visible=!1,setTimeout(function(){n.mc.stop(),n.mc.parent&&n.mc.parent.removeChild(n.mc),n.diceGro.alpha=1,n.diceGro.scaleX=.6,n.diceGro.scaleY=.6,n.diceGro.visible=!0,n.diceGro.getChildAt(0).texture=RES.getRes("tpm_s"+e[0]+"_png"),n.diceGro.getChildAt(1).texture=RES.getRes("tpm_s"+e[1]+"_png"),n.diceGro.visible=!0,egret.Tween.get(n.diceGro).wait(300).to({scaleX:1,scaleY:1},200).wait(700).to({alpha:0},200).set({visible:!1}).call(function(){n.gameScene.headDown.reZhuangFlag(t.UserPosition.Down),n.gameScene.headUp.reZhuangFlag(t.UserPosition.Up)},n),setTimeout(function(){t.App.DataCenter.MsgCache.exeMsg(t.ProtocolHeadRev.R_101005)},1400)},330*o)},o}(t.BaseGameMod);t.GameDiskMod=e,__reflect(e.prototype,"Tpm.GameDiskMod");var n;!function(t){t[t.normal=0]="normal",t[t.down=1]="down",t[t.up=2]="up",t[t.dice=3]="dice"}(n=t.DiskState||(t.DiskState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameEatChooseModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.initRectList(),this.twoCardList=[[],[]],this.threeCardList=[[],[],[]]},n.prototype.onEnable=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},n.prototype.onRemove=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},n.prototype.initRectList=function(){this.rectList=[];for(var t=0;2>t;t++)this.rectList.push(this.twoGro.getChildAt(t+2));for(var t=0;3>t;t++)this.rectList.push(this.threeGro.getChildAt(t+3))},n.prototype.onChoose=function(t){var e,n=t.target;switch(n){case this.rectList[0]:e=this.tValueList[0];break;case this.rectList[1]:e=this.tValueList[1];break;case this.rectList[2]:e=this.tValueList[0];break;case this.rectList[3]:e=this.tValueList[1];break;case this.rectList[4]:e=this.tValueList[2];break;default:console.error("eat choose error")}return!e||e.length<3?void console.error("eat choose list error"):(console.log("chooseList===",e),this.hideCombo(),void this.dispatchEventWith("selectComboEvent",!1,e))},n.prototype.onCancle=function(){this.hideCombo(),this.gameScene.selectBtnMod.reShow()},n.prototype.showCombo=function(t){if(!t||t.length<2||t[0].length<3)return void console.error("param error");this.tValueList=t,this.twoCardList[0].length<1&&this.initCard();var e,n=3;2==t.length?(this.twoGro.visible=!0,this.threeGro.visible=!1,e=this.twoCardList):3==t.length&&(this.twoGro.visible=!1,this.threeGro.visible=!0,e=this.threeCardList),t.sort(function(t,e){return t[0]-e[0]});for(var o=0;o<t.length;o++)for(var r=0;n>r;r++)t[o].sort(function(t,e){return t-e}),e[o][r].setCardValueAndSHow(t[o][r]);this.visible=!0},n.prototype.hideCombo=function(){this.visible=!1},n.prototype.initCard=function(){for(var e=3,n=60,o=10,r=10,i=.65,a=t.CardFactory.getInstance(),s=0;s<this.twoCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.twoGro.getChildAt(s).addChild(h),h.x=o+n*c,h.y=r,h.scaleX=h.scaleY=i,this.twoCardList[s].push(h)}for(var s=0;s<this.threeCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.threeGro.getChildAt(s).addChild(h),h.x=o+n*c,h.y=r,h.scaleX=h.scaleY=i,this.threeCardList[s].push(h)}},n}(t.BaseGameMod);t.GameEatChooseMod=e,__reflect(e.prototype,"Tpm.GameEatChooseMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameFlowerModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){},n.prototype.onRemove=function(){},n.prototype.initUI=function(){this.downGro.visible=!1,this.upGro.visible=!1,this.upNum=0,this.downNum=0},n.prototype.setFlowerState=function(e,n){1>n||(e==t.UserPosition.Down?(this.downGro.visible=!0,this.downNum+=n,this.flowerLabDown.text="x"+this.downNum):(this.upGro.visible=!0,this.upNum+=n,this.flowerLabUp.text="x"+this.upNum))},n}(t.BaseUI);t.GameFlowerMod=e,__reflect(e.prototype,"Tpm.GameFlowerMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameGangChooseModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.initRectList(),this.twoCardList=[[],[]],this.threeCardList=[[],[],[]]},n.prototype.onEnable=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},n.prototype.onRemove=function(){for(var t=0;t<this.rectList.length;t++)this.rectList[t].removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChoose,this);this.cancleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},n.prototype.initRectList=function(){this.rectList=[];for(var t=0;2>t;t++)this.rectList.push(this.twoGro.getChildAt(t+2));for(var t=0;3>t;t++)this.rectList.push(this.threeGro.getChildAt(t+3))},n.prototype.onChoose=function(t){var e,n=t.target;switch(n){case this.rectList[0]:e=this.tValueList[0];break;case this.rectList[1]:e=this.tValueList[1];break;case this.rectList[2]:e=this.tValueList[0];break;case this.rectList[3]:e=this.tValueList[1];break;case this.rectList[4]:e=this.tValueList[2];break;default:console.error("gang choose error")}(!e||e.length<3)&&console.error("gang choose list error"),console.log("chooseList===",e),this.hideCombo(),this.dispatchEventWith("selectComboEvent",!1,e)},n.prototype.onCancle=function(){this.hideCombo(),this.gameScene.selectBtnMod.reShow()},n.prototype.showCombo=function(t){if(!t||t.length<2||t[0].length<3)return void console.error("param error");this.tValueList=t,this.twoCardList[0].length<1&&this.initCard();var e,n=4;2==t.length?(this.twoGro.visible=!0,this.threeGro.visible=!1,e=this.twoCardList):3==t.length&&(this.twoGro.visible=!1,this.threeGro.visible=!0,e=this.threeCardList);for(var o=0;o<t.length;o++)for(var r=0;n>r;r++)e[o][r].setCardValueAndSHow(t[o][r]);this.visible=!0},n.prototype.hideCombo=function(){this.visible=!1},n.prototype.initCard=function(){for(var e=4,n=60,o=10,r=10,i=.65,a=t.CardFactory.getInstance(),s=0;s<this.twoCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.twoGro.getChildAt(s).addChild(h),h.x=o+n*c,h.y=r,h.scaleX=h.scaleY=i,this.twoCardList[s].push(h)}for(var s=0;s<this.threeCardList.length;s++)for(var c=0;e>c;c++){var h=a.getHandCard(0,t.UserPosition.Down);this.threeGro.getChildAt(s).addChild(h),h.x=o+n*c,h.y=r,h.scaleX=h.scaleY=i,this.threeCardList[s].push(h)}},n}(t.BaseGameMod);t.GameGangChooseMod=e,__reflect(e.prototype,"Tpm.GameGangChooseMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameHeadModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.headImg.mask=this.headMask},n.prototype.onEnable=function(){this.zhuangImg.visible=!1,this.reGoldLab(0)
},n.prototype.onRemove=function(){},n.prototype.reHeadState=function(e){var n=t.App.DataCenter.UserInfo.getUserByPos(e);n?(this.visible=!0,this.reGoldLab(n.gold),this.reZhuangFlag(e)):this.visible=!1},n.prototype.reZhuangFlag=function(e){var n=t.App.DataCenter.UserInfo.getUserByPos(e);n&&n.zhuangFlag?this.zhuangImg.visible=!0:this.zhuangImg.visible=!1},n.prototype.reGoldLab=function(e){this.goldLab.text=t.NumberTool.formatGoldHead(e)},n}(t.BaseUI);t.GameHeadMod=e,__reflect(e.prototype,"Tpm.GameHeadMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.itemWidth=129,t.itemHeight=83,t.frameMaxWidth=536,t.frameMaxHeight=320,t.skinName=TpmSkin.GameHuTipsModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.cancleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancle,this)},n.prototype.onRemove=function(){this.hideTips()},n.prototype.showHuTips=function(e,n){if(this.curValue!=n&&this.curList!=e){this.curList=e,this.curValue=n;var o=e.length;if(1>o)return void console.error("valuelist error");var r=this.frameMaxWidth,i=this.frameMaxHeight;7>o&&o>3?i-=this.itemHeight+6:4>o&&(i-=2*(this.itemHeight+6)),2==o?r-=this.itemWidth:1==o&&(r-=2*this.itemWidth),this.framGro.width=r,this.framGro.height=i,this.validateNow();var a=new eui.ArrayCollection;a.source=e,this.fanList.dataProvider=a,this.fanList.itemRenderer=t.HuTipsItem,this.framGro.visible=!0}},n.prototype.showCancle=function(){this.visible=!0,this.framGro.visible=!1},n.prototype.hideTips=function(){this.curValue=null,this.visible=!1},n.prototype.onCancle=function(){this.hideTips(),this.gameScene.selectBtnMod.reShow(),this.gameScene.cardMod.tingCancleShow()},n}(t.BaseGameMod);t.GameHuTipsMod=e,__reflect(e.prototype,"Tpm.GameHuTipsMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=TpmSkin.GameMatchModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){},e.prototype.onRemove=function(){this.removeCircleTween()},e.prototype.setType=function(t){switch(this.uiType=t,this.removeCircleTween(),this.uiType){case n.common:this.matchGro.visible=!1,this.reMatchGro.visible=!1,this.jieSanGro.visible=!1;break;case n.match:this.matchGro.visible=!0,this.reMatchGro.visible=!1,this.jieSanGro.visible=!1,this.curentCircleImg=this.circleImg,this.circleRound();break;case n.jieSan:this.matchGro.visible=!1,this.reMatchGro.visible=!1,this.jieSanGro.visible=!0,this.curentCircleImg=null;break;case n.reMatch:this.matchGro.visible=!1,this.reMatchGro.visible=!0,this.jieSanGro.visible=!1,this.curentCircleImg=this.circleImgRe,this.circleRound();break;default:console.error("type error")}},e.prototype.circleRound=function(){egret.Tween.get(this.curentCircleImg,{loop:!0}).to({rotation:360},1e3)},e.prototype.removeCircleTween=function(){this.curentCircleImg&&egret.Tween.removeTweens(this.curentCircleImg)},e}(t.BaseUI);t.GameMatchMod=e,__reflect(e.prototype,"Tpm.GameMatchMod");var n;!function(t){t[t.common=0]="common",t[t.match=1]="match",t[t.jieSan=2]="jieSan",t[t.reMatch=3]="reMatch"}(n=t.MatchType||(t.MatchType={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameMenuModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.initUI(),this.gameAddBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this),this.gameRuleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRule,this),this.gameSetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSet,this)},n.prototype.onRemove=function(){},n.prototype.initUI=function(){this.menuState=!1,this.bg.visible=this.menuState,this.addGro.visible=this.menuState},n.prototype.onRule=function(){t.App.PanelManager.open(t.PanelConst.PlayMethodPanel,!0),this.onAdd()},n.prototype.onSet=function(){t.App.PanelManager.open(t.PanelConst.SetPanel,!0),this.onAdd()},n.prototype.onAdd=function(){this.menuState=!this.menuState,this.bg.visible=this.menuState,this.addGro.visible=this.menuState,this.menuState?this.gameAddBtn.rotation=180:this.gameAddBtn.rotation=0},n}(t.BaseUI);t.GameMenuMod=e,__reflect(e.prototype,"Tpm.GameMenuMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.durationTime=2e3,t.skinName=TpmSkin.GameOutShowModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.upGro.visible=!1,this.downGro.visible=!1},n.prototype.onRemove=function(){egret.Tween.removeTweens(this)},n.prototype.showOutCard=function(e,n){t.App.DataCenter.runingData.latelyCardValue=e,this.upCard||this.initCard(),n==t.UserPosition.Down?(this.upGro.visible=!1,this.downGro.visible=!0,this.startHide(this.downGro),this.downCard.setCardValueAndSHow(e)):(this.upGro.visible=!0,this.downGro.visible=!1,this.startHide(this.upGro),this.upCard.setCardValueAndSHow(e))},n.prototype.initCard=function(){var e=20,n=17,o=t.CardFactory.getInstance();this.upCard=o.getHandCard(0,t.UserPosition.Down),this.upGro.addChild(this.upCard),this.upCard.x=e,this.upCard.y=n,this.downCard=o.getHandCard(0,t.UserPosition.Down),this.downGro.addChild(this.downCard),this.downCard.x=e,this.downCard.y=n},n.prototype.startHide=function(t){egret.Tween.get(this).wait(this.durationTime).call(function(){t.visible=!1})},n}(t.BaseUI);t.GameOutShowMod=e,__reflect(e.prototype,"Tpm.GameOutShowMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function o(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameReadyModSkin,t}return __extends(o,e),o.prototype.childrenCreated=function(){},o.prototype.onEnable=function(){this.beginBtn.touchEnabled=!0,this.beginBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegin,this)},o.prototype.onRemove=function(){this.stopTimer(),this.beginBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBegin,this)},o.prototype.setState=function(t,e){switch(void 0===e&&(e=!1),this.readyState=t,this.stopTimer(),this.readyState){case n.normal:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!1;break;case n.ready_00:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!0,this.startTimer();break;case n.ready_10:this.upReady.visible=!0,this.downReady.visible=!1,this.beginBtn.visible=!0,this.startTimer();break;case n.ready_01:this.upReady.visible=!1,this.downReady.visible=!0,this.beginBtn.visible=!1;break;case n.ready_11:this.upReady.visible=!0,this.downReady.visible=!0,this.beginBtn.visible=!1;break;default:this.upReady.visible=!1,this.downReady.visible=!1,this.beginBtn.visible=!1}e&&(this.downReady.visible=!1)},o.prototype.hideBeginBtn=function(){this.beginBtn.visible=!1},o.prototype.onBegin=function(){var t=this;this.beginBtn.touchEnabled=!1,setTimeout(function(){t.beginBtn.touchEnabled=!0},1e3),this.ctrl.sendMod.sendReady(),this.gameScene.clearDesk(!1)},o.prototype.startTimer=function(e){void 0===e&&(e=120),this.remainTime=e,this.backTimer&&this.backTimer.stop()&&this.backTimer.removeEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.backTimer=new t.DateTimer(1e3,e),this.backTimer.addEventListener(egret.TimerEvent.TIMER,this.onOutTime,this),this.backTimer.reset(),this.backTimer.start()},o.prototype.onOutTime=function(){return this.remainTime<1?void this.stopTimer():void this.remainTime--},o.prototype.stopTimer=function(){this.backTimer&&this.backTimer.stop()},o}(t.BaseGameMod);t.GameReadyMod=e,__reflect(e.prototype,"Tpm.GameReadyMod");var n;!function(t){t[t.normal=0]="normal",t[t.ready_00=1]="ready_00",t[t.ready_10=2]="ready_10",t[t.ready_01=3]="ready_01",t[t.ready_11=4]="ready_11"}(n=t.ReadyState||(t.ReadyState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.GameSceneSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.ctrl.onRegister(),this.initUI(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.hallBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onExit,this),this.selectBtnMod.addEventListener("sendActEvent",this.onActBtnTouch,this),this.headDown.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this),this.headUp.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this)},n.prototype.onRemove=function(){this.ctrl.onRemove(),this.clearDesk()},n.prototype.initUI=function(e){void 0===e&&(e=!0),this.reResidue(!1),this.diskMod.setState(t.DiskState.normal),this.flowerMod.initUI(),this.selectBtnMod.hide(),this.matchMod.setType(t.MatchType.common),this.tuoMod.setState(!1),this.eatChooseMod.hideCombo(),this.gangChooseMod.hideCombo(),this.huTipsMod.hideTips(),this.outShowMod.visible=!0,this.tingDown.setState(t.TingState.normal),this.tingUp.setState(t.TingState.normal),e&&(this.reDeskDesc(t.RoomType.noob),this.readyMod.setState(t.ReadyState.normal)),t.App.DataCenter.debugInfo.testState&&(this.cheatMod.visible=!0)},n.prototype.clearDesk=function(e){void 0===e&&(e=!0),this.cardMod.clearCardMovieGro(),this.cardMod.clearAllCard(),t.App.DataCenter.runingData.clearData(e),this.initUI(e)},n.prototype.intoRoom=function(){this.headDown.reHeadState(t.UserPosition.Down),this.headUp.reHeadState(t.UserPosition.Up),t.App.DataCenter.UserInfo.getUserNum()<2?this.matchMod.setType(t.MatchType.match):this.matchMod.setType(t.MatchType.common),t.App.DataCenter.debugInfo.autoReady?this.ctrl.sendMod.sendReady():(this.readyMod.visible=!0,this.readyMod.setState(t.ReadyState.ready_00)),this.reDeskDesc(t.App.DataCenter.runingData.curentRoomType)},n.prototype.reConnect=function(e){console.log("scene reConnect");var n=t.ProtocolDataRev.R_100010;n=e,t.App.DataCenter.runingData.gameState=t.GameState.Playing;for(var o=n.info.user_info,r=0;r<o.length;r++)if(o[r].user_id==t.App.DataCenter.UserInfo.myUserUid)t.App.DataCenter.UserInfo.myUserInfo.seatID=o[r].seat_id,t.App.DataCenter.UserInfo.myUserInfo.gold=o[r].point;else{var i=new t.UserVO;i.initUserFromSocket(o[r]),t.App.DataCenter.UserInfo.addUser(i)}var a=n.info.game_data.desk_info;t.App.DataCenter.runingData.curentRoomType=a.room_type,a.remain_count&&this.reResidue(!0,a.remain_count),this.reDeskDesc(t.App.DataCenter.runingData.curentRoomType);var s=n.info.game_data.player_info;this.headDown.reHeadState(t.UserPosition.Down),this.headUp.reHeadState(t.UserPosition.Up);var c=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Down),h=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Up);this.flowerMod.setFlowerState(t.UserPosition.Down,s[c].bu_hua_num),this.flowerMod.setFlowerState(t.UserPosition.Up,s[h].bu_hua_num),this.setTingState(s);var p=Math.floor(n.info.game_data.wait_task.end_time),d=n.info.game_data.player_info;if(d[c].hand_card_by_order[d[c].hand_card_by_order.length-2].length%3==2?(this.diskMod.setState(t.DiskState.down,p),t.App.DataCenter.runingData.bAllowOutCard=!0):d[h].hand_card_by_order[d[h].hand_card_by_order.length-2].length%3==2?this.diskMod.setState(t.DiskState.up,p||t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime):this.diskMod.setState(t.DiskState.up,p||t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),this.cardMod.reConnectCardShow(t.UserPosition.Down,n.info.game_data.player_info[c].hand_card_by_order,n.info.game_data.player_info[c].last_card,n.info.game_data.player_info[c].out_card),this.cardMod.reConnectCardShow(t.UserPosition.Up,n.info.game_data.player_info[h].hand_card_by_order,n.info.game_data.player_info[h].last_card,n.info.game_data.player_info[h].out_card),n.info.game_data.wait_task.params){var l=n.info.game_data.wait_task.params,u=t.App.DataCenter.UserInfo.getPosFromSeat(l.seat_id),g=u?t.DiskState.up:t.DiskState.down;if(this.diskMod.setState(g,p),l.seat_id==t.App.DataCenter.UserInfo.myUserInfo.seatID){console.log("动作操作数据：",l),t.App.DataCenter.MsgCache.addMsgData(t.ProtocolHeadRev.R_101001,l);var m=t.CardLogic.getInstance().getActListFromKey(l.act_info);this.selectBtnMod.showActBtn(m)}}},n.prototype.setTingState=function(e){var n=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Down),o=t.App.DataCenter.UserInfo.getSeatFromPos(t.UserPosition.Up),r=t.TingState.normal;e[n].is_ting&&(t.App.DataCenter.runingData.ownTingState=!0,r=e[n].guo_hu_num>0?t.TingState.guo:t.TingState.ting),r!=t.TingState.normal&&(t.App.DataCenter.runingData.ownTingState=!0),this.tingDown.setState(r,e[n].guo_hu_num),t.App.DataCenter.runingData.ownGuoTimes=e[n].guo_hu_num;var i=t.TingState.normal;e[o].is_ting&&(i=e[o].guo_hu_num>0?t.TingState.guo:t.TingState.ting),this.tingUp.setState(i,e[o].guo_hu_num)},n.prototype.reDeskDesc=function(e){var n=t.App.DataCenter.roomInfo.getConfigForType(e);return n?void(this.descLab.text=n.roomName+" "+n.minHuFan+"番起胡 底分"+n.baseBet):void console.error("roomInfo error")},n.prototype.reResidue=function(t,e){void 0===e&&(e=0),this.residueGro.visible=t,this.residueLab.text=e.toString()},n.prototype.onExit=function(){this.ctrl.sendMod.sendExitRoom()},n.prototype.onHead=function(e){var n=0;e.target==this.headDown?n=t.App.DataCenter.UserInfo.myUserUid:e.target==this.headUp&&(n=t.App.DataCenter.UserInfo.getUserByPos(t.UserPosition.Up).userID),this.ctrl.sendHeadInfo(n)},n.prototype.onTouchTap=function(t){},n.prototype.onActBtnTouch=function(e){var n=this;this.selectBtnMod.hide();var o=e.data;console.log("按钮动作==",o);switch(o){case t.ACT_state.Act_Chi:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);1==r.act_info[t.ACT_state.Act_Chi].length?this.ctrl.sendMod.sendAct(o,r.act_info[t.ACT_state.Act_Chi][0]):r.act_info[t.ACT_state.Act_Chi].length>1?(this.eatChooseMod.showCombo(r.act_info[t.ACT_state.Act_Chi]),this.eatChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedEatList==",t.data),n.ctrl.sendMod.sendAct(o,t.data)},this)):console.error("eat combo error");break;case t.ACT_state.Act_AnGang:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);if(1==r.act_info[t.ACT_state.Act_AnGang].length)this.ctrl.sendMod.sendAct(o,r.act_info[t.ACT_state.Act_AnGang][0]);else if(r.act_info[t.ACT_state.Act_AnGang].length>1){for(var i=[],a=0;a<r.act_info[t.ACT_state.Act_AnGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedAGangList==",t.data),n.ctrl.sendMod.sendAct(o,t.data[0])},this)}else console.error("angang combo error");break;case t.ACT_state.Act_BuGang:var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1);if(1==r.act_info[t.ACT_state.Act_BuGang].length)this.ctrl.sendMod.sendAct(o,r.act_info[t.ACT_state.Act_BuGang][0]);else if(r.act_info[t.ACT_state.Act_BuGang].length>1){for(var i=[],a=0;a<r.act_info[t.ACT_state.Act_BuGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(t){console.log("choosedBGangList==",t.data),n.ctrl.sendMod.sendAct(o,t.data[0])},this)}else console.error("bugang combo error");break;case t.ACT_state.Act_ZuheGang:for(var r=t.App.DataCenter.MsgCache.getMsgData(t.ProtocolHeadRev.R_101001,!1),i=[],a=0;a<r.act_info[t.ACT_state.Act_AnGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),s.push(r.act_info[t.ACT_state.Act_AnGang][a]),i.push(s)}for(var a=0;a<r.act_info[t.ACT_state.Act_BuGang].length;a++){var s=[];s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),s.push(r.act_info[t.ACT_state.Act_BuGang][a]),i.push(s)}this.gangChooseMod.showCombo(i),this.gangChooseMod.addEventListener("selectComboEvent",function(e){console.log("choosedZuheGangList==",e.data),e.data[0]==r.act_info[t.ACT_state.Act_BuGang][0][0]?n.ctrl.sendMod.sendAct(t.ACT_state.Act_BuGang,e.data[0]):n.ctrl.sendMod.sendAct(t.ACT_state.Act_AnGang,e.data[0])},this);break;case t.ACT_state.Act_Ting:t.App.DataCenter.runingData.bAllowOutCard=!0,this.huTipsMod.showCancle(),this.cardMod.tingCardShow();break;case t.ACT_state.Act_Guohu:this.ctrl.sendMod.sendAct(t.ACT_state.Act_Pass);break;default:this.ctrl.sendMod.sendAct(o)}},n.prototype.allowOutCardJudge=function(e,n){if(n==t.UserPosition.Down){var o=[t.ACT_state.Act_Chi,t.ACT_state.Act_Peng,t.ACT_state.Act_Gang,t.ACT_state.Act_AnGang,t.ACT_state.Act_BuGang];o.indexOf(e)>=0&&(t.App.DataCenter.runingData.bAllowOutCard=!0)}},n.prototype.onActDo=function(e,n,o,r){switch(console.log("处理动作：",e),e==t.ACT_state.Act_Out?this.outShowMod.showOutCard(o[0],n):this.dbMod.showActDb(e,n),this.allowOutCardJudge(e,n),e){case t.ACT_state.Act_Pass:break;case t.ACT_state.Act_Out:n==t.UserPosition.Down&&(t.App.DataCenter.runingData.bAllowOutCard=!1);var i=n?t.DiskState.down:t.DiskState.up;this.diskMod.setState(i,t.App.DataCenter.roomInfo.getConfigForType(t.App.DataCenter.runingData.curentRoomType).outCardTime),console.log("out card===",o[0]),this.cardMod.outCardShow(n,o[0]);break;case t.ACT_state.Act_Chi:this.cardMod.eatCardShow(o,n);break;case t.ACT_state.Act_Peng:o.push(o[0]),o.push(o[0]),this.cardMod.eatCardShow(o,n,!0);break;case t.ACT_state.Act_AnGang:this.cardMod.gangCardShow(e,o[0],n);break;case t.ACT_state.Act_BuGang:this.cardMod.gangCardShow(e,o[0],n);break;case t.ACT_state.Act_Gang:this.cardMod.gangCardShow(e,o[0],n);break;case t.ACT_state.Act_Ting:n==t.UserPosition.Down?(t.App.DataCenter.runingData.ownTingState=!0,this.huTipsMod.hideTips(),this.cardMod.tingDidShow(r),this.tingDown.setState(t.TingState.ting)):this.tingUp.setState(t.TingState.ting);break;case t.ACT_state.Act_DianHu:this.selectBtnMod.hide(),this.cardMod.dianHuCardShow(o[0],n);break;case t.ACT_state.Act_Guohu:this.selectBtnMod.hide(),n==t.UserPosition.Down?(this.tingDown.setState(t.TingState.guo,1,!0),t.App.DataCenter.runingData.ownGuoTimes++):this.tingUp.setState(t.TingState.guo,1,!0)}},n}(t.BaseScene);t.GameScene=e,__reflect(e.prototype,"Tpm.GameScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.btnList={},t.btnListTouch={},t.vectorWidth=1126,t.itemWidth=150,t.bInitRes=!1,t.skinName=TpmSkin.GameSelectBtnModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.btnList[t.ACT_state.Act_Pass]=this.passBtn,this.btnList[t.ACT_state.Act_Peng]=this.pengBtn,this.btnList[t.ACT_state.Act_Chi]=this.eatBtn,this.btnList[t.ACT_state.Act_Gang]=this.gangBtn,this.btnList[t.ACT_state.Act_BuGang]=this.gangBtn,this.btnList[t.ACT_state.Act_AnGang]=this.gangBtn,this.btnList[t.ACT_state.Act_DianHu]=this.huBtn,this.btnList[t.ACT_state.Act_Zimo]=this.huBtn,this.btnList[t.ACT_state.Act_Guohu]=this.guoHuBtn,this.btnList[t.ACT_state.Act_Cancle]=this.cancleBtn,this.btnList[t.ACT_state.Act_Ting]=this.tingBtn,this.btnListTouch[t.ACT_state.Act_Pass]=this.passBtn0,this.btnListTouch[t.ACT_state.Act_Peng]=this.pengBtn0,this.btnListTouch[t.ACT_state.Act_Chi]=this.eatBtn0,this.btnListTouch[t.ACT_state.Act_Gang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_BuGang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_AnGang]=this.gangBtn0,this.btnListTouch[t.ACT_state.Act_DianHu]=this.huBtn0,this.btnListTouch[t.ACT_state.Act_Zimo]=this.huBtn0,this.btnListTouch[t.ACT_state.Act_Guohu]=this.guoHuBtn0,this.btnListTouch[t.ACT_state.Act_Cancle]=this.cancleBtn0,this.btnListTouch[t.ACT_state.Act_Ting]=this.tingBtn0,this.touchEnabled=!1},n.prototype.initRes=function(){0==this.bInitRes&&(this.bInitRes=!0,this.passBtn.setNewActSkin(t.ACT_act.Act_Pass),this.eatBtn.setNewActSkin(t.ACT_act.Act_Chi),this.pengBtn.setNewActSkin(t.ACT_act.Act_Peng),this.gangBtn.setNewActSkin(t.ACT_act.Act_Gang),this.huBtn.setNewActSkin(t.ACT_act.Act_Hu),this.guoHuBtn.setNewActSkin(t.ACT_act.Act_Guohu),this.cancleBtn.setNewActSkin(t.ACT_act.Act_cancle),this.tingBtn.setNewActSkin(t.ACT_act.Act_Ting),this.passBtn0.setSortWeight(t.ACT_act.Act_Pass),this.eatBtn0.setSortWeight(t.ACT_act.Act_Chi),this.pengBtn0.setSortWeight(t.ACT_act.Act_Peng),this.gangBtn0.setSortWeight(t.ACT_act.Act_Gang),this.huBtn0.setSortWeight(t.ACT_act.Act_Hu),this.guoHuBtn0.setSortWeight(t.ACT_act.Act_Guohu),this.cancleBtn0.setSortWeight(t.ACT_act.Act_cancle),this.tingBtn0.setSortWeight(t.ACT_act.Act_Ting))},n.prototype.onTouch=function(e){for(var n in this.btnListTouch)if(this.btnListTouch[n]==e.parent){this.btnListTouch[n]==this.gangBtn0?this.keyIn(t.ACT_state.Act_AnGang)&&this.keyIn(t.ACT_state.Act_BuGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_ZuheGang):this.keyIn(t.ACT_state.Act_AnGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_AnGang):this.keyIn(t.ACT_state.Act_BuGang)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_BuGang):this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_Gang):this.btnListTouch[n]==this.huBtn0?this.keyIn(t.ACT_state.Act_DianHu)&&!this.keyIn(t.ACT_state.Act_Zimo)?this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_DianHu):!this.keyIn(t.ACT_state.Act_DianHu)&&this.keyIn(t.ACT_state.Act_Zimo)&&this.dispatchEventWith("sendActEvent",!1,t.ACT_state.Act_Zimo):this.dispatchEventWith("sendActEvent",!1,parseInt(n));break}},n.prototype.keyIn=function(t){for(var e=0;e<this.actList.length;e++)if(t==this.actList[e])return!0;return!1},n.prototype.showActBtn=function(e){if(console.log("btnlit===",e),this.actList=t.ArrayTool.deepCopy(e),(this.keyIn(t.ACT_state.Act_DianHu)||this.keyIn(t.ACT_state.Act_Zimo))&&t.App.DataCenter.runingData.guoHuFlag&&t.App.DataCenter.runingData.ownTingState)for(var n=0;n<this.actList.length;n++)if(this.actList[n]==t.ACT_state.Act_Pass){this.actList[n]=t.ACT_state.Act_Guohu,this.setTipsState(!0);break}this.initRes();var o=this.actList.length;this.showBtnList=[],this.touchBtnList=[];for(var n=o-1;n>=0;n--){var r=this.actList[n],i=this.btnList[r],a=this.btnListTouch[r];null!=i?this.btnAdded(i)?console.log("重复按钮"):(this.showBtnList.push(i),this.touchBtnList.push(a)):console.error("缺少动作操作按钮:",r)}for(var s in this.btnList)this.btnList[s].visible=!1;for(var s in this.btnListTouch)this.btnListTouch[s].visible=!1;for(var n=0;n<this.showBtnList.length;n++)this.showBtnList[n].visible=!0,this.showBtnList[n].playAnim(),this.touchBtnList[n].visible=!0;this.showBtnList.sort(function(t,e){return t.sortWeight-e.sortWeight}),this.touchBtnList.sort(function(t,e){return t.sortWeight-e.sortWeight});for(var c=this.showBtnList.length,h=this.vectorWidth-o*this.itemWidth,p=0,n=c-1;n>=0;n--){var d=this.showBtnList[n],l=this.touchBtnList[n];l.x=d.x=h+this.itemWidth*n+p}(this.actList.length>1||this.actList[0]!=t.ACT_state.Act_Out&&1==this.actList.length)&&this.show()},n.prototype.btnAdded=function(t){for(var e=0;e<this.showBtnList.length;e++)if(this.showBtnList[e]==t)return!0;return!1},n.prototype.show=function(){this.visible=!0,t.App.DataCenter.runingData.selectBtnState=!0},n.prototype.hide=function(){for(var e in this.btnList)this.btnList[e].stopAnim();this.visible=!1,t.App.DataCenter.runingData.selectBtnState=!1,this.setTipsState(!1)},n.prototype.reShow=function(){for(var e=0;e<this.showBtnList.length;e++)this.showBtnList[e].visible=!0,this.showBtnList[e].playAnim();(this.keyIn(t.ACT_state.Act_DianHu)||this.keyIn(t.ACT_state.Act_Zimo))&&(t.App.DataCenter.runingData.bAllowOutCard=!1),this.show()},n.prototype.setTipsState=function(e){if(this.tipsGro.visible=e,e){var n=t.App.DataCenter.runingData.ownGuoTimes+1;this.tipsLab.text="过胡"+n+"次，金币x"+Math.pow(2,n)}},n}(eui.Component);t.GameSelectBtnMod=e,__reflect(e.prototype,"Tpm.GameSelectBtnMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=TpmSkin.GameTingModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){this.setState(n.normal)},e.prototype.onRemove=function(){},e.prototype.setState=function(t,e,o){switch(void 0===e&&(e=1),void 0===o&&(o=!1),this.tingState=t,this.tingState){case n.normal:this.tingImg.visible=!1,this.guoGro.visible=!1,this.timesLab.text="0";break;case n.guo:this.tingImg.visible=!1,this.guoGro.visible=!0,o?this.timesLab.text=Number(this.timesLab.text)+e+"":this.timesLab.text=e.toString();break;case n.ting:this.tingImg.visible=!0,this.guoGro.visible=!1;break;default:this.tingImg.visible=!1,this.guoGro.visible=!1}},e}(t.BaseUI);t.GameTingMod=e,__reflect(e.prototype,"Tpm.GameTingMod");var n;!function(t){t[t.normal=0]="normal",t[t.ting=1]="ting",t[t.guo=2]="guo"}(n=t.TingState||(t.TingState={}))}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.tuoGuanState=!1,e.skinName=TpmSkin.GameTuogModSkin,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.onEnable=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onRemove=function(){},e.prototype.setState=function(t){this.tuoGuanState=t,this.visible=this.tuoGuanState},e.prototype.onTouch=function(){},e}(t.BaseUI);t.GameTuogMod=e,__reflect(e.prototype,"Tpm.GameTuogMod")}(Tpm||(Tpm={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function o(o){e.call(n,o,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?o(r):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Tpm;!function(t){var e=function(){function t(){}return t}();e.outCardPosXList=[230,1031],e.outCardPosYList=[536,127],e.outCardGapList=[50,46],e.handCardPosXList=[70,270],e.handCardPosYlist=[624,19],e.handCardGapList=[82,63],e.eatCardPosYList=[647,23],e.eatCardGapList=[73,60],e.eatCardOffset=[0,9],e.gangFourOffsetY=[-22,-19],e.angFourOffsetY=[-21,-18],e.moCardPosXList=[1179,185],e.moCardOffsetY=[-50,-19],e.huCardOffsetX=[30,-9],t.CardPos=e,__reflect(e.prototype,"Tpm.CardPos")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.HuTipsItemSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.posImg.visible=!1},n.prototype.dataChanged=function(){this.itemCard&&this.itemCard.parent&&this.removeChild(this.itemCard);var e=t.CardFactory.getInstance();this.itemCard=e.getHandCard(this.data.outCardValue,t.UserPosition.Down),this.itemCard.scaleX=this.itemCard.scaleY=.6,this.itemCard.x=8,this.itemCard.y=5,this.addChild(this.itemCard),this.fanLab.text=this.data.fanNum+"",this.sheetLab.text=this.data.residueNum+""},n}(eui.ItemRenderer);t.HuTipsItem=e,__reflect(e.prototype,"Tpm.HuTipsItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.cardList=[],t.skinName=TpmSkin.huTypeItemSkin,t.touchEnabled=!0,t}return __extends(n,e),n.prototype.dataChanged=function(){this.cardList=this.data.cardList,this.huLabel.text=this.data.hulabel,this.setCardList(this.cardList)},n.prototype.childrenCreated=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},n.prototype.onTouch=function(){var e=t.ProtocolDataSend.S_100999;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.test_type=4;var n={source_card:[],target_card:[]};n.target_card=this.cardList,e.test_params=JSON.stringify(n),t.App.gameSocket.send(t.ProtocolHeadSend.S_100999,e),t.Tips.showTop("发送成功"),t.App.SceneManager.getScene(t.SceneConst.GameScene).cheatMod.setFanGro(!1)},n.prototype.setCardList=function(e){for(var n,o=e.length,r=t.CardFactory.getInstance(),i=0;o>i;i++)n=r.getOutCard(e[i],t.UserPosition.Up),n.x=46*i,n.y=0,this.cardListGroup.addChild(n)},n}(eui.ItemRenderer);t.HuTypeItem=e,__reflect(e.prototype,"Tpm.HuTypeItem")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.resList=[],t.bInitRes=!1,t.skinName=TpmSkin.SelectActBtnSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.dbAmature=this.createDBArmature("tpm_NewProject_ske_json","tpm_NewProject_tex_json","tpm_NewProject_tex_png"),this.touchRect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},n.prototype.onTouch=function(){console.log("touch rect"),t.App.SceneManager.getScene(t.SceneConst.GameScene).selectBtnMod.onTouch(this.touchRect)},Object.defineProperty(n.prototype,"sortWeight",{get:function(){return this._sortWeight},enumerable:!0,configurable:!0}),n.prototype.initRes=function(){if(0==this.bInitRes){this.bInitRes=!0;var e="annui_";this.resList[t.ACT_act.Act_Pass]="actBtnGuo",this.resList[t.ACT_act.Act_Chi]=e+"chi_erren",this.resList[t.ACT_act.Act_Peng]=e+"peng_erren",this.resList[t.ACT_act.Act_Gang]=e+"gang_erren",this.resList[t.ACT_act.Act_AnGang]=e+"gang_erren",this.resList[t.ACT_act.Act_Hu]=e+"hu_erren",this.resList[t.ACT_act.Act_Guohu]=e+"guohujiabei_erren",this.resList[t.ACT_act.Act_cancle]="actBtnCancle",this.resList[t.ACT_act.Act_Ting]=e+"ting_erren"}},n.prototype.setNewActSkin=function(e){this.initRes();var n=this.resList[e];this.dbKey=e,e==t.ACT_act.Act_Pass||e==t.ACT_act.Act_cancle?(this.img=new eui.Image("tpm_"+n+"_png"),this.img.x=19,this.img.y=19,this.btnGro.addChild(this.img)):(this.dbName=n,this.dbAmature.x=75,this.dbAmature.y=75,this.dbAmature.touchEnabled=!1,this.btnGro.addChild(this.dbAmature)),this.setSortWeight(e)},n.prototype.setSortWeight=function(e){var n=0;switch(e){case t.ACT_act.Act_Chi:n=10;break;case t.ACT_act.Act_Peng:n=20;break;case t.ACT_act.Act_Gang:n=30;break;case t.ACT_act.Act_AnGang:n=40;break;case t.ACT_act.Act_Hu:n=50;break;case t.ACT_act.Act_Ting:n=55;break;case t.ACT_act.Act_Guohu:n=60;break;case t.ACT_act.Act_Pass:n=70;break;case t.ACT_act.Act_cancle:n=80}this._sortWeight=n},n.prototype.playAnim=function(){this.dbName&&this.dbAmature.animation&&this.dbAmature.animation.play(this.dbName,0)},n.prototype.stopAnim=function(){this.dbName&&this.dbAmature.animation&&this.dbAmature.animation.stop()},n.prototype.createDBArmature=function(t,e,n){var o=new dragonBones.EgretFactory;o.parseDragonBonesData(RES.getRes(t)),o.parseTextureAtlasData(RES.getRes(e),RES.getRes(n));var r=o.buildArmatureDisplay("Armature");return r},n}(eui.Component);t.SelectActBtn=e,__reflect(e.prototype,"Tpm.SelectActBtn")}(Tpm||(Tpm={}));var Tpm;!function(t){var e;!function(t){t[t.playMethod=0]="playMethod",t[t.email=1]="email",t[t.share=2]="share",t[t.shop=3]="shop",t[t.set=4]="set"}(e=t.HallBtnMsg||(t.HallBtnMsg={}));var n=function(t){function n(){var e=t.call(this)||this;return e.skinName=TpmSkin.HallBtnModSkin,e}return __extends(n,t),n.prototype.childrenCreated=function(){},n.prototype.onEnable=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},n.prototype.onRemove=function(){},n.prototype.onTouch=function(t){if(!this.listener)return void console.error("按钮未设置监听");var n,o=t.target;switch(o){case this.hall_playMethod:n=e.playMethod;break;case this.hall_email:n=e.email;break;case this.hall_share:n=e.share;break;case this.hall_shop:n=e.shop;break;case this.hall_set:n=e.set}(n||0==n)&&this.listener(n)},n}(t.BaseUI);t.HallBtnMod=n,__reflect(n.prototype,"Tpm.HallBtnMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),Object.defineProperty(n.prototype,"hallScene",{get:function(){return t.App.SceneManager.getScene(t.SceneConst.HallScene)},enumerable:!0,configurable:!0}),n.prototype.onRegister=function(){var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100104,this.revQuickBegin,this),e.register(t.ProtocolHeadRev.R_100105,this.revQuickBegin,this)},n.prototype.onRemove=function(){},n.prototype.sendChooseRoom=function(e){var n=t.ProtocolDataSend.S_100105;
n.user_id=t.App.DataCenter.UserInfo.myUserUid,n.room_type=e,t.App.gameSocket.send(t.ProtocolHeadSend.S_100105,n)},n.prototype.sendQuickBegin=function(){var e=t.ProtocolDataSend.S_100104;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100104,e)},n.prototype.revQuickBegin=function(e){if(200==e.code){var n=t.ProtocolDataRev.R_100104;n=e,t.App.DataCenter.runingData.curentRoomType=n.info.room_type;for(var o in n.info.seat_info)if(n.info.seat_info[o].user_id==t.App.DataCenter.UserInfo.myUserUid)t.App.DataCenter.UserInfo.myUserInfo.seatID=n.info.seat_info[o].seat_id,t.App.DataCenter.UserInfo.myUserInfo.gold=n.info.seat_info[o].point;else{var r=new t.UserVO;r.initUserFromSocket(n.info.seat_info[o]),t.App.DataCenter.UserInfo.addUser(r)}var i=t.App.SceneManager.runScene(t.SceneConst.GameScene,t.App.getController(t.GameController.NAME));i.intoRoom()}else t.Tips.showTop(e.desc)},n.prototype.sendJieSanTest=function(){var e=t.ProtocolDataSend.S_100112;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100112,e)},n.prototype.sendRoomNum=function(){var e=new t.HttpSender,n=t.ProtocolHttp.getRoomNum;e.sendTest(n,this.revRoomNum,this)},n.prototype.revRoomNum=function(e){return e.ret?void(e.desc?t.Tips.showTop(e.desc):t.Tips.showTop("获取房间人数失败")):(t.App.DataCenter.roomInfo.reRoomNum(e.data.room_people_count),void this.hallScene.roomMod.reRoomNum(t.App.DataCenter.roomInfo.roomList))},n}(t.BaseController);e.NAME="HallController",t.HallController=e,__reflect(e.prototype,"Tpm.HallController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallHeadModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.headImg.mask=this.headMask},n.prototype.onEnable=function(){this.setDiamondVisible(),this.headGro.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPersonalInfo,this),this.arrowGro.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onArrow,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this)},n.prototype.onRemove=function(){this.headGro.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.showPersonalInfo,this),this.arrowGro.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onArrow,this),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAdd,this)},n.prototype.setDiamondVisible=function(t){void 0===t&&(t=!1),t?(this.arrowGro.visible=!1,this.diamondGro.visible=!0):(this.arrowGro.visible=!0,this.diamondGro.visible=!1)},Object.defineProperty(n.prototype,"arrowGroup",{get:function(){return this.arrowGro},enumerable:!0,configurable:!0}),n.prototype.onArrow=function(){var e=this;this.setDiamondVisible(!0),this.timeOut=setTimeout(function(){e.setDiamondVisible(!1),clearTimeout(e.timeOut)},3e3,this),t.HallHttpDataSend.sendGetDiamondAndGold()},n.prototype.showPersonalInfo=function(){t.HallHttpDataSend.sendGetUserInfo()},n.prototype.onAdd=function(){t.HallHttpDataSend.sendGetGoodsList()},n.prototype.updateDiamondAndGold=function(e,n){this.diamondLab.text=e+"",this.goldLab.text=t.NumberTool.formatMoney(n)},n.prototype.updatePersonalInfo=function(){this.nameLab.text=t.StringTool.formatNickName(t.App.DataCenter.UserInfo.myUserInfo.nickName,12),this.idLab.text="ID:"+t.App.DataCenter.UserInfo.myUserInfo.userID,this.diamondLab.text=t.App.DataCenter.UserInfo.myUserInfo.diamond+"",this.goldLab.text=t.NumberTool.formatMoney(t.App.DataCenter.UserInfo.myUserInfo.gold),this.headImg.source=t.App.DataCenter.UserInfo.myUserInfo.headUrl},n}(t.BaseUI);t.HallHeadMod=e,__reflect(e.prototype,"Tpm.HallHeadMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallRoomModSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){this.initList()},n.prototype.onEnable=function(){this.lowBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.middleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.highBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},n.prototype.onRemove=function(){this.lowBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.middleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.highBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},n.prototype.initList=function(){this.betLabList=[],this.minGoldLabList=[],this.playerLabList=[],this.betLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("baseLab")),this.betLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("baseLabM")),this.betLabList.push(this.highBtn.getChildByName("highGro").getChildByName("baseLabH")),this.minGoldLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("mininumLab")),this.minGoldLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("mininumLabM")),this.minGoldLabList.push(this.highBtn.getChildByName("highGro").getChildByName("mininumLabH")),this.playerLabList.push(this.lowBtn.getChildByName("lowGro").getChildByName("playLab")),this.playerLabList.push(this.middleBtn.getChildByName("middleGro").getChildByName("playLabM")),this.playerLabList.push(this.highBtn.getChildByName("highGro").getChildByName("playLabH"))},n.prototype.initRoomUI=function(e){for(var n=0;n<e.length;n++)this.betLabList[n].text=e[n].baseBet+"",this.minGoldLabList[n].text=t.NumberTool.formatMoney(e[n].minEnterGold,2)+"金币以上",this.playerLabList[n].text=e[n].curPlayerCount+"人在玩"},n.prototype.reRoomNum=function(t){for(var e=0;e<t.length;e++)this.playerLabList[e].text=t[e].curPlayerCount+"人在玩"},n.prototype.onTouch=function(e){var n,o=e.target;switch(o){case this.lowBtn:n=t.RoomType.noob;break;case this.middleBtn:n=t.RoomType.middle;break;case this.highBtn:n=t.RoomType.high;break;default:n=t.RoomType.noob}t.App.getController(t.HallController.NAME).sendChooseRoom(n)},n}(t.BaseUI);t.HallRoomMod=e,__reflect(e.prototype,"Tpm.HallRoomMod")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName=TpmSkin.HallSceneSkin,t}return __extends(n,e),n.prototype.childrenCreated=function(){var t=this;this.btnMod.listener=function(e){t.onTouchBottomBtn(e)}},n.prototype.onEnable=function(){this.hallQuickBtn.touchEnabled=!0,this.ctrl.onRegister(),this.playQuick(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.hallBackBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.hallKefuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onKefu,this),this.hallQuickBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuick,this),this.headMod.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this),t.App.DataCenter.debugInfo.skipNet||this.headMod.updatePersonalInfo(),this.ctrl.sendRoomNum()},n.prototype.onRemove=function(){this.ctrl.onRemove(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.hallBackBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBack,this),this.hallKefuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onKefu,this),this.hallQuickBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onQuick,this),this.headMod.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onHead,this)},n.prototype.onTap=function(t){t.target!=this.headMod.arrowGroup&&this.headMod.setDiamondVisible(!1)},n.prototype.onBack=function(){var e=this,n=t.App.MessageBoxManager.getBox();n.showMsg("您确定要退出游戏吗?",!0),n.ok=function(){e.ctrl.sendJieSanTest()}},n.prototype.onQuick=function(){var t=this;this.hallQuickBtn.touchEnabled=!1,setTimeout(function(){t.hallQuickBtn.touchEnabled=!0},1e3),this.ctrl.sendQuickBegin()},n.prototype.onKefu=function(){t.HallHttpDataSend.sendGetIncomeSupportMsg()},n.prototype.onHead=function(){},n.prototype.createQuickDb=function(){var t=new dragonBones.EgretFactory;t.parseDragonBonesData(RES.getRes("tpm_NewProject_ske_json")),t.parseTextureAtlasData(RES.getRes("tpm_NewProject_tex_json"),RES.getRes("tpm_NewProject_tex_png")),this.quickDb=t.buildArmatureDisplay("Armature"),this.moveGro.addChild(this.quickDb),this.quickDb.x=667,this.quickDb.y=545},n.prototype.playQuick=function(){this.quickDb||this.createQuickDb(),this.quickDb.animation.play("kuaisukaishi",0)},n.prototype.onTouchBottomBtn=function(e){switch(e){case t.HallBtnMsg.playMethod:t.App.PanelManager.open(t.PanelConst.PlayMethodPanel);break;case t.HallBtnMsg.email:t.HallHttpDataSend.sendGetEmailList();break;case t.HallBtnMsg.share:t.App.PanelManager.open(t.PanelConst.SharePanel);break;case t.HallBtnMsg.shop:t.HallHttpDataSend.sendGetGoodsList();break;case t.HallBtnMsg.set:t.App.PanelManager.open(t.PanelConst.SetPanel);break;default:console.error("hallbtn error")}},n}(t.BaseScene);t.HallScene=e,__reflect(e.prototype,"Tpm.HallScene")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.reconnectFlag=!1,t}return __extends(n,e),n.prototype.onRegister=function(){this.addEvent(t.EventConst.SocketConnect,this.onSocketSuccess,this);var e=t.App.gameSocket;e.register(t.ProtocolHeadRev.R_100002,this.revSocketLogin,this),e.register(t.ProtocolHeadRev.R_100010,this.revReconnect,this)},n.prototype.showLoginDialog=function(){t.App.PanelManager.open(t.PanelConst.LoginPanel,!1,null,null,!0,!0,null)},n.prototype.loginGate=function(){t.App.LoadingLock.addLock("WEB服务登录中..."),this.sendHttpLogin(t.App.DataCenter.debugInfo.account,t.App.DataCenter.debugInfo.password)},n.prototype.sendHttpLogin=function(e,n){var o=new t.HttpSender,r={action:"Login",param:{}};r.param={user:e,password:n},o.post(r,this.revHttpLogin,this)},n.prototype.revHttpLogin=function(e){var n=t.ProtocolHttpData.LoginData;if(n=e,e.ret)t.Tips.showTop(n.desc);else{t.App.LoadingLock.minusLock();var o=n.data,r=new t.UserVO;r.initUserFromHttp(o),t.App.DataCenter.UserInfo.myUserUid=o.uid,t.App.DataCenter.UserInfo.addUser(r),t.App.DataCenter.ServerInfo.MD5PASS=o.password,t.App.DataCenter.ServerInfo.SERVER_URL="ws://"+o.ip+":"+o.port,t.App.DataCenter.debugInfo.skipGameServer?this.sendRoomInfo():(console.log("hhhhhhhhhhhhhhhhh11111:"+!t.App.DataCenter.debugInfo.skipHall),this.connectGameServer())}},n.prototype.sendHttpRegister=function(e,n,o){var r=new t.HttpSender,i={action:"register",param:{}};i.param={user:e,password:n,nickname:o},r.post(i,this.revHttpRegister,this)},n.prototype.revHttpRegister=function(e){var n=t.ProtocolHttpData.LoginData;if(n=e,e.ret)t.Tips.showTop(n.desc);else{t.App.LoadingLock.minusLock();var o=n.data,r=new t.UserVO;r.initUserFromHttp(o),t.App.DataCenter.UserInfo.myUserUid=o.uid,t.App.DataCenter.UserInfo.addUser(r),t.App.DataCenter.ServerInfo.MD5PASS=o.password,t.App.DataCenter.ServerInfo.SERVER_URL="ws://"+o.ip+":"+o.port,t.App.DataCenter.debugInfo.skipGameServer?this.sendRoomInfo():(console.log("hhhhhhhhhhhhhhhhh11111:"+!t.App.DataCenter.debugInfo.skipHall),this.connectGameServer())}},n.prototype.connectGameServer=function(){t.App.LoadingLock.addLock("游戏服务登录中..."),t.App.gameSocket.startConnect(t.App.DataCenter.ServerInfo.SERVER_URL,!0)},n.prototype.onSocketSuccess=function(){this.sendSocketLogin()},n.prototype.sendSocketLogin=function(){var e=t.ProtocolDataSend.S_100002;e.user_id=t.App.DataCenter.UserInfo.myUserUid,e.passwd=t.App.DataCenter.debugInfo.password,t.App.gameSocket.send(t.ProtocolHeadSend.S_100002,e)},n.prototype.revSocketLogin=function(e){var n=t.ProtocolDataRev.R_100002;n=e,200==n.code?(t.App.LoadingLock.minusLock(),n.info.reconnect&&(this.reconnectFlag=!0),this.sendRoomInfo()):t.Tips.showTop(e.desc)},n.prototype.sendRoomInfo=function(){var e=new t.HttpSender,n=t.ProtocolHttp.getRoomInfo;e.sendTest(n,this.revRoomInfo,this)},n.prototype.revRoomInfo=function(e){return e.ret?void console.error("get roominfo fail"):(t.App.DataCenter.roomInfo.initList(e.data.room_cfg_info),void(this.reconnectFlag?(this.sendReconnect(),this.reconnectFlag=!1):(t.App.PanelManager.closeAllPanel(),t.App.SceneManager.runScene(t.SceneConst.HallScene,t.App.getController(t.HallController.NAME)),t.App.SceneManager.getScene(t.SceneConst.HallScene).roomMod.initRoomUI(t.App.DataCenter.roomInfo.roomList))))},n.prototype.sendReconnect=function(){var e=t.ProtocolDataSend.S_100010;e.user_id=t.App.DataCenter.UserInfo.myUserUid,t.App.gameSocket.send(t.ProtocolHeadSend.S_100010,e)},n.prototype.revReconnect=function(e){if(200!=e.code)return void t.Tips.showTop(e.desc);var n=t.ArrayTool.deepCopy(e),o=t.App.SceneManager.runScene(t.SceneConst.GameScene,t.App.getController(t.GameController.NAME));o.reConnect(n)},n}(t.BaseController);e.NAME="LoginController",t.LoginController=e,__reflect(e.prototype,"Tpm.LoginController")}(Tpm||(Tpm={}));var Tpm;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName=TpmSkin.LoginSceneSkin,e}return __extends(e,t),e.prototype.onEnable=function(){this.ctrl.showLoginDialog()},e.prototype.onRemove=function(){this.ctrl.onRemove()},e}(t.BaseScene);t.LoginScene=e,__reflect(e.prototype,"Tpm.LoginScene")}(Tpm||(Tpm={}));var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.addBg()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName},e.prototype.addBg=function(){this.loadBg=new eui.Image,this.loadBg.source=Tpm.ResPathConfig.loadBg,this.addChild(this.loadBg),Tpm.App.LoadingLock.addLock("加载资源中..."),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.startApp,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("all")},e.prototype.startApp=function(){Tpm.App.LoadingLock.minusLock(),Tpm.App.getInstance().startUp()},e}(eui.UILayer);__reflect(Main.prototype,"Main");
